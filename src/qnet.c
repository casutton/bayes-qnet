/* Generated by Cython 0.21.1 */

#define PY_SSIZE_T_CLEAN
#ifndef CYTHON_USE_PYLONG_INTERNALS
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 0
#else
#include "pyconfig.h"
#ifdef PYLONG_BITS_IN_DIGIT
#define CYTHON_USE_PYLONG_INTERNALS 1
#else
#define CYTHON_USE_PYLONG_INTERNALS 0
#endif
#endif
#endif
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03020000)
    #error Cython requires Python 2.6+ or Python 3.2+.
#else
#define CYTHON_ABI "0_21_1"
#include <stddef.h>
#ifndef offsetof
#define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
#define CYTHON_COMPILING_IN_PYPY 1
#define CYTHON_COMPILING_IN_CPYTHON 0
#else
#define CYTHON_COMPILING_IN_PYPY 0
#define CYTHON_COMPILING_IN_CPYTHON 1
#endif
#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600
#define Py_OptimizeFlag 0
#endif
#define __PYX_BUILD_PY_SSIZE_T "n"
#define CYTHON_FORMAT_SSIZE_T "z"
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyClass_Type
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos) \
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyType_Type
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_VERSION_HEX < 0x030400a1 && !defined(Py_TPFLAGS_HAVE_FINALIZE)
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ? \
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
#else
  #define CYTHON_PEP393_ENABLED 0
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
  #define __Pyx_PyFrozenSet_Size(s)         PyObject_Size(s)
#else
  #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ? \
      PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
  #define __Pyx_PyFrozenSet_Size(s)         PySet_Size(s)
#endif
#define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
  #ifndef PyUnicode_InternFromString
    #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
  #endif
#endif
#if PY_VERSION_HEX < 0x030200A4
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : PyInstanceMethod_New(func))
#else
  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
#endif
#ifndef CYTHON_INLINE
  #if defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  /* Initialize NaN. The sign is irrelevant, an exponent with all bits 1 and
   a nonzero mantissa means NaN. If the first bit in the mantissa is 1, it is
   a quiet NaN. */
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif
#ifdef __cplusplus
template<typename T>
void __Pyx_call_destructor(T* x) {
    x->~T();
}
#endif


#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
#define _USE_MATH_DEFINES
#endif
#include <math.h>
#define __PYX_HAVE__qnet
#define __PYX_HAVE_API__qnet
#include "math.h"
#include "randomkit.h"
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#ifdef PYREX_WITHOUT_ASSERTIONS
#define CYTHON_WITHOUT_ASSERTIONS
#endif

#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
typedef struct {PyObject **p; char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry;

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT 0
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (    \
    (sizeof(type) < sizeof(Py_ssize_t))  ||             \
    (sizeof(type) > sizeof(Py_ssize_t) &&               \
          likely(v < (type)PY_SSIZE_T_MAX ||            \
                 v == (type)PY_SSIZE_T_MAX)  &&         \
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||       \
                                v == (type)PY_SSIZE_T_MIN)))  ||  \
    (sizeof(type) == sizeof(Py_ssize_t) &&              \
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||        \
                               v == (type)PY_SSIZE_T_MAX)))  )
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyByteArray_FromString(s) PyByteArray_FromStringAndSize((const char*)s, strlen((const char*)s))
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyObject_AsSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromUString(s)  __Pyx_PyObject_FromString((const char*)s)
#define __Pyx_PyBytes_FromUString(s)   __Pyx_PyBytes_FromString((const char*)s)
#define __Pyx_PyByteArray_FromUString(s)   __Pyx_PyByteArray_FromString((const char*)s)
#define __Pyx_PyStr_FromUString(s)     __Pyx_PyStr_FromString((const char*)s)
#define __Pyx_PyUnicode_FromUString(s) __Pyx_PyUnicode_FromString((const char*)s)
#if PY_MAJOR_VERSION < 3
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
{
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return (size_t)(u_end - u - 1);
}
#else
#define __Pyx_Py_UNICODE_strlen Py_UNICODE_strlen
#endif
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_Owned_Py_None(b) (Py_INCREF(Py_None), Py_None)
#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
#if CYTHON_COMPILING_IN_CPYTHON
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    const char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    if (strcmp(default_encoding_c, "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (!ascii_chars_u) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
        Py_DECREF(ascii_chars_u);
        Py_DECREF(ascii_chars_b);
    }
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c));
    if (!__PYX_DEFAULT_STRING_ENCODING) goto bad;
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


/* Test for GCC > 2.95 */
#if defined(__GNUC__)     && (__GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)))
  #define likely(x)   __builtin_expect(!!(x), 1)
  #define unlikely(x) __builtin_expect(!!(x), 0)
#else /* !__GNUC__ or GCC < 2.95 */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */

static PyObject *__pyx_m;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;


static const char *__pyx_f[] = {
  "qnet.pyx",
  "qnet.pxd",
  "distributions.pxd",
  "pwfun.pxd",
  "queues.pxd",
  "arrivals.pxd",
};

/*--- Type declarations ---*/
struct __pyx_obj_13distributions_Distribution;
struct __pyx_obj_5pwfun_Pwfun;
struct __pyx_obj_5pwfun_Pwlin;
struct __pyx_obj_6queues_FactorTemplate;
struct __pyx_obj_6queues_Queue;
struct __pyx_obj_8arrivals_Vars;
struct __pyx_obj_8arrivals_Event;
struct __pyx_obj_8arrivals_Arrivals;
struct __pyx_obj_4qnet_Qnet;
struct __pyx_obj_4qnet_GGkGibbs;

/* "qnet.pyx":8
 *     enum: INFINITY
 * 
 * cdef enum:             # <<<<<<<<<<<<<<
 *     DEBUG = 0
 *     DEBUG_RTP = 0
 */
enum  {
  __pyx_e_4qnet_DEBUG = 0,
  __pyx_e_4qnet_DEBUG_RTP = 0,
  __pyx_e_4qnet_DEBUG_INITIAL = 0
};

/* "qnet.pyx":13
 *     DEBUG_INITIAL = 0
 * 
 * cdef enum:             # <<<<<<<<<<<<<<
 *     SEC_ARRIVAL = 0
 *     SEC_CLEAR = 1
 */
enum  {
  __pyx_e_4qnet_SEC_ARRIVAL = 0,
  __pyx_e_4qnet_SEC_CLEAR = 1,
  __pyx_e_4qnet_SEC_DEPARTURE = 2
};

/* "qnet.pyx":56
 * 
 * # configuration: need to expose in a better way
 * cdef enum SamplingType:             # <<<<<<<<<<<<<<
 *     ARS_PWFUN = 0
 *     SLICE_PWFUN = 1
 */
enum __pyx_t_4qnet_SamplingType {
  __pyx_e_4qnet_ARS_PWFUN = 0,
  __pyx_e_4qnet_SLICE_PWFUN = 1,
  __pyx_e_4qnet_SLICE = 2,
  __pyx_e_4qnet_STUPID_REJECT = 3
};

/* "distributions.pxd":1
 * cdef class Distribution:             # <<<<<<<<<<<<<<
 *     cdef double _lpdf (self, double x)
 *     cdef double _mean (self)
 */
struct __pyx_obj_13distributions_Distribution {
  PyObject_HEAD
  struct __pyx_vtabstruct_13distributions_Distribution *__pyx_vtab;
};

struct __pyx_obj_5pwfun_Pwfun {
  PyObject_HEAD
  struct __pyx_vtabstruct_5pwfun_Pwfun *__pyx_vtab;
  PyObject *xs;
  PyObject *derivs;
  PyObject *fns;
  int N;
  PyObject *OOR;
};


/* "pwfun.pxd":16
 * 
 * 
 * cdef class Pwlin:             # <<<<<<<<<<<<<<
 *     cdef object xs      # Points at which slope changes xs[0] is lower bound xs[-1] upper
 *     cdef object x_tan   # Points at which the tangent is taken.
 */
struct __pyx_obj_5pwfun_Pwlin {
  PyObject_HEAD
  struct __pyx_vtabstruct_5pwfun_Pwlin *__pyx_vtab;
  PyObject *xs;
  PyObject *x_tan;
  PyObject *heights;
  PyObject *derivs;
  PyObject *f;
  PyObject *fprime;
};


/* "queues.pxd":12
 * cdef Pwfun _departure_proposal (Arrivals arrv, Event e0)
 * 
 * cdef class FactorTemplate:             # <<<<<<<<<<<<<<
 *     cdef object estimate (self, evtl)
 *     cdef object serviceLikelihood (self, Event evt)
 */
struct __pyx_obj_6queues_FactorTemplate {
  PyObject_HEAD
  struct __pyx_vtabstruct_6queues_FactorTemplate *__pyx_vtab;
};


/* "queues.pxd":1
 * cdef class Queue             # <<<<<<<<<<<<<<
 * 
 * from distributions cimport Distribution
 */
struct __pyx_obj_6queues_Queue {
  PyObject_HEAD
  struct __pyx_vtabstruct_6queues_Queue *__pyx_vtab;
  PyObject *name;
  struct __pyx_obj_6queues_FactorTemplate *service;
};


/* "arrivals.pxd":8
 * cimport cython
 * 
 * cdef class Vars:             # <<<<<<<<<<<<<<
 *     cdef object map
 * 
 */
struct __pyx_obj_8arrivals_Vars {
  PyObject_HEAD
  PyObject *map;
};


/* "arrivals.pxd":1
 * cdef class Event             # <<<<<<<<<<<<<<
 * cdef class Arrivals
 * 
 */
struct __pyx_obj_8arrivals_Event {
  PyObject_HEAD
  struct __pyx_vtabstruct_8arrivals_Event *__pyx_vtab;
  int eid;
  int tid;
  struct __pyx_obj_6queues_Queue *q;
  int qid;
  int state;
  double a;
  double s;
  double c;
  double d;
  int obs_a;
  int obs_d;
  PyObject *prev_byt;
  PyObject *next_byt;
  PyObject *prev_byq;
  PyObject *next_byq;
  PyObject *arrv;
  int proc;
  int num_proc;
  double d_prev;
  double *d_proc_prev;
  struct __pyx_obj_8arrivals_Vars *auxiliaries;
};


/* "arrivals.pxd":2
 * cdef class Event
 * cdef class Arrivals             # <<<<<<<<<<<<<<
 * 
 * from queues cimport Queue
 */
struct __pyx_obj_8arrivals_Arrivals {
  PyObject_HEAD
  struct __pyx_vtabstruct_8arrivals_Arrivals *__pyx_vtab;
  struct __pyx_obj_4qnet_Qnet *net;
  PyObject *byq;
  PyObject *final_byq;
  PyObject *byt;
  PyObject *events;
  PyObject *_initial_events;
  PyObject *queue_orders;
  PyObject *ninq;
  PyObject *inq;
  PyObject *a2e_cache;
  PyObject *c2e_cache;
  int cap;
};


/* "qnet.pxd":1
 * cdef class Qnet             # <<<<<<<<<<<<<<
 * 
 * from arrivals cimport Arrivals
 */
struct __pyx_obj_4qnet_Qnet {
  PyObject_HEAD
  struct __pyx_vtabstruct_4qnet_Qnet *__pyx_vtab;
  PyObject *queues;
  PyObject *templates;
  PyObject *fsm;
  PyObject *universe;
  PyObject *qname2id;
  PyObject *sname2id;
  int eidx;
};


/* "qnet.pyx":141
 * INITIAL_STATE = 0
 * 
 * cdef class GGkGibbs             # <<<<<<<<<<<<<<
 * 
 * cdef class Qnet:
 */
struct __pyx_obj_4qnet_GGkGibbs {
  PyObject_HEAD
  double lik0;
  struct __pyx_obj_8arrivals_Event *evt;
  struct __pyx_obj_8arrivals_Event *evt_next;
  struct __pyx_obj_8arrivals_Arrivals *arrv;
  struct __pyx_obj_4qnet_Qnet *net;
};



/* "distributions.pxd":1
 * cdef class Distribution:             # <<<<<<<<<<<<<<
 *     cdef double _lpdf (self, double x)
 *     cdef double _mean (self)
 */

struct __pyx_vtabstruct_13distributions_Distribution {
  double (*_lpdf)(struct __pyx_obj_13distributions_Distribution *, double);
  double (*_mean)(struct __pyx_obj_13distributions_Distribution *);
  PyObject *(*_sample)(struct __pyx_obj_13distributions_Distribution *, int);
  PyObject *(*_estimate)(struct __pyx_obj_13distributions_Distribution *, PyObject *);
  double (*_dx_lpdf)(struct __pyx_obj_13distributions_Distribution *, double);
  double (*_quantile)(struct __pyx_obj_13distributions_Distribution *, double);
};
static struct __pyx_vtabstruct_13distributions_Distribution *__pyx_vtabptr_13distributions_Distribution;


struct __pyx_vtabstruct_5pwfun_Pwfun {
  double (*value)(struct __pyx_obj_5pwfun_Pwfun *, double);
  int (*_find_knot)(struct __pyx_obj_5pwfun_Pwfun *, double);
  double (*L)(struct __pyx_obj_5pwfun_Pwfun *);
  double (*U)(struct __pyx_obj_5pwfun_Pwfun *);
};
static struct __pyx_vtabstruct_5pwfun_Pwfun *__pyx_vtabptr_5pwfun_Pwfun;


/* "pwfun.pxd":16
 * 
 * 
 * cdef class Pwlin:             # <<<<<<<<<<<<<<
 *     cdef object xs      # Points at which slope changes xs[0] is lower bound xs[-1] upper
 *     cdef object x_tan   # Points at which the tangent is taken.
 */

struct __pyx_vtabstruct_5pwfun_Pwlin {
  double (*value)(struct __pyx_obj_5pwfun_Pwlin *, double);
  PyObject *(*c_argmin)(struct __pyx_obj_5pwfun_Pwlin *, double);
};
static struct __pyx_vtabstruct_5pwfun_Pwlin *__pyx_vtabptr_5pwfun_Pwlin;


/* "queues.pxd":1
 * cdef class Queue             # <<<<<<<<<<<<<<
 * 
 * from distributions cimport Distribution
 */

struct __pyx_vtabstruct_6queues_Queue {
  struct __pyx_obj_5pwfun_Pwfun *(*arrivalLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  struct __pyx_obj_5pwfun_Pwfun *(*departureLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  double (*allEventLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *);
  PyObject *(*diffListForArrival)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  PyObject *(*diffListForDeparture)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  double (*likelihoodDelta)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, PyObject *, int __pyx_skip_dispatch);
  PyObject *(*recompute_service)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  PyObject *(*recompute_departure)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  double (*departure_of_service)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  double (*service_lpdf)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_6queues_Queue *__pyx_vtabptr_6queues_Queue;


/* "queues.pxd":12
 * cdef Pwfun _departure_proposal (Arrivals arrv, Event e0)
 * 
 * cdef class FactorTemplate:             # <<<<<<<<<<<<<<
 *     cdef object estimate (self, evtl)
 *     cdef object serviceLikelihood (self, Event evt)
 */

struct __pyx_vtabstruct_6queues_FactorTemplate {
  PyObject *(*estimate)(struct __pyx_obj_6queues_FactorTemplate *, PyObject *);
  PyObject *(*serviceLikelihood)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*serviceDerivative)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  void (*resample_auxiliaries)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  void (*initialize_auxiliaries)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
};
static struct __pyx_vtabstruct_6queues_FactorTemplate *__pyx_vtabptr_6queues_FactorTemplate;


/* "arrivals.pxd":1
 * cdef class Event             # <<<<<<<<<<<<<<
 * cdef class Arrivals
 * 
 */

struct __pyx_vtabstruct_8arrivals_Event {
  PyObject *(*set_service)(struct __pyx_obj_8arrivals_Event *, double);
  PyObject *(*set_departure)(struct __pyx_obj_8arrivals_Event *, double);
  struct __pyx_obj_8arrivals_Event *(*duplicate)(struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  struct __pyx_obj_8arrivals_Event *(*dup_with_structure)(struct __pyx_obj_8arrivals_Event *);
  int (*update_from_solution)(struct __pyx_obj_8arrivals_Event *, PyObject *);
  PyObject *(*copy_dtimes)(struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*init_dtimes)(struct __pyx_obj_8arrivals_Event *);
  struct __pyx_obj_8arrivals_Event *(*_dup_inner)(struct __pyx_obj_8arrivals_Event *, int);
};
static struct __pyx_vtabstruct_8arrivals_Event *__pyx_vtabptr_8arrivals_Event;


/* "arrivals.pxd":2
 * cdef class Event
 * cdef class Arrivals             # <<<<<<<<<<<<<<
 * 
 * from queues cimport Queue
 */

struct __pyx_vtabstruct_8arrivals_Arrivals {
  struct __pyx_obj_8arrivals_Event *(*event)(struct __pyx_obj_8arrivals_Arrivals *, int, int __pyx_skip_dispatch);
  int (*num_events)(struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch);
  PyObject *(*_is_initial)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*_is_final)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
};
static struct __pyx_vtabstruct_8arrivals_Arrivals *__pyx_vtabptr_8arrivals_Arrivals;


/* "qnet.pyx":143
 * cdef class GGkGibbs
 * 
 * cdef class Qnet:             # <<<<<<<<<<<<<<
 * 
 *     def __init__ (self, queues, templates, universe, qname2id, sname2id, fsm):
 */

struct __pyx_vtabstruct_4qnet_Qnet {
  int (*gibbs_resample_final)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  int (*gibbs_resample_pair)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *);
  double (*determine_upper)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*dfn_range)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  double (*log_prob)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_4qnet_Qnet *__pyx_vtabptr_4qnet_Qnet;
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          if (acquire_gil) { \
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure(); \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
              PyGILState_Release(__pyx_gilstate_save); \
          } else { \
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__); \
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil) \
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext() \
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif
#define __Pyx_XDECREF_SET(r, v) do {                            \
        PyObject *tmp = (PyObject *) r;                         \
        r = v; __Pyx_XDECREF(tmp);                              \
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {                             \
        PyObject *tmp = (PyObject *) r;                         \
        r = v; __Pyx_DECREF(tmp);                               \
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

static PyObject *__Pyx_GetBuiltinName(PyObject *name);

#include <string.h>

static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);

static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);

#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
#else
#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
#endif

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
#else
#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
#endif

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb);
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb);

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
#endif

static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
#else
#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
#endif

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
#define __Pyx_PyCallable_Check(obj)   ((obj)->ob_type->tp_call != NULL)
#else
#define __Pyx_PyCallable_Check(obj)   PyCallable_Check(obj)
#endif

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name);

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);

static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[], \
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args, \
    const char* function_name);

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyString_Join __Pyx_PyBytes_Join
#define __Pyx_PyBaseString_Join(s, v) (PyUnicode_CheckExact(s) ? PyUnicode_Join(s, v) : __Pyx_PyBytes_Join(s, v))
#else
#define __Pyx_PyString_Join PyUnicode_Join
#define __Pyx_PyBaseString_Join PyUnicode_Join
#endif
#if CYTHON_COMPILING_IN_CPYTHON
    #if PY_MAJOR_VERSION < 3
    #define __Pyx_PyBytes_Join _PyString_Join
    #else
    #define __Pyx_PyBytes_Join _PyBytes_Join
    #endif
#else
static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values);
#endif

#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck) \
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ? \
    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) : \
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) : \
               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck) \
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ? \
    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) : \
    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck) \
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ? \
    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) : \
    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);

static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x);

static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact);

static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);

static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

static CYTHON_INLINE int __Pyx_IterFinish(void);

static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);

static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);

static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);

static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index);

static CYTHON_INLINE int __Pyx_unpack_tuple2(PyObject* tuple, PyObject** value1, PyObject** value2,
                                             int is_tuple, int has_known_size, int decref_tuple);

static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_is_dict);
static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);

static CYTHON_INLINE int __Pyx_PySequence_Contains(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t, Py_ssize_t); /* proto */

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb);
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb);

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);

#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o,n,NULL)
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_setattro))
        return tp->tp_setattro(obj, attr_name, value);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_setattr))
        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
#endif
    return PyObject_SetAttr(obj, attr_name, value);
}
#else
#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
#endif

static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);

static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                  int lineno, const char *filename,
                                  int full_traceback);

static CYTHON_INLINE int __Pyx_PyList_Extend(PyObject* L, PyObject* v) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject* none = _PyList_Extend((PyListObject*)L, v);
    if (unlikely(!none))
        return -1;
    Py_DECREF(none);
    return 0;
#else
    return PyList_SetSlice(L, PY_SSIZE_T_MAX, PY_SSIZE_T_MAX, v);
#endif
}

#define __Pyx_PyObject_PopIndex(L, ix, is_signed, type, to_py_func) ( \
    (PyList_CheckExact(L) && __Pyx_fits_Py_ssize_t(ix, type, is_signed)) ? \
        __Pyx__PyList_PopIndex(L, ix) : __Pyx__PyObject_PopIndex(L, to_py_func(ix)))
#define __Pyx_PyList_PopIndex(L, ix, is_signed, type, to_py_func) ( \
    __Pyx_fits_Py_ssize_t(ix, type, is_signed) ? \
        __Pyx__PyList_PopIndex(L, ix) : __Pyx__PyObject_PopIndex(L, to_py_func(ix)))
static PyObject* __Pyx__PyList_PopIndex(PyObject* L, Py_ssize_t ix);
static PyObject* __Pyx__PyObject_PopIndex(PyObject* L, PyObject* py_ix);

static CYTHON_INLINE int __Pyx_PyDict_Contains(PyObject* item, PyObject* dict, int eq) {
    int result = PyDict_Contains(dict, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck) \
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ? \
    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) : \
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) : \
               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
static CYTHON_INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck);

static int __Pyx_SetVtable(PyObject *dict, void *vtable);

static void* __Pyx_GetVtable(PyObject *dict);

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);

typedef struct {
    int code_line;
    PyCodeObject* code_object;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename);

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);

static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

static int __Pyx_Print(PyObject*, PyObject *, int);
#if CYTHON_COMPILING_IN_PYPY || PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

static int __Pyx_PrintOne(PyObject* stream, PyObject *o);

static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

static int __Pyx_check_binary_version(void);

#if !defined(__Pyx_PyIdentifier_FromString)
#if PY_MAJOR_VERSION < 3
  #define __Pyx_PyIdentifier_FromString(s) PyString_FromString(s)
#else
  #define __Pyx_PyIdentifier_FromString(s) PyUnicode_FromString(s)
#endif
#endif

static PyObject *__Pyx_ImportModule(const char *name);

static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, size_t size, int strict);

static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig);

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);

static int __pyx_f_4qnet_4Qnet_gibbs_resample_final(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto*/
static int __pyx_f_4qnet_4Qnet_gibbs_resample_pair(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_e0, struct __pyx_obj_8arrivals_Event *__pyx_v_e1); /* proto*/
static double __pyx_f_4qnet_4Qnet_determine_upper(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto*/
static PyObject *__pyx_f_4qnet_4Qnet_dfn_range(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto*/
static double __pyx_f_4qnet_4Qnet_log_prob(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, int __pyx_skip_dispatch); /* proto*/

/* Module declarations from 'distributions' */
static PyTypeObject *__pyx_ptype_13distributions_Distribution = 0;

/* Module declarations from 'pwfun' */
static PyTypeObject *__pyx_ptype_5pwfun_Pwfun = 0;
static PyTypeObject *__pyx_ptype_5pwfun_Pwlin = 0;

/* Module declarations from 'queues' */
static PyTypeObject *__pyx_ptype_6queues_Queue = 0;
static PyTypeObject *__pyx_ptype_6queues_FactorTemplate = 0;
static struct __pyx_obj_5pwfun_Pwfun *(*__pyx_f_6queues__pair_proposal)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *); /*proto*/
static struct __pyx_obj_5pwfun_Pwfun *(*__pyx_f_6queues__departure_proposal)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *); /*proto*/

/* Module declarations from 'cython' */

/* Module declarations from 'arrivals' */
static PyTypeObject *__pyx_ptype_8arrivals_Event = 0;
static PyTypeObject *__pyx_ptype_8arrivals_Arrivals = 0;
static PyTypeObject *__pyx_ptype_8arrivals_Vars = 0;

/* Module declarations from 'sampling' */
static double (*__pyx_f_8sampling__slice)(double, PyObject *, double, double); /*proto*/
static double (*__pyx_f_8sampling__slice_pwfun)(struct __pyx_obj_5pwfun_Pwfun *, double); /*proto*/
static double (*__pyx_f_8sampling_rand)(void); /*proto*/
static double (*__pyx_f_8sampling_uniform)(double, double); /*proto*/
static double (*__pyx_f_8sampling_exponential)(double); /*proto*/

/* Module declarations from 'misc' */
static double (*__pyx_f_4misc__integrate)(PyObject *, double, double); /*proto*/

/* Module declarations from 'qnet' */
static PyTypeObject *__pyx_ptype_4qnet_Qnet = 0;
static PyTypeObject *__pyx_ptype_4qnet_GGkGibbs = 0;
static int __pyx_v_4qnet_doUseRtp;
static enum __pyx_t_4qnet_SamplingType __pyx_v_4qnet_sampler;
static int __pyx_v_4qnet_BRUTE_FORCE_RATIO;
static PyObject *__pyx_v_4qnet_initializer = 0;
static int __pyx_v_4qnet_is_slice_sorted;
static int __pyx_v_4qnet_nreject;
static int __pyx_v_4qnet_nevents;
static int __pyx_v_4qnet_nrtp_reject;
static int __pyx_v_4qnet_nrtp_calls;
static int __pyx_v_4qnet_diff_len;
static int __pyx_v_4qnet_num_diff;
static PyObject *__pyx_f_4qnet_setup_initialization_lp(struct __pyx_obj_8arrivals_Arrivals *, PyObject *); /*proto*/
static PyObject *__pyx_f_4qnet_format_six(struct __pyx_obj_8arrivals_Event *); /*proto*/
static double __pyx_f_4qnet_call_sampler(struct __pyx_obj_5pwfun_Pwfun *, double); /*proto*/
static double __pyx_f_4qnet_apply_departure(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, double, double, int __pyx_skip_dispatch); /*proto*/
#define __Pyx_MODULE_NAME "qnet"
int __pyx_module_is_main_qnet = 0;

/* Implementation of 'qnet' */
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_xrange;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_builtin_NotImplementedError;
static PyObject *__pyx_builtin_max;
static PyObject *__pyx_builtin_map;
static PyObject *__pyx_builtin_open;
static PyObject *__pyx_pf_4qnet_set_sampler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_str); /* proto */
static PyObject *__pyx_pf_4qnet_2set_use_rtp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_doitp); /* proto */
static PyObject *__pyx_pf_4qnet_4set_initialization_type(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_type); /* proto */
static PyObject *__pyx_pf_4qnet_6get_initializer(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_4qnet_8set_slice_sorted(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val); /* proto */
static PyObject *__pyx_pf_4qnet_10reset_stats(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_4qnet_12stats(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static int __pyx_pf_4qnet_4Qnet___init__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_queues, PyObject *__pyx_v_templates, PyObject *__pyx_v_universe, PyObject *__pyx_v_qname2id, PyObject *__pyx_v_sname2id, PyObject *__pyx_v_fsm); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_2as_yaml(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_4as_xml(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_6sample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_n); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_8sample_by_time(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_T); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_10_sample_discrete_events(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_heap, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_obs); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_12num_queues(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_14num_states(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_16get_fsm(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_18sid_by_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sname); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_20sid_to_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sid); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_22queues_of_state(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sid); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_24qid_of_queue(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_queue); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_26queue_by_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_qname); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_28all_queues(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_30all_templates(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_32gibbs_resample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrv, PyObject *__pyx_v_burn, PyObject *__pyx_v_num_iter, PyObject *__pyx_v_report_fn, PyObject *__pyx_v_return_arrv, PyObject *__pyx_v_sample_final); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_34gibbs_for_departure(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_36gibbs_initialize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a, CYTHON_UNUSED PyObject *__pyx_v_samplePaths); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_38gibbs_initialize_via_mmk(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_40markovize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_42markovize_from_arrivals(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_44demarkovize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_old_tmpls); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_46gibbs_initialize_via_rejection(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_48slice_resample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, int __pyx_v_num_iter, PyObject *__pyx_v_report_fn, PyObject *__pyx_v_return_arrv, PyObject *__pyx_v_reverse, PyObject *__pyx_v_return_lp); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_50gibbs_kernel(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_from, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_to, double __pyx_v_lik); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_52parameter_kernel(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_theta_from, PyObject *__pyx_v_theta_to, PyObject *__pyx_v_arrvl); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_54estimate(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrvl); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_56estimate_from_obs(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_58estimate_from_events(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_evts); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_60sample_parameters(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrvl); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_10parameters___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static int __pyx_pf_4qnet_4Qnet_10parameters_2__set__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_v); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_62remove_task_proposal(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_old); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_64sample_path(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_66log_prob(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_6queues___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_9templates___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_3fsm___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_8universe___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_8qname2id___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_8sname2id___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_4Qnet_4eidx___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_14is_sampled_by_task(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_16has_tau(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_18create_qp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, CYTHON_UNUSED PyObject *__pyx_v_reg); /* proto */
static PyObject *__pyx_pf_4qnet_20compute_obs_means(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_22compute_obs_mean_ia(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_24compute_mean_ia(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_26sorted_uniforms(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_n, PyObject *__pyx_v_L, PyObject *__pyx_v_U); /* proto */
static PyObject *__pyx_pf_4qnet_28setup_minilp(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_reg); /* proto */
static PyObject *__pyx_pf_4qnet_30astr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_32dstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_34compactify_soln(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv, PyObject *__pyx_v_soln); /* proto */
static PyObject *__pyx_pf_4qnet_36_compute_task_order(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_38display_diff_list(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_e, PyObject *__pyx_v_diff_list); /* proto */
static PyObject *__pyx_pf_4qnet_40any_zero_service(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_diff_list); /* proto */
static int __pyx_pf_4qnet_8GGkGibbs___init__(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_lik0); /* proto */
static PyObject *__pyx_pf_4qnet_8GGkGibbs_2inner_dfun(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, double __pyx_v_d); /* proto */
static PyObject *__pyx_pf_4qnet_8GGkGibbs_4dfn(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_4qnet_8GGkGibbs_6integrate(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, PyObject *__pyx_v_C); /* proto */
static PyObject *__pyx_pf_4qnet_8GGkGibbs_8add_points(CYTHON_UNUSED struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, PyObject *__pyx_v_points, struct __pyx_obj_8arrivals_Event *__pyx_v_e0, double __pyx_v_lower, double __pyx_v_upper, PyObject *__pyx_v_fn); /* proto */
static PyObject *__pyx_pf_4qnet_42gibbs_initialize_via_dfn1(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_44gibbs_initialize_via_dfn2(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_46gibbs_initialize_via_dfn3(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_48insert_implied_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_50initialize_inserting_implied_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_52gibbs_initialize_via_dfn(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_scale); /* proto */
static PyObject *__pyx_pf_4qnet_54init_insert_observed_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result, PyObject *__pyx_v_add_initial); /* proto */
static PyObject *__pyx_pf_4qnet_56init_add_initial_events(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result); /* proto */
static PyObject *__pyx_pf_4qnet_58gibbs_initialize_via_order(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_60gibbs_initialize_for_gg1r(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_62diff_list_definitely_bad(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, PyObject *__pyx_v_arrv, PyObject *__pyx_v_q, PyObject *__pyx_v_diff_list); /* proto */
static PyObject *__pyx_pf_4qnet_64sample_d_until_acceptance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, PyObject *__pyx_v_service_only, PyObject *__pyx_v_scale); /* proto */
static PyObject *__pyx_pf_4qnet_66heap_from_arrivals(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_68gibbs_initialize_via_lp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in); /* proto */
static PyObject *__pyx_pf_4qnet_70visualize_initialization_lp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_72gibbs_initialize_via_minilp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in); /* proto */
static PyObject *__pyx_pf_4qnet_74estimate_minilp_params(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_76gibbs_initialize_for_ps(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_78null_initializer(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, PyObject *__pyx_v_arrv); /* proto */
static PyObject *__pyx_pf_4qnet_80get_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_82get_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_4qnet_84apply_departure(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_d, double __pyx_v_lik); /* proto */
static PyObject *__pyx_tp_new_4qnet_Qnet(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_4qnet_GGkGibbs(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static char __pyx_k_[] = ",";
static char __pyx_k_C[] = "C";
static char __pyx_k_L[] = "L";
static char __pyx_k_N[] = "N";
static char __pyx_k_U[] = "U";
static char __pyx_k_Z[] = "Z";
static char __pyx_k_a[] = "a";
static char __pyx_k_d[] = "d";
static char __pyx_k_e[] = "e";
static char __pyx_k_f[] = "f";
static char __pyx_k_i[] = "i";
static char __pyx_k_j[] = "j";
static char __pyx_k_k[] = "k";
static char __pyx_k_l[] = "l";
static char __pyx_k_n[] = "n";
static char __pyx_k_q[] = "q";
static char __pyx_k_s[] = "s";
static char __pyx_k_v[] = "v";
static char __pyx_k_w[] = "w";
static char __pyx_k_LP[] = "LP";
static char __pyx_k_Ns[] = "Ns";
static char __pyx_k_PS[] = "PS";
static char __pyx_k_QP[] = "QP";
static char __pyx_k__2[] = "\n";
static char __pyx_k__3[] = "  ";
static char __pyx_k_d0[] = "d0";
static char __pyx_k_e0[] = "e0";
static char __pyx_k_fn[] = "fn";
static char __pyx_k_lp[] = "lp";
static char __pyx_k_ne[] = "ne";
static char __pyx_k_nh[] = "nh";
static char __pyx_k_nt[] = "nt";
static char __pyx_k_q0[] = "q0";
static char __pyx_k_qp[] = "qp";
static char __pyx_k_10f[] = "%.10f";
static char __pyx_k_Huh[] = "Huh?";
static char __pyx_k_RTP[] = "RTP";
static char __pyx_k__13[] = "+++++++++++++++++";
static char __pyx_k__27[] = "=================";
static char __pyx_k__28[] = "::::::::::::::::::::::::::";
static char __pyx_k__30[] = "***********";
static char __pyx_k__33[] = "}\n";
static char __pyx_k_a_d[] = "a[%d]";
static char __pyx_k_add[] = "add";
static char __pyx_k_aux[] = "aux";
static char __pyx_k_byq[] = "byq";
static char __pyx_k_byt[] = "byt";
static char __pyx_k_d_d[] = "d[%d]";
static char __pyx_k_dfn[] = "dfn";
static char __pyx_k_dup[] = "dup";
static char __pyx_k_eid[] = "eid";
static char __pyx_k_end[] = "end";
static char __pyx_k_eps[] = "eps";
static char __pyx_k_evt[] = "evt";
static char __pyx_k_exp[] = "exp";
static char __pyx_k_fsm[] = "fsm";
static char __pyx_k_get[] = "get";
static char __pyx_k_hmm[] = "hmm";
static char __pyx_k_inf[] = "inf";
static char __pyx_k_key[] = "key";
static char __pyx_k_lik[] = "lik";
static char __pyx_k_map[] = "map";
static char __pyx_k_max[] = "max";
static char __pyx_k_net[] = "net";
static char __pyx_k_obs[] = "obs";
static char __pyx_k_pop[] = "pop";
static char __pyx_k_qid[] = "qid";
static char __pyx_k_reg[] = "reg";
static char __pyx_k_s_s[] = "%s %s";
static char __pyx_k_sid[] = "sid";
static char __pyx_k_str[] = "str";
static char __pyx_k_sys[] = "sys";
static char __pyx_k_tid[] = "tid";
static char __pyx_k_val[] = "val";
static char __pyx_k_was[] = "was";
static char __pyx_k_DFN1[] = "DFN1";
static char __pyx_k_DFN2[] = "DFN2";
static char __pyx_k_NONE[] = "NONE";
static char __pyx_k_TIDS[] = "TIDS:";
static char __pyx_k_arrv[] = "arrv";
static char __pyx_k_astr[] = "astr";
static char __pyx_k_burn[] = "burn";
static char __pyx_k_dstr[] = "dstr";
static char __pyx_k_dump[] = "dump";
static char __pyx_k_elem[] = "elem";
static char __pyx_k_evt0[] = "evt0";
static char __pyx_k_evt1[] = "evt1";
static char __pyx_k_evt2[] = "evt2";
static char __pyx_k_evts[] = "evts";
static char __pyx_k_file[] = "file";
static char __pyx_k_heap[] = "heap";
static char __pyx_k_join[] = "join";
static char __pyx_k_lik0[] = "lik0";
static char __pyx_k_main[] = "__main__";
static char __pyx_k_math[] = "math";
static char __pyx_k_mean[] = "mean";
static char __pyx_k_misc[] = "misc";
static char __pyx_k_mu_s[] = "mu_s";
static char __pyx_k_name[] = "name";
static char __pyx_k_open[] = "open";
static char __pyx_k_path[] = "path";
static char __pyx_k_proc[] = "proc";
static char __pyx_k_qnet[] = "qnet";
static char __pyx_k_rate[] = "rate";
static char __pyx_k_soln[] = "soln";
static char __pyx_k_sort[] = "sort";
static char __pyx_k_test[] = "__test__";
static char __pyx_k_thin[] = "thin";
static char __pyx_k_tid0[] = "tid0";
static char __pyx_k_tid1[] = "tid1";
static char __pyx_k_tid2[] = "tid2";
static char __pyx_k_tots[] = "tots";
static char __pyx_k_type[] = "type";
static char __pyx_k_wait[] = "wait";
static char __pyx_k_yaml[] = "yaml";
static char __pyx_k_D_NEW[] = "D_NEW ";
static char __pyx_k_EID_d[] = "EID: %d\n";
static char __pyx_k_Huh_s[] = "Huh? %s";
static char __pyx_k_Ratio[] = "Ratio: ";
static char __pyx_k_SLICE[] = "SLICE";
static char __pyx_k_TAU_d[] = "TAU%d";
static char __pyx_k_arrvl[] = "arrvl";
static char __pyx_k_close[] = "close";
static char __pyx_k_d_max[] = "d_max";
static char __pyx_k_d_new[] = "d_new";
static char __pyx_k_d_old[] = "d_old";
static char __pyx_k_delta[] = "delta";
static char __pyx_k_dists[] = "dists";
static char __pyx_k_doitp[] = "doitp";
static char __pyx_k_event[] = "event";
static char __pyx_k_heapq[] = "heapq";
static char __pyx_k_ievts[] = "ievts";
static char __pyx_k_index[] = "index";
static char __pyx_k_inner[] = "inner";
static char __pyx_k_isinf[] = "isinf";
static char __pyx_k_lower[] = "lower";
static char __pyx_k_numpy[] = "numpy";
static char __pyx_k_obs_a[] = "obs_a";
static char __pyx_k_obs_d[] = "obs_d";
static char __pyx_k_order[] = "order";
static char __pyx_k_print[] = "print";
static char __pyx_k_pwfun[] = "pwfun";
static char __pyx_k_queue[] = "queue";
static char __pyx_k_range[] = "range";
static char __pyx_k_s_17g[] = "%s %.17g";
static char __pyx_k_s_new[] = "s_new";
static char __pyx_k_scale[] = "scale";
static char __pyx_k_scipy[] = "scipy";
static char __pyx_k_slice[] = "slice";
static char __pyx_k_solve[] = "solve";
static char __pyx_k_stats[] = "stats";
static char __pyx_k_tasks[] = "tasks";
static char __pyx_k_times[] = "times";
static char __pyx_k_unobs[] = "unobs";
static char __pyx_k_upper[] = "upper";
static char __pyx_k_write[] = "write";
static char __pyx_k_INIT_s[] = "INIT  %s\n";
static char __pyx_k_MINILP[] = "MINILP";
static char __pyx_k_append[] = "append";
static char __pyx_k_arrvls[] = "arrvls";
static char __pyx_k_bisect[] = "bisect";
static char __pyx_k_d_last[] = "d_last";
static char __pyx_k_d_prev[] = "d_prev";
static char __pyx_k_expify[] = "expify";
static char __pyx_k_extend[] = "extend";
static char __pyx_k_import[] = "__import__";
static char __pyx_k_insert[] = "insert";
static char __pyx_k_insort[] = "insort";
static char __pyx_k_last_a[] = "last_a";
static char __pyx_k_name_s[] = "  - name: %s\n";
static char __pyx_k_points[] = "points";
static char __pyx_k_qstats[] = "qstats";
static char __pyx_k_queues[] = "queues";
static char __pyx_k_random[] = "random";
static char __pyx_k_remove[] = "remove";
static char __pyx_k_report[] = "report";
static char __pyx_k_result[] = "result";
static char __pyx_k_s_next[] = "s_next";
static char __pyx_k_s_true[] = "s_true";
static char __pyx_k_states[] = "states:\n";
static char __pyx_k_stdout[] = "stdout";
static char __pyx_k_to_fix[] = "to_fix";
static char __pyx_k_xrange[] = "xrange";
static char __pyx_k_EID_d_s[] = "    EID: %d\n%s";
static char __pyx_k_Ratio_2[] = "Ratio";
static char __pyx_k_Sampled[] = "Sampled: ";
static char __pyx_k_a_d_a_d[] = "a%d -> a%d;\n";
static char __pyx_k_arrv_in[] = "arrv_in";
static char __pyx_k_arrv_to[] = "arrv_to";
static char __pyx_k_as_yaml[] = "as_yaml";
static char __pyx_k_cleanup[] = "cleanup";
static char __pyx_k_d_d_d_d[] = "d%d -> d%d;\n";
static char __pyx_k_evt_new[] = "evt_new";
static char __pyx_k_evt_old[] = "evt_old";
static char __pyx_k_has_tau[] = "has_tau";
static char __pyx_k_heappop[] = "heappop";
static char __pyx_k_nevents[] = "nevents";
static char __pyx_k_nreject[] = "nreject";
static char __pyx_k_poisson[] = "poisson";
static char __pyx_k_product[] = "product: ";
static char __pyx_k_reverse[] = "reverse";
static char __pyx_k_sampled[] = "sampled";
static char __pyx_k_service[] = "service";
static char __pyx_k_uniform[] = "uniform";
static char __pyx_k_KeyError[] = "KeyError";
static char __pyx_k_New_task[] = "New task ";
static char __pyx_k_Rejected[] = "Rejected:\n";
static char __pyx_k_add_vars[] = "add_vars";
static char __pyx_k_arrivals[] = "arrivals";
static char __pyx_k_arrv_new[] = "arrv_new";
static char __pyx_k_diff_len[] = "diff_len";
static char __pyx_k_eid_prev[] = "eid_prev";
static char __pyx_k_estimate[] = "estimate";
static char __pyx_k_evt_prev[] = "evt_prev";
static char __pyx_k_heappush[] = "heappush";
static char __pyx_k_is_final[] = "is_final";
static char __pyx_k_log_prob[] = "log_prob";
static char __pyx_k_max_eidx[] = "max_eidx";
static char __pyx_k_n_hidden[] = "n_hidden";
static char __pyx_k_netutils[] = "netutils";
static char __pyx_k_next_obs[] = "next_obs";
static char __pyx_k_num_diff[] = "num_diff";
static char __pyx_k_num_iter[] = "num_iter";
static char __pyx_k_qname2id[] = "qname2id";
static char __pyx_k_queues_2[] = "queues:\n";
static char __pyx_k_queues_s[] = "    queues: [ %s ]\n";
static char __pyx_k_sampling[] = "sampling";
static char __pyx_k_sname2id[] = "sname2id";
static char __pyx_k_stupidlp[] = "stupidlp";
static char __pyx_k_tasks_in[] = "tasks_in";
static char __pyx_k_theta_to[] = "theta_to";
static char __pyx_k_universe[] = "universe";
static char __pyx_k_validate[] = "validate";
static char __pyx_k_warnings[] = "warnings";
static char __pyx_k_ARRV_BY_A[] = "ARRV_BY_A";
static char __pyx_k_ARRV_BY_D[] = "ARRV_BY_D";
static char __pyx_k_ARS_PWFUN[] = "ARS_PWFUN";
static char __pyx_k_Bad_event[] = "Bad event:";
static char __pyx_k_DIFF_LIST[] = "DIFF LIST";
static char __pyx_k_Exception[] = "Exception";
static char __pyx_k_NUM_TRIES[] = "NUM_TRIES";
static char __pyx_k_add_objsq[] = "add_objsq";
static char __pyx_k_all_tasks[] = "all_tasks";
static char __pyx_k_arrv_from[] = "arrv_from";
static char __pyx_k_create_qp[] = "create_qp";
static char __pyx_k_d_initial[] = "d_initial";
static char __pyx_k_diff_list[] = "diff_list";
static char __pyx_k_digraph_G[] = "digraph G {\n";
static char __pyx_k_duplicate[] = "duplicate";
static char __pyx_k_initial_q[] = "initial_q";
static char __pyx_k_integrate[] = "integrate";
static char __pyx_k_is_markov[] = "is_markov";
static char __pyx_k_iteritems[] = "iteritems";
static char __pyx_k_markovize[] = "markovize";
static char __pyx_k_model_dot[] = "model.dot";
static char __pyx_k_num_tasks[] = "num_tasks";
static char __pyx_k_old_tmpls[] = "old_tmpls";
static char __pyx_k_print_exc[] = "print_exc";
static char __pyx_k_rejection[] = "rejection";
static char __pyx_k_report_fn[] = "report_fn";
static char __pyx_k_return_lp[] = "return_lp";
static char __pyx_k_s_initial[] = "s_initial";
static char __pyx_k_set_E_0_d[] = "set E := 0 .. %d;\n";
static char __pyx_k_tasks_out[] = "tasks_out";
static char __pyx_k_templates[] = "templates";
static char __pyx_k_time_next[] = "time_next";
static char __pyx_k_traceback[] = "traceback";
static char __pyx_k_write_csv[] = "write_csv";
static char __pyx_k_Final_d_fn[] = "Final d_fn: ";
static char __pyx_k_Parameters[] = "Parameters: ";
static char __pyx_k_Resampling[] = "Resampling:\n";
static char __pyx_k_add_points[] = "add_points";
static char __pyx_k_add_var_ge[] = "add_var_ge";
static char __pyx_k_all_events[] = "all_events";
static char __pyx_k_arms_pwfun[] = "arms_pwfun";
static char __pyx_k_inner_dfun[] = "inner_dfun";
static char __pyx_k_nrtp_calls[] = "nrtp_calls";
static char __pyx_k_num_queues[] = "num_queues";
static char __pyx_k_num_states[] = "num_states";
static char __pyx_k_parameters[] = "parameters";
static char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
static char __pyx_k_random_elt[] = "random_elt";
static char __pyx_k_resort_byq[] = "resort_byq";
static char __pyx_k_successors[] = "successors";
static char __pyx_k_theta_from[] = "theta_from";
static char __pyx_k_when_clear[] = "when_clear";
static char __pyx_k_Exponential[] = "Exponential";
static char __pyx_k_Huh_Z_0_Lik[] = "Huh? Z=0. Lik ";
static char __pyx_k_INITIAL_QID[] = "INITIAL_QID";
static char __pyx_k_OLD_s_NEW_s[] = "OLD %s\nNEW %s\n\n";
static char __pyx_k_QNET_QUEUES[] = "<QNET>\n  <QUEUES>\n";
static char __pyx_k_QUEUES_QNET[] = "\n  </QUEUES>\n</QNET>";
static char __pyx_k_SLICE_PWFUN[] = "SLICE_PWFUN";
static char __pyx_k_add_initial[] = "add_initial";
static char __pyx_k_delete_task[] = "delete_task";
static char __pyx_k_demarkovize[] = "demarkovize";
static char __pyx_k_diff_list_2[] = "diff_list: ";
static char __pyx_k_diff_list_3[] = "diff_list ";
static char __pyx_k_evt_to_test[] = "evt_to_test";
static char __pyx_k_get_arrival[] = "get_arrival";
static char __pyx_k_nrtp_reject[] = "nrtp_reject";
static char __pyx_k_queue_order[] = "queue_order";
static char __pyx_k_reset_stats[] = "reset_stats";
static char __pyx_k_return_arrv[] = "return_arrv";
static char __pyx_k_samplePaths[] = "samplePaths";
static char __pyx_k_sample_path[] = "sample_path";
static char __pyx_k_set_sampler[] = "set_sampler";
static char __pyx_k_set_use_rtp[] = "set_use_rtp";
static char __pyx_k_sid_to_name[] = "sid_to_name";
static char __pyx_k_Event_d_done[] = ":::::::  Event %d done :::::::::::::::::::\n";
static char __pyx_k_mean_service[] = "mean_service";
static char __pyx_k_next_by_task[] = "next_by_task";
static char __pyx_k_sample_final[] = "sample_final";
static char __pyx_k_sample_state[] = "sample_state";
static char __pyx_k_service_only[] = "service_only";
static char __pyx_k_setup_minilp[] = "setup_minilp";
static char __pyx_k_successors_s[] = "    successors: [ %s ]\n";
static char __pyx_k_INITIAL_STATE[] = "INITIAL_STATE";
static char __pyx_k_STUPID_REJECT[] = "STUPID_REJECT";
static char __pyx_k_applyDiffList[] = "applyDiffList";
static char __pyx_k_diff_list_was[] = "diff_list was\n";
static char __pyx_k_distributions[] = "distributions";
static char __pyx_k_get_departure[] = "get_departure";
static char __pyx_k_initial_state[] = "initial_state";
static char __pyx_k_numParameters[] = "numParameters";
static char __pyx_k_prev_arrv_old[] = "prev_arrv_old";
static char __pyx_k_prev_dept_old[] = "prev_dept_old";
static char __pyx_k_setParameters[] = "setParameters";
static char __pyx_k_set_objective[] = "set_objective";
static char __pyx_k_add_constraint[] = "add_constraint";
static char __pyx_k_events_of_task[] = "events_of_task";
static char __pyx_k_gibbs_resample[] = "gibbs_resample";
static char __pyx_k_initial_events[] = "initial_events";
static char __pyx_k_s_t_a_pi_d_s_s[] = "s.t. a_pi%d: %s = %s;\n";
static char __pyx_k_sample_one_obs[] = "sample_one_obs";
static char __pyx_k_sample_service[] = "sample_service";
static char __pyx_k_slice_resample[] = "slice_resample";
static char __pyx_k_var_a_i_in_E_0[] = "var a{i in E} >= 0;";
static char __pyx_k_var_d_i_in_E_0[] = "var d{i in E} >= 0;";
static char __pyx_k_var_r_i_in_E_0[] = "var r{i in E} >= 0;";
static char __pyx_k_RUNNING_MINI_LP[] = "********** RUNNING MINI-LP ";
static char __pyx_k_compactify_soln[] = "compactify_soln";
static char __pyx_k_compute_mean_ia[] = "compute_mean_ia";
static char __pyx_k_events_of_queue[] = "events_of_queue";
static char __pyx_k_get_initializer[] = "get_initializer";
static char __pyx_k_gg1r_initialize[] = "gg1r_initialize ";
static char __pyx_k_likelihoodDelta[] = "likelihoodDelta";
static char __pyx_k_minimize_cost_0[] = "minimize cost: 0;\n";
static char __pyx_k_pi0_10f_pi1_10f[] = "pi0: %.10f  pi1: %.10f";
static char __pyx_k_queues_of_state[] = "queues_of_state";
static char __pyx_k_s_t_order_d_s_s[] = "s.t. order%d: %s >= %s;\n";
static char __pyx_k_sorted_uniforms[] = "sorted_uniforms";
static char __pyx_k_Initial_log_prob[] = "Initial log prob";
static char __pyx_k_RTP_Adding_event[] = "RTP: Adding event";
static char __pyx_k_any_zero_service[] = "any_zero_service";
static char __pyx_k_found_a_good_one[] = "found_a_good_one";
static char __pyx_k_mean_task_length[] = "mean_task_length";
static char __pyx_k_null_initializer[] = "null_initializer";
static char __pyx_k_parameter_kernel[] = "parameter_kernel";
static char __pyx_k_s_t_a_pi_d_a_d_0[] = "s.t. a_pi%d: a[%d] = 0;\n";
static char __pyx_k_set_slice_sorted[] = "set_slice_sorted";
static char __pyx_k_var_tau_i_in_E_0[] = "var tau{i in E} >= 0;";
static char __pyx_k_75s_s_75s_s_75s_s[] = "%-75s%s\n%-75s%s\n%-75s%s";
static char __pyx_k_Deleting_task_s_s[] = "Deleting task %s\n  %s";
static char __pyx_k_QNET_slice_sorted[] = "QNET slice_sorted = ";
static char __pyx_k_TID_s_SID_s_QID_s[] = "TID: %s  SID: %s  QID: %s";
static char __pyx_k_compute_obs_means[] = "compute_obs_means";
static char __pyx_k_display_diff_list[] = "display_diff_list";
static char __pyx_k_mean_task_service[] = "mean_task_service";
static char __pyx_k_previous_arriving[] = "previous_arriving";
static char __pyx_k_recompute_service[] = "recompute_service";
static char __pyx_k_s_t_a_ini_d_a_d_0[] = "s.t. a_ini%d: a[%d] = 0;\n";
static char __pyx_k_sample_parameters[] = "sample_parameters";
static char __pyx_k_update_caches_for[] = "update_caches_for";
static char __pyx_k_No_state_with_id_s[] = "No state with id %s";
static char __pyx_k_compute_task_order[] = "_compute_task_order";
static char __pyx_k_heap_from_arrivals[] = "heap_from_arrivals";
static char __pyx_k_is_sampled_by_task[] = "is_sampled_by_task";
static char __pyx_k_minilp_mini_params[] = "minilp mini params";
static char __pyx_k_previous_departing[] = "previous_departing";
static char __pyx_k_s_t_a_pi_d_a_d_d_d[] = "s.t. a_pi%d: a[%d] = d[%d];\n";
static char __pyx_k_s_t_d_ge_a_d_s_s_s[] = "s.t. d_ge_a%d: %s - %s >= %s;\n";
static char __pyx_k_NotImplementedError[] = "NotImplementedError";
static char __pyx_k_compute_obs_mean_ia[] = "compute_obs_mean_ia";
static char __pyx_k_integrate_by_points[] = "integrate_by_points";
static char __pyx_k_s_t_aobs__d_a_d_17g[] = "s.t. aobs_%d: a[%d] = %.17g;\n";
static char __pyx_k_s_t_dobs__d_d_d_17g[] = "s.t. dobs_%d: d[%d] = %.17g;\n";
static char __pyx_k_s_t_tau_d_d_d_tau_d[] = "s.t. tau%d: d[%d] = tau[%d];\n";
static char __pyx_k_slice_resample_Tmax[] = "slice_resample: Tmax ";
static char __pyx_k_var_slack1_i_in_E_0[] = "var slack1{i in E} >= 0;";
static char __pyx_k_var_slack2_i_in_E_0[] = "var slack2{i in E} >= 0;";
static char __pyx_k_var_slack3_i_in_E_0[] = "var slack3{i in E} >= 0;";
static char __pyx_k_var_slack4_i_in_E_0[] = "var slack4{i in E} >= 0;";
static char __pyx_k_Adding_initial_event[] = "Adding initial event ";
static char __pyx_k_DistributionTemplate[] = "DistributionTemplate";
static char __pyx_k_New_QNET_initializer[] = "New QNET initializer = ";
static char __pyx_k_Pre_add_prev_s_evt_s[] = "Pre add:\n  prev %s\n   evt %s";
static char __pyx_k_a_d_d_d_color_gray60[] = "a%d -> d%d [color=gray60];\n";
static char __pyx_k_final_arrival_by_qid[] = "final_arrival_by_qid";
static char __pyx_k_first_arrival_by_qid[] = "first_arrival_by_qid";
static char __pyx_k_insert_implied_tasks[] = "insert_implied_tasks";
static char __pyx_k_remove_task_proposal[] = "remove_task_proposal";
static char __pyx_k_resample_auxiliaries[] = "resample_auxiliaries";
static char __pyx_k_s_t_d_ge_a_d_s_s_s_2[] = "s.t. d_ge_a%d: %s - %s >= %s;";
static char __pyx_k_Adding_observed_event[] = "Adding observed event ";
static char __pyx_k_Can_t_find_s_in_net_s[] = "Can't find %s in net %s";
static char __pyx_k_Log_prob_from_scratch[] = "Log prob (from scratch)";
static char __pyx_k_possible_observations[] = "possible_observations";
static char __pyx_k_recompute_all_service[] = "recompute_all_service";
static char __pyx_k_regenerate_all_caches[] = "regenerate_all_caches";
static char __pyx_k_s_t_a_rho_d_a_d_a_d_s[] = "s.t. a_rho%d: a[%d] - a[%d] >= %s;\n";
static char __pyx_k_s_t_d_rho_d_d_d_d_d_s[] = "s.t. d_rho%d: d[%d] - d[%d] >= %s;\n";
static char __pyx_k_Adding_observed_events[] = "Adding observed events";
static char __pyx_k_Could_not_initialize_s[] = "Could not initialize\n%s";
static char __pyx_k_NUM_INTEGRATION_POINTS[] = "NUM_INTEGRATION_POINTS";
static char __pyx_k_estimate_minilp_params[] = "estimate_minilp_params";
static char __pyx_k_initialize_auxiliaries[] = "initialize_auxiliaries";
static char __pyx_k_s_t_d_ge_a_d_d_d_a_d_s[] = "s.t. d_ge_a%d: d[%d] - a[%d] >= %s;\n";
static char __pyx_k_sample_discrete_events[] = "_sample_discrete_events";
static char __pyx_k_select_job_for_service[] = "select_job_for_service";
static char __pyx_k_d_d_a_d_color_lawngreen[] = "d%d -> a%d [color=lawngreen];\n";
static char __pyx_k_gibbs_initialize_for_ps[] = "gibbs_initialize_for_ps";
static char __pyx_k_gibbs_initialize_via_lp[] = "gibbs_initialize_via_lp";
static char __pyx_k_init_add_initial_events[] = "init_add_initial_events";
static char __pyx_k_markovize_from_arrivals[] = "markovize_from_arrivals";
static char __pyx_k_s_t_tau_d_d_d_tau_d_d_d[] = "s.t. tau%d: d[%d] + tau[%d] = d[%d];\n";
static char __pyx_k_set_initialization_type[] = "set_initialization_type";
static char __pyx_k_Adding_unobserved_events[] = "Adding unobserved events";
static char __pyx_k_Cannot_understand_type_s[] = "Cannot understand type %s";
static char __pyx_k_Error_resampling_event_s[] = "Error resampling event %s";
static char __pyx_k_RTP_Resampling_departure[] = "++++++++++++++++\nRTP: Resampling departure";
static char __pyx_k_diff_list_definitely_bad[] = "diff_list_definitely_bad";
static char __pyx_k_gibbs_initialize_via_dfn[] = "gibbs_initialize_via_dfn";
static char __pyx_k_slice_resampling_EID_d_s[] = "=========\nslice_resampling EID: %d\n%s";
static char __pyx_k_Huh_Unknown_queue_order_d[] = "Huh? Unknown queue order %d";
static char __pyx_k_gibbs_initialize_for_gg1r[] = "gibbs_initialize_for_gg1r";
static char __pyx_k_gibbs_initialize_via_dfn1[] = "gibbs_initialize_via_dfn1";
static char __pyx_k_gibbs_initialize_via_dfn2[] = "gibbs_initialize_via_dfn2";
static char __pyx_k_gibbs_initialize_via_dfn3[] = "gibbs_initialize_via_dfn3";
static char __pyx_k_sample_d_until_acceptance[] = "sample_d_until_acceptance";
static char __pyx_k_gibbs_initialize_via_order[] = "gibbs_initialize_via_order";
static char __pyx_k_init_insert_observed_tasks[] = "init_insert_observed_tasks";
static char __pyx_k_Initialization_done_Service[] = "Initialization done.  Service: ";
static char __pyx_k_Rejecting_zero_service_on_s[] = "Rejecting: zero service on %s";
static char __pyx_k_gibbs_initialize_via_minilp[] = "gibbs_initialize_via_minilp";
static char __pyx_k_s_t_allr_i_in_E_d_i_a_i_r_i[] = "s.t. allr{i in E}: d[i] = a[i] + r[i];";
static char __pyx_k_visualize_initialization_lp[] = "visualize_initialization_lp";
static char __pyx_k_After_update_lik_is_infinity[] = "After update: lik is infinity";
static char __pyx_k_Initialization_at_s_failed_s[] = "Initialization at %s failed: %s";
static char __pyx_k_Resampling_final_event_s_s_s[] = "Resampling final event:\n  %s\n  %s\n  %s";
static char __pyx_k_Using_strange_initialization[] = "Using strange initialization.";
static char __pyx_k_Before_update_lik_is_infinity[] = "Before update: lik is infinity";
static char __pyx_k_a_d_style_filled_color_grey80[] = "a%d [style=filled, color=grey80];\n";
static char __pyx_k_d_d_style_filled_color_grey80[] = "d%d [style=filled, color=grey80];\n";
static char __pyx_k_add_initialization_constraints[] = "add_initialization_constraints";
static char __pyx_k_gibbs_initialize_mini_params_s[] = "gibbs_initialize: mini_params %s";
static char __pyx_k_gibbs_initialize_via_rejection[] = "gibbs_initialize_via_rejection";
static char __pyx_k_Can_t_find_valid_initialization[] = "Can't find valid initialization";
static char __pyx_k_Could_not_understand_event_type[] = "Could not understand event type %d";
static char __pyx_k_ERROR_sample_by_time_works_only[] = "ERROR: sample_by_time works only for M/G/xxx queues";
static char __pyx_k_Users_csutton_svn_research_code[] = "/Users/csutton/svn/research/code/gqnet/src/qnet.pyx";
static char __pyx_k_gibbs_kernel_Kernel_0_5f_not_in[] = "gibbs_kernel: Kernel 0: %.5f not in %.5f .. %.5f\n  %s";
static char __pyx_k_minimize_cost_sum_i_in_E_slack1[] = "minimize cost: sum{i in E} slack1[i] + sum{i in E} slack2[i] + sum{i in E} slack3[i] + sum{i in E} slack4[i];\n";
static char __pyx_k_slice_resample_initial_log_prob[] = "slice_resample: initial log_prob ";
static char __pyx_k_Could_not_understand_one_d_sampl[] = "Could not understand one_d_sampler: %s";
static char __pyx_k_GG1R_initialization_done_Mean_se[] = "GG1R initialization done.  Mean service: ";
static char __pyx_k_Gibbs_initialization_Num_backtra[] = "Gibbs initialization: Num backtracks = %d";
static char __pyx_k_gibbs_kernel_0_Could_not_process[] = "gibbs_kernel=0 : Could not process events";
static char __pyx_k_gibbs_kernel_inf_Kernel_0_FROM_s[] = "gibbs_kernel -inf: Kernel 0\nFROM  %s\nTO    %s";
static char __pyx_k_initialize_by_order_aborting_tas[] = "initialize_by_order: aborting task ";
static char __pyx_k_initialize_inserting_implied_tas[] = "initialize_inserting_implied_tasks";
static char __pyx_k_s_d_u_a_Error_Could_not_find_goo[] = "s_d_u_a: Error: Could not find good initial time for EVT %d\n%s";
static char __pyx_k_s_t_slack1_d_r_d_slack1_d_slack2[] = "s.t. slack1%d: r[%d] + slack1[%d] - slack2[%d] = %s;\n";
static char __pyx_k_s_t_slack_b_d_tau_d_slack3_d_sla[] = "s.t. slack_b%d: tau[%d] + slack3[%d] - slack4[%d] = %s;\n";
static char __pyx_k_subgraph_cluster__s_A_label_s_co[] = "subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n";
  static char __pyx_k_subgraph_cluster__s_D_label_s_co[] = "subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n";
    static PyObject *__pyx_kp_s_;
    static PyObject *__pyx_kp_s_10f;
    static PyObject *__pyx_kp_s_75s_s_75s_s_75s_s;
    static PyObject *__pyx_n_s_ARRV_BY_A;
    static PyObject *__pyx_n_s_ARRV_BY_D;
    static PyObject *__pyx_n_s_ARS_PWFUN;
    static PyObject *__pyx_kp_s_Adding_initial_event;
    static PyObject *__pyx_kp_s_Adding_observed_event;
    static PyObject *__pyx_kp_s_Adding_observed_events;
    static PyObject *__pyx_kp_s_Adding_unobserved_events;
    static PyObject *__pyx_kp_s_After_update_lik_is_infinity;
    static PyObject *__pyx_kp_s_Bad_event;
    static PyObject *__pyx_kp_s_Before_update_lik_is_infinity;
    static PyObject *__pyx_n_s_C;
    static PyObject *__pyx_kp_s_Can_t_find_s_in_net_s;
    static PyObject *__pyx_kp_s_Can_t_find_valid_initialization;
    static PyObject *__pyx_kp_s_Cannot_understand_type_s;
    static PyObject *__pyx_kp_s_Could_not_initialize_s;
    static PyObject *__pyx_kp_s_Could_not_understand_event_type;
    static PyObject *__pyx_kp_s_Could_not_understand_one_d_sampl;
    static PyObject *__pyx_n_s_DFN1;
    static PyObject *__pyx_n_s_DFN2;
    static PyObject *__pyx_kp_s_DIFF_LIST;
    static PyObject *__pyx_kp_s_D_NEW;
    static PyObject *__pyx_kp_s_Deleting_task_s_s;
    static PyObject *__pyx_n_s_DistributionTemplate;
    static PyObject *__pyx_kp_s_EID_d;
    static PyObject *__pyx_kp_s_EID_d_s;
    static PyObject *__pyx_kp_s_ERROR_sample_by_time_works_only;
    static PyObject *__pyx_kp_s_Error_resampling_event_s;
    static PyObject *__pyx_kp_s_Event_d_done;
    static PyObject *__pyx_n_s_Exception;
    static PyObject *__pyx_n_s_Exponential;
    static PyObject *__pyx_kp_s_Final_d_fn;
    static PyObject *__pyx_kp_s_GG1R_initialization_done_Mean_se;
    static PyObject *__pyx_kp_s_Gibbs_initialization_Num_backtra;
    static PyObject *__pyx_kp_s_Huh;
    static PyObject *__pyx_kp_s_Huh_Unknown_queue_order_d;
    static PyObject *__pyx_kp_s_Huh_Z_0_Lik;
    static PyObject *__pyx_kp_s_Huh_s;
    static PyObject *__pyx_n_s_INITIAL_QID;
    static PyObject *__pyx_n_s_INITIAL_STATE;
    static PyObject *__pyx_kp_s_INIT_s;
    static PyObject *__pyx_kp_s_Initial_log_prob;
    static PyObject *__pyx_kp_s_Initialization_at_s_failed_s;
    static PyObject *__pyx_kp_s_Initialization_done_Service;
    static PyObject *__pyx_n_s_KeyError;
    static PyObject *__pyx_n_s_L;
    static PyObject *__pyx_n_s_LP;
    static PyObject *__pyx_kp_s_Log_prob_from_scratch;
    static PyObject *__pyx_n_s_MINILP;
    static PyObject *__pyx_n_s_N;
    static PyObject *__pyx_n_s_NONE;
    static PyObject *__pyx_n_s_NUM_INTEGRATION_POINTS;
    static PyObject *__pyx_n_s_NUM_TRIES;
    static PyObject *__pyx_kp_s_New_QNET_initializer;
    static PyObject *__pyx_kp_s_New_task;
    static PyObject *__pyx_kp_s_No_state_with_id_s;
    static PyObject *__pyx_n_s_NotImplementedError;
    static PyObject *__pyx_n_s_Ns;
    static PyObject *__pyx_kp_s_OLD_s_NEW_s;
    static PyObject *__pyx_n_s_PS;
    static PyObject *__pyx_kp_s_Parameters;
    static PyObject *__pyx_kp_s_Pre_add_prev_s_evt_s;
    static PyObject *__pyx_kp_s_QNET_QUEUES;
    static PyObject *__pyx_kp_s_QNET_slice_sorted;
    static PyObject *__pyx_n_s_QP;
    static PyObject *__pyx_kp_s_QUEUES_QNET;
    static PyObject *__pyx_n_s_RTP;
    static PyObject *__pyx_kp_s_RTP_Adding_event;
    static PyObject *__pyx_kp_s_RTP_Resampling_departure;
    static PyObject *__pyx_kp_s_RUNNING_MINI_LP;
    static PyObject *__pyx_kp_s_Ratio;
    static PyObject *__pyx_n_s_Ratio_2;
    static PyObject *__pyx_kp_s_Rejected;
    static PyObject *__pyx_kp_s_Rejecting_zero_service_on_s;
    static PyObject *__pyx_kp_s_Resampling;
    static PyObject *__pyx_kp_s_Resampling_final_event_s_s_s;
    static PyObject *__pyx_n_s_SLICE;
    static PyObject *__pyx_n_s_SLICE_PWFUN;
    static PyObject *__pyx_n_s_STUPID_REJECT;
    static PyObject *__pyx_kp_s_Sampled;
    static PyObject *__pyx_kp_s_TAU_d;
    static PyObject *__pyx_kp_s_TIDS;
    static PyObject *__pyx_kp_s_TID_s_SID_s_QID_s;
    static PyObject *__pyx_n_s_U;
    static PyObject *__pyx_kp_s_Users_csutton_svn_research_code;
    static PyObject *__pyx_kp_s_Using_strange_initialization;
    static PyObject *__pyx_n_s_Z;
    static PyObject *__pyx_kp_s__13;
    static PyObject *__pyx_kp_s__2;
    static PyObject *__pyx_kp_s__27;
    static PyObject *__pyx_kp_s__28;
    static PyObject *__pyx_kp_s__3;
    static PyObject *__pyx_kp_s__30;
    static PyObject *__pyx_kp_s__33;
    static PyObject *__pyx_n_s_a;
    static PyObject *__pyx_kp_s_a_d;
    static PyObject *__pyx_kp_s_a_d_a_d;
    static PyObject *__pyx_kp_s_a_d_d_d_color_gray60;
    static PyObject *__pyx_kp_s_a_d_style_filled_color_grey80;
    static PyObject *__pyx_n_s_add;
    static PyObject *__pyx_n_s_add_constraint;
    static PyObject *__pyx_n_s_add_initial;
    static PyObject *__pyx_n_s_add_initialization_constraints;
    static PyObject *__pyx_n_s_add_objsq;
    static PyObject *__pyx_n_s_add_points;
    static PyObject *__pyx_n_s_add_var_ge;
    static PyObject *__pyx_n_s_add_vars;
    static PyObject *__pyx_n_s_all_events;
    static PyObject *__pyx_n_s_all_tasks;
    static PyObject *__pyx_n_s_any_zero_service;
    static PyObject *__pyx_n_s_append;
    static PyObject *__pyx_n_s_applyDiffList;
    static PyObject *__pyx_n_s_arms_pwfun;
    static PyObject *__pyx_n_s_arrivals;
    static PyObject *__pyx_n_s_arrv;
    static PyObject *__pyx_n_s_arrv_from;
    static PyObject *__pyx_n_s_arrv_in;
    static PyObject *__pyx_n_s_arrv_new;
    static PyObject *__pyx_n_s_arrv_to;
    static PyObject *__pyx_n_s_arrvl;
    static PyObject *__pyx_n_s_arrvls;
    static PyObject *__pyx_n_s_as_yaml;
    static PyObject *__pyx_n_s_astr;
    static PyObject *__pyx_n_s_aux;
    static PyObject *__pyx_n_s_bisect;
    static PyObject *__pyx_n_s_burn;
    static PyObject *__pyx_n_s_byq;
    static PyObject *__pyx_n_s_byt;
    static PyObject *__pyx_n_s_cleanup;
    static PyObject *__pyx_n_s_close;
    static PyObject *__pyx_n_s_compactify_soln;
    static PyObject *__pyx_n_s_compute_mean_ia;
    static PyObject *__pyx_n_s_compute_obs_mean_ia;
    static PyObject *__pyx_n_s_compute_obs_means;
    static PyObject *__pyx_n_s_compute_task_order;
    static PyObject *__pyx_n_s_create_qp;
    static PyObject *__pyx_n_s_d;
    static PyObject *__pyx_n_s_d0;
    static PyObject *__pyx_kp_s_d_d;
    static PyObject *__pyx_kp_s_d_d_a_d_color_lawngreen;
    static PyObject *__pyx_kp_s_d_d_d_d;
    static PyObject *__pyx_kp_s_d_d_style_filled_color_grey80;
    static PyObject *__pyx_n_s_d_initial;
    static PyObject *__pyx_n_s_d_last;
    static PyObject *__pyx_n_s_d_max;
    static PyObject *__pyx_n_s_d_new;
    static PyObject *__pyx_n_s_d_old;
    static PyObject *__pyx_n_s_d_prev;
    static PyObject *__pyx_n_s_delete_task;
    static PyObject *__pyx_n_s_delta;
    static PyObject *__pyx_n_s_demarkovize;
    static PyObject *__pyx_n_s_dfn;
    static PyObject *__pyx_n_s_diff_len;
    static PyObject *__pyx_n_s_diff_list;
    static PyObject *__pyx_kp_s_diff_list_2;
    static PyObject *__pyx_kp_s_diff_list_3;
    static PyObject *__pyx_n_s_diff_list_definitely_bad;
    static PyObject *__pyx_kp_s_diff_list_was;
    static PyObject *__pyx_kp_s_digraph_G;
    static PyObject *__pyx_n_s_display_diff_list;
    static PyObject *__pyx_n_s_distributions;
    static PyObject *__pyx_n_s_dists;
    static PyObject *__pyx_n_s_doitp;
    static PyObject *__pyx_n_s_dstr;
    static PyObject *__pyx_n_s_dump;
    static PyObject *__pyx_n_s_dup;
    static PyObject *__pyx_n_s_duplicate;
    static PyObject *__pyx_n_s_e;
    static PyObject *__pyx_n_s_e0;
    static PyObject *__pyx_n_s_eid;
    static PyObject *__pyx_n_s_eid_prev;
    static PyObject *__pyx_n_s_elem;
    static PyObject *__pyx_n_s_end;
    static PyObject *__pyx_n_s_eps;
    static PyObject *__pyx_n_s_estimate;
    static PyObject *__pyx_n_s_estimate_minilp_params;
    static PyObject *__pyx_n_s_event;
    static PyObject *__pyx_n_s_events_of_queue;
    static PyObject *__pyx_n_s_events_of_task;
    static PyObject *__pyx_n_s_evt;
    static PyObject *__pyx_n_s_evt0;
    static PyObject *__pyx_n_s_evt1;
    static PyObject *__pyx_n_s_evt2;
    static PyObject *__pyx_n_s_evt_new;
    static PyObject *__pyx_n_s_evt_old;
    static PyObject *__pyx_n_s_evt_prev;
    static PyObject *__pyx_n_s_evt_to_test;
    static PyObject *__pyx_n_s_evts;
    static PyObject *__pyx_n_s_exp;
    static PyObject *__pyx_n_s_expify;
    static PyObject *__pyx_n_s_extend;
    static PyObject *__pyx_n_s_f;
    static PyObject *__pyx_n_s_file;
    static PyObject *__pyx_n_s_final_arrival_by_qid;
    static PyObject *__pyx_n_s_first_arrival_by_qid;
    static PyObject *__pyx_n_s_fn;
    static PyObject *__pyx_n_s_found_a_good_one;
    static PyObject *__pyx_n_s_fsm;
    static PyObject *__pyx_n_s_get;
    static PyObject *__pyx_n_s_get_arrival;
    static PyObject *__pyx_n_s_get_departure;
    static PyObject *__pyx_n_s_get_initializer;
    static PyObject *__pyx_kp_s_gg1r_initialize;
    static PyObject *__pyx_n_s_gibbs_initialize_for_gg1r;
    static PyObject *__pyx_n_s_gibbs_initialize_for_ps;
    static PyObject *__pyx_kp_s_gibbs_initialize_mini_params_s;
    static PyObject *__pyx_n_s_gibbs_initialize_via_dfn;
    static PyObject *__pyx_n_s_gibbs_initialize_via_dfn1;
    static PyObject *__pyx_n_s_gibbs_initialize_via_dfn2;
    static PyObject *__pyx_n_s_gibbs_initialize_via_dfn3;
    static PyObject *__pyx_n_s_gibbs_initialize_via_lp;
    static PyObject *__pyx_n_s_gibbs_initialize_via_minilp;
    static PyObject *__pyx_n_s_gibbs_initialize_via_order;
    static PyObject *__pyx_n_s_gibbs_initialize_via_rejection;
    static PyObject *__pyx_kp_s_gibbs_kernel_0_Could_not_process;
    static PyObject *__pyx_kp_s_gibbs_kernel_Kernel_0_5f_not_in;
    static PyObject *__pyx_kp_s_gibbs_kernel_inf_Kernel_0_FROM_s;
    static PyObject *__pyx_n_s_gibbs_resample;
    static PyObject *__pyx_n_s_has_tau;
    static PyObject *__pyx_n_s_heap;
    static PyObject *__pyx_n_s_heap_from_arrivals;
    static PyObject *__pyx_n_s_heappop;
    static PyObject *__pyx_n_s_heappush;
    static PyObject *__pyx_n_s_heapq;
    static PyObject *__pyx_n_s_hmm;
    static PyObject *__pyx_n_s_i;
    static PyObject *__pyx_n_s_ievts;
    static PyObject *__pyx_n_s_import;
    static PyObject *__pyx_n_s_index;
    static PyObject *__pyx_n_s_inf;
    static PyObject *__pyx_n_s_init_add_initial_events;
    static PyObject *__pyx_n_s_init_insert_observed_tasks;
    static PyObject *__pyx_n_s_initial_events;
    static PyObject *__pyx_n_s_initial_q;
    static PyObject *__pyx_n_s_initial_state;
    static PyObject *__pyx_n_s_initialize_auxiliaries;
    static PyObject *__pyx_kp_s_initialize_by_order_aborting_tas;
    static PyObject *__pyx_n_s_initialize_inserting_implied_tas;
    static PyObject *__pyx_n_s_inner;
    static PyObject *__pyx_n_s_inner_dfun;
    static PyObject *__pyx_n_s_insert;
    static PyObject *__pyx_n_s_insert_implied_tasks;
    static PyObject *__pyx_n_s_insort;
    static PyObject *__pyx_n_s_integrate;
    static PyObject *__pyx_n_s_integrate_by_points;
    static PyObject *__pyx_n_s_is_final;
    static PyObject *__pyx_n_s_is_markov;
    static PyObject *__pyx_n_s_is_sampled_by_task;
    static PyObject *__pyx_n_s_isinf;
    static PyObject *__pyx_n_s_iteritems;
    static PyObject *__pyx_n_s_j;
    static PyObject *__pyx_n_s_join;
    static PyObject *__pyx_n_s_k;
    static PyObject *__pyx_n_s_key;
    static PyObject *__pyx_n_s_l;
    static PyObject *__pyx_n_s_last_a;
    static PyObject *__pyx_n_s_lik;
    static PyObject *__pyx_n_s_lik0;
    static PyObject *__pyx_n_s_likelihoodDelta;
    static PyObject *__pyx_n_s_log_prob;
    static PyObject *__pyx_n_s_lower;
    static PyObject *__pyx_n_s_lp;
    static PyObject *__pyx_n_s_main;
    static PyObject *__pyx_n_s_map;
    static PyObject *__pyx_n_s_markovize;
    static PyObject *__pyx_n_s_markovize_from_arrivals;
    static PyObject *__pyx_n_s_math;
    static PyObject *__pyx_n_s_max;
    static PyObject *__pyx_n_s_max_eidx;
    static PyObject *__pyx_n_s_mean;
    static PyObject *__pyx_n_s_mean_service;
    static PyObject *__pyx_n_s_mean_task_length;
    static PyObject *__pyx_n_s_mean_task_service;
    static PyObject *__pyx_kp_s_minilp_mini_params;
    static PyObject *__pyx_kp_s_minimize_cost_0;
    static PyObject *__pyx_kp_s_minimize_cost_sum_i_in_E_slack1;
    static PyObject *__pyx_n_s_misc;
    static PyObject *__pyx_kp_s_model_dot;
    static PyObject *__pyx_n_s_mu_s;
    static PyObject *__pyx_n_s_n;
    static PyObject *__pyx_n_s_n_hidden;
    static PyObject *__pyx_n_s_name;
    static PyObject *__pyx_kp_s_name_s;
    static PyObject *__pyx_n_s_ne;
    static PyObject *__pyx_n_s_net;
    static PyObject *__pyx_n_s_netutils;
    static PyObject *__pyx_n_s_nevents;
    static PyObject *__pyx_n_s_next_by_task;
    static PyObject *__pyx_n_s_next_obs;
    static PyObject *__pyx_n_s_nh;
    static PyObject *__pyx_n_s_nreject;
    static PyObject *__pyx_n_s_nrtp_calls;
    static PyObject *__pyx_n_s_nrtp_reject;
    static PyObject *__pyx_n_s_nt;
    static PyObject *__pyx_n_s_null_initializer;
    static PyObject *__pyx_n_s_numParameters;
    static PyObject *__pyx_n_s_num_diff;
    static PyObject *__pyx_n_s_num_iter;
    static PyObject *__pyx_n_s_num_queues;
    static PyObject *__pyx_n_s_num_states;
    static PyObject *__pyx_n_s_num_tasks;
    static PyObject *__pyx_n_s_numpy;
    static PyObject *__pyx_n_s_obs;
    static PyObject *__pyx_n_s_obs_a;
    static PyObject *__pyx_n_s_obs_d;
    static PyObject *__pyx_n_s_old_tmpls;
    static PyObject *__pyx_n_s_open;
    static PyObject *__pyx_n_s_order;
    static PyObject *__pyx_n_s_parameter_kernel;
    static PyObject *__pyx_n_s_parameters;
    static PyObject *__pyx_n_s_path;
    static PyObject *__pyx_kp_s_pi0_10f_pi1_10f;
    static PyObject *__pyx_n_s_points;
    static PyObject *__pyx_n_s_poisson;
    static PyObject *__pyx_n_s_pop;
    static PyObject *__pyx_n_s_possible_observations;
    static PyObject *__pyx_n_s_prev_arrv_old;
    static PyObject *__pyx_n_s_prev_dept_old;
    static PyObject *__pyx_n_s_previous_arriving;
    static PyObject *__pyx_n_s_previous_departing;
    static PyObject *__pyx_n_s_print;
    static PyObject *__pyx_n_s_print_exc;
    static PyObject *__pyx_n_s_proc;
    static PyObject *__pyx_kp_s_product;
    static PyObject *__pyx_n_s_pwfun;
    static PyObject *__pyx_n_s_pyx_vtable;
    static PyObject *__pyx_n_s_q;
    static PyObject *__pyx_n_s_q0;
    static PyObject *__pyx_n_s_qid;
    static PyObject *__pyx_n_s_qname2id;
    static PyObject *__pyx_n_s_qnet;
    static PyObject *__pyx_n_s_qp;
    static PyObject *__pyx_n_s_qstats;
    static PyObject *__pyx_n_s_queue;
    static PyObject *__pyx_n_s_queue_order;
    static PyObject *__pyx_n_s_queues;
    static PyObject *__pyx_kp_s_queues_2;
    static PyObject *__pyx_n_s_queues_of_state;
    static PyObject *__pyx_kp_s_queues_s;
    static PyObject *__pyx_n_s_random;
    static PyObject *__pyx_n_s_random_elt;
    static PyObject *__pyx_n_s_range;
    static PyObject *__pyx_n_s_rate;
    static PyObject *__pyx_n_s_recompute_all_service;
    static PyObject *__pyx_n_s_recompute_service;
    static PyObject *__pyx_n_s_reg;
    static PyObject *__pyx_n_s_regenerate_all_caches;
    static PyObject *__pyx_n_s_rejection;
    static PyObject *__pyx_n_s_remove;
    static PyObject *__pyx_n_s_remove_task_proposal;
    static PyObject *__pyx_n_s_report;
    static PyObject *__pyx_n_s_report_fn;
    static PyObject *__pyx_n_s_resample_auxiliaries;
    static PyObject *__pyx_n_s_reset_stats;
    static PyObject *__pyx_n_s_resort_byq;
    static PyObject *__pyx_n_s_result;
    static PyObject *__pyx_n_s_return_arrv;
    static PyObject *__pyx_n_s_return_lp;
    static PyObject *__pyx_n_s_reverse;
    static PyObject *__pyx_n_s_s;
    static PyObject *__pyx_kp_s_s_17g;
    static PyObject *__pyx_kp_s_s_d_u_a_Error_Could_not_find_goo;
    static PyObject *__pyx_n_s_s_initial;
    static PyObject *__pyx_n_s_s_new;
    static PyObject *__pyx_n_s_s_next;
    static PyObject *__pyx_kp_s_s_s;
    static PyObject *__pyx_kp_s_s_t_a_ini_d_a_d_0;
    static PyObject *__pyx_kp_s_s_t_a_pi_d_a_d_0;
    static PyObject *__pyx_kp_s_s_t_a_pi_d_a_d_d_d;
    static PyObject *__pyx_kp_s_s_t_a_pi_d_s_s;
    static PyObject *__pyx_kp_s_s_t_a_rho_d_a_d_a_d_s;
    static PyObject *__pyx_kp_s_s_t_allr_i_in_E_d_i_a_i_r_i;
    static PyObject *__pyx_kp_s_s_t_aobs__d_a_d_17g;
    static PyObject *__pyx_kp_s_s_t_d_ge_a_d_d_d_a_d_s;
    static PyObject *__pyx_kp_s_s_t_d_ge_a_d_s_s_s;
    static PyObject *__pyx_kp_s_s_t_d_ge_a_d_s_s_s_2;
    static PyObject *__pyx_kp_s_s_t_d_rho_d_d_d_d_d_s;
    static PyObject *__pyx_kp_s_s_t_dobs__d_d_d_17g;
    static PyObject *__pyx_kp_s_s_t_order_d_s_s;
    static PyObject *__pyx_kp_s_s_t_slack1_d_r_d_slack1_d_slack2;
    static PyObject *__pyx_kp_s_s_t_slack_b_d_tau_d_slack3_d_sla;
    static PyObject *__pyx_kp_s_s_t_tau_d_d_d_tau_d;
    static PyObject *__pyx_kp_s_s_t_tau_d_d_d_tau_d_d_d;
    static PyObject *__pyx_n_s_s_true;
    static PyObject *__pyx_n_s_samplePaths;
    static PyObject *__pyx_n_s_sample_d_until_acceptance;
    static PyObject *__pyx_n_s_sample_discrete_events;
    static PyObject *__pyx_n_s_sample_final;
    static PyObject *__pyx_n_s_sample_one_obs;
    static PyObject *__pyx_n_s_sample_parameters;
    static PyObject *__pyx_n_s_sample_path;
    static PyObject *__pyx_n_s_sample_service;
    static PyObject *__pyx_n_s_sample_state;
    static PyObject *__pyx_n_s_sampled;
    static PyObject *__pyx_n_s_sampling;
    static PyObject *__pyx_n_s_scale;
    static PyObject *__pyx_n_s_scipy;
    static PyObject *__pyx_n_s_select_job_for_service;
    static PyObject *__pyx_n_s_service;
    static PyObject *__pyx_n_s_service_only;
    static PyObject *__pyx_n_s_setParameters;
    static PyObject *__pyx_kp_s_set_E_0_d;
    static PyObject *__pyx_n_s_set_initialization_type;
    static PyObject *__pyx_n_s_set_objective;
    static PyObject *__pyx_n_s_set_sampler;
    static PyObject *__pyx_n_s_set_slice_sorted;
    static PyObject *__pyx_n_s_set_use_rtp;
    static PyObject *__pyx_n_s_setup_minilp;
    static PyObject *__pyx_n_s_sid;
    static PyObject *__pyx_n_s_sid_to_name;
    static PyObject *__pyx_n_s_slice;
    static PyObject *__pyx_n_s_slice_resample;
    static PyObject *__pyx_kp_s_slice_resample_Tmax;
    static PyObject *__pyx_kp_s_slice_resample_initial_log_prob;
    static PyObject *__pyx_kp_s_slice_resampling_EID_d_s;
    static PyObject *__pyx_n_s_sname2id;
    static PyObject *__pyx_n_s_soln;
    static PyObject *__pyx_n_s_solve;
    static PyObject *__pyx_n_s_sort;
    static PyObject *__pyx_n_s_sorted_uniforms;
    static PyObject *__pyx_kp_s_states;
    static PyObject *__pyx_n_s_stats;
    static PyObject *__pyx_n_s_stdout;
    static PyObject *__pyx_n_s_str;
    static PyObject *__pyx_n_s_stupidlp;
    static PyObject *__pyx_kp_s_subgraph_cluster__s_A_label_s_co;
    static PyObject *__pyx_kp_s_subgraph_cluster__s_D_label_s_co;
    static PyObject *__pyx_n_s_successors;
    static PyObject *__pyx_kp_s_successors_s;
    static PyObject *__pyx_n_s_sys;
    static PyObject *__pyx_n_s_tasks;
    static PyObject *__pyx_n_s_tasks_in;
    static PyObject *__pyx_n_s_tasks_out;
    static PyObject *__pyx_n_s_templates;
    static PyObject *__pyx_n_s_test;
    static PyObject *__pyx_n_s_theta_from;
    static PyObject *__pyx_n_s_theta_to;
    static PyObject *__pyx_n_s_thin;
    static PyObject *__pyx_n_s_tid;
    static PyObject *__pyx_n_s_tid0;
    static PyObject *__pyx_n_s_tid1;
    static PyObject *__pyx_n_s_tid2;
    static PyObject *__pyx_n_s_time_next;
    static PyObject *__pyx_n_s_times;
    static PyObject *__pyx_n_s_to_fix;
    static PyObject *__pyx_n_s_tots;
    static PyObject *__pyx_n_s_traceback;
    static PyObject *__pyx_n_s_type;
    static PyObject *__pyx_n_s_uniform;
    static PyObject *__pyx_n_s_universe;
    static PyObject *__pyx_n_s_unobs;
    static PyObject *__pyx_n_s_update_caches_for;
    static PyObject *__pyx_n_s_upper;
    static PyObject *__pyx_n_s_v;
    static PyObject *__pyx_n_s_val;
    static PyObject *__pyx_n_s_validate;
    static PyObject *__pyx_kp_s_var_a_i_in_E_0;
    static PyObject *__pyx_kp_s_var_d_i_in_E_0;
    static PyObject *__pyx_kp_s_var_r_i_in_E_0;
    static PyObject *__pyx_kp_s_var_slack1_i_in_E_0;
    static PyObject *__pyx_kp_s_var_slack2_i_in_E_0;
    static PyObject *__pyx_kp_s_var_slack3_i_in_E_0;
    static PyObject *__pyx_kp_s_var_slack4_i_in_E_0;
    static PyObject *__pyx_kp_s_var_tau_i_in_E_0;
    static PyObject *__pyx_n_s_visualize_initialization_lp;
    static PyObject *__pyx_n_s_w;
    static PyObject *__pyx_n_s_wait;
    static PyObject *__pyx_n_s_warnings;
    static PyObject *__pyx_n_s_was;
    static PyObject *__pyx_n_s_when_clear;
    static PyObject *__pyx_n_s_write;
    static PyObject *__pyx_n_s_write_csv;
    static PyObject *__pyx_n_s_xrange;
    static PyObject *__pyx_n_s_yaml;
    static PyObject *__pyx_float_0_0;
    static PyObject *__pyx_float_0_1;
    static PyObject *__pyx_float_1_0;
    static PyObject *__pyx_float_1_1;
    static PyObject *__pyx_float_0_01;
    static PyObject *__pyx_float_1eneg_4;
    static PyObject *__pyx_float_1eneg_5;
    static PyObject *__pyx_float_1eneg_6;
    static PyObject *__pyx_float_1eneg_9;
    static PyObject *__pyx_float_1eneg_10;
    static PyObject *__pyx_int_0;
    static PyObject *__pyx_int_1;
    static PyObject *__pyx_int_2;
    static PyObject *__pyx_int_3;
    static PyObject *__pyx_int_9;
    static PyObject *__pyx_int_10;
    static PyObject *__pyx_int_1000;
    static PyObject *__pyx_int_neg_1;
    static double __pyx_k__10;
    static PyObject *__pyx_slice__6;
    static PyObject *__pyx_slice__7;
    static PyObject *__pyx_slice__8;
    static PyObject *__pyx_slice__9;
    static PyObject *__pyx_tuple__4;
    static PyObject *__pyx_tuple__5;
    static PyObject *__pyx_slice__11;
    static PyObject *__pyx_tuple__12;
    static PyObject *__pyx_tuple__14;
    static PyObject *__pyx_tuple__15;
    static PyObject *__pyx_tuple__16;
    static PyObject *__pyx_tuple__17;
    static PyObject *__pyx_tuple__18;
    static PyObject *__pyx_tuple__19;
    static PyObject *__pyx_tuple__20;
    static PyObject *__pyx_tuple__21;
    static PyObject *__pyx_tuple__22;
    static PyObject *__pyx_tuple__23;
    static PyObject *__pyx_tuple__24;
    static PyObject *__pyx_tuple__25;
    static PyObject *__pyx_tuple__26;
    static PyObject *__pyx_tuple__29;
    static PyObject *__pyx_tuple__31;
    static PyObject *__pyx_tuple__32;
    static PyObject *__pyx_tuple__34;
    static PyObject *__pyx_tuple__35;
    static PyObject *__pyx_tuple__36;
    static PyObject *__pyx_tuple__37;
    static PyObject *__pyx_tuple__38;
    static PyObject *__pyx_tuple__40;
    static PyObject *__pyx_tuple__42;
    static PyObject *__pyx_tuple__45;
    static PyObject *__pyx_tuple__47;
    static PyObject *__pyx_tuple__50;
    static PyObject *__pyx_tuple__52;
    static PyObject *__pyx_tuple__54;
    static PyObject *__pyx_tuple__56;
    static PyObject *__pyx_tuple__58;
    static PyObject *__pyx_tuple__60;
    static PyObject *__pyx_tuple__62;
    static PyObject *__pyx_tuple__64;
    static PyObject *__pyx_tuple__66;
    static PyObject *__pyx_tuple__68;
    static PyObject *__pyx_tuple__70;
    static PyObject *__pyx_tuple__72;
    static PyObject *__pyx_tuple__74;
    static PyObject *__pyx_tuple__76;
    static PyObject *__pyx_tuple__78;
    static PyObject *__pyx_tuple__80;
    static PyObject *__pyx_tuple__82;
    static PyObject *__pyx_tuple__84;
    static PyObject *__pyx_tuple__86;
    static PyObject *__pyx_tuple__88;
    static PyObject *__pyx_tuple__90;
    static PyObject *__pyx_tuple__92;
    static PyObject *__pyx_tuple__94;
    static PyObject *__pyx_tuple__96;
    static PyObject *__pyx_tuple__98;
    static PyObject *__pyx_tuple__100;
    static PyObject *__pyx_tuple__102;
    static PyObject *__pyx_tuple__104;
    static PyObject *__pyx_tuple__106;
    static PyObject *__pyx_tuple__108;
    static PyObject *__pyx_tuple__110;
    static PyObject *__pyx_tuple__112;
    static PyObject *__pyx_tuple__114;
    static PyObject *__pyx_tuple__116;
    static PyObject *__pyx_tuple__118;
    static PyObject *__pyx_codeobj__39;
    static PyObject *__pyx_codeobj__41;
    static PyObject *__pyx_codeobj__43;
    static PyObject *__pyx_codeobj__44;
    static PyObject *__pyx_codeobj__46;
    static PyObject *__pyx_codeobj__48;
    static PyObject *__pyx_codeobj__49;
    static PyObject *__pyx_codeobj__51;
    static PyObject *__pyx_codeobj__53;
    static PyObject *__pyx_codeobj__55;
    static PyObject *__pyx_codeobj__57;
    static PyObject *__pyx_codeobj__59;
    static PyObject *__pyx_codeobj__61;
    static PyObject *__pyx_codeobj__63;
    static PyObject *__pyx_codeobj__65;
    static PyObject *__pyx_codeobj__67;
    static PyObject *__pyx_codeobj__69;
    static PyObject *__pyx_codeobj__71;
    static PyObject *__pyx_codeobj__73;
    static PyObject *__pyx_codeobj__75;
    static PyObject *__pyx_codeobj__77;
    static PyObject *__pyx_codeobj__79;
    static PyObject *__pyx_codeobj__81;
    static PyObject *__pyx_codeobj__83;
    static PyObject *__pyx_codeobj__85;
    static PyObject *__pyx_codeobj__87;
    static PyObject *__pyx_codeobj__89;
    static PyObject *__pyx_codeobj__91;
    static PyObject *__pyx_codeobj__93;
    static PyObject *__pyx_codeobj__95;
    static PyObject *__pyx_codeobj__97;
    static PyObject *__pyx_codeobj__99;
    static PyObject *__pyx_codeobj__101;
    static PyObject *__pyx_codeobj__103;
    static PyObject *__pyx_codeobj__105;
    static PyObject *__pyx_codeobj__107;
    static PyObject *__pyx_codeobj__109;
    static PyObject *__pyx_codeobj__111;
    static PyObject *__pyx_codeobj__113;
    static PyObject *__pyx_codeobj__115;
    static PyObject *__pyx_codeobj__117;
    static PyObject *__pyx_codeobj__119;

/* "qnet.pyx":71
 * cdef int is_slice_sorted = 0
 * 
 * def set_sampler (str):             # <<<<<<<<<<<<<<
 *     global sampler
 *     if str == "SLICE": sampler = SLICE
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_1set_sampler(PyObject *__pyx_self, PyObject *__pyx_v_str); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_1set_sampler = {"set_sampler", (PyCFunction)__pyx_pw_4qnet_1set_sampler, METH_O, 0};
static PyObject *__pyx_pw_4qnet_1set_sampler(PyObject *__pyx_self, PyObject *__pyx_v_str) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_sampler (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_set_sampler(__pyx_self, ((PyObject *)__pyx_v_str));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_set_sampler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_str) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_sampler", 0);

  /* "qnet.pyx":73
 * def set_sampler (str):
 *     global sampler
 *     if str == "SLICE": sampler = SLICE             # <<<<<<<<<<<<<<
 *     elif str == "SLICE_PWFUN": sampler = SLICE_PWFUN
 *     elif str == "ARS_PWFUN": sampler = ARS_PWFUN
 */
  __pyx_t_1 = (__Pyx_PyString_Equals(__pyx_v_str, __pyx_n_s_SLICE, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_v_4qnet_sampler = __pyx_e_4qnet_SLICE;
    goto __pyx_L3;
  }

  /* "qnet.pyx":74
 *     global sampler
 *     if str == "SLICE": sampler = SLICE
 *     elif str == "SLICE_PWFUN": sampler = SLICE_PWFUN             # <<<<<<<<<<<<<<
 *     elif str == "ARS_PWFUN": sampler = ARS_PWFUN
 *     elif str == "STUPID_REJECT": sampler = STUPID_REJECT
 */
  __pyx_t_1 = (__Pyx_PyString_Equals(__pyx_v_str, __pyx_n_s_SLICE_PWFUN, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_v_4qnet_sampler = __pyx_e_4qnet_SLICE_PWFUN;
    goto __pyx_L3;
  }

  /* "qnet.pyx":75
 *     if str == "SLICE": sampler = SLICE
 *     elif str == "SLICE_PWFUN": sampler = SLICE_PWFUN
 *     elif str == "ARS_PWFUN": sampler = ARS_PWFUN             # <<<<<<<<<<<<<<
 *     elif str == "STUPID_REJECT": sampler = STUPID_REJECT
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 */
  __pyx_t_1 = (__Pyx_PyString_Equals(__pyx_v_str, __pyx_n_s_ARS_PWFUN, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_v_4qnet_sampler = __pyx_e_4qnet_ARS_PWFUN;
    goto __pyx_L3;
  }

  /* "qnet.pyx":76
 *     elif str == "SLICE_PWFUN": sampler = SLICE_PWFUN
 *     elif str == "ARS_PWFUN": sampler = ARS_PWFUN
 *     elif str == "STUPID_REJECT": sampler = STUPID_REJECT             # <<<<<<<<<<<<<<
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 * 
 */
  __pyx_t_1 = (__Pyx_PyString_Equals(__pyx_v_str, __pyx_n_s_STUPID_REJECT, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_1) {
    __pyx_v_4qnet_sampler = __pyx_e_4qnet_STUPID_REJECT;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "qnet.pyx":77
 *     elif str == "ARS_PWFUN": sampler = ARS_PWFUN
 *     elif str == "STUPID_REJECT": sampler = STUPID_REJECT
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)             # <<<<<<<<<<<<<<
 * 
 * def set_use_rtp (doitp):
 */
    __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_Could_not_understand_one_d_sampl, __pyx_v_str); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L3:;

  /* "qnet.pyx":71
 * cdef int is_slice_sorted = 0
 * 
 * def set_sampler (str):             # <<<<<<<<<<<<<<
 *     global sampler
 *     if str == "SLICE": sampler = SLICE
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.set_sampler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":79
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 * 
 * def set_use_rtp (doitp):             # <<<<<<<<<<<<<<
 *     global doUseRtp
 *     doUseRtp = doitp
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_3set_use_rtp(PyObject *__pyx_self, PyObject *__pyx_v_doitp); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_3set_use_rtp = {"set_use_rtp", (PyCFunction)__pyx_pw_4qnet_3set_use_rtp, METH_O, 0};
static PyObject *__pyx_pw_4qnet_3set_use_rtp(PyObject *__pyx_self, PyObject *__pyx_v_doitp) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_use_rtp (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_2set_use_rtp(__pyx_self, ((PyObject *)__pyx_v_doitp));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_2set_use_rtp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_doitp) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_use_rtp", 0);

  /* "qnet.pyx":81
 * def set_use_rtp (doitp):
 *     global doUseRtp
 *     doUseRtp = doitp             # <<<<<<<<<<<<<<
 * 
 * def set_initialization_type (type):
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_doitp); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_doUseRtp = __pyx_t_1;

  /* "qnet.pyx":79
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 * 
 * def set_use_rtp (doitp):             # <<<<<<<<<<<<<<
 *     global doUseRtp
 *     doUseRtp = doitp
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("qnet.set_use_rtp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":83
 *     doUseRtp = doitp
 * 
 * def set_initialization_type (type):             # <<<<<<<<<<<<<<
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_5set_initialization_type(PyObject *__pyx_self, PyObject *__pyx_v_type); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_5set_initialization_type = {"set_initialization_type", (PyCFunction)__pyx_pw_4qnet_5set_initialization_type, METH_O, 0};
static PyObject *__pyx_pw_4qnet_5set_initialization_type(PyObject *__pyx_self, PyObject *__pyx_v_type) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_initialization_type (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4set_initialization_type(__pyx_self, ((PyObject *)__pyx_v_type));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4set_initialization_type(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_type) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_initialization_type", 0);
  __Pyx_INCREF(__pyx_v_type);

  /* "qnet.pyx":85
 * def set_initialization_type (type):
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type             # <<<<<<<<<<<<<<
 *     if callable (type):
 *         initializer = type
 */
  __pyx_t_2 = PyString_Check(__pyx_v_type); 
  if ((__pyx_t_2 != 0)) {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_type, __pyx_n_s_upper); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (__pyx_t_5) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else {
      __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(__pyx_v_type);
    __pyx_t_1 = __pyx_v_type;
  }
  __Pyx_DECREF_SET(__pyx_v_type, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":86
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type
 *     if callable (type):             # <<<<<<<<<<<<<<
 *         initializer = type
 *     elif type == "DFN1":
 */
  __pyx_t_2 = __Pyx_PyCallable_Check(__pyx_v_type); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_6 = (__pyx_t_2 != 0);
  if (__pyx_t_6) {

    /* "qnet.pyx":87
 *     type = type.upper() if isinstance(type, str) else type
 *     if callable (type):
 *         initializer = type             # <<<<<<<<<<<<<<
 *     elif type == "DFN1":
 *         initializer = gibbs_initialize_via_dfn1
 */
    __Pyx_INCREF(__pyx_v_type);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_v_type);
    __Pyx_GIVEREF(__pyx_v_type);
    goto __pyx_L3;
  }

  /* "qnet.pyx":88
 *     if callable (type):
 *         initializer = type
 *     elif type == "DFN1":             # <<<<<<<<<<<<<<
 *         initializer = gibbs_initialize_via_dfn1
 *     elif type == "DFN2":
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_DFN1, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":89
 *         initializer = type
 *     elif type == "DFN1":
 *         initializer = gibbs_initialize_via_dfn1             # <<<<<<<<<<<<<<
 *     elif type == "DFN2":
 *         initializer = gibbs_initialize_via_dfn2
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "qnet.pyx":90
 *     elif type == "DFN1":
 *         initializer = gibbs_initialize_via_dfn1
 *     elif type == "DFN2":             # <<<<<<<<<<<<<<
 *         initializer = gibbs_initialize_via_dfn2
 *     elif type == "LP":
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_DFN2, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":91
 *         initializer = gibbs_initialize_via_dfn1
 *     elif type == "DFN2":
 *         initializer = gibbs_initialize_via_dfn2             # <<<<<<<<<<<<<<
 *     elif type == "LP":
 *         initializer = gibbs_initialize_via_lp
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "qnet.pyx":92
 *     elif type == "DFN2":
 *         initializer = gibbs_initialize_via_dfn2
 *     elif type == "LP":             # <<<<<<<<<<<<<<
 *         initializer = gibbs_initialize_via_lp
 *     elif type == "MINILP":
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_LP, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":93
 *         initializer = gibbs_initialize_via_dfn2
 *     elif type == "LP":
 *         initializer = gibbs_initialize_via_lp             # <<<<<<<<<<<<<<
 *     elif type == "MINILP":
 *         initializer = gibbs_initialize_via_minilp
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_lp); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "qnet.pyx":94
 *     elif type == "LP":
 *         initializer = gibbs_initialize_via_lp
 *     elif type == "MINILP":             # <<<<<<<<<<<<<<
 *         initializer = gibbs_initialize_via_minilp
 *     elif type == "PS":
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_MINILP, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":95
 *         initializer = gibbs_initialize_via_lp
 *     elif type == "MINILP":
 *         initializer = gibbs_initialize_via_minilp             # <<<<<<<<<<<<<<
 *     elif type == "PS":
 *         initializer = gibbs_initialize_for_ps
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_minilp); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "qnet.pyx":96
 *     elif type == "MINILP":
 *         initializer = gibbs_initialize_via_minilp
 *     elif type == "PS":             # <<<<<<<<<<<<<<
 *         initializer = gibbs_initialize_for_ps
 *     elif type == "NONE":
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_PS, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":97
 *         initializer = gibbs_initialize_via_minilp
 *     elif type == "PS":
 *         initializer = gibbs_initialize_for_ps             # <<<<<<<<<<<<<<
 *     elif type == "NONE":
 *         initializer = null_initializer
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_for_ps); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }

  /* "qnet.pyx":98
 *     elif type == "PS":
 *         initializer = gibbs_initialize_for_ps
 *     elif type == "NONE":             # <<<<<<<<<<<<<<
 *         initializer = null_initializer
 *     else:
 */
  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_type, __pyx_n_s_NONE, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_6) {

    /* "qnet.pyx":99
 *         initializer = gibbs_initialize_for_ps
 *     elif type == "NONE":
 *         initializer = null_initializer             # <<<<<<<<<<<<<<
 *     else:
 *         raise Exception ("Cannot understand type %s" % type)
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_null_initializer); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
    __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  /*else*/ {

    /* "qnet.pyx":101
 *         initializer = null_initializer
 *     else:
 *         raise Exception ("Cannot understand type %s" % type)             # <<<<<<<<<<<<<<
 *     print "New QNET initializer = ", initializer
 * 
 */
    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Cannot_understand_type_s, __pyx_v_type); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_L3:;

  /* "qnet.pyx":102
 *     else:
 *         raise Exception ("Cannot understand type %s" % type)
 *     print "New QNET initializer = ", initializer             # <<<<<<<<<<<<<<
 * 
 * def get_initializer (): return initializer
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_s_New_QNET_initializer);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_New_QNET_initializer);
  __Pyx_GIVEREF(__pyx_kp_s_New_QNET_initializer);
  __Pyx_INCREF(__pyx_v_4qnet_initializer);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_4qnet_initializer);
  __Pyx_GIVEREF(__pyx_v_4qnet_initializer);
  if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":83
 *     doUseRtp = doitp
 * 
 * def set_initialization_type (type):             # <<<<<<<<<<<<<<
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.set_initialization_type", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_type);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":104
 *     print "New QNET initializer = ", initializer
 * 
 * def get_initializer (): return initializer             # <<<<<<<<<<<<<<
 * 
 * def set_slice_sorted (val):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_7get_initializer(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_7get_initializer = {"get_initializer", (PyCFunction)__pyx_pw_4qnet_7get_initializer, METH_NOARGS, 0};
static PyObject *__pyx_pw_4qnet_7get_initializer(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_initializer (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_6get_initializer(__pyx_self);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_6get_initializer(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_initializer", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_4qnet_initializer);
  __pyx_r = __pyx_v_4qnet_initializer;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":106
 * def get_initializer (): return initializer
 * 
 * def set_slice_sorted (val):             # <<<<<<<<<<<<<<
 *     global is_slice_sorted
 *     is_slice_sorted = val
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_9set_slice_sorted(PyObject *__pyx_self, PyObject *__pyx_v_val); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_9set_slice_sorted = {"set_slice_sorted", (PyCFunction)__pyx_pw_4qnet_9set_slice_sorted, METH_O, 0};
static PyObject *__pyx_pw_4qnet_9set_slice_sorted(PyObject *__pyx_self, PyObject *__pyx_v_val) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_slice_sorted (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_8set_slice_sorted(__pyx_self, ((PyObject *)__pyx_v_val));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_8set_slice_sorted(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_val) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("set_slice_sorted", 0);

  /* "qnet.pyx":108
 * def set_slice_sorted (val):
 *     global is_slice_sorted
 *     is_slice_sorted = val             # <<<<<<<<<<<<<<
 *     "QNET slice_sorted = ", val
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_val); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_is_slice_sorted = __pyx_t_1;

  /* "qnet.pyx":109
 *     global is_slice_sorted
 *     is_slice_sorted = val
 *     "QNET slice_sorted = ", val             # <<<<<<<<<<<<<<
 * 
 * # end configuration
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_s_QNET_slice_sorted);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_QNET_slice_sorted);
  __Pyx_GIVEREF(__pyx_kp_s_QNET_slice_sorted);
  __Pyx_INCREF(__pyx_v_val);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_val);
  __Pyx_GIVEREF(__pyx_v_val);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":106
 * def get_initializer (): return initializer
 * 
 * def set_slice_sorted (val):             # <<<<<<<<<<<<<<
 *     global is_slice_sorted
 *     is_slice_sorted = val
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("qnet.set_slice_sorted", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":122
 * cdef int num_diff = 0
 * 
 * def reset_stats():             # <<<<<<<<<<<<<<
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_11reset_stats(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_11reset_stats = {"reset_stats", (PyCFunction)__pyx_pw_4qnet_11reset_stats, METH_NOARGS, 0};
static PyObject *__pyx_pw_4qnet_11reset_stats(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset_stats (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_10reset_stats(__pyx_self);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_10reset_stats(CYTHON_UNUSED PyObject *__pyx_self) {
  CYTHON_UNUSED long __pyx_v_num_diff;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset_stats", 0);

  /* "qnet.pyx":124
 * def reset_stats():
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0             # <<<<<<<<<<<<<<
 *     nevents = 0
 *     nrtp_reject = 0
 */
  __pyx_v_4qnet_nreject = 0;

  /* "qnet.pyx":125
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0
 *     nevents = 0             # <<<<<<<<<<<<<<
 *     nrtp_reject = 0
 *     nrtp_calls = 0
 */
  __pyx_v_4qnet_nevents = 0;

  /* "qnet.pyx":126
 *     nreject = 0
 *     nevents = 0
 *     nrtp_reject = 0             # <<<<<<<<<<<<<<
 *     nrtp_calls = 0
 *     diff_len = 0
 */
  __pyx_v_4qnet_nrtp_reject = 0;

  /* "qnet.pyx":127
 *     nevents = 0
 *     nrtp_reject = 0
 *     nrtp_calls = 0             # <<<<<<<<<<<<<<
 *     diff_len = 0
 *     num_diff = 0
 */
  __pyx_v_4qnet_nrtp_calls = 0;

  /* "qnet.pyx":128
 *     nrtp_reject = 0
 *     nrtp_calls = 0
 *     diff_len = 0             # <<<<<<<<<<<<<<
 *     num_diff = 0
 * 
 */
  __pyx_v_4qnet_diff_len = 0;

  /* "qnet.pyx":129
 *     nrtp_calls = 0
 *     diff_len = 0
 *     num_diff = 0             # <<<<<<<<<<<<<<
 * 
 * def stats():
 */
  __pyx_v_num_diff = 0;

  /* "qnet.pyx":122
 * cdef int num_diff = 0
 * 
 * def reset_stats():             # <<<<<<<<<<<<<<
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":131
 *     num_diff = 0
 * 
 * def stats():             # <<<<<<<<<<<<<<
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_13stats(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_13stats = {"stats", (PyCFunction)__pyx_pw_4qnet_13stats, METH_NOARGS, 0};
static PyObject *__pyx_pw_4qnet_13stats(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("stats (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_12stats(__pyx_self);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_12stats(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("stats", 0);

  /* "qnet.pyx":132
 * 
 * def stats():
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}             # <<<<<<<<<<<<<<
 * 
 * reset_stats()
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_nreject); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nreject, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_nevents); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nevents, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_nrtp_calls); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nrtp_calls, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_nrtp_reject); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_nrtp_reject, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_diff_len); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_diff_len, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_4qnet_num_diff); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_num_diff, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":131
 *     num_diff = 0
 * 
 * def stats():             # <<<<<<<<<<<<<<
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("qnet.stats", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":145
 * cdef class Qnet:
 * 
 *     def __init__ (self, queues, templates, universe, qname2id, sname2id, fsm):             # <<<<<<<<<<<<<<
 *         self.queues = queues
 *         self.templates = templates
 */

/* Python wrapper */
static int __pyx_pw_4qnet_4Qnet_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_4qnet_4Qnet_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_queues = 0;
  PyObject *__pyx_v_templates = 0;
  PyObject *__pyx_v_universe = 0;
  PyObject *__pyx_v_qname2id = 0;
  PyObject *__pyx_v_sname2id = 0;
  PyObject *__pyx_v_fsm = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_queues,&__pyx_n_s_templates,&__pyx_n_s_universe,&__pyx_n_s_qname2id,&__pyx_n_s_sname2id,&__pyx_n_s_fsm,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_queues)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_templates)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_universe)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_qname2id)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  4:
        if (likely((values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_sname2id)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, 4); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  5:
        if (likely((values[5] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_fsm)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, 5); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
    }
    __pyx_v_queues = values[0];
    __pyx_v_templates = values[1];
    __pyx_v_universe = values[2];
    __pyx_v_qname2id = values[3];
    __pyx_v_sname2id = values[4];
    __pyx_v_fsm = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_4Qnet___init__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_queues, __pyx_v_templates, __pyx_v_universe, __pyx_v_qname2id, __pyx_v_sname2id, __pyx_v_fsm);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_4qnet_4Qnet___init__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_queues, PyObject *__pyx_v_templates, PyObject *__pyx_v_universe, PyObject *__pyx_v_qname2id, PyObject *__pyx_v_sname2id, PyObject *__pyx_v_fsm) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "qnet.pyx":146
 * 
 *     def __init__ (self, queues, templates, universe, qname2id, sname2id, fsm):
 *         self.queues = queues             # <<<<<<<<<<<<<<
 *         self.templates = templates
 *         self.universe = universe
 */
  __Pyx_INCREF(__pyx_v_queues);
  __Pyx_GIVEREF(__pyx_v_queues);
  __Pyx_GOTREF(__pyx_v_self->queues);
  __Pyx_DECREF(__pyx_v_self->queues);
  __pyx_v_self->queues = __pyx_v_queues;

  /* "qnet.pyx":147
 *     def __init__ (self, queues, templates, universe, qname2id, sname2id, fsm):
 *         self.queues = queues
 *         self.templates = templates             # <<<<<<<<<<<<<<
 *         self.universe = universe
 *         self.fsm = fsm
 */
  __Pyx_INCREF(__pyx_v_templates);
  __Pyx_GIVEREF(__pyx_v_templates);
  __Pyx_GOTREF(__pyx_v_self->templates);
  __Pyx_DECREF(__pyx_v_self->templates);
  __pyx_v_self->templates = __pyx_v_templates;

  /* "qnet.pyx":148
 *         self.queues = queues
 *         self.templates = templates
 *         self.universe = universe             # <<<<<<<<<<<<<<
 *         self.fsm = fsm
 *         self.qname2id = qname2id
 */
  __Pyx_INCREF(__pyx_v_universe);
  __Pyx_GIVEREF(__pyx_v_universe);
  __Pyx_GOTREF(__pyx_v_self->universe);
  __Pyx_DECREF(__pyx_v_self->universe);
  __pyx_v_self->universe = __pyx_v_universe;

  /* "qnet.pyx":149
 *         self.templates = templates
 *         self.universe = universe
 *         self.fsm = fsm             # <<<<<<<<<<<<<<
 *         self.qname2id = qname2id
 *         self.sname2id = sname2id
 */
  __Pyx_INCREF(__pyx_v_fsm);
  __Pyx_GIVEREF(__pyx_v_fsm);
  __Pyx_GOTREF(__pyx_v_self->fsm);
  __Pyx_DECREF(__pyx_v_self->fsm);
  __pyx_v_self->fsm = __pyx_v_fsm;

  /* "qnet.pyx":150
 *         self.universe = universe
 *         self.fsm = fsm
 *         self.qname2id = qname2id             # <<<<<<<<<<<<<<
 *         self.sname2id = sname2id
 *         self.eidx = -1
 */
  __Pyx_INCREF(__pyx_v_qname2id);
  __Pyx_GIVEREF(__pyx_v_qname2id);
  __Pyx_GOTREF(__pyx_v_self->qname2id);
  __Pyx_DECREF(__pyx_v_self->qname2id);
  __pyx_v_self->qname2id = __pyx_v_qname2id;

  /* "qnet.pyx":151
 *         self.fsm = fsm
 *         self.qname2id = qname2id
 *         self.sname2id = sname2id             # <<<<<<<<<<<<<<
 *         self.eidx = -1
 * 
 */
  __Pyx_INCREF(__pyx_v_sname2id);
  __Pyx_GIVEREF(__pyx_v_sname2id);
  __Pyx_GOTREF(__pyx_v_self->sname2id);
  __Pyx_DECREF(__pyx_v_self->sname2id);
  __pyx_v_self->sname2id = __pyx_v_sname2id;

  /* "qnet.pyx":152
 *         self.qname2id = qname2id
 *         self.sname2id = sname2id
 *         self.eidx = -1             # <<<<<<<<<<<<<<
 * 
 *     def as_yaml (self):
 */
  __pyx_v_self->eidx = -1;

  /* "qnet.pyx":145
 * cdef class Qnet:
 * 
 *     def __init__ (self, queues, templates, universe, qname2id, sname2id, fsm):             # <<<<<<<<<<<<<<
 *         self.queues = queues
 *         self.templates = templates
 */

  /* function exit code */
  __pyx_r = 0;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":154
 *         self.eidx = -1
 * 
 *     def as_yaml (self):             # <<<<<<<<<<<<<<
 *         ret = "states:\n"
 *         for si in range(self.fsm.num_states()):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_3as_yaml(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_3as_yaml(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("as_yaml (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_2as_yaml(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_2as_yaml(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_v_ret = NULL;
  PyObject *__pyx_v_si = NULL;
  PyObject *__pyx_v_sname = NULL;
  PyObject *__pyx_v_qnames = NULL;
  PyObject *__pyx_v_successors = NULL;
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_si_next = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("as_yaml", 0);

  /* "qnet.pyx":155
 * 
 *     def as_yaml (self):
 *         ret = "states:\n"             # <<<<<<<<<<<<<<
 *         for si in range(self.fsm.num_states()):
 *             sname = self.sid_to_name (si)
 */
  __Pyx_INCREF(__pyx_kp_s_states);
  __pyx_v_ret = __pyx_kp_s_states;

  /* "qnet.pyx":156
 *     def as_yaml (self):
 *         ret = "states:\n"
 *         for si in range(self.fsm.num_states()):             # <<<<<<<<<<<<<<
 *             sname = self.sid_to_name (si)
 *             ret += "  - name: %s\n" % sname
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_num_states); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_si, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":157
 *         ret = "states:\n"
 *         for si in range(self.fsm.num_states()):
 *             sname = self.sid_to_name (si)             # <<<<<<<<<<<<<<
 *             ret += "  - name: %s\n" % sname
 *             qnames = [ q.name for q in self.queues_of_state (si) ]
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_sid_to_name); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_si); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_si);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_si);
      __Pyx_GIVEREF(__pyx_v_si);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_sname, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":158
 *         for si in range(self.fsm.num_states()):
 *             sname = self.sid_to_name (si)
 *             ret += "  - name: %s\n" % sname             # <<<<<<<<<<<<<<
 *             qnames = [ q.name for q in self.queues_of_state (si) ]
 *             ret += "    queues: [ %s ]\n" % ",".join (qnames)
 */
    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_name_s, __pyx_v_sname); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":159
 *             sname = self.sid_to_name (si)
 *             ret += "  - name: %s\n" % sname
 *             qnames = [ q.name for q in self.queues_of_state (si) ]             # <<<<<<<<<<<<<<
 *             ret += "    queues: [ %s ]\n" % ",".join (qnames)
 *             successors = [ self.sid_to_name (si_next) for si_next in self.fsm.successors (si) ]
 */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_queues_of_state); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_si); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_si);
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_si);
      __Pyx_GIVEREF(__pyx_v_si);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_7 = __pyx_t_1; __Pyx_INCREF(__pyx_t_7); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_10 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_7))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_7, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_7, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_10(__pyx_t_7);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_qnames, ((PyObject*)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":160
 *             ret += "  - name: %s\n" % sname
 *             qnames = [ q.name for q in self.queues_of_state (si) ]
 *             ret += "    queues: [ %s ]\n" % ",".join (qnames)             # <<<<<<<<<<<<<<
 *             successors = [ self.sid_to_name (si_next) for si_next in self.fsm.successors (si) ]
 *             if len(successors) > 0:
 */
    __pyx_t_3 = __Pyx_PyString_Join(__pyx_kp_s_, __pyx_v_qnames); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_queues_s, __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":161
 *             qnames = [ q.name for q in self.queues_of_state (si) ]
 *             ret += "    queues: [ %s ]\n" % ",".join (qnames)
 *             successors = [ self.sid_to_name (si_next) for si_next in self.fsm.successors (si) ]             # <<<<<<<<<<<<<<
 *             if len(successors) > 0:
 *                 ret += "    successors: [ %s ]\n" % ",".join(successors)
 */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_successors); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_si); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
    } else {
      __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
      __Pyx_INCREF(__pyx_v_si);
      PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_v_si);
      __Pyx_GIVEREF(__pyx_v_si);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(PyList_CheckExact(__pyx_t_7)) || PyTuple_CheckExact(__pyx_t_7)) {
      __pyx_t_1 = __pyx_t_7; __Pyx_INCREF(__pyx_t_1); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_7); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_7); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_7 = __pyx_t_10(__pyx_t_1);
        if (unlikely(!__pyx_t_7)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_7);
      }
      __Pyx_XDECREF_SET(__pyx_v_si_next, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_sid_to_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_si_next); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
      } else {
        __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
        __Pyx_INCREF(__pyx_v_si_next);
        PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_si_next);
        __Pyx_GIVEREF(__pyx_v_si_next);
        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_7))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_successors, ((PyObject*)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":162
 *             ret += "    queues: [ %s ]\n" % ",".join (qnames)
 *             successors = [ self.sid_to_name (si_next) for si_next in self.fsm.successors (si) ]
 *             if len(successors) > 0:             # <<<<<<<<<<<<<<
 *                 ret += "    successors: [ %s ]\n" % ",".join(successors)
 *         ret += "queues:\n"
 */
    __pyx_t_9 = PyList_GET_SIZE(__pyx_v_successors); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_12 = ((__pyx_t_9 > 0) != 0);
    if (__pyx_t_12) {

      /* "qnet.pyx":163
 *             successors = [ self.sid_to_name (si_next) for si_next in self.fsm.successors (si) ]
 *             if len(successors) > 0:
 *                 ret += "    successors: [ %s ]\n" % ",".join(successors)             # <<<<<<<<<<<<<<
 *         ret += "queues:\n"
 *         for qi in range(len(self.queues)):
 */
      __pyx_t_3 = __Pyx_PyString_Join(__pyx_kp_s_, __pyx_v_successors); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_successors_s, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_3);
      __pyx_t_3 = 0;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "qnet.pyx":156
 *     def as_yaml (self):
 *         ret = "states:\n"
 *         for si in range(self.fsm.num_states()):             # <<<<<<<<<<<<<<
 *             sname = self.sid_to_name (si)
 *             ret += "  - name: %s\n" % sname
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":164
 *             if len(successors) > 0:
 *                 ret += "    successors: [ %s ]\n" % ",".join(successors)
 *         ret += "queues:\n"             # <<<<<<<<<<<<<<
 *         for qi in range(len(self.queues)):
 *             ret += self.queues[qi].as_yaml ()
 */
  __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_kp_s_queues_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":165
 *                 ret += "    successors: [ %s ]\n" % ",".join(successors)
 *         ret += "queues:\n"
 *         for qi in range(len(self.queues)):             # <<<<<<<<<<<<<<
 *             ret += self.queues[qi].as_yaml ()
 *             ret += "\n"
 */
  __pyx_t_2 = __pyx_v_self->queues;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_4 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_4; __pyx_t_9+=1) {
    __pyx_v_qi = __pyx_t_9;

    /* "qnet.pyx":166
 *         ret += "queues:\n"
 *         for qi in range(len(self.queues)):
 *             ret += self.queues[qi].as_yaml ()             # <<<<<<<<<<<<<<
 *             ret += "\n"
 *         return ret
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self->queues, __pyx_v_qi, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_as_yaml); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":167
 *         for qi in range(len(self.queues)):
 *             ret += self.queues[qi].as_yaml ()
 *             ret += "\n"             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
    __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_kp_s__2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_1);
    __pyx_t_1 = 0;
  }

  /* "qnet.pyx":168
 *             ret += self.queues[qi].as_yaml ()
 *             ret += "\n"
 *         return ret             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "qnet.pyx":154
 *         self.eidx = -1
 * 
 *     def as_yaml (self):             # <<<<<<<<<<<<<<
 *         ret = "states:\n"
 *         for si in range(self.fsm.num_states()):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("qnet.Qnet.as_yaml", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XDECREF(__pyx_v_si);
  __Pyx_XDECREF(__pyx_v_sname);
  __Pyx_XDECREF(__pyx_v_qnames);
  __Pyx_XDECREF(__pyx_v_successors);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_si_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":172
 * 
 * 
 *     def as_xml (self):             # <<<<<<<<<<<<<<
 *         ret = "<QNET>\n  <QUEUES>\n"
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_5as_xml(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_5as_xml(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("as_xml (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_4as_xml(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_4as_xml(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_v_ret = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("as_xml", 0);

  /* "qnet.pyx":173
 * 
 *     def as_xml (self):
 *         ret = "<QNET>\n  <QUEUES>\n"             # <<<<<<<<<<<<<<
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"
 *         ret = ret + "\n  </QUEUES>\n</QNET>"
 */
  __Pyx_INCREF(__pyx_kp_s_QNET_QUEUES);
  __pyx_v_ret = __pyx_kp_s_QNET_QUEUES;

  /* "qnet.pyx":174
 *     def as_xml (self):
 *         ret = "<QNET>\n  <QUEUES>\n"
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"             # <<<<<<<<<<<<<<
 *         ret = ret + "\n  </QUEUES>\n</QNET>"
 *         return ret
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Add(__pyx_v_ret, __pyx_kp_s__3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_q);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_q);
    __Pyx_GIVEREF(__pyx_v_q);
    __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)(&PyString_Type))), __pyx_t_5, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_kp_s__2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_6);
    __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":175
 *         ret = "<QNET>\n  <QUEUES>\n"
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"
 *         ret = ret + "\n  </QUEUES>\n</QNET>"             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
  __pyx_t_1 = PyNumber_Add(__pyx_v_ret, __pyx_kp_s_QUEUES_QNET); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":176
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"
 *         ret = ret + "\n  </QUEUES>\n</QNET>"
 *         return ret             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "qnet.pyx":172
 * 
 * 
 *     def as_xml (self):             # <<<<<<<<<<<<<<
 *         ret = "<QNET>\n  <QUEUES>\n"
 *         for q in self.queues: ret = ret + "  " + str(q) + "\n"
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.Qnet.as_xml", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":184
 *     # samples assuming that an infinite number of customers queue up according
 *     #  to the initial state.
 *     def sample (self, n):             # <<<<<<<<<<<<<<
 *         """Generates n jobs from this qnet."""
 *         arrv = Arrivals (self)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_7sample(PyObject *__pyx_v_self, PyObject *__pyx_v_n); /*proto*/
static char __pyx_doc_4qnet_4Qnet_6sample[] = "Generates n jobs from this qnet.";
static PyObject *__pyx_pw_4qnet_4Qnet_7sample(PyObject *__pyx_v_self, PyObject *__pyx_v_n) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sample (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_6sample(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_n));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_6sample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_n) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sample", 0);

  /* "qnet.pyx":186
 *     def sample (self, n):
 *         """Generates n jobs from this qnet."""
 *         arrv = Arrivals (self)             # <<<<<<<<<<<<<<
 * 
 *         heap = []
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":188
 *         arrv = Arrivals (self)
 * 
 *         heap = []             # <<<<<<<<<<<<<<
 *         for i in xrange(n):
 *             s_initial = self.fsm.initial_state()
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_heap = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":189
 * 
 *         heap = []
 *         for i in xrange(n):             # <<<<<<<<<<<<<<
 *             s_initial = self.fsm.initial_state()
 *             heappush (heap, (0.0, i, s_initial, SEC_ARRIVAL, None))
 */
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_n);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_n);
  __Pyx_GIVEREF(__pyx_v_n);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":190
 *         heap = []
 *         for i in xrange(n):
 *             s_initial = self.fsm.initial_state()             # <<<<<<<<<<<<<<
 *             heappush (heap, (0.0, i, s_initial, SEC_ARRIVAL, None))
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_s_initial, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":191
 *         for i in xrange(n):
 *             s_initial = self.fsm.initial_state()
 *             heappush (heap, (0.0, i, s_initial, SEC_ARRIVAL, None))             # <<<<<<<<<<<<<<
 * 
 *         return self._sample_discrete_events (heap, arrv, True)
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_ARRIVAL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = PyTuple_New(5); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_float_0_0);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_float_0_0);
    __Pyx_GIVEREF(__pyx_float_0_0);
    __Pyx_INCREF(__pyx_v_i);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_i);
    __Pyx_GIVEREF(__pyx_v_i);
    __Pyx_INCREF(__pyx_v_s_initial);
    PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_v_s_initial);
    __Pyx_GIVEREF(__pyx_v_s_initial);
    PyTuple_SET_ITEM(__pyx_t_7, 3, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __Pyx_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_7, 4, Py_None);
    __Pyx_GIVEREF(Py_None);
    __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_8 = 1;
      }
    }
    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    if (__pyx_t_6) {
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(__pyx_v_heap);
    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_v_heap);
    __Pyx_GIVEREF(__pyx_v_heap);
    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":189
 * 
 *         heap = []
 *         for i in xrange(n):             # <<<<<<<<<<<<<<
 *             s_initial = self.fsm.initial_state()
 *             heappush (heap, (0.0, i, s_initial, SEC_ARRIVAL, None))
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":193
 *             heappush (heap, (0.0, i, s_initial, SEC_ARRIVAL, None))
 * 
 *         return self._sample_discrete_events (heap, arrv, True)             # <<<<<<<<<<<<<<
 * 
 *     def sample_by_time (self, T):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_sample_discrete_events); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  __pyx_t_3 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_3 = 1;
    }
  }
  __pyx_t_9 = PyTuple_New(3+__pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (__pyx_t_5) {
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
  }
  __Pyx_INCREF(__pyx_v_heap);
  PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_3, __pyx_v_heap);
  __Pyx_GIVEREF(__pyx_v_heap);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_3, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(Py_True);
  PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_3, Py_True);
  __Pyx_GIVEREF(Py_True);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":184
 *     # samples assuming that an infinite number of customers queue up according
 *     #  to the initial state.
 *     def sample (self, n):             # <<<<<<<<<<<<<<
 *         """Generates n jobs from this qnet."""
 *         arrv = Arrivals (self)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.Qnet.sample", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":195
 *         return self._sample_discrete_events (heap, arrv, True)
 * 
 *     def sample_by_time (self, T):             # <<<<<<<<<<<<<<
 *         """Simulates the system from time 0...T.  Arrivals must be poisson."""
 *         q0 = self.queues[0]
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_9sample_by_time(PyObject *__pyx_v_self, PyObject *__pyx_v_T); /*proto*/
static char __pyx_doc_4qnet_4Qnet_8sample_by_time[] = "Simulates the system from time 0...T.  Arrivals must be poisson.";
static PyObject *__pyx_pw_4qnet_4Qnet_9sample_by_time(PyObject *__pyx_v_self, PyObject *__pyx_v_T) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sample_by_time (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_8sample_by_time(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_T));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_8sample_by_time(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_T) {
  PyObject *__pyx_v_q0 = NULL;
  PyObject *__pyx_v_delta_bar = NULL;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_allD = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_d_prev = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_v_s = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_eid = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *(*__pyx_t_9)(PyObject *);
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  Py_ssize_t __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sample_by_time", 0);

  /* "qnet.pyx":197
 *     def sample_by_time (self, T):
 *         """Simulates the system from time 0...T.  Arrivals must be poisson."""
 *         q0 = self.queues[0]             # <<<<<<<<<<<<<<
 *         delta_bar = q0.service.parameters[0]
 *         if not q0.is_markov():
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->queues, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_q0 = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":198
 *         """Simulates the system from time 0...T.  Arrivals must be poisson."""
 *         q0 = self.queues[0]
 *         delta_bar = q0.service.parameters[0]             # <<<<<<<<<<<<<<
 *         if not q0.is_markov():
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q0, __pyx_n_s_service); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_parameters); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_delta_bar = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":199
 *         q0 = self.queues[0]
 *         delta_bar = q0.service.parameters[0]
 *         if not q0.is_markov():             # <<<<<<<<<<<<<<
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")
 *         if not len(q0.service.parameters) == 1:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_q0, __pyx_n_s_is_markov); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {

    /* "qnet.pyx":200
 *         delta_bar = q0.service.parameters[0]
 *         if not q0.is_markov():
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")             # <<<<<<<<<<<<<<
 *         if not len(q0.service.parameters) == 1:
 *             raise Exception ("Huh?")
 */
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "qnet.pyx":201
 *         if not q0.is_markov():
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")
 *         if not len(q0.service.parameters) == 1:             # <<<<<<<<<<<<<<
 *             raise Exception ("Huh?")
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q0, __pyx_n_s_service); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_parameters); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = ((!((__pyx_t_6 == 1) != 0)) != 0);
  if (__pyx_t_5) {

    /* "qnet.pyx":202
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")
 *         if not len(q0.service.parameters) == 1:
 *             raise Exception ("Huh?")             # <<<<<<<<<<<<<<
 * 
 *         arrv = Arrivals (self)
 */
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "qnet.pyx":204
 *             raise Exception ("Huh?")
 * 
 *         arrv = Arrivals (self)             # <<<<<<<<<<<<<<
 *         n = random.poisson (T / delta_bar)
 *         heap = []
 */
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":205
 * 
 *         arrv = Arrivals (self)
 *         n = random.poisson (T / delta_bar)             # <<<<<<<<<<<<<<
 *         heap = []
 * 
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_random); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_poisson); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_v_T, __pyx_v_delta_bar); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_n = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":206
 *         arrv = Arrivals (self)
 *         n = random.poisson (T / delta_bar)
 *         heap = []             # <<<<<<<<<<<<<<
 * 
 *         allD = random.uniform(0, T, n)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_heap = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":208
 *         heap = []
 * 
 *         allD = random.uniform(0, T, n)             # <<<<<<<<<<<<<<
 *         allD.sort()
 * 
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_random); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uniform); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_6 = 1;
    }
  }
  __pyx_t_2 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_6, __pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_INCREF(__pyx_v_T);
  PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_6, __pyx_v_T);
  __Pyx_GIVEREF(__pyx_v_T);
  __Pyx_INCREF(__pyx_v_n);
  PyTuple_SET_ITEM(__pyx_t_2, 2+__pyx_t_6, __pyx_v_n);
  __Pyx_GIVEREF(__pyx_v_n);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_allD = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":209
 * 
 *         allD = random.uniform(0, T, n)
 *         allD.sort()             # <<<<<<<<<<<<<<
 * 
 *         sid = self.fsm.initial_state()
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_allD, __pyx_n_s_sort); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":211
 *         allD.sort()
 * 
 *         sid = self.fsm.initial_state()             # <<<<<<<<<<<<<<
 *         qid = self.fsm.sample_one_obs (sid)
 *         q = self.queues[qid]
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_sid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":212
 * 
 *         sid = self.fsm.initial_state()
 *         qid = self.fsm.sample_one_obs (sid)             # <<<<<<<<<<<<<<
 *         q = self.queues[qid]
 * 
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_one_obs); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_sid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":213
 *         sid = self.fsm.initial_state()
 *         qid = self.fsm.sample_one_obs (sid)
 *         q = self.queues[qid]             # <<<<<<<<<<<<<<
 * 
 *         d_prev = 0
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_q = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":215
 *         q = self.queues[qid]
 * 
 *         d_prev = 0             # <<<<<<<<<<<<<<
 *         for i in xrange(n):
 *             d = allD[i]
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_d_prev = __pyx_int_0;

  /* "qnet.pyx":216
 * 
 *         d_prev = 0
 *         for i in xrange(n):             # <<<<<<<<<<<<<<
 *             d = allD[i]
 *             s = d - d_prev
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_n);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_n);
  __Pyx_GIVEREF(__pyx_v_n);
  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_1, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_8)) || PyTuple_CheckExact(__pyx_t_8)) {
    __pyx_t_1 = __pyx_t_8; __Pyx_INCREF(__pyx_t_1); __pyx_t_6 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  for (;;) {
    if (likely(!__pyx_t_9)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_1, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_1, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_9(__pyx_t_1);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "qnet.pyx":217
 *         d_prev = 0
 *         for i in xrange(n):
 *             d = allD[i]             # <<<<<<<<<<<<<<
 *             s = d - d_prev
 *             tid = eid = i
 */
    __pyx_t_8 = PyObject_GetItem(__pyx_v_allD, __pyx_v_i); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_d, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "qnet.pyx":218
 *         for i in xrange(n):
 *             d = allD[i]
 *             s = d - d_prev             # <<<<<<<<<<<<<<
 *             tid = eid = i
 *             evt = Event (eid, tid, qid, q, 0.0, s, d, sid, obs_a=1, obs_d=1)
 */
    __pyx_t_8 = PyNumber_Subtract(__pyx_v_d, __pyx_v_d_prev); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_s, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "qnet.pyx":219
 *             d = allD[i]
 *             s = d - d_prev
 *             tid = eid = i             # <<<<<<<<<<<<<<
 *             evt = Event (eid, tid, qid, q, 0.0, s, d, sid, obs_a=1, obs_d=1)
 *             arrv.append (evt)
 */
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_v_i);
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_v_i);

    /* "qnet.pyx":220
 *             s = d - d_prev
 *             tid = eid = i
 *             evt = Event (eid, tid, qid, q, 0.0, s, d, sid, obs_a=1, obs_d=1)             # <<<<<<<<<<<<<<
 *             arrv.append (evt)
 *             heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))
 */
    __pyx_t_8 = PyTuple_New(8); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_v_eid);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_eid);
    __Pyx_GIVEREF(__pyx_v_eid);
    __Pyx_INCREF(__pyx_v_tid);
    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_tid);
    __Pyx_GIVEREF(__pyx_v_tid);
    __Pyx_INCREF(__pyx_v_qid);
    PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_v_qid);
    __Pyx_GIVEREF(__pyx_v_qid);
    __Pyx_INCREF(__pyx_v_q);
    PyTuple_SET_ITEM(__pyx_t_8, 3, __pyx_v_q);
    __Pyx_GIVEREF(__pyx_v_q);
    __Pyx_INCREF(__pyx_float_0_0);
    PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_float_0_0);
    __Pyx_GIVEREF(__pyx_float_0_0);
    __Pyx_INCREF(__pyx_v_s);
    PyTuple_SET_ITEM(__pyx_t_8, 5, __pyx_v_s);
    __Pyx_GIVEREF(__pyx_v_s);
    __Pyx_INCREF(__pyx_v_d);
    PyTuple_SET_ITEM(__pyx_t_8, 6, __pyx_v_d);
    __Pyx_GIVEREF(__pyx_v_d);
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_8, 7, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_obs_a, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_obs_d, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":221
 *             tid = eid = i
 *             evt = Event (eid, tid, qid, q, 0.0, s, d, sid, obs_a=1, obs_d=1)
 *             arrv.append (evt)             # <<<<<<<<<<<<<<
 *             heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))
 *             d_prev = d
 */
    __pyx_t_10 = __Pyx_PyObject_Append(((PyObject *)__pyx_v_arrv), ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "qnet.pyx":222
 *             evt = Event (eid, tid, qid, q, 0.0, s, d, sid, obs_a=1, obs_d=1)
 *             arrv.append (evt)
 *             heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))             # <<<<<<<<<<<<<<
 *             d_prev = d
 * 
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_DEPARTURE); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_11 = PyTuple_New(5); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_v_tid);
    PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_tid);
    __Pyx_GIVEREF(__pyx_v_tid);
    __Pyx_INCREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_11, 2, Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_11, 3, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_11, 4, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __pyx_t_8 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    __pyx_t_12 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_12 = 1;
      }
    }
    __pyx_t_8 = PyTuple_New(2+__pyx_t_12); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_7) {
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    }
    __Pyx_INCREF(__pyx_v_heap);
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_12, __pyx_v_heap);
    __Pyx_GIVEREF(__pyx_v_heap);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_12, __pyx_t_11);
    __Pyx_GIVEREF(__pyx_t_11);
    __pyx_t_11 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":223
 *             arrv.append (evt)
 *             heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))
 *             d_prev = d             # <<<<<<<<<<<<<<
 * 
 *         return self._sample_discrete_events (heap, arrv, True)
 */
    __Pyx_INCREF(__pyx_v_d);
    __Pyx_DECREF_SET(__pyx_v_d_prev, __pyx_v_d);

    /* "qnet.pyx":216
 * 
 *         d_prev = 0
 *         for i in xrange(n):             # <<<<<<<<<<<<<<
 *             d = allD[i]
 *             s = d - d_prev
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":225
 *             d_prev = d
 * 
 *         return self._sample_discrete_events (heap, arrv, True)             # <<<<<<<<<<<<<<
 * 
 *     # discrete event simulation, private
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_sample_discrete_events); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  __pyx_t_8 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_heap);
  PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_6, __pyx_v_heap);
  __Pyx_GIVEREF(__pyx_v_heap);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_6, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(Py_True);
  PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_6, Py_True);
  __Pyx_GIVEREF(Py_True);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":195
 *         return self._sample_discrete_events (heap, arrv, True)
 * 
 *     def sample_by_time (self, T):             # <<<<<<<<<<<<<<
 *         """Simulates the system from time 0...T.  Arrivals must be poisson."""
 *         q0 = self.queues[0]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("qnet.Qnet.sample_by_time", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_q0);
  __Pyx_XDECREF(__pyx_v_delta_bar);
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_allD);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_d_prev);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_XDECREF(__pyx_v_s);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":228
 * 
 *     # discrete event simulation, private
 *     def _sample_discrete_events (self, heap, Arrivals arrv, obs):             # <<<<<<<<<<<<<<
 *         job_lists = [ list() for i in range(len(self.queues)) ]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_11_sample_discrete_events(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_11_sample_discrete_events(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_heap = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  PyObject *__pyx_v_obs = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_sample_discrete_events (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_heap,&__pyx_n_s_arrv,&__pyx_n_s_obs,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_heap)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_sample_discrete_events", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_obs)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_sample_discrete_events", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sample_discrete_events") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_heap = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_obs = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_sample_discrete_events", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet._sample_discrete_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_10_sample_discrete_events(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_heap, __pyx_v_arrv, __pyx_v_obs);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_10_sample_discrete_events(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_heap, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_obs) {
  PyObject *__pyx_v_job_lists = NULL;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_tup = NULL;
  PyObject *__pyx_v_event_type = NULL;
  PyObject *__pyx_v_a_i = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_sid = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_arg = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_v_t = NULL;
  PyObject *__pyx_v_s_i = NULL;
  PyObject *__pyx_v_aux = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_foo1 = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_foo2 = NULL;
  PyObject *__pyx_v_s_next = NULL;
  CYTHON_UNUSED Py_ssize_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *(*__pyx_t_10)(PyObject *);
  double __pyx_t_11;
  int __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_sample_discrete_events", 0);

  /* "qnet.pyx":229
 *     # discrete event simulation, private
 *     def _sample_discrete_events (self, heap, Arrivals arrv, obs):
 *         job_lists = [ list() for i in range(len(self.queues)) ]             # <<<<<<<<<<<<<<
 * 
 *         cdef Queue q
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_v_self->queues;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_job_lists = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":234
 *         cdef Event evt
 * 
 *         eid = arrv.max_eidx() + 1             # <<<<<<<<<<<<<<
 * 
 *         while heap:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_eid = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":236
 *         eid = arrv.max_eidx() + 1
 * 
 *         while heap:             # <<<<<<<<<<<<<<
 *             tup = heappop(heap)
 *             event_type = tup[3]
 */
  while (1) {
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_heap); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_6) break;

    /* "qnet.pyx":237
 * 
 *         while heap:
 *             tup = heappop(heap)             # <<<<<<<<<<<<<<
 *             event_type = tup[3]
 * #            print "TYPE %d: @ %.5f  TID: %d QID: %s STATE: %s" % (tup[3], tup[0], tup[1], tup[4], tup[2])
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappop); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_heap); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_tup, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":238
 *         while heap:
 *             tup = heappop(heap)
 *             event_type = tup[3]             # <<<<<<<<<<<<<<
 * #            print "TYPE %d: @ %.5f  TID: %d QID: %s STATE: %s" % (tup[3], tup[0], tup[1], tup[4], tup[2])
 * 
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_tup, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_event_type, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":241
 * #            print "TYPE %d: @ %.5f  TID: %d QID: %s STATE: %s" % (tup[3], tup[0], tup[1], tup[4], tup[2])
 * 
 *             if event_type == SEC_ARRIVAL:             # <<<<<<<<<<<<<<
 *                 a_i, tid, sid, event_type, arg = tup
 *                 qid = self.fsm.sample_one_obs (sid)
 */
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_ARRIVAL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_event_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_6) {

      /* "qnet.pyx":242
 * 
 *             if event_type == SEC_ARRIVAL:
 *                 a_i, tid, sid, event_type, arg = tup             # <<<<<<<<<<<<<<
 *                 qid = self.fsm.sample_one_obs (sid)
 *                 q = self.queues[qid]
 */
      if ((likely(PyTuple_CheckExact(__pyx_v_tup))) || (PyList_CheckExact(__pyx_v_tup))) {
        PyObject* sequence = __pyx_v_tup;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 5)) {
          if (size > 5) __Pyx_RaiseTooManyValuesError(5);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
          __pyx_t_5 = PyTuple_GET_ITEM(sequence, 3); 
          __pyx_t_8 = PyTuple_GET_ITEM(sequence, 4); 
        } else {
          __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
          __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
          __pyx_t_5 = PyList_GET_ITEM(sequence, 3); 
          __pyx_t_8 = PyList_GET_ITEM(sequence, 4); 
        }
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_8);
        #else
        {
          Py_ssize_t i;
          PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_2,&__pyx_t_7,&__pyx_t_5,&__pyx_t_8};
          for (i=0; i < 5; i++) {
            PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(item);
            *(temps[i]) = item;
          }
        }
        #endif
      } else {
        Py_ssize_t index = -1;
        PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_2,&__pyx_t_7,&__pyx_t_5,&__pyx_t_8};
        __pyx_t_9 = PyObject_GetIter(__pyx_v_tup); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_10 = Py_TYPE(__pyx_t_9)->tp_iternext;
        for (index=0; index < 5; index++) {
          PyObject* item = __pyx_t_10(__pyx_t_9); if (unlikely(!item)) goto __pyx_L8_unpacking_failed;
          __Pyx_GOTREF(item);
          *(temps[index]) = item;
        }
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_10 = NULL;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L9_unpacking_done;
        __pyx_L8_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L9_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_a_i, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_7);
      __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_event_type, __pyx_t_5);
      __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_arg, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":243
 *             if event_type == SEC_ARRIVAL:
 *                 a_i, tid, sid, event_type, arg = tup
 *                 qid = self.fsm.sample_one_obs (sid)             # <<<<<<<<<<<<<<
 *                 q = self.queues[qid]
 *                 evt = Event (eid, tid, qid, q, a_i, 0.0, a_i, sid, obs_a=obs, obs_d=obs)
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_one_obs); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_sid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
      } else {
        __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        __Pyx_INCREF(__pyx_v_sid);
        PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_v_sid);
        __Pyx_GIVEREF(__pyx_v_sid);
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":244
 *                 a_i, tid, sid, event_type, arg = tup
 *                 qid = self.fsm.sample_one_obs (sid)
 *                 q = self.queues[qid]             # <<<<<<<<<<<<<<
 *                 evt = Event (eid, tid, qid, q, a_i, 0.0, a_i, sid, obs_a=obs, obs_d=obs)
 *                 eid += 1
 */
      __pyx_t_8 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_8);
      if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_8));
      __pyx_t_8 = 0;

      /* "qnet.pyx":245
 *                 qid = self.fsm.sample_one_obs (sid)
 *                 q = self.queues[qid]
 *                 evt = Event (eid, tid, qid, q, a_i, 0.0, a_i, sid, obs_a=obs, obs_d=obs)             # <<<<<<<<<<<<<<
 *                 eid += 1
 *                 bisect.insort (job_lists[qid], evt)
 */
      __pyx_t_8 = PyTuple_New(8); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_v_eid);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_eid);
      __Pyx_GIVEREF(__pyx_v_eid);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __Pyx_INCREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      __Pyx_INCREF(((PyObject *)__pyx_v_q));
      PyTuple_SET_ITEM(__pyx_t_8, 3, ((PyObject *)__pyx_v_q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
      __Pyx_INCREF(__pyx_v_a_i);
      PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_v_a_i);
      __Pyx_GIVEREF(__pyx_v_a_i);
      __Pyx_INCREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_8, 5, __pyx_float_0_0);
      __Pyx_GIVEREF(__pyx_float_0_0);
      __Pyx_INCREF(__pyx_v_a_i);
      PyTuple_SET_ITEM(__pyx_t_8, 6, __pyx_v_a_i);
      __Pyx_GIVEREF(__pyx_v_a_i);
      __Pyx_INCREF(__pyx_v_sid);
      PyTuple_SET_ITEM(__pyx_t_8, 7, __pyx_v_sid);
      __Pyx_GIVEREF(__pyx_v_sid);
      __pyx_t_5 = PyDict_New(); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_obs_a, __pyx_v_obs) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_obs_d, __pyx_v_obs) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":246
 *                 q = self.queues[qid]
 *                 evt = Event (eid, tid, qid, q, a_i, 0.0, a_i, sid, obs_a=obs, obs_d=obs)
 *                 eid += 1             # <<<<<<<<<<<<<<
 *                 bisect.insort (job_lists[qid], evt)
 *                 if len(job_lists[qid]) == 1: # wake up queue, if necessary
 */
      __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "qnet.pyx":247
 *                 evt = Event (eid, tid, qid, q, a_i, 0.0, a_i, sid, obs_a=obs, obs_d=obs)
 *                 eid += 1
 *                 bisect.insort (job_lists[qid], evt)             # <<<<<<<<<<<<<<
 *                 if len(job_lists[qid]) == 1: # wake up queue, if necessary
 *                     t = q.when_clear (arrv)
 */
      __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_bisect); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_insort); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_GetItem(__pyx_v_job_lists, __pyx_v_qid); if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = NULL;
      __pyx_t_3 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
          __pyx_t_3 = 1;
        }
      }
      __pyx_t_1 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (__pyx_t_7) {
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      }
      PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_3, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_3, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_5 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "qnet.pyx":248
 *                 eid += 1
 *                 bisect.insort (job_lists[qid], evt)
 *                 if len(job_lists[qid]) == 1: # wake up queue, if necessary             # <<<<<<<<<<<<<<
 *                     t = q.when_clear (arrv)
 * #                    print "Pushing ", (t, tid, 0, SEC_CLEAR, qid)
 */
      __pyx_t_2 = PyObject_GetItem(__pyx_v_job_lists, __pyx_v_qid); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_6 = ((__pyx_t_3 == 1) != 0);
      if (__pyx_t_6) {

        /* "qnet.pyx":249
 *                 bisect.insort (job_lists[qid], evt)
 *                 if len(job_lists[qid]) == 1: # wake up queue, if necessary
 *                     t = q.when_clear (arrv)             # <<<<<<<<<<<<<<
 * #                    print "Pushing ", (t, tid, 0, SEC_CLEAR, qid)
 *                     heappush (heap, (t, tid, 0, SEC_CLEAR, qid))
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_when_clear); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
          }
        }
        if (!__pyx_t_1) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
          PyTuple_SET_ITEM(__pyx_t_5, 0+1, ((PyObject *)__pyx_v_arrv));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":251
 *                     t = q.when_clear (arrv)
 * #                    print "Pushing ", (t, tid, 0, SEC_CLEAR, qid)
 *                     heappush (heap, (t, tid, 0, SEC_CLEAR, qid))             # <<<<<<<<<<<<<<
 * 
 *             elif event_type == SEC_CLEAR:
 */
        __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_CLEAR); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_v_t);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_t);
        __Pyx_GIVEREF(__pyx_v_t);
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __Pyx_INCREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_int_0);
        __Pyx_GIVEREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_qid);
        PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_v_qid);
        __Pyx_GIVEREF(__pyx_v_qid);
        __pyx_t_5 = 0;
        __pyx_t_5 = NULL;
        __pyx_t_3 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
            __pyx_t_3 = 1;
          }
        }
        __pyx_t_7 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        if (__pyx_t_5) {
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
        }
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_3, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_3, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L10;
      }
      __pyx_L10:;
      goto __pyx_L7;
    }

    /* "qnet.pyx":253
 *                     heappush (heap, (t, tid, 0, SEC_CLEAR, qid))
 * 
 *             elif event_type == SEC_CLEAR:             # <<<<<<<<<<<<<<
 *                 qid = tup[4]
 *                 if job_lists[qid]:
 */
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_CLEAR); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = PyObject_RichCompare(__pyx_v_event_type, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_6) {

      /* "qnet.pyx":254
 * 
 *             elif event_type == SEC_CLEAR:
 *                 qid = tup[4]             # <<<<<<<<<<<<<<
 *                 if job_lists[qid]:
 *                     q = self.queues[qid]
 */
      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_tup, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":255
 *             elif event_type == SEC_CLEAR:
 *                 qid = tup[4]
 *                 if job_lists[qid]:             # <<<<<<<<<<<<<<
 *                     q = self.queues[qid]
 * 
 */
      __pyx_t_8 = PyObject_GetItem(__pyx_v_job_lists, __pyx_v_qid); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (__pyx_t_6) {

        /* "qnet.pyx":256
 *                 qid = tup[4]
 *                 if job_lists[qid]:
 *                     q = self.queues[qid]             # <<<<<<<<<<<<<<
 * 
 *                     # select job to serve, remove from queue
 */
        __pyx_t_8 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_8);
        if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_8));
        __pyx_t_8 = 0;

        /* "qnet.pyx":259
 * 
 *                     # select job to serve, remove from queue
 *                     evt = q.select_job_for_service (job_lists[qid])             # <<<<<<<<<<<<<<
 *                     tid = evt.tid
 *                     job_lists[qid].remove (evt)
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_select_job_for_service); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_7 = PyObject_GetItem(__pyx_v_job_lists, __pyx_v_qid); if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_1 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_1) {
          __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_8);
        } else {
          __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
          PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
        __pyx_t_8 = 0;

        /* "qnet.pyx":260
 *                     # select job to serve, remove from queue
 *                     evt = q.select_job_for_service (job_lists[qid])
 *                     tid = evt.tid             # <<<<<<<<<<<<<<
 *                     job_lists[qid].remove (evt)
 * 
 */
        __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_8);
        __pyx_t_8 = 0;

        /* "qnet.pyx":261
 *                     evt = q.select_job_for_service (job_lists[qid])
 *                     tid = evt.tid
 *                     job_lists[qid].remove (evt)             # <<<<<<<<<<<<<<
 * 
 *                     #  add served event to Arrivals
 */
        __pyx_t_2 = PyObject_GetItem(__pyx_v_job_lists, __pyx_v_qid); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_remove); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        if (!__pyx_t_2) {
          __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
        } else {
          __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "qnet.pyx":264
 * 
 *                     #  add served event to Arrivals
 *                     s_i, aux = q.sample_service()             # <<<<<<<<<<<<<<
 *                     evt.s = s_i
 *                     evt.auxiliaries = aux
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_sample_service); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        if (__pyx_t_7) {
          __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        } else {
          __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if ((likely(PyTuple_CheckExact(__pyx_t_8))) || (PyList_CheckExact(__pyx_t_8))) {
          PyObject* sequence = __pyx_t_8;
          #if CYTHON_COMPILING_IN_CPYTHON
          Py_ssize_t size = Py_SIZE(sequence);
          #else
          Py_ssize_t size = PySequence_Size(sequence);
          #endif
          if (unlikely(size != 2)) {
            if (size > 2) __Pyx_RaiseTooManyValuesError(2);
            else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          #if CYTHON_COMPILING_IN_CPYTHON
          if (likely(PyTuple_CheckExact(sequence))) {
            __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
            __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
          } else {
            __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
            __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
          }
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_7);
          #else
          __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          #endif
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          Py_ssize_t index = -1;
          __pyx_t_2 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_10 = Py_TYPE(__pyx_t_2)->tp_iternext;
          index = 0; __pyx_t_5 = __pyx_t_10(__pyx_t_2); if (unlikely(!__pyx_t_5)) goto __pyx_L12_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_5);
          index = 1; __pyx_t_7 = __pyx_t_10(__pyx_t_2); if (unlikely(!__pyx_t_7)) goto __pyx_L12_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_7);
          if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_2), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_10 = NULL;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L13_unpacking_done;
          __pyx_L12_unpacking_failed:;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_10 = NULL;
          if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_L13_unpacking_done:;
        }
        __Pyx_XDECREF_SET(__pyx_v_s_i, __pyx_t_5);
        __pyx_t_5 = 0;
        __Pyx_XDECREF_SET(__pyx_v_aux, __pyx_t_7);
        __pyx_t_7 = 0;

        /* "qnet.pyx":265
 *                     #  add served event to Arrivals
 *                     s_i, aux = q.sample_service()
 *                     evt.s = s_i             # <<<<<<<<<<<<<<
 *                     evt.auxiliaries = aux
 *                     arrv.append (evt)
 */
        __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_v_s_i); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_v_evt->s = __pyx_t_11;

        /* "qnet.pyx":266
 *                     s_i, aux = q.sample_service()
 *                     evt.s = s_i
 *                     evt.auxiliaries = aux             # <<<<<<<<<<<<<<
 *                     arrv.append (evt)
 *                     q.recompute_departure (arrv, evt)
 */
        if (!(likely(((__pyx_v_aux) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_aux, __pyx_ptype_8arrivals_Vars))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_8 = __pyx_v_aux;
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_8);
        __Pyx_GOTREF(__pyx_v_evt->auxiliaries);
        __Pyx_DECREF(((PyObject *)__pyx_v_evt->auxiliaries));
        __pyx_v_evt->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)__pyx_t_8);
        __pyx_t_8 = 0;

        /* "qnet.pyx":267
 *                     evt.s = s_i
 *                     evt.auxiliaries = aux
 *                     arrv.append (evt)             # <<<<<<<<<<<<<<
 *                     q.recompute_departure (arrv, evt)
 * #                    print "   Added event: ", evt
 */
        __pyx_t_12 = __Pyx_PyObject_Append(((PyObject *)__pyx_v_arrv), ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "qnet.pyx":268
 *                     evt.auxiliaries = aux
 *                     arrv.append (evt)
 *                     q.recompute_departure (arrv, evt)             # <<<<<<<<<<<<<<
 * #                    print "   Added event: ", evt
 * #                    arrv.validate()
 */
        __pyx_t_8 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_departure(__pyx_v_q, __pyx_v_arrv, __pyx_v_evt, 0); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "qnet.pyx":273
 * 
 *                     # create arrival event
 *                     heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))             # <<<<<<<<<<<<<<
 * 
 *                     # create next clear event
 */
        __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_DEPARTURE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __Pyx_INCREF(Py_None);
        PyTuple_SET_ITEM(__pyx_t_1, 2, Py_None);
        __Pyx_GIVEREF(Py_None);
        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_5 = 0;
        __pyx_t_2 = 0;
        __pyx_t_2 = NULL;
        __pyx_t_3 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_3 = 1;
          }
        }
        __pyx_t_5 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        if (__pyx_t_2) {
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
        }
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_3, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_3, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "qnet.pyx":276
 * 
 *                     # create next clear event
 *                     t = q.when_clear (arrv)             # <<<<<<<<<<<<<<
 *                     heappush (heap, (t, 0, 0, SEC_CLEAR, qid))
 * 
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_when_clear); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_5) {
          __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
        } else {
          __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
          PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_arrv));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_8);
        __pyx_t_8 = 0;

        /* "qnet.pyx":277
 *                     # create next clear event
 *                     t = q.when_clear (arrv)
 *                     heappush (heap, (t, 0, 0, SEC_CLEAR, qid))             # <<<<<<<<<<<<<<
 * 
 * 
 */
        __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_CLEAR); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = PyTuple_New(5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_t);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_t);
        __Pyx_GIVEREF(__pyx_v_t);
        __Pyx_INCREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_int_0);
        __Pyx_GIVEREF(__pyx_int_0);
        __Pyx_INCREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_int_0);
        __Pyx_GIVEREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_v_qid);
        PyTuple_SET_ITEM(__pyx_t_5, 4, __pyx_v_qid);
        __Pyx_GIVEREF(__pyx_v_qid);
        __pyx_t_1 = 0;
        __pyx_t_1 = NULL;
        __pyx_t_3 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_3 = 1;
          }
        }
        __pyx_t_2 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        if (__pyx_t_1) {
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
        }
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_3, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_3, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        __pyx_t_5 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L11;
      }
      __pyx_L11:;
      goto __pyx_L7;
    }

    /* "qnet.pyx":280
 * 
 * 
 *             elif event_type == SEC_DEPARTURE:             # <<<<<<<<<<<<<<
 *                 t, tid, foo1, foo2, evt = tup
 *                 # Below check necessary b/c of PS queues
 */
    __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_DEPARTURE); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_7 = PyObject_RichCompare(__pyx_v_event_type, __pyx_t_8, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_6) {

      /* "qnet.pyx":281
 * 
 *             elif event_type == SEC_DEPARTURE:
 *                 t, tid, foo1, foo2, evt = tup             # <<<<<<<<<<<<<<
 *                 # Below check necessary b/c of PS queues
 *                 if evt.d == t:
 */
      if ((likely(PyTuple_CheckExact(__pyx_v_tup))) || (PyList_CheckExact(__pyx_v_tup))) {
        PyObject* sequence = __pyx_v_tup;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 5)) {
          if (size > 5) __Pyx_RaiseTooManyValuesError(5);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_8 = PyTuple_GET_ITEM(sequence, 1); 
          __pyx_t_2 = PyTuple_GET_ITEM(sequence, 2); 
          __pyx_t_5 = PyTuple_GET_ITEM(sequence, 3); 
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 4); 
        } else {
          __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_8 = PyList_GET_ITEM(sequence, 1); 
          __pyx_t_2 = PyList_GET_ITEM(sequence, 2); 
          __pyx_t_5 = PyList_GET_ITEM(sequence, 3); 
          __pyx_t_1 = PyList_GET_ITEM(sequence, 4); 
        }
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_1);
        #else
        {
          Py_ssize_t i;
          PyObject** temps[5] = {&__pyx_t_7,&__pyx_t_8,&__pyx_t_2,&__pyx_t_5,&__pyx_t_1};
          for (i=0; i < 5; i++) {
            PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(item);
            *(temps[i]) = item;
          }
        }
        #endif
      } else {
        Py_ssize_t index = -1;
        PyObject** temps[5] = {&__pyx_t_7,&__pyx_t_8,&__pyx_t_2,&__pyx_t_5,&__pyx_t_1};
        __pyx_t_9 = PyObject_GetIter(__pyx_v_tup); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_10 = Py_TYPE(__pyx_t_9)->tp_iternext;
        for (index=0; index < 5; index++) {
          PyObject* item = __pyx_t_10(__pyx_t_9); if (unlikely(!item)) goto __pyx_L14_unpacking_failed;
          __Pyx_GOTREF(item);
          *(temps[index]) = item;
        }
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_10 = NULL;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L15_unpacking_done;
        __pyx_L14_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L15_unpacking_done:;
      }
      if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_7);
      __pyx_t_7 = 0;
      __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_8);
      __pyx_t_8 = 0;
      __Pyx_XDECREF_SET(__pyx_v_foo1, __pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_foo2, __pyx_t_5);
      __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "qnet.pyx":283
 *                 t, tid, foo1, foo2, evt = tup
 *                 # Below check necessary b/c of PS queues
 *                 if evt.d == t:             # <<<<<<<<<<<<<<
 *                     s_next = self.fsm.sample_state (evt.state)
 *                     if s_next:
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_t, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_6) {

        /* "qnet.pyx":284
 *                 # Below check necessary b/c of PS queues
 *                 if evt.d == t:
 *                     s_next = self.fsm.sample_state (evt.state)             # <<<<<<<<<<<<<<
 *                     if s_next:
 *                         heappush (heap, (t, tid, s_next, SEC_ARRIVAL, None))
 */
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_state); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_1, function);
          }
        }
        if (!__pyx_t_8) {
          __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_GOTREF(__pyx_t_5);
        } else {
          __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
          PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          __pyx_t_2 = 0;
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF_SET(__pyx_v_s_next, __pyx_t_5);
        __pyx_t_5 = 0;

        /* "qnet.pyx":285
 *                 if evt.d == t:
 *                     s_next = self.fsm.sample_state (evt.state)
 *                     if s_next:             # <<<<<<<<<<<<<<
 *                         heappush (heap, (t, tid, s_next, SEC_ARRIVAL, None))
 *                 else:
 */
        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_s_next); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__pyx_t_6) {

          /* "qnet.pyx":286
 *                     s_next = self.fsm.sample_state (evt.state)
 *                     if s_next:
 *                         heappush (heap, (t, tid, s_next, SEC_ARRIVAL, None))             # <<<<<<<<<<<<<<
 *                 else:
 *                     # oops, job isn't really finished yet
 */
          __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_ARRIVAL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_INCREF(__pyx_v_t);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_t);
          __Pyx_GIVEREF(__pyx_v_t);
          __Pyx_INCREF(__pyx_v_tid);
          PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_tid);
          __Pyx_GIVEREF(__pyx_v_tid);
          __Pyx_INCREF(__pyx_v_s_next);
          PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_s_next);
          __Pyx_GIVEREF(__pyx_v_s_next);
          PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_7);
          __Pyx_INCREF(Py_None);
          PyTuple_SET_ITEM(__pyx_t_2, 4, Py_None);
          __Pyx_GIVEREF(Py_None);
          __pyx_t_7 = 0;
          __pyx_t_7 = NULL;
          __pyx_t_3 = 0;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
              __pyx_t_3 = 1;
            }
          }
          __pyx_t_8 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_7) {
            PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
          }
          __Pyx_INCREF(__pyx_v_heap);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_3, __pyx_v_heap);
          __Pyx_GIVEREF(__pyx_v_heap);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_3, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          __pyx_t_2 = 0;
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          goto __pyx_L17;
        }
        __pyx_L17:;
        goto __pyx_L16;
      }
      /*else*/ {

        /* "qnet.pyx":290
 *                     # oops, job isn't really finished yet
 *                     #  (other concurrent jobs came into the PS queue)
 *                     heappush (heap, (evt.d, tid, None, SEC_DEPARTURE, evt))             # <<<<<<<<<<<<<<
 * 
 * 
 */
        __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_DEPARTURE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_7 = PyTuple_New(5); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __Pyx_INCREF(Py_None);
        PyTuple_SET_ITEM(__pyx_t_7, 2, Py_None);
        __Pyx_GIVEREF(Py_None);
        PyTuple_SET_ITEM(__pyx_t_7, 3, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_7, 4, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_8 = 0;
        __pyx_t_2 = 0;
        __pyx_t_2 = NULL;
        __pyx_t_3 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_1, function);
            __pyx_t_3 = 1;
          }
        }
        __pyx_t_8 = PyTuple_New(2+__pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        if (__pyx_t_2) {
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
        }
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_3, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_3, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_7);
        __pyx_t_7 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __pyx_L16:;
      goto __pyx_L7;
    }
    /*else*/ {

      /* "qnet.pyx":294
 * 
 *             else: # event_type == something else
 *                 raise Exception ("Could not understand event type %d" % event_type)             # <<<<<<<<<<<<<<
 * 
 *         arrv.regenerate_all_caches()
 */
      __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Could_not_understand_event_type, __pyx_v_event_type); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __pyx_L7:;
  }

  /* "qnet.pyx":296
 *                 raise Exception ("Could not understand event type %d" % event_type)
 * 
 *         arrv.regenerate_all_caches()             # <<<<<<<<<<<<<<
 * 
 *         return arrv
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_8) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else {
    __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":298
 *         arrv.regenerate_all_caches()
 * 
 *         return arrv             # <<<<<<<<<<<<<<
 * 
 *     def num_queues (self): return len(self.queues)
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  __pyx_r = ((PyObject *)__pyx_v_arrv);
  goto __pyx_L0;

  /* "qnet.pyx":228
 * 
 *     # discrete event simulation, private
 *     def _sample_discrete_events (self, heap, Arrivals arrv, obs):             # <<<<<<<<<<<<<<
 *         job_lists = [ list() for i in range(len(self.queues)) ]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.Qnet._sample_discrete_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_job_lists);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_tup);
  __Pyx_XDECREF(__pyx_v_event_type);
  __Pyx_XDECREF(__pyx_v_a_i);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_arg);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_t);
  __Pyx_XDECREF(__pyx_v_s_i);
  __Pyx_XDECREF(__pyx_v_aux);
  __Pyx_XDECREF(__pyx_v_foo1);
  __Pyx_XDECREF(__pyx_v_foo2);
  __Pyx_XDECREF(__pyx_v_s_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":300
 *         return arrv
 * 
 *     def num_queues (self): return len(self.queues)             # <<<<<<<<<<<<<<
 *     def num_states (self): return self.fsm.num_states()
 *     def get_fsm (self): return self.fsm
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_13num_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_13num_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_queues (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_12num_queues(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_12num_queues(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("num_queues", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_v_self->queues;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.Qnet.num_queues", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":301
 * 
 *     def num_queues (self): return len(self.queues)
 *     def num_states (self): return self.fsm.num_states()             # <<<<<<<<<<<<<<
 *     def get_fsm (self): return self.fsm
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_15num_states(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_15num_states(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_states (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_14num_states(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_14num_states(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("num_states", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_num_states); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.Qnet.num_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":302
 *     def num_queues (self): return len(self.queues)
 *     def num_states (self): return self.fsm.num_states()
 *     def get_fsm (self): return self.fsm             # <<<<<<<<<<<<<<
 * 
 *     def sid_by_name (self, sname):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_17get_fsm(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_17get_fsm(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_fsm (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_16get_fsm(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_16get_fsm(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_fsm", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->fsm);
  __pyx_r = __pyx_v_self->fsm;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":304
 *     def get_fsm (self): return self.fsm
 * 
 *     def sid_by_name (self, sname):             # <<<<<<<<<<<<<<
 *         return self.sname2id.get (sname, None)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_19sid_by_name(PyObject *__pyx_v_self, PyObject *__pyx_v_sname); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_19sid_by_name(PyObject *__pyx_v_self, PyObject *__pyx_v_sname) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sid_by_name (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_18sid_by_name(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_sname));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_18sid_by_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sname) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sid_by_name", 0);

  /* "qnet.pyx":305
 * 
 *     def sid_by_name (self, sname):
 *         return self.sname2id.get (sname, None)             # <<<<<<<<<<<<<<
 * 
 *     def sid_to_name (self, sid):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->sname2id, __pyx_n_s_get); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_sname);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_sname);
  __Pyx_GIVEREF(__pyx_v_sname);
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":304
 *     def get_fsm (self): return self.fsm
 * 
 *     def sid_by_name (self, sname):             # <<<<<<<<<<<<<<
 *         return self.sname2id.get (sname, None)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.sid_by_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":307
 *         return self.sname2id.get (sname, None)
 * 
 *     def sid_to_name (self, sid):             # <<<<<<<<<<<<<<
 *         for k,v in self.sname2id.iteritems():
 *             if v == sid:
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_21sid_to_name(PyObject *__pyx_v_self, PyObject *__pyx_v_sid); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_21sid_to_name(PyObject *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sid_to_name (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_20sid_to_name(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_sid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_20sid_to_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sid_to_name", 0);

  /* "qnet.pyx":308
 * 
 *     def sid_to_name (self, sid):
 *         for k,v in self.sname2id.iteritems():             # <<<<<<<<<<<<<<
 *             if v == sid:
 *                 return k
 */
  __pyx_t_2 = 0;
  if (unlikely(__pyx_v_self->sname2id == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __pyx_t_5 = __Pyx_dict_iterator(__pyx_v_self->sname2id, 0, __pyx_n_s_iteritems, (&__pyx_t_3), (&__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_1);
  __pyx_t_1 = __pyx_t_5;
  __pyx_t_5 = 0;
  while (1) {
    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &__pyx_t_2, &__pyx_t_5, &__pyx_t_6, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_7 == 0)) break;
    if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_5);
    __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "qnet.pyx":309
 *     def sid_to_name (self, sid):
 *         for k,v in self.sname2id.iteritems():
 *             if v == sid:             # <<<<<<<<<<<<<<
 *                 return k
 *         raise KeyError ("No state with id %s" % sid)
 */
    __pyx_t_6 = PyObject_RichCompare(__pyx_v_v, __pyx_v_sid, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":310
 *         for k,v in self.sname2id.iteritems():
 *             if v == sid:
 *                 return k             # <<<<<<<<<<<<<<
 *         raise KeyError ("No state with id %s" % sid)
 * 
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_v_k);
      __pyx_r = __pyx_v_k;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":311
 *             if v == sid:
 *                 return k
 *         raise KeyError ("No state with id %s" % sid)             # <<<<<<<<<<<<<<
 * 
 *     def queues_of_state (self, sid):
 */
  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_No_state_with_id_s, __pyx_v_sid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_KeyError, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_Raise(__pyx_t_1, 0, 0, 0);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":307
 *         return self.sname2id.get (sname, None)
 * 
 *     def sid_to_name (self, sid):             # <<<<<<<<<<<<<<
 *         for k,v in self.sname2id.iteritems():
 *             if v == sid:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.Qnet.sid_to_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":313
 *         raise KeyError ("No state with id %s" % sid)
 * 
 *     def queues_of_state (self, sid):             # <<<<<<<<<<<<<<
 *         qids = self.fsm.possible_observations (sid)
 *         return [ self.queues[qi] for qi in qids ]
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_23queues_of_state(PyObject *__pyx_v_self, PyObject *__pyx_v_sid); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_23queues_of_state(PyObject *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("queues_of_state (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_22queues_of_state(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_sid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_22queues_of_state(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_v_qids = NULL;
  PyObject *__pyx_v_qi = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("queues_of_state", 0);

  /* "qnet.pyx":314
 * 
 *     def queues_of_state (self, sid):
 *         qids = self.fsm.possible_observations (sid)             # <<<<<<<<<<<<<<
 *         return [ self.queues[qi] for qi in qids ]
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_possible_observations); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qids = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":315
 *     def queues_of_state (self, sid):
 *         qids = self.fsm.possible_observations (sid)
 *         return [ self.queues[qi] for qi in qids ]             # <<<<<<<<<<<<<<
 * 
 *     # inefficient
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_v_qids)) || PyTuple_CheckExact(__pyx_v_qids)) {
    __pyx_t_2 = __pyx_v_qids; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_qids); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_qi, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qi); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_4);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_4))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":313
 *         raise KeyError ("No state with id %s" % sid)
 * 
 *     def queues_of_state (self, sid):             # <<<<<<<<<<<<<<
 *         qids = self.fsm.possible_observations (sid)
 *         return [ self.queues[qi] for qi in qids ]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.Qnet.queues_of_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qids);
  __Pyx_XDECREF(__pyx_v_qi);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":318
 * 
 *     # inefficient
 *     def qid_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         if queue in self.queues:
 *             return self.queues.index (queue)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_25qid_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_25qid_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("qid_of_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_24qid_of_queue(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_queue));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_24qid_of_queue(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("qid_of_queue", 0);

  /* "qnet.pyx":319
 *     # inefficient
 *     def qid_of_queue (self, queue):
 *         if queue in self.queues:             # <<<<<<<<<<<<<<
 *             return self.queues.index (queue)
 *         else:
 */
  __pyx_t_1 = (__Pyx_PySequence_Contains(__pyx_v_queue, __pyx_v_self->queues, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 319; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":320
 *     def qid_of_queue (self, queue):
 *         if queue in self.queues:
 *             return self.queues.index (queue)             # <<<<<<<<<<<<<<
 *         else:
 *             raise Exception ("Can't find %s in net %s" % (queue, self))
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->queues, __pyx_n_s_index); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_queue); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      __Pyx_INCREF(__pyx_v_queue);
      PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_v_queue);
      __Pyx_GIVEREF(__pyx_v_queue);
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":322
 *             return self.queues.index (queue)
 *         else:
 *             raise Exception ("Can't find %s in net %s" % (queue, self))             # <<<<<<<<<<<<<<
 * 
 *     def queue_by_name (self, qname):
 */
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_queue);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_queue);
    __Pyx_GIVEREF(__pyx_v_queue);
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Can_t_find_s_in_net_s, __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "qnet.pyx":318
 * 
 *     # inefficient
 *     def qid_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         if queue in self.queues:
 *             return self.queues.index (queue)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.Qnet.qid_of_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":324
 *             raise Exception ("Can't find %s in net %s" % (queue, self))
 * 
 *     def queue_by_name (self, qname):             # <<<<<<<<<<<<<<
 *         qid = self.qname2id.get (qname, None)
 *         if qid != None:
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_27queue_by_name(PyObject *__pyx_v_self, PyObject *__pyx_v_qname); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_27queue_by_name(PyObject *__pyx_v_self, PyObject *__pyx_v_qname) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("queue_by_name (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_26queue_by_name(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_qname));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_26queue_by_name(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_qname) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("queue_by_name", 0);

  /* "qnet.pyx":325
 * 
 *     def queue_by_name (self, qname):
 *         qid = self.qname2id.get (qname, None)             # <<<<<<<<<<<<<<
 *         if qid != None:
 *             return self.queues[qid]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->qname2id, __pyx_n_s_get); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_qname);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_qname);
  __Pyx_GIVEREF(__pyx_v_qname);
  __Pyx_INCREF(Py_None);
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, Py_None);
  __Pyx_GIVEREF(Py_None);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":326
 *     def queue_by_name (self, qname):
 *         qid = self.qname2id.get (qname, None)
 *         if qid != None:             # <<<<<<<<<<<<<<
 *             return self.queues[qid]
 *         else:
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_qid, Py_None, Py_NE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "qnet.pyx":327
 *         qid = self.qname2id.get (qname, None)
 *         if qid != None:
 *             return self.queues[qid]             # <<<<<<<<<<<<<<
 *         else:
 *             return None
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":329
 *             return self.queues[qid]
 *         else:
 *             return None             # <<<<<<<<<<<<<<
 * 
 *     def all_queues (self): return self.queues[:]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
  }

  /* "qnet.pyx":324
 *             raise Exception ("Can't find %s in net %s" % (queue, self))
 * 
 *     def queue_by_name (self, qname):             # <<<<<<<<<<<<<<
 *         qid = self.qname2id.get (qname, None)
 *         if qid != None:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.queue_by_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":331
 *             return None
 * 
 *     def all_queues (self): return self.queues[:]             # <<<<<<<<<<<<<<
 * 
 *     def all_templates (self): return self.templates[:]
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_29all_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_29all_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("all_queues (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_28all_queues(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_28all_queues(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("all_queues", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_self->queues, 0, 0, NULL, NULL, &__pyx_slice__6, 0, 0, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.Qnet.all_queues", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":333
 *     def all_queues (self): return self.queues[:]
 * 
 *     def all_templates (self): return self.templates[:]             # <<<<<<<<<<<<<<
 * 
 *     # Gibbs sampling
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_31all_templates(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_31all_templates(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("all_templates (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_30all_templates(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_30all_templates(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("all_templates", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_self->templates, 0, 0, NULL, NULL, &__pyx_slice__7, 0, 0, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.Qnet.all_templates", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":337
 *     # Gibbs sampling
 * 
 *     def gibbs_resample (self, arrv, burn, num_iter, report_fn=None, return_arrv=True, sample_final=True):             # <<<<<<<<<<<<<<
 * 
 *         cdef int gi, i
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_33gibbs_resample(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_33gibbs_resample(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_arrv = 0;
  PyObject *__pyx_v_burn = 0;
  PyObject *__pyx_v_num_iter = 0;
  PyObject *__pyx_v_report_fn = 0;
  PyObject *__pyx_v_return_arrv = 0;
  PyObject *__pyx_v_sample_final = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_resample (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_burn,&__pyx_n_s_num_iter,&__pyx_n_s_report_fn,&__pyx_n_s_return_arrv,&__pyx_n_s_sample_final,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[3] = ((PyObject *)Py_None);
    values[4] = ((PyObject *)Py_True);
    values[5] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_burn)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_resample", 0, 3, 6, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_num_iter)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_resample", 0, 3, 6, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_report_fn);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_return_arrv);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_sample_final);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_resample") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arrv = values[0];
    __pyx_v_burn = values[1];
    __pyx_v_num_iter = values[2];
    __pyx_v_report_fn = values[3];
    __pyx_v_return_arrv = values[4];
    __pyx_v_sample_final = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_resample", 0, 3, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.gibbs_resample", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_4Qnet_32gibbs_resample(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_arrv, __pyx_v_burn, __pyx_v_num_iter, __pyx_v_report_fn, __pyx_v_return_arrv, __pyx_v_sample_final);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_32gibbs_resample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrv, PyObject *__pyx_v_burn, PyObject *__pyx_v_num_iter, PyObject *__pyx_v_report_fn, PyObject *__pyx_v_return_arrv, PyObject *__pyx_v_sample_final) {
  int __pyx_v_gi;
  CYTHON_UNUSED int __pyx_v_i;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_next = 0;
  int __pyx_v_nt05;
  PyObject *__pyx_v_all_arrv = NULL;
  PyObject *__pyx_v_a2 = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_resample", 0);
  __Pyx_INCREF(__pyx_v_arrv);

  /* "qnet.pyx":343
 *         cdef FactorTemplate factor
 * 
 *         cdef int nt05 = len(arrv.all_tasks()) / 20             # <<<<<<<<<<<<<<
 *         if nt05 == 0: nt05 = 1
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_nt05 = __Pyx_div_Py_ssize_t(__pyx_t_4, 20);

  /* "qnet.pyx":344
 * 
 *         cdef int nt05 = len(arrv.all_tasks()) / 20
 *         if nt05 == 0: nt05 = 1             # <<<<<<<<<<<<<<
 * 
 *         all_arrv = []
 */
  __pyx_t_5 = ((__pyx_v_nt05 == 0) != 0);
  if (__pyx_t_5) {
    __pyx_v_nt05 = 1;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":346
 *         if nt05 == 0: nt05 = 1
 * 
 *         all_arrv = []             # <<<<<<<<<<<<<<
 * 
 *         for gi from 0 <= gi < num_iter + burn:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_all_arrv = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":348
 *         all_arrv = []
 * 
 *         for gi from 0 <= gi < num_iter + burn:             # <<<<<<<<<<<<<<
 * 
 *             # resample latent variables for all factors
 */
  __pyx_t_1 = PyNumber_Add(__pyx_v_num_iter, __pyx_v_burn); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_v_gi = 0; __pyx_v_gi < __pyx_t_6; __pyx_v_gi++) {

    /* "qnet.pyx":351
 * 
 *             # resample latent variables for all factors
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.resample_auxiliaries (evt)
 * 
 */
    if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
      __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_7(__pyx_t_1);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":352
 *             # resample latent variables for all factors
 *             for evt in arrv:
 *                 evt.q.resample_auxiliaries (evt)             # <<<<<<<<<<<<<<
 * 
 *             for evt in arrv:
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_resample_auxiliaries); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_9 = PyTuple_New(1+1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_9, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "qnet.pyx":351
 * 
 *             # resample latent variables for all factors
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.resample_auxiliaries (evt)
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":354
 *                 evt.q.resample_auxiliaries (evt)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 * #                if not arrv.is_final(evt): continue
 * #                if not evt.qid != 1: continue
 */
    if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
      __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_7(__pyx_t_1);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":358
 * #                if not evt.qid != 1: continue
 * 
 *                 if not evt.obs_d:             # <<<<<<<<<<<<<<
 *                     if arrv.is_final (evt):
 *                         if sample_final:
 */
      __pyx_t_5 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
      if (__pyx_t_5) {

        /* "qnet.pyx":359
 * 
 *                 if not evt.obs_d:
 *                     if arrv.is_final (evt):             # <<<<<<<<<<<<<<
 *                         if sample_final:
 *                             if DEBUG: print "Resampling final event:\n  %s\n  %s\n  %s" % (evt.prev_byq, evt, evt.next_byq)
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_is_final); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_9 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_9)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_9);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (!__pyx_t_9) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_5) {

          /* "qnet.pyx":360
 *                 if not evt.obs_d:
 *                     if arrv.is_final (evt):
 *                         if sample_final:             # <<<<<<<<<<<<<<
 *                             if DEBUG: print "Resampling final event:\n  %s\n  %s\n  %s" % (evt.prev_byq, evt, evt.next_byq)
 *                             self.gibbs_resample_final (arrv, evt)
 */
          __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_sample_final); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__pyx_t_5) {

            /* "qnet.pyx":361
 *                     if arrv.is_final (evt):
 *                         if sample_final:
 *                             if DEBUG: print "Resampling final event:\n  %s\n  %s\n  %s" % (evt.prev_byq, evt, evt.next_byq)             # <<<<<<<<<<<<<<
 *                             self.gibbs_resample_final (arrv, evt)
 *                     else:
 */
            if (__pyx_e_4qnet_DEBUG) {
              __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_2);
              __Pyx_INCREF(__pyx_v_evt->prev_byq);
              PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_evt->prev_byq);
              __Pyx_GIVEREF(__pyx_v_evt->prev_byq);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt));
              PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_evt));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
              __Pyx_INCREF(__pyx_v_evt->next_byq);
              PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_evt->next_byq);
              __Pyx_GIVEREF(__pyx_v_evt->next_byq);
              __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_Resampling_final_event_s_s_s, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
              if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              goto __pyx_L13;
            }
            __pyx_L13:;

            /* "qnet.pyx":362
 *                         if sample_final:
 *                             if DEBUG: print "Resampling final event:\n  %s\n  %s\n  %s" % (evt.prev_byq, evt, evt.next_byq)
 *                             self.gibbs_resample_final (arrv, evt)             # <<<<<<<<<<<<<<
 *                     else:
 *                         e_next = evt.next_byt
 */
            if (!(likely(((__pyx_v_arrv) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_arrv, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_t_10 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->gibbs_resample_final(__pyx_v_self, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv), __pyx_v_evt); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            goto __pyx_L12;
          }
          __pyx_L12:;
          goto __pyx_L11;
        }
        /*else*/ {

          /* "qnet.pyx":364
 *                             self.gibbs_resample_final (arrv, evt)
 *                     else:
 *                         e_next = evt.next_byt             # <<<<<<<<<<<<<<
 *                         if not e_next.obs_a:
 *                             if DEBUG: print "Resampling:\n", format_six (evt)
 */
          if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_3 = __pyx_v_evt->next_byt;
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_XDECREF_SET(__pyx_v_e_next, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
          __pyx_t_3 = 0;

          /* "qnet.pyx":365
 *                     else:
 *                         e_next = evt.next_byt
 *                         if not e_next.obs_a:             # <<<<<<<<<<<<<<
 *                             if DEBUG: print "Resampling:\n", format_six (evt)
 *                             self.gibbs_resample_pair (arrv, evt, e_next)
 */
          __pyx_t_5 = ((!(__pyx_v_e_next->obs_a != 0)) != 0);
          if (__pyx_t_5) {

            /* "qnet.pyx":366
 *                         e_next = evt.next_byt
 *                         if not e_next.obs_a:
 *                             if DEBUG: print "Resampling:\n", format_six (evt)             # <<<<<<<<<<<<<<
 *                             self.gibbs_resample_pair (arrv, evt, e_next)
 *                 if DEBUG: arrv.validate()
 */
            if (__pyx_e_4qnet_DEBUG) {
              __pyx_t_3 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_2);
              __Pyx_INCREF(__pyx_kp_s_Resampling);
              PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_Resampling);
              __Pyx_GIVEREF(__pyx_kp_s_Resampling);
              PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
              __Pyx_GIVEREF(__pyx_t_3);
              __pyx_t_3 = 0;
              if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
              goto __pyx_L15;
            }
            __pyx_L15:;

            /* "qnet.pyx":367
 *                         if not e_next.obs_a:
 *                             if DEBUG: print "Resampling:\n", format_six (evt)
 *                             self.gibbs_resample_pair (arrv, evt, e_next)             # <<<<<<<<<<<<<<
 *                 if DEBUG: arrv.validate()
 * 
 */
            if (!(likely(((__pyx_v_arrv) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_arrv, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_t_10 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->gibbs_resample_pair(__pyx_v_self, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv), __pyx_v_evt, __pyx_v_e_next); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            goto __pyx_L14;
          }
          __pyx_L14:;
        }
        __pyx_L11:;
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "qnet.pyx":368
 *                             if DEBUG: print "Resampling:\n", format_six (evt)
 *                             self.gibbs_resample_pair (arrv, evt, e_next)
 *                 if DEBUG: arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *             if doUseRtp:
 */
      if (__pyx_e_4qnet_DEBUG) {
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "qnet.pyx":354
 *                 evt.q.resample_auxiliaries (evt)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 * #                if not arrv.is_final(evt): continue
 * #                if not evt.qid != 1: continue
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":370
 *                 if DEBUG: arrv.validate()
 * 
 *             if doUseRtp:             # <<<<<<<<<<<<<<
 *                 for i from 0 <= i < nt05:
 *                     arrv = self.remove_task_proposal (arrv)
 */
    __pyx_t_5 = (__pyx_v_4qnet_doUseRtp != 0);
    if (__pyx_t_5) {

      /* "qnet.pyx":371
 * 
 *             if doUseRtp:
 *                 for i from 0 <= i < nt05:             # <<<<<<<<<<<<<<
 *                     arrv = self.remove_task_proposal (arrv)
 * 
 */
      __pyx_t_10 = __pyx_v_nt05;
      for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_10; __pyx_v_i++) {

        /* "qnet.pyx":372
 *             if doUseRtp:
 *                 for i from 0 <= i < nt05:
 *                     arrv = self.remove_task_proposal (arrv)             # <<<<<<<<<<<<<<
 * 
 *             if burn <= gi:
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_task_proposal); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(__pyx_v_arrv);
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_arrv);
          __Pyx_GIVEREF(__pyx_v_arrv);
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF_SET(__pyx_v_arrv, __pyx_t_1);
        __pyx_t_1 = 0;
      }
      goto __pyx_L17;
    }
    __pyx_L17:;

    /* "qnet.pyx":374
 *                     arrv = self.remove_task_proposal (arrv)
 * 
 *             if burn <= gi:             # <<<<<<<<<<<<<<
 *                 if report_fn:
 *                     report_fn (self, arrv, gi)
 */
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_gi); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_burn, __pyx_t_1, Py_LE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_5) {

      /* "qnet.pyx":375
 * 
 *             if burn <= gi:
 *                 if report_fn:             # <<<<<<<<<<<<<<
 *                     report_fn (self, arrv, gi)
 *                 if return_arrv:
 */
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_report_fn); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_5) {

        /* "qnet.pyx":376
 *             if burn <= gi:
 *                 if report_fn:
 *                     report_fn (self, arrv, gi)             # <<<<<<<<<<<<<<
 *                 if return_arrv:
 *                     a2 = arrv.duplicate()
 */
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_gi); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_v_report_fn);
        __pyx_t_8 = __pyx_v_report_fn; __pyx_t_3 = NULL;
        __pyx_t_4 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
            __pyx_t_4 = 1;
          }
        }
        __pyx_t_9 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        if (__pyx_t_3) {
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
        }
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_4, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        __Pyx_INCREF(__pyx_v_arrv);
        PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_4, __pyx_v_arrv);
        __Pyx_GIVEREF(__pyx_v_arrv);
        PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_4, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L21;
      }
      __pyx_L21:;

      /* "qnet.pyx":377
 *                 if report_fn:
 *                     report_fn (self, arrv, gi)
 *                 if return_arrv:             # <<<<<<<<<<<<<<
 *                     a2 = arrv.duplicate()
 *                     all_arrv.append (a2)
 */
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_return_arrv); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_5) {

        /* "qnet.pyx":378
 *                     report_fn (self, arrv, gi)
 *                 if return_arrv:
 *                     a2 = arrv.duplicate()             # <<<<<<<<<<<<<<
 *                     all_arrv.append (a2)
 * 
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_duplicate); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_9 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_9)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_9);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
          }
        }
        if (__pyx_t_9) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF_SET(__pyx_v_a2, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":379
 *                 if return_arrv:
 *                     a2 = arrv.duplicate()
 *                     all_arrv.append (a2)             # <<<<<<<<<<<<<<
 * 
 *         if not return_arrv:
 */
        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_all_arrv, __pyx_v_a2); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L22;
      }
      __pyx_L22:;
      goto __pyx_L20;
    }
    __pyx_L20:;
  }

  /* "qnet.pyx":381
 *                     all_arrv.append (a2)
 * 
 *         if not return_arrv:             # <<<<<<<<<<<<<<
 *             all_arrv = [arrv]
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_return_arrv); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_12 = ((!__pyx_t_5) != 0);
  if (__pyx_t_12) {

    /* "qnet.pyx":382
 * 
 *         if not return_arrv:
 *             all_arrv = [arrv]             # <<<<<<<<<<<<<<
 * 
 *         return all_arrv
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_arrv);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_v_arrv);
    __Pyx_GIVEREF(__pyx_v_arrv);
    __Pyx_DECREF_SET(__pyx_v_all_arrv, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;
    goto __pyx_L23;
  }
  __pyx_L23:;

  /* "qnet.pyx":384
 *             all_arrv = [arrv]
 * 
 *         return all_arrv             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_all_arrv);
  __pyx_r = __pyx_v_all_arrv;
  goto __pyx_L0;

  /* "qnet.pyx":337
 *     # Gibbs sampling
 * 
 *     def gibbs_resample (self, arrv, burn, num_iter, report_fn=None, return_arrv=True, sample_final=True):             # <<<<<<<<<<<<<<
 * 
 *         cdef int gi, i
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_resample", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_next);
  __Pyx_XDECREF(__pyx_v_all_arrv);
  __Pyx_XDECREF(__pyx_v_a2);
  __Pyx_XDECREF(__pyx_v_arrv);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":388
 * 
 * 
 *     cdef int gibbs_resample_final (self, Arrivals arrv, Event evt) except -1:             # <<<<<<<<<<<<<<
 *         cdef Pwfun fn = _departure_proposal (arrv, evt)
 * 
 */

static int __pyx_f_4qnet_4Qnet_gibbs_resample_final(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_5pwfun_Pwfun *__pyx_v_fn = 0;
  double __pyx_v_new_s;
  double __pyx_v_d_new;
  int __pyx_v_tries;
  double __pyx_v_x_initial;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_old = 0;
  double __pyx_v_ratio;
  double __pyx_v_u;
  PyObject *__pyx_v_diff_list = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  double __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *(*__pyx_t_15)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_resample_final", 0);

  /* "qnet.pyx":389
 * 
 *     cdef int gibbs_resample_final (self, Arrivals arrv, Event evt) except -1:
 *         cdef Pwfun fn = _departure_proposal (arrv, evt)             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG: print "Final d_fn: ", fn
 */
  __pyx_t_1 = ((PyObject *)__pyx_f_6queues__departure_proposal(__pyx_v_arrv, __pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_fn = ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":391
 *         cdef Pwfun fn = _departure_proposal (arrv, evt)
 * 
 *         if DEBUG: print "Final d_fn: ", fn             # <<<<<<<<<<<<<<
 *         if fn.U() - fn.L() < 1e-10: return 0  # don't sample small intervals
 * 
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_s_Final_d_fn);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_Final_d_fn);
    __Pyx_GIVEREF(__pyx_kp_s_Final_d_fn);
    __Pyx_INCREF(((PyObject *)__pyx_v_fn));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_fn));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_fn));
    if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":392
 * 
 *         if DEBUG: print "Final d_fn: ", fn
 *         if fn.U() - fn.L() < 1e-10: return 0  # don't sample small intervals             # <<<<<<<<<<<<<<
 * 
 *         cdef double new_s, d_new
 */
  __pyx_t_2 = (((((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_fn->__pyx_vtab)->U(__pyx_v_fn) - ((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_fn->__pyx_vtab)->L(__pyx_v_fn)) < 1e-10) != 0);
  if (__pyx_t_2) {
    __pyx_r = 0;
    goto __pyx_L0;
  }

  /* "qnet.pyx":396
 *         cdef double new_s, d_new
 * 
 *         cdef int tries = 0             # <<<<<<<<<<<<<<
 *         cdef double x_initial = evt.d
 *         while (<double> fn(x_initial)) == -INFINITY:
 */
  __pyx_v_tries = 0;

  /* "qnet.pyx":397
 * 
 *         cdef int tries = 0
 *         cdef double x_initial = evt.d             # <<<<<<<<<<<<<<
 *         while (<double> fn(x_initial)) == -INFINITY:
 *             new_s = exponential (1.0)
 */
  __pyx_t_3 = __pyx_v_evt->d;
  __pyx_v_x_initial = __pyx_t_3;

  /* "qnet.pyx":398
 *         cdef int tries = 0
 *         cdef double x_initial = evt.d
 *         while (<double> fn(x_initial)) == -INFINITY:             # <<<<<<<<<<<<<<
 *             new_s = exponential (1.0)
 *             x_initial = (<Queue> evt.q).departure_of_service (evt, new_s)
 */
  while (1) {
    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_x_initial); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(((PyObject *)__pyx_v_fn));
    __pyx_t_5 = ((PyObject *)__pyx_v_fn); __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = ((((double)__pyx_t_3) == (-INFINITY)) != 0);
    if (!__pyx_t_2) break;

    /* "qnet.pyx":399
 *         cdef double x_initial = evt.d
 *         while (<double> fn(x_initial)) == -INFINITY:
 *             new_s = exponential (1.0)             # <<<<<<<<<<<<<<
 *             x_initial = (<Queue> evt.q).departure_of_service (evt, new_s)
 *             tries += 1
 */
    __pyx_v_new_s = __pyx_f_8sampling_exponential(1.0);

    /* "qnet.pyx":400
 *         while (<double> fn(x_initial)) == -INFINITY:
 *             new_s = exponential (1.0)
 *             x_initial = (<Queue> evt.q).departure_of_service (evt, new_s)             # <<<<<<<<<<<<<<
 *             tries += 1
 *             if tries > 25:
 */
    __pyx_v_x_initial = ((struct __pyx_vtabstruct_6queues_Queue *)((struct __pyx_obj_6queues_Queue *)__pyx_v_evt->q)->__pyx_vtab)->departure_of_service(((struct __pyx_obj_6queues_Queue *)__pyx_v_evt->q), __pyx_v_evt, __pyx_v_new_s);

    /* "qnet.pyx":401
 *             new_s = exponential (1.0)
 *             x_initial = (<Queue> evt.q).departure_of_service (evt, new_s)
 *             tries += 1             # <<<<<<<<<<<<<<
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"
 */
    __pyx_v_tries = (__pyx_v_tries + 1);

    /* "qnet.pyx":402
 *             x_initial = (<Queue> evt.q).departure_of_service (evt, new_s)
 *             tries += 1
 *             if tries > 25:             # <<<<<<<<<<<<<<
 *                 if DEBUG: print "Can't find valid initialization"
 *                 return 0 # can't find a valid initialize
 */
    __pyx_t_2 = ((__pyx_v_tries > 25) != 0);
    if (__pyx_t_2) {

      /* "qnet.pyx":403
 *             tries += 1
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"             # <<<<<<<<<<<<<<
 *                 return 0 # can't find a valid initialize
 * 
 */
      if (__pyx_e_4qnet_DEBUG) {
        if (__Pyx_PrintOne(0, __pyx_kp_s_Can_t_find_valid_initialization) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "qnet.pyx":404
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"
 *                 return 0 # can't find a valid initialize             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
      __pyx_r = 0;
      goto __pyx_L0;
    }
  }

  /* "qnet.pyx":406
 *                 return 0 # can't find a valid initialize
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             d_new = call_sampler (fn, x_initial)
 *         except:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
    __Pyx_XGOTREF(__pyx_t_8);
    __Pyx_XGOTREF(__pyx_t_9);
    __Pyx_XGOTREF(__pyx_t_10);
    /*try:*/ {

      /* "qnet.pyx":407
 * 
 *         try:
 *             d_new = call_sampler (fn, x_initial)             # <<<<<<<<<<<<<<
 *         except:
 *             print "Error resampling event %s" % evt
 */
      __pyx_t_3 = __pyx_f_4qnet_call_sampler(__pyx_v_fn, __pyx_v_x_initial); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L9_error;}
      __pyx_v_d_new = __pyx_t_3;
    }
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    goto __pyx_L16_try_end;
    __pyx_L9_error:;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":408
 *         try:
 *             d_new = call_sampler (fn, x_initial)
 *         except:             # <<<<<<<<<<<<<<
 *             print "Error resampling event %s" % evt
 *             print format_six (evt)
 */
    /*except:*/ {
      __Pyx_AddTraceback("qnet.Qnet.gibbs_resample_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_5, &__pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_7);

      /* "qnet.pyx":409
 *             d_new = call_sampler (fn, x_initial)
 *         except:
 *             print "Error resampling event %s" % evt             # <<<<<<<<<<<<<<
 *             print format_six (evt)
 *             raise
 */
      __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Error_resampling_event_s, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_PrintOne(0, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "qnet.pyx":410
 *         except:
 *             print "Error resampling event %s" % evt
 *             print format_six (evt)             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_t_4 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_PrintOne(0, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "qnet.pyx":411
 *             print "Error resampling event %s" % evt
 *             print format_six (evt)
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         cdef Event e_new, e_old
 */
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ErrRestore(__pyx_t_1, __pyx_t_5, __pyx_t_7);
      __pyx_t_1 = 0; __pyx_t_5 = 0; __pyx_t_7 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 411; __pyx_clineno = __LINE__; goto __pyx_L11_except_error;}
    }
    __pyx_L11_except_error:;
    __Pyx_XGIVEREF(__pyx_t_8);
    __Pyx_XGIVEREF(__pyx_t_9);
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
    goto __pyx_L1_error;
    __pyx_L16_try_end:;
  }

  /* "qnet.pyx":416
 *         cdef double ratio, u
 *         global nreject, nevents
 *         nevents += 1             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG: print "was", evt.d, "sampled", d_new
 */
  __pyx_v_4qnet_nevents = (__pyx_v_4qnet_nevents + 1);

  /* "qnet.pyx":418
 *         nevents += 1
 * 
 *         if DEBUG: print "was", evt.d, "sampled", d_new             # <<<<<<<<<<<<<<
 *         diff_list = (<Queue> evt.q).diffListForDeparture (evt, d_new)
 * 
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_7 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_5 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_n_s_was);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_was);
    __Pyx_GIVEREF(__pyx_n_s_was);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_n_s_sampled);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_n_s_sampled);
    __Pyx_GIVEREF(__pyx_n_s_sampled);
    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_7 = 0;
    __pyx_t_5 = 0;
    if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L19;
  }
  __pyx_L19:;

  /* "qnet.pyx":419
 * 
 *         if DEBUG: print "was", evt.d, "sampled", d_new
 *         diff_list = (<Queue> evt.q).diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 * 
 *         global diff_len, num_diff
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)((struct __pyx_obj_6queues_Queue *)__pyx_v_evt->q)->__pyx_vtab)->diffListForDeparture(((struct __pyx_obj_6queues_Queue *)__pyx_v_evt->q), __pyx_v_evt, __pyx_v_d_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_diff_list = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":422
 * 
 *         global diff_len, num_diff
 *         num_diff += 1             # <<<<<<<<<<<<<<
 *         diff_len += len (diff_list)
 * 
 */
  __pyx_v_4qnet_num_diff = (__pyx_v_4qnet_num_diff + 1);

  /* "qnet.pyx":423
 *         global diff_len, num_diff
 *         num_diff += 1
 *         diff_len += len (diff_list)             # <<<<<<<<<<<<<<
 * 
 *         ratio = math.exp(fn(evt.d) - fn(d_new))
 */
  __pyx_t_11 = PyObject_Length(__pyx_v_diff_list); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 423; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_diff_len = (__pyx_v_4qnet_diff_len + __pyx_t_11);

  /* "qnet.pyx":425
 *         diff_len += len (diff_list)
 * 
 *         ratio = math.exp(fn(evt.d) - fn(d_new))             # <<<<<<<<<<<<<<
 *         for e_new in diff_list:
 *             if e_new.s < 0:
 */
  __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_math); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_exp); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_fn));
  __pyx_t_6 = ((PyObject *)__pyx_v_fn); __pyx_t_12 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  if (!__pyx_t_12) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_5);
  } else {
    __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_13);
    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
    PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_13, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_13 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_13);
  __Pyx_INCREF(((PyObject *)__pyx_v_fn));
  __pyx_t_4 = ((PyObject *)__pyx_v_fn); __pyx_t_12 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_12) {
    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_13); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    __Pyx_GOTREF(__pyx_t_6);
  } else {
    __pyx_t_14 = PyTuple_New(1+1); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_14);
    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
    PyTuple_SET_ITEM(__pyx_t_14, 0+1, __pyx_t_13);
    __Pyx_GIVEREF(__pyx_t_13);
    __pyx_t_13 = 0;
    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_14, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Subtract(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  if (!__pyx_t_6) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
    PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ratio = __pyx_t_3;

  /* "qnet.pyx":426
 * 
 *         ratio = math.exp(fn(evt.d) - fn(d_new))
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             if e_new.s < 0:
 *                 ratio = 0
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_1 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_1); __pyx_t_11 = 0;
    __pyx_t_15 = NULL;
  } else {
    __pyx_t_11 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_15 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_15)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_11); __Pyx_INCREF(__pyx_t_7); __pyx_t_11++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_11); __Pyx_INCREF(__pyx_t_7); __pyx_t_11++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_7 = __pyx_t_15(__pyx_t_1);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_7);
    }
    if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 426; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_e_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":427
 *         ratio = math.exp(fn(evt.d) - fn(d_new))
 *         for e_new in diff_list:
 *             if e_new.s < 0:             # <<<<<<<<<<<<<<
 *                 ratio = 0
 *                 break
 */
    __pyx_t_2 = ((__pyx_v_e_new->s < 0.0) != 0);
    if (__pyx_t_2) {

      /* "qnet.pyx":428
 *         for e_new in diff_list:
 *             if e_new.s < 0:
 *                 ratio = 0             # <<<<<<<<<<<<<<
 *                 break
 *             e_old = arrv.event (e_new.eid)
 */
      __pyx_v_ratio = 0.0;

      /* "qnet.pyx":429
 *             if e_new.s < 0:
 *                 ratio = 0
 *                 break             # <<<<<<<<<<<<<<
 *             e_old = arrv.event (e_new.eid)
 *             ratio *= exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 */
      goto __pyx_L21_break;
    }

    /* "qnet.pyx":430
 *                 ratio = 0
 *                 break
 *             e_old = arrv.event (e_new.eid)             # <<<<<<<<<<<<<<
 *             ratio *= exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 * 
 */
    __pyx_t_7 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_arrv->__pyx_vtab)->event(__pyx_v_arrv, __pyx_v_e_new->eid, 0)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_e_old, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":431
 *                 break
 *             e_old = arrv.event (e_new.eid)
 *             ratio *= exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))             # <<<<<<<<<<<<<<
 * 
 *         u = rand()
 */
    __pyx_v_ratio = (__pyx_v_ratio * exp((((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e_new->q->__pyx_vtab)->service_lpdf(__pyx_v_e_new->q, __pyx_v_e_new, 0) - ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e_old->q->__pyx_vtab)->service_lpdf(__pyx_v_e_old->q, __pyx_v_e_old, 0))));

    /* "qnet.pyx":426
 * 
 *         ratio = math.exp(fn(evt.d) - fn(d_new))
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             if e_new.s < 0:
 *                 ratio = 0
 */
  }
  __pyx_L21_break:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":433
 *             ratio *= exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 * 
 *         u = rand()             # <<<<<<<<<<<<<<
 *         if DEBUG: print "Ratio: ", ratio
 * 
 */
  __pyx_v_u = __pyx_f_8sampling_rand();

  /* "qnet.pyx":434
 * 
 *         u = rand()
 *         if DEBUG: print "Ratio: ", ratio             # <<<<<<<<<<<<<<
 * 
 * #        print "diff_list\n", display_diff_list (arrv, evt, diff_list)
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_ratio); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_kp_s_Ratio);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_s_Ratio);
    __Pyx_GIVEREF(__pyx_kp_s_Ratio);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_7, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L23;
  }
  __pyx_L23:;

  /* "qnet.pyx":438
 * #        print "diff_list\n", display_diff_list (arrv, evt, diff_list)
 * 
 *         if u < ratio:             # <<<<<<<<<<<<<<
 *             arrv.applyDiffList (diff_list)
 *         else:
 */
  __pyx_t_2 = ((__pyx_v_u < __pyx_v_ratio) != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":439
 * 
 *         if u < ratio:
 *             arrv.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 *         else:
 *             if DEBUG: print "Rejected:\n", display_diff_list (arrv, evt, diff_list)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_diff_list); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
    } else {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L24;
  }
  /*else*/ {

    /* "qnet.pyx":441
 *             arrv.applyDiffList (diff_list)
 *         else:
 *             if DEBUG: print "Rejected:\n", display_diff_list (arrv, evt, diff_list)             # <<<<<<<<<<<<<<
 *             nreject += 1
 * 
 */
    if (__pyx_e_4qnet_DEBUG) {
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_display_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_11 = 1;
        }
      }
      __pyx_t_5 = PyTuple_New(3+__pyx_t_11); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (__pyx_t_4) {
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_11, ((PyObject *)__pyx_v_arrv));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_11, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_11, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_kp_s_Rejected);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_Rejected);
      __Pyx_GIVEREF(__pyx_kp_s_Rejected);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __pyx_t_7 = 0;
      if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L25;
    }
    __pyx_L25:;

    /* "qnet.pyx":442
 *         else:
 *             if DEBUG: print "Rejected:\n", display_diff_list (arrv, evt, diff_list)
 *             nreject += 1             # <<<<<<<<<<<<<<
 * 
 *         return 0
 */
    __pyx_v_4qnet_nreject = (__pyx_v_4qnet_nreject + 1);
  }
  __pyx_L24:;

  /* "qnet.pyx":444
 *             nreject += 1
 * 
 *         return 0             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = 0;
  goto __pyx_L0;

  /* "qnet.pyx":388
 * 
 * 
 *     cdef int gibbs_resample_final (self, Arrivals arrv, Event evt) except -1:             # <<<<<<<<<<<<<<
 *         cdef Pwfun fn = _departure_proposal (arrv, evt)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_resample_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_fn);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_old);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":448
 * 
 *     # Resamples departure of event E0 == arrival of event E1
 *     cdef int gibbs_resample_pair (self, Arrivals arrv, Event e0, Event e1) except -1:             # <<<<<<<<<<<<<<
 *         cdef Pwfun product = _pair_proposal (arrv, e0, e1)
 * 
 */

static int __pyx_f_4qnet_4Qnet_gibbs_resample_pair(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_e0, struct __pyx_obj_8arrivals_Event *__pyx_v_e1) {
  struct __pyx_obj_5pwfun_Pwfun *__pyx_v_product = 0;
  int __pyx_v_tries;
  double __pyx_v_x_initial;
  double __pyx_v_d_new;
  double __pyx_v_L;
  double __pyx_v_U;
  CYTHON_UNUSED double __pyx_v_mid;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_old = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q0 = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q1 = 0;
  double __pyx_v_ratio;
  double __pyx_v_u;
  PyObject *__pyx_v_diff_list = NULL;
  double __pyx_v_ratio_this;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  double __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  Py_ssize_t __pyx_t_12;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *(*__pyx_t_16)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_resample_pair", 0);

  /* "qnet.pyx":449
 *     # Resamples departure of event E0 == arrival of event E1
 *     cdef int gibbs_resample_pair (self, Arrivals arrv, Event e0, Event e1) except -1:
 *         cdef Pwfun product = _pair_proposal (arrv, e0, e1)             # <<<<<<<<<<<<<<
 * 
 *         if product.U() - product.L() < 1e-10 or e1.d - e0.a < 1e-10: return 0  # don't sample small intervals
 */
  __pyx_t_1 = ((PyObject *)__pyx_f_6queues__pair_proposal(__pyx_v_arrv, __pyx_v_e0, __pyx_v_e1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_product = ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":451
 *         cdef Pwfun product = _pair_proposal (arrv, e0, e1)
 * 
 *         if product.U() - product.L() < 1e-10 or e1.d - e0.a < 1e-10: return 0  # don't sample small intervals             # <<<<<<<<<<<<<<
 * 
 *         cdef int tries = 0
 */
  __pyx_t_3 = (((((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_product->__pyx_vtab)->U(__pyx_v_product) - ((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_product->__pyx_vtab)->L(__pyx_v_product)) < 1e-10) != 0);
  if (!__pyx_t_3) {
  } else {
    __pyx_t_2 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (((__pyx_v_e1->d - __pyx_v_e0->a) < 1e-10) != 0);
  __pyx_t_2 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_2) {
    __pyx_r = 0;
    goto __pyx_L0;
  }

  /* "qnet.pyx":453
 *         if product.U() - product.L() < 1e-10 or e1.d - e0.a < 1e-10: return 0  # don't sample small intervals
 * 
 *         cdef int tries = 0             # <<<<<<<<<<<<<<
 *         cdef double x_initial = e0.d
 *         while (<double>product(x_initial)) == -INFINITY:
 */
  __pyx_v_tries = 0;

  /* "qnet.pyx":454
 * 
 *         cdef int tries = 0
 *         cdef double x_initial = e0.d             # <<<<<<<<<<<<<<
 *         while (<double>product(x_initial)) == -INFINITY:
 *             if DEBUG: print "Using strange initialization."
 */
  __pyx_t_4 = __pyx_v_e0->d;
  __pyx_v_x_initial = __pyx_t_4;

  /* "qnet.pyx":455
 *         cdef int tries = 0
 *         cdef double x_initial = e0.d
 *         while (<double>product(x_initial)) == -INFINITY:             # <<<<<<<<<<<<<<
 *             if DEBUG: print "Using strange initialization."
 *             x_initial = uniform (e0.a, e1.d)
 */
  while (1) {
    __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x_initial); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(((PyObject *)__pyx_v_product));
    __pyx_t_6 = ((PyObject *)__pyx_v_product); __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 455; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = ((((double)__pyx_t_4) == (-INFINITY)) != 0);
    if (!__pyx_t_2) break;

    /* "qnet.pyx":456
 *         cdef double x_initial = e0.d
 *         while (<double>product(x_initial)) == -INFINITY:
 *             if DEBUG: print "Using strange initialization."             # <<<<<<<<<<<<<<
 *             x_initial = uniform (e0.a, e1.d)
 *             tries += 1
 */
    if (__pyx_e_4qnet_DEBUG) {
      if (__Pyx_PrintOne(0, __pyx_kp_s_Using_strange_initialization) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 456; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "qnet.pyx":457
 *         while (<double>product(x_initial)) == -INFINITY:
 *             if DEBUG: print "Using strange initialization."
 *             x_initial = uniform (e0.a, e1.d)             # <<<<<<<<<<<<<<
 *             tries += 1
 *             if tries > 25:
 */
    __pyx_v_x_initial = __pyx_f_8sampling_uniform(__pyx_v_e0->a, __pyx_v_e1->d);

    /* "qnet.pyx":458
 *             if DEBUG: print "Using strange initialization."
 *             x_initial = uniform (e0.a, e1.d)
 *             tries += 1             # <<<<<<<<<<<<<<
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"
 */
    __pyx_v_tries = (__pyx_v_tries + 1);

    /* "qnet.pyx":459
 *             x_initial = uniform (e0.a, e1.d)
 *             tries += 1
 *             if tries > 25:             # <<<<<<<<<<<<<<
 *                 if DEBUG: print "Can't find valid initialization"
 *                 return 0
 */
    __pyx_t_2 = ((__pyx_v_tries > 25) != 0);
    if (__pyx_t_2) {

      /* "qnet.pyx":460
 *             tries += 1
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"             # <<<<<<<<<<<<<<
 *                 return 0
 * 
 */
      if (__pyx_e_4qnet_DEBUG) {
        if (__Pyx_PrintOne(0, __pyx_kp_s_Can_t_find_valid_initialization) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L10;
      }
      __pyx_L10:;

      /* "qnet.pyx":461
 *             if tries > 25:
 *                 if DEBUG: print "Can't find valid initialization"
 *                 return 0             # <<<<<<<<<<<<<<
 * 
 *         try:
 */
      __pyx_r = 0;
      goto __pyx_L0;
    }
  }

  /* "qnet.pyx":463
 *                 return 0
 * 
 *         try:             # <<<<<<<<<<<<<<
 *             d_new = call_sampler (product, x_initial)
 *         except:
 */
  {
    __Pyx_ExceptionSave(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
    __Pyx_XGOTREF(__pyx_t_9);
    __Pyx_XGOTREF(__pyx_t_10);
    __Pyx_XGOTREF(__pyx_t_11);
    /*try:*/ {

      /* "qnet.pyx":464
 * 
 *         try:
 *             d_new = call_sampler (product, x_initial)             # <<<<<<<<<<<<<<
 *         except:
 *             print "Error resampling event %s" % e0
 */
      __pyx_t_4 = __pyx_f_4qnet_call_sampler(__pyx_v_product, __pyx_v_x_initial); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
      __pyx_v_d_new = __pyx_t_4;
    }
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    goto __pyx_L18_try_end;
    __pyx_L11_error:;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":465
 *         try:
 *             d_new = call_sampler (product, x_initial)
 *         except:             # <<<<<<<<<<<<<<
 *             print "Error resampling event %s" % e0
 *             print format_six (e0)
 */
    /*except:*/ {
      __Pyx_AddTraceback("qnet.Qnet.gibbs_resample_pair", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_6, &__pyx_t_8) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_8);

      /* "qnet.pyx":466
 *             d_new = call_sampler (product, x_initial)
 *         except:
 *             print "Error resampling event %s" % e0             # <<<<<<<<<<<<<<
 *             print format_six (e0)
 *             L = product.L()
 */
      __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Error_resampling_event_s, ((PyObject *)__pyx_v_e0)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_PrintOne(0, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "qnet.pyx":467
 *         except:
 *             print "Error resampling event %s" % e0
 *             print format_six (e0)             # <<<<<<<<<<<<<<
 *             L = product.L()
 *             U = product.U() - 1e-8
 */
      __pyx_t_5 = __pyx_f_4qnet_format_six(__pyx_v_e0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_PrintOne(0, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "qnet.pyx":468
 *             print "Error resampling event %s" % e0
 *             print format_six (e0)
 *             L = product.L()             # <<<<<<<<<<<<<<
 *             U = product.U() - 1e-8
 *             mid = (L+U)/2
 */
      __pyx_v_L = ((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_product->__pyx_vtab)->L(__pyx_v_product);

      /* "qnet.pyx":469
 *             print format_six (e0)
 *             L = product.L()
 *             U = product.U() - 1e-8             # <<<<<<<<<<<<<<
 *             mid = (L+U)/2
 *             raise
 */
      __pyx_v_U = (((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_product->__pyx_vtab)->U(__pyx_v_product) - 1e-8);

      /* "qnet.pyx":470
 *             L = product.L()
 *             U = product.U() - 1e-8
 *             mid = (L+U)/2             # <<<<<<<<<<<<<<
 *             raise
 * 
 */
      __pyx_v_mid = ((__pyx_v_L + __pyx_v_U) / 2.0);

      /* "qnet.pyx":471
 *             U = product.U() - 1e-8
 *             mid = (L+U)/2
 *             raise             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG: print "product: ", product
 */
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_ErrRestore(__pyx_t_1, __pyx_t_6, __pyx_t_8);
      __pyx_t_1 = 0; __pyx_t_6 = 0; __pyx_t_8 = 0; 
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L13_except_error;}
    }
    __pyx_L13_except_error:;
    __Pyx_XGIVEREF(__pyx_t_9);
    __Pyx_XGIVEREF(__pyx_t_10);
    __Pyx_XGIVEREF(__pyx_t_11);
    __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_10, __pyx_t_11);
    goto __pyx_L1_error;
    __pyx_L18_try_end:;
  }

  /* "qnet.pyx":473
 *             raise
 * 
 *         if DEBUG: print "product: ", product             # <<<<<<<<<<<<<<
 *         if DEBUG: print "was", e0.d, "sampled", d_new
 * 
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_kp_s_product);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_s_product);
    __Pyx_GIVEREF(__pyx_kp_s_product);
    __Pyx_INCREF(((PyObject *)__pyx_v_product));
    PyTuple_SET_ITEM(__pyx_t_8, 1, ((PyObject *)__pyx_v_product));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_product));
    if (__Pyx_Print(0, __pyx_t_8, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    goto __pyx_L21;
  }
  __pyx_L21:;

  /* "qnet.pyx":474
 * 
 *         if DEBUG: print "product: ", product
 *         if DEBUG: print "was", e0.d, "sampled", d_new             # <<<<<<<<<<<<<<
 * 
 *         cdef Event e_new, e_old
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_8 = PyFloat_FromDouble(__pyx_v_e0->d); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_n_s_was);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_was);
    __Pyx_GIVEREF(__pyx_n_s_was);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_n_s_sampled);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_n_s_sampled);
    __Pyx_GIVEREF(__pyx_n_s_sampled);
    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_8 = 0;
    __pyx_t_6 = 0;
    if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L22;
  }
  __pyx_L22:;

  /* "qnet.pyx":477
 * 
 *         cdef Event e_new, e_old
 *         cdef Queue q0 = e0.q             # <<<<<<<<<<<<<<
 *         cdef Queue q1 = e1.q
 *         cdef double ratio, u
 */
  __pyx_t_1 = ((PyObject *)__pyx_v_e0->q);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_q0 = ((struct __pyx_obj_6queues_Queue *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":478
 *         cdef Event e_new, e_old
 *         cdef Queue q0 = e0.q
 *         cdef Queue q1 = e1.q             # <<<<<<<<<<<<<<
 *         cdef double ratio, u
 *         global nreject, nevents
 */
  __pyx_t_1 = ((PyObject *)__pyx_v_e1->q);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_q1 = ((struct __pyx_obj_6queues_Queue *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":481
 *         cdef double ratio, u
 *         global nreject, nevents
 *         nevents += 1             # <<<<<<<<<<<<<<
 * 
 *         diff_list = q0.diffListForDeparture (e0, d_new)
 */
  __pyx_v_4qnet_nevents = (__pyx_v_4qnet_nevents + 1);

  /* "qnet.pyx":483
 *         nevents += 1
 * 
 *         diff_list = q0.diffListForDeparture (e0, d_new)             # <<<<<<<<<<<<<<
 *         diff_list.extend (q1.diffListForArrival (e1, d_new))
 * 
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q0->__pyx_vtab)->diffListForDeparture(__pyx_v_q0, __pyx_v_e0, __pyx_v_d_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_diff_list = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":484
 * 
 *         diff_list = q0.diffListForDeparture (e0, d_new)
 *         diff_list.extend (q1.diffListForArrival (e1, d_new))             # <<<<<<<<<<<<<<
 * 
 *         global diff_len, num_diff
 */
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_diff_list, __pyx_n_s_extend); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_8 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q1->__pyx_vtab)->diffListForArrival(__pyx_v_q1, __pyx_v_e1, __pyx_v_d_new); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  if (!__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
    PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":487
 * 
 *         global diff_len, num_diff
 *         num_diff += 1             # <<<<<<<<<<<<<<
 *         diff_len += len (diff_list)
 * 
 */
  __pyx_v_4qnet_num_diff = (__pyx_v_4qnet_num_diff + 1);

  /* "qnet.pyx":488
 *         global diff_len, num_diff
 *         num_diff += 1
 *         diff_len += len (diff_list)             # <<<<<<<<<<<<<<
 * 
 *         ratio = math.exp(product(e0.d) - product(d_new))
 */
  __pyx_t_12 = PyObject_Length(__pyx_v_diff_list); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_diff_len = (__pyx_v_4qnet_diff_len + __pyx_t_12);

  /* "qnet.pyx":490
 *         diff_len += len (diff_list)
 * 
 *         ratio = math.exp(product(e0.d) - product(d_new))             # <<<<<<<<<<<<<<
 *         for e_new in diff_list:
 *             if e_new.s < 0:
 */
  __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_math); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_exp); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_8 = PyFloat_FromDouble(__pyx_v_e0->d); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_INCREF(((PyObject *)__pyx_v_product));
  __pyx_t_5 = ((PyObject *)__pyx_v_product); __pyx_t_13 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_13)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_13);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  if (!__pyx_t_13) {
    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_6);
  } else {
    __pyx_t_14 = PyTuple_New(1+1); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_14);
    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
    PyTuple_SET_ITEM(__pyx_t_14, 0+1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_14, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_14 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_14);
  __Pyx_INCREF(((PyObject *)__pyx_v_product));
  __pyx_t_8 = ((PyObject *)__pyx_v_product); __pyx_t_13 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_13)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_13);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (!__pyx_t_13) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_14); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_GOTREF(__pyx_t_5);
  } else {
    __pyx_t_15 = PyTuple_New(1+1); if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_15);
    PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
    PyTuple_SET_ITEM(__pyx_t_15, 0+1, __pyx_t_14);
    __Pyx_GIVEREF(__pyx_t_14);
    __pyx_t_14 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_15, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = PyNumber_Subtract(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  if (!__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
    PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ratio = __pyx_t_4;

  /* "qnet.pyx":491
 * 
 *         ratio = math.exp(product(e0.d) - product(d_new))
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             if e_new.s < 0:
 *                 ratio = 0
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_1 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_1); __pyx_t_12 = 0;
    __pyx_t_16 = NULL;
  } else {
    __pyx_t_12 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_16 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_16)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_12); __Pyx_INCREF(__pyx_t_7); __pyx_t_12++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_12 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_12); __Pyx_INCREF(__pyx_t_7); __pyx_t_12++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_7 = __pyx_t_16(__pyx_t_1);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_7);
    }
    if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_e_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":492
 *         ratio = math.exp(product(e0.d) - product(d_new))
 *         for e_new in diff_list:
 *             if e_new.s < 0:             # <<<<<<<<<<<<<<
 *                 ratio = 0
 *                 break
 */
    __pyx_t_2 = ((__pyx_v_e_new->s < 0.0) != 0);
    if (__pyx_t_2) {

      /* "qnet.pyx":493
 *         for e_new in diff_list:
 *             if e_new.s < 0:
 *                 ratio = 0             # <<<<<<<<<<<<<<
 *                 break
 *             e_old = arrv.event (e_new.eid)
 */
      __pyx_v_ratio = 0.0;

      /* "qnet.pyx":494
 *             if e_new.s < 0:
 *                 ratio = 0
 *                 break             # <<<<<<<<<<<<<<
 *             e_old = arrv.event (e_new.eid)
 *             ratio_this = exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 */
      goto __pyx_L24_break;
    }

    /* "qnet.pyx":495
 *                 ratio = 0
 *                 break
 *             e_old = arrv.event (e_new.eid)             # <<<<<<<<<<<<<<
 *             ratio_this = exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 *             ratio *= ratio_this
 */
    __pyx_t_7 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_arrv->__pyx_vtab)->event(__pyx_v_arrv, __pyx_v_e_new->eid, 0)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_e_old, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":496
 *                 break
 *             e_old = arrv.event (e_new.eid)
 *             ratio_this = exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))             # <<<<<<<<<<<<<<
 *             ratio *= ratio_this
 * #            print "%s\n%s\n%.5f %.5f\n\n" % (e_new, e_old, ratio_this, ratio)
 */
    __pyx_v_ratio_this = exp((((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e_new->q->__pyx_vtab)->service_lpdf(__pyx_v_e_new->q, __pyx_v_e_new, 0) - ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e_old->q->__pyx_vtab)->service_lpdf(__pyx_v_e_old->q, __pyx_v_e_old, 0)));

    /* "qnet.pyx":497
 *             e_old = arrv.event (e_new.eid)
 *             ratio_this = exp(e_new.q.service_lpdf (e_new) - e_old.q.service_lpdf (e_old))
 *             ratio *= ratio_this             # <<<<<<<<<<<<<<
 * #            print "%s\n%s\n%.5f %.5f\n\n" % (e_new, e_old, ratio_this, ratio)
 * 
 */
    __pyx_v_ratio = (__pyx_v_ratio * __pyx_v_ratio_this);

    /* "qnet.pyx":491
 * 
 *         ratio = math.exp(product(e0.d) - product(d_new))
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             if e_new.s < 0:
 *                 ratio = 0
 */
  }
  __pyx_L24_break:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":500
 * #            print "%s\n%s\n%.5f %.5f\n\n" % (e_new, e_old, ratio_this, ratio)
 * 
 *         u = rand()             # <<<<<<<<<<<<<<
 *         if DEBUG: print "Ratio", ratio
 * 
 */
  __pyx_v_u = __pyx_f_8sampling_rand();

  /* "qnet.pyx":501
 * 
 *         u = rand()
 *         if DEBUG: print "Ratio", ratio             # <<<<<<<<<<<<<<
 * 
 *         if u < ratio:
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_ratio); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_n_s_Ratio_2);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_n_s_Ratio_2);
    __Pyx_GIVEREF(__pyx_n_s_Ratio_2);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_7, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L26;
  }
  __pyx_L26:;

  /* "qnet.pyx":503
 *         if DEBUG: print "Ratio", ratio
 * 
 *         if u < ratio:             # <<<<<<<<<<<<<<
 * #            print "diff list: ", display_diff_list (arrv, e0, diff_list)
 *             arrv.applyDiffList (diff_list)
 */
  __pyx_t_2 = ((__pyx_v_u < __pyx_v_ratio) != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":505
 *         if u < ratio:
 * #            print "diff list: ", display_diff_list (arrv, e0, diff_list)
 *             arrv.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 * #             lpOld = self.log_prob (arrv)
 * #             self.applyDiffList (arrv, diff_list)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_diff_list); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 505; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L27;
  }
  /*else*/ {

    /* "qnet.pyx":511
 * #             print "Ratio real: ", exp(lpNew - lpOld)*ratio0
 *         else:
 *             if DEBUG: print "Rejected:\n", display_diff_list (arrv, e0, diff_list)             # <<<<<<<<<<<<<<
 *             nreject += 1
 * 
 */
    if (__pyx_e_4qnet_DEBUG) {
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_display_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = NULL;
      __pyx_t_12 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_12 = 1;
        }
      }
      __pyx_t_6 = PyTuple_New(3+__pyx_t_12); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_8) {
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_12, ((PyObject *)__pyx_v_arrv));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
      __Pyx_INCREF(((PyObject *)__pyx_v_e0));
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_12, ((PyObject *)__pyx_v_e0));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e0));
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_12, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_kp_s_Rejected);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_Rejected);
      __Pyx_GIVEREF(__pyx_kp_s_Rejected);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __pyx_t_7 = 0;
      if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 511; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L28;
    }
    __pyx_L28:;

    /* "qnet.pyx":512
 *         else:
 *             if DEBUG: print "Rejected:\n", display_diff_list (arrv, e0, diff_list)
 *             nreject += 1             # <<<<<<<<<<<<<<
 * 
 *         return 0
 */
    __pyx_v_4qnet_nreject = (__pyx_v_4qnet_nreject + 1);
  }
  __pyx_L27:;

  /* "qnet.pyx":514
 *             nreject += 1
 * 
 *         return 0             # <<<<<<<<<<<<<<
 * 
 *     # For debugging / unit tests
 */
  __pyx_r = 0;
  goto __pyx_L0;

  /* "qnet.pyx":448
 * 
 *     # Resamples departure of event E0 == arrival of event E1
 *     cdef int gibbs_resample_pair (self, Arrivals arrv, Event e0, Event e1) except -1:             # <<<<<<<<<<<<<<
 *         cdef Pwfun product = _pair_proposal (arrv, e0, e1)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_resample_pair", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_product);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_old);
  __Pyx_XDECREF((PyObject *)__pyx_v_q0);
  __Pyx_XDECREF((PyObject *)__pyx_v_q1);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":517
 * 
 *     # For debugging / unit tests
 *     def gibbs_for_departure (self, a, evt):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv = a
 *         cdef Event e0 = evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_35gibbs_for_departure(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_35gibbs_for_departure(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_evt = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_for_departure (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_a,&__pyx_n_s_evt,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_for_departure", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_for_departure") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_a = values[0];
    __pyx_v_evt = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_for_departure", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.gibbs_for_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_4Qnet_34gibbs_for_departure(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_a, __pyx_v_evt);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_34gibbs_for_departure(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a, PyObject *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e0 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e1 = 0;
  struct __pyx_obj_5pwfun_Pwfun *__pyx_v_a_fn = NULL;
  struct __pyx_obj_5pwfun_Pwfun *__pyx_v_d_fn = NULL;
  PyObject *__pyx_v_product = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_for_departure", 0);

  /* "qnet.pyx":518
 *     # For debugging / unit tests
 *     def gibbs_for_departure (self, a, evt):
 *         cdef Arrivals arrv = a             # <<<<<<<<<<<<<<
 *         cdef Event e0 = evt
 *         cdef Event e1 = e0.next_byt
 */
  if (!(likely(((__pyx_v_a) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_a, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_a;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":519
 *     def gibbs_for_departure (self, a, evt):
 *         cdef Arrivals arrv = a
 *         cdef Event e0 = evt             # <<<<<<<<<<<<<<
 *         cdef Event e1 = e0.next_byt
 *         if e1:
 */
  if (!(likely(((__pyx_v_evt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_e0 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":520
 *         cdef Arrivals arrv = a
 *         cdef Event e0 = evt
 *         cdef Event e1 = e0.next_byt             # <<<<<<<<<<<<<<
 *         if e1:
 *             a_fn = e0.q.departureLik (arrv, e0)
 */
  if (!(likely(((__pyx_v_e0->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e0->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_e0->next_byt;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_e1 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":521
 *         cdef Event e0 = evt
 *         cdef Event e1 = e0.next_byt
 *         if e1:             # <<<<<<<<<<<<<<
 *             a_fn = e0.q.departureLik (arrv, e0)
 *             d_fn = e1.q.arrivalLik (arrv, e1)
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_e1)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "qnet.pyx":522
 *         cdef Event e1 = e0.next_byt
 *         if e1:
 *             a_fn = e0.q.departureLik (arrv, e0)             # <<<<<<<<<<<<<<
 *             d_fn = e1.q.arrivalLik (arrv, e1)
 *             product = pwfun.add (a_fn, d_fn)
 */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e0->q->__pyx_vtab)->departureLik(__pyx_v_e0->q, __pyx_v_arrv, __pyx_v_e0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_v_a_fn = ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":523
 *         if e1:
 *             a_fn = e0.q.departureLik (arrv, e0)
 *             d_fn = e1.q.arrivalLik (arrv, e1)             # <<<<<<<<<<<<<<
 *             product = pwfun.add (a_fn, d_fn)
 *             return product
 */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e1->q->__pyx_vtab)->arrivalLik(__pyx_v_e1->q, __pyx_v_arrv, __pyx_v_e1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_v_d_fn = ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":524
 *             a_fn = e0.q.departureLik (arrv, e0)
 *             d_fn = e1.q.arrivalLik (arrv, e1)
 *             product = pwfun.add (a_fn, d_fn)             # <<<<<<<<<<<<<<
 *             return product
 *         else:
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_pwfun); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_add); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_5 = 1;
      }
    }
    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_3) {
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_a_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, ((PyObject *)__pyx_v_a_fn));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_a_fn));
    __Pyx_INCREF(((PyObject *)__pyx_v_d_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, ((PyObject *)__pyx_v_d_fn));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_d_fn));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_product = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "qnet.pyx":525
 *             d_fn = e1.q.arrivalLik (arrv, e1)
 *             product = pwfun.add (a_fn, d_fn)
 *             return product             # <<<<<<<<<<<<<<
 *         else:
 *             raise NotImplementedError()
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_product);
    __pyx_r = __pyx_v_product;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":527
 *             return product
 *         else:
 *             raise NotImplementedError()             # <<<<<<<<<<<<<<
 * 
 *     NUM_TRIES = 1  # Number of tries for random GGk initializations
 */
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_builtin_NotImplementedError); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "qnet.pyx":517
 * 
 *     # For debugging / unit tests
 *     def gibbs_for_departure (self, a, evt):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv = a
 *         cdef Event e0 = evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_for_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF((PyObject *)__pyx_v_e0);
  __Pyx_XDECREF((PyObject *)__pyx_v_e1);
  __Pyx_XDECREF((PyObject *)__pyx_v_a_fn);
  __Pyx_XDECREF((PyObject *)__pyx_v_d_fn);
  __Pyx_XDECREF(__pyx_v_product);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":531
 *     NUM_TRIES = 1  # Number of tries for random GGk initializations
 * 
 *     def gibbs_initialize (self, a, samplePaths=False):             # <<<<<<<<<<<<<<
 * #        return self.gibbs_initialize_via_mmk (a)
 *         return initializer (self, a)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_37gibbs_initialize(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_37gibbs_initialize(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_a = 0;
  CYTHON_UNUSED PyObject *__pyx_v_samplePaths = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_a,&__pyx_n_s_samplePaths,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_samplePaths);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_a = values[0];
    __pyx_v_samplePaths = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.gibbs_initialize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_4Qnet_36gibbs_initialize(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_a, __pyx_v_samplePaths);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_36gibbs_initialize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a, CYTHON_UNUSED PyObject *__pyx_v_samplePaths) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize", 0);

  /* "qnet.pyx":533
 *     def gibbs_initialize (self, a, samplePaths=False):
 * #        return self.gibbs_initialize_via_mmk (a)
 *         return initializer (self, a)             # <<<<<<<<<<<<<<
 * #        return self.gibbs_initialize_via_dfn3 (a)
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_4qnet_initializer);
  __pyx_t_2 = __pyx_v_4qnet_initializer; __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __Pyx_INCREF(__pyx_v_a);
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_a);
  __Pyx_GIVEREF(__pyx_v_a);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":531
 *     NUM_TRIES = 1  # Number of tries for random GGk initializations
 * 
 *     def gibbs_initialize (self, a, samplePaths=False):             # <<<<<<<<<<<<<<
 * #        return self.gibbs_initialize_via_mmk (a)
 *         return initializer (self, a)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_initialize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":536
 * #        return self.gibbs_initialize_via_dfn3 (a)
 * 
 *     def gibbs_initialize_via_mmk (self, a):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv2 = self.gibbs_initialize_via_rejection (a.duplicate())
 *         cdef Queue q
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_39gibbs_initialize_via_mmk(PyObject *__pyx_v_self, PyObject *__pyx_v_a); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_39gibbs_initialize_via_mmk(PyObject *__pyx_v_self, PyObject *__pyx_v_a) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_mmk (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_38gibbs_initialize_via_mmk(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_a));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_38gibbs_initialize_via_mmk(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv2 = 0;
  PyObject *__pyx_v_old_tmpls = NULL;
  PyObject *__pyx_v_arrvls = NULL;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_mmk", 0);

  /* "qnet.pyx":537
 * 
 *     def gibbs_initialize_via_mmk (self, a):
 *         cdef Arrivals arrv2 = self.gibbs_initialize_via_rejection (a.duplicate())             # <<<<<<<<<<<<<<
 *         cdef Queue q
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_gibbs_initialize_via_rejection); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_a, __pyx_n_s_duplicate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_arrv2 = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":540
 *         cdef Queue q
 * 
 *         old_tmpls = self.markovize (arrv2)             # <<<<<<<<<<<<<<
 * 
 *         arrvls = self.gibbs_resample (arrv2, burn=9, num_iter=1)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_markovize); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_arrv2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv2));
    PyTuple_SET_ITEM(__pyx_t_3, 0+1, ((PyObject *)__pyx_v_arrv2));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv2));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_old_tmpls = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":542
 *         old_tmpls = self.markovize (arrv2)
 * 
 *         arrvls = self.gibbs_resample (arrv2, burn=9, num_iter=1)             # <<<<<<<<<<<<<<
 * 
 *         self.demarkovize (old_tmpls)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_gibbs_resample); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv2));
  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_arrv2));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv2));
  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_burn, __pyx_int_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_num_iter, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_arrvls = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "qnet.pyx":544
 *         arrvls = self.gibbs_resample (arrv2, burn=9, num_iter=1)
 * 
 *         self.demarkovize (old_tmpls)             # <<<<<<<<<<<<<<
 * 
 *         cdef Arrivals result = arrvls[-1]
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_demarkovize); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_old_tmpls); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
  } else {
    __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(__pyx_v_old_tmpls);
    PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_old_tmpls);
    __Pyx_GIVEREF(__pyx_v_old_tmpls);
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":546
 *         self.demarkovize (old_tmpls)
 * 
 *         cdef Arrivals result = arrvls[-1]             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in result:
 */
  __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_arrvls, -1, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "qnet.pyx":548
 *         cdef Arrivals result = arrvls[-1]
 *         cdef Event evt
 *         for evt in result:             # <<<<<<<<<<<<<<
 *             evt.q.initialize_auxiliaries (evt)
 * 
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_result))) || PyTuple_CheckExact(((PyObject *)__pyx_v_result))) {
    __pyx_t_5 = ((PyObject *)__pyx_v_result); __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(((PyObject *)__pyx_v_result)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_5))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_7(__pyx_t_5);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":549
 *         cdef Event evt
 *         for evt in result:
 *             evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 * 
 *         return result
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_2) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":548
 *         cdef Arrivals result = arrvls[-1]
 *         cdef Event evt
 *         for evt in result:             # <<<<<<<<<<<<<<
 *             evt.q.initialize_auxiliaries (evt)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":551
 *             evt.q.initialize_auxiliaries (evt)
 * 
 *         return result             # <<<<<<<<<<<<<<
 * 
 *     def markovize (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  /* "qnet.pyx":536
 * #        return self.gibbs_initialize_via_dfn3 (a)
 * 
 *     def gibbs_initialize_via_mmk (self, a):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv2 = self.gibbs_initialize_via_rejection (a.duplicate())
 *         cdef Queue q
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_initialize_via_mmk", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv2);
  __Pyx_XDECREF(__pyx_v_old_tmpls);
  __Pyx_XDECREF(__pyx_v_arrvls);
  __Pyx_XDECREF((PyObject *)__pyx_v_result);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":553
 *         return result
 * 
 *     def markovize (self):             # <<<<<<<<<<<<<<
 *         cdef Queue q
 *         old_tmpls = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_41markovize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_41markovize(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("markovize (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_40markovize(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_40markovize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_old_tmpls = NULL;
  PyObject *__pyx_v_theta = NULL;
  PyObject *__pyx_v_f = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("markovize", 0);

  /* "qnet.pyx":555
 *     def markovize (self):
 *         cdef Queue q
 *         old_tmpls = []             # <<<<<<<<<<<<<<
 *         for q in self.queues:
 *             old_tmpls.append (q.service)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_old_tmpls = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":556
 *         cdef Queue q
 *         old_tmpls = []
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 556; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":557
 *         old_tmpls = []
 *         for q in self.queues:
 *             old_tmpls.append (q.service)             # <<<<<<<<<<<<<<
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         theta = [ f.mean() for f in old_tmpls ]
 */
    __pyx_t_4 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyList_Append(__pyx_v_old_tmpls, __pyx_t_4); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":558
 *         for q in self.queues:
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())             # <<<<<<<<<<<<<<
 *         theta = [ f.mean() for f in old_tmpls ]
 *         self.parameters = theta
 */
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_queues); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_DistributionTemplate); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_distributions); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_Exponential); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_FactorTemplate))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GIVEREF(__pyx_t_4);
    __Pyx_GOTREF(__pyx_v_q->service);
    __Pyx_DECREF(((PyObject *)__pyx_v_q->service));
    __pyx_v_q->service = ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":556
 *         cdef Queue q
 *         old_tmpls = []
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":559
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         theta = [ f.mean() for f in old_tmpls ]             # <<<<<<<<<<<<<<
 *         self.parameters = theta
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __pyx_v_old_tmpls; __Pyx_INCREF(__pyx_t_4); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_4)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_7); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    __Pyx_XDECREF_SET(__pyx_v_f, __pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_mean); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_7))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_theta = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":560
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         theta = [ f.mean() for f in old_tmpls ]
 *         self.parameters = theta             # <<<<<<<<<<<<<<
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 *         return old_tmpls
 */
  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters, __pyx_v_theta) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":561
 *         theta = [ f.mean() for f in old_tmpls ]
 *         self.parameters = theta
 *         print "gibbs_initialize: mini_params %s" % self.parameters             # <<<<<<<<<<<<<<
 *         return old_tmpls
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_gibbs_initialize_mini_params_s, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PrintOne(0, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":562
 *         self.parameters = theta
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 *         return old_tmpls             # <<<<<<<<<<<<<<
 * 
 *     def markovize_from_arrivals (self, a):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_old_tmpls);
  __pyx_r = __pyx_v_old_tmpls;
  goto __pyx_L0;

  /* "qnet.pyx":553
 *         return result
 * 
 *     def markovize (self):             # <<<<<<<<<<<<<<
 *         cdef Queue q
 *         old_tmpls = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.Qnet.markovize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_old_tmpls);
  __Pyx_XDECREF(__pyx_v_theta);
  __Pyx_XDECREF(__pyx_v_f);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":564
 *         return old_tmpls
 * 
 *     def markovize_from_arrivals (self, a):             # <<<<<<<<<<<<<<
 *         cdef Queue q
 *         old_tmpls = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_43markovize_from_arrivals(PyObject *__pyx_v_self, PyObject *__pyx_v_a); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_43markovize_from_arrivals(PyObject *__pyx_v_self, PyObject *__pyx_v_a) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("markovize_from_arrivals (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_42markovize_from_arrivals(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_a));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_42markovize_from_arrivals(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_a) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_old_tmpls = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("markovize_from_arrivals", 0);

  /* "qnet.pyx":566
 *     def markovize_from_arrivals (self, a):
 *         cdef Queue q
 *         old_tmpls = []             # <<<<<<<<<<<<<<
 *         for q in self.queues:
 *             old_tmpls.append (q.service)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_old_tmpls = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":567
 *         cdef Queue q
 *         old_tmpls = []
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":568
 *         old_tmpls = []
 *         for q in self.queues:
 *             old_tmpls.append (q.service)             # <<<<<<<<<<<<<<
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         self.estimate (a)
 */
    __pyx_t_4 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyList_Append(__pyx_v_old_tmpls, __pyx_t_4); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":569
 *         for q in self.queues:
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())             # <<<<<<<<<<<<<<
 *         self.estimate (a)
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 */
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_queues); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_DistributionTemplate); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_distributions); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_Exponential); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_FactorTemplate))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GIVEREF(__pyx_t_4);
    __Pyx_GOTREF(__pyx_v_q->service);
    __Pyx_DECREF(((PyObject *)__pyx_v_q->service));
    __pyx_v_q->service = ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":567
 *         cdef Queue q
 *         old_tmpls = []
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":570
 *             old_tmpls.append (q.service)
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         self.estimate (a)             # <<<<<<<<<<<<<<
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 *         return old_tmpls
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_estimate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    __Pyx_INCREF(__pyx_v_a);
    PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_a);
    __Pyx_GIVEREF(__pyx_v_a);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":571
 *             q.service = queues.DistributionTemplate (distributions.Exponential ())
 *         self.estimate (a)
 *         print "gibbs_initialize: mini_params %s" % self.parameters             # <<<<<<<<<<<<<<
 *         return old_tmpls
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_gibbs_initialize_mini_params_s, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PrintOne(0, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":572
 *         self.estimate (a)
 *         print "gibbs_initialize: mini_params %s" % self.parameters
 *         return old_tmpls             # <<<<<<<<<<<<<<
 * 
 *     def demarkovize (self, old_tmpls):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_old_tmpls);
  __pyx_r = __pyx_v_old_tmpls;
  goto __pyx_L0;

  /* "qnet.pyx":564
 *         return old_tmpls
 * 
 *     def markovize_from_arrivals (self, a):             # <<<<<<<<<<<<<<
 *         cdef Queue q
 *         old_tmpls = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.Qnet.markovize_from_arrivals", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_old_tmpls);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":574
 *         return old_tmpls
 * 
 *     def demarkovize (self, old_tmpls):             # <<<<<<<<<<<<<<
 *         for i in xrange(len(old_tmpls)):
 *             (<Queue>self.queues[i]).service = old_tmpls[i]
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_45demarkovize(PyObject *__pyx_v_self, PyObject *__pyx_v_old_tmpls); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_45demarkovize(PyObject *__pyx_v_self, PyObject *__pyx_v_old_tmpls) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("demarkovize (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_44demarkovize(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_old_tmpls));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_44demarkovize(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_old_tmpls) {
  Py_ssize_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  Py_ssize_t __pyx_t_1;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("demarkovize", 0);

  /* "qnet.pyx":575
 * 
 *     def demarkovize (self, old_tmpls):
 *         for i in xrange(len(old_tmpls)):             # <<<<<<<<<<<<<<
 *             (<Queue>self.queues[i]).service = old_tmpls[i]
 * 
 */
  __pyx_t_1 = PyObject_Length(__pyx_v_old_tmpls); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 575; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;

    /* "qnet.pyx":576
 *     def demarkovize (self, old_tmpls):
 *         for i in xrange(len(old_tmpls)):
 *             (<Queue>self.queues[i]).service = old_tmpls[i]             # <<<<<<<<<<<<<<
 * 
 *     def gibbs_initialize_via_rejection (self, Arrivals arrv):
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_old_tmpls, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_6queues_FactorTemplate))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->queues, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 576; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_3);
    __Pyx_GOTREF(((struct __pyx_obj_6queues_Queue *)__pyx_t_4)->service);
    __Pyx_DECREF(((PyObject *)((struct __pyx_obj_6queues_Queue *)__pyx_t_4)->service));
    ((struct __pyx_obj_6queues_Queue *)__pyx_t_4)->service = ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "qnet.pyx":574
 *         return old_tmpls
 * 
 *     def demarkovize (self, old_tmpls):             # <<<<<<<<<<<<<<
 *         for i in xrange(len(old_tmpls)):
 *             (<Queue>self.queues[i]).service = old_tmpls[i]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.Qnet.demarkovize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":578
 *             (<Queue>self.queues[i]).service = old_tmpls[i]
 * 
 *     def gibbs_initialize_via_rejection (self, Arrivals arrv):             # <<<<<<<<<<<<<<
 *         # Initialize by sampling response times from initial distribution
 *         #  Assumes that data is sampled by task
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_47gibbs_initialize_via_rejection(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_47gibbs_initialize_via_rejection(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_rejection (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 578; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_46gibbs_initialize_via_rejection(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_46gibbs_initialize_via_rejection(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new = 0;
  long __pyx_v_max_backtracks;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_v_result_snapshot = NULL;
  PyObject *__pyx_v_heap_snapshot = NULL;
  PyObject *__pyx_v_eid_snapshot = NULL;
  PyObject *__pyx_v_s_max = NULL;
  PyObject *__pyx_v_rep = NULL;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_a_i = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_d_min = NULL;
  PyObject *__pyx_v_prev_d = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_v_s_i = NULL;
  PyObject *__pyx_v_aux = NULL;
  PyObject *__pyx_v_s_next = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *(*__pyx_t_11)(PyObject *);
  int __pyx_t_12;
  int __pyx_t_13;
  Py_ssize_t __pyx_t_14;
  int __pyx_t_15;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_rejection", 0);

  /* "qnet.pyx":585
 *         cdef Event evt, evt_new
 * 
 *         max_backtracks = 10000             # <<<<<<<<<<<<<<
 * 
 *         result = None
 */
  __pyx_v_max_backtracks = 10000;

  /* "qnet.pyx":587
 *         max_backtracks = 10000
 * 
 *         result = None             # <<<<<<<<<<<<<<
 * 
 *         s_initial = self.fsm.initial_state()
 */
  __Pyx_INCREF(Py_None);
  __pyx_v_result = Py_None;

  /* "qnet.pyx":589
 *         result = None
 * 
 *         s_initial = self.fsm.initial_state()             # <<<<<<<<<<<<<<
 * 
 *         result_snapshot = Arrivals (self)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_s_initial = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":591
 *         s_initial = self.fsm.initial_state()
 * 
 *         result_snapshot = Arrivals (self)             # <<<<<<<<<<<<<<
 *         heap_snapshot = self.heap_from_arrivals (arrv)
 *         eid_snapshot = 0
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result_snapshot = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":592
 * 
 *         result_snapshot = Arrivals (self)
 *         heap_snapshot = self.heap_from_arrivals (arrv)             # <<<<<<<<<<<<<<
 *         eid_snapshot = 0
 *         s_max = numpy.inf
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_heap_from_arrivals); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_heap_snapshot = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":593
 *         result_snapshot = Arrivals (self)
 *         heap_snapshot = self.heap_from_arrivals (arrv)
 *         eid_snapshot = 0             # <<<<<<<<<<<<<<
 *         s_max = numpy.inf
 * 
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_eid_snapshot = __pyx_int_0;

  /* "qnet.pyx":594
 *         heap_snapshot = self.heap_from_arrivals (arrv)
 *         eid_snapshot = 0
 *         s_max = numpy.inf             # <<<<<<<<<<<<<<
 * 
 *         for rep in xrange (max_backtracks):
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_inf); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_s_max = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":596
 *         s_max = numpy.inf
 * 
 *         for rep in xrange (max_backtracks):             # <<<<<<<<<<<<<<
 *             eid = eid_snapshot
 *             heap = heap_snapshot[:]
 */
  __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v_max_backtracks); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 596; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_rep, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":597
 * 
 *         for rep in xrange (max_backtracks):
 *             eid = eid_snapshot             # <<<<<<<<<<<<<<
 *             heap = heap_snapshot[:]
 *             result = result_snapshot.duplicate()
 */
    __Pyx_INCREF(__pyx_v_eid_snapshot);
    __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_v_eid_snapshot);

    /* "qnet.pyx":598
 *         for rep in xrange (max_backtracks):
 *             eid = eid_snapshot
 *             heap = heap_snapshot[:]             # <<<<<<<<<<<<<<
 *             result = result_snapshot.duplicate()
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_heap_snapshot, 0, 0, NULL, NULL, &__pyx_slice__8, 0, 0, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_heap, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":599
 *             eid = eid_snapshot
 *             heap = heap_snapshot[:]
 *             result = result_snapshot.duplicate()             # <<<<<<<<<<<<<<
 * 
 *             while heap:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_result_snapshot, __pyx_n_s_duplicate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (__pyx_t_3) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_result, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":601
 *             result = result_snapshot.duplicate()
 * 
 *             while heap:             # <<<<<<<<<<<<<<
 *                 a_i, tid, sid, evt = heappop (heap)
 * 
 */
    while (1) {
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_heap); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (!__pyx_t_7) break;

      /* "qnet.pyx":602
 * 
 *             while heap:
 *                 a_i, tid, sid, evt = heappop (heap)             # <<<<<<<<<<<<<<
 * 
 *                 if evt:
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappop); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      if (!__pyx_t_3) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_heap); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
        PyObject* sequence = __pyx_t_1;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 4)) {
          if (size > 4) __Pyx_RaiseTooManyValuesError(4);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_8 = PyTuple_GET_ITEM(sequence, 1); 
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 2); 
          __pyx_t_9 = PyTuple_GET_ITEM(sequence, 3); 
        } else {
          __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_8 = PyList_GET_ITEM(sequence, 1); 
          __pyx_t_3 = PyList_GET_ITEM(sequence, 2); 
          __pyx_t_9 = PyList_GET_ITEM(sequence, 3); 
        }
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        #else
        {
          Py_ssize_t i;
          PyObject** temps[4] = {&__pyx_t_4,&__pyx_t_8,&__pyx_t_3,&__pyx_t_9};
          for (i=0; i < 4; i++) {
            PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(item);
            *(temps[i]) = item;
          }
        }
        #endif
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        Py_ssize_t index = -1;
        PyObject** temps[4] = {&__pyx_t_4,&__pyx_t_8,&__pyx_t_3,&__pyx_t_9};
        __pyx_t_10 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_11 = Py_TYPE(__pyx_t_10)->tp_iternext;
        for (index=0; index < 4; index++) {
          PyObject* item = __pyx_t_11(__pyx_t_10); if (unlikely(!item)) goto __pyx_L7_unpacking_failed;
          __Pyx_GOTREF(item);
          *(temps[index]) = item;
        }
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_10), 4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_11 = NULL;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        goto __pyx_L8_unpacking_done;
        __pyx_L7_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_11 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L8_unpacking_done:;
      }
      if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_a_i, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_8);
      __pyx_t_8 = 0;
      __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_3);
      __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_9));
      __pyx_t_9 = 0;

      /* "qnet.pyx":604
 *                 a_i, tid, sid, evt = heappop (heap)
 * 
 *                 if evt:             # <<<<<<<<<<<<<<
 *                     # it was an observed event
 *                     d_min = evt.q.when_clear (result)
 */
      __pyx_t_7 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_7) {

        /* "qnet.pyx":606
 *                 if evt:
 *                     # it was an observed event
 *                     d_min = evt.q.when_clear (result)             # <<<<<<<<<<<<<<
 *                     if d_min > evt.d:
 *                         # oops. backtrack
 */
        __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_when_clear); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_9, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_result); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(__pyx_v_result);
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_result);
          __Pyx_GIVEREF(__pyx_v_result);
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_XDECREF_SET(__pyx_v_d_min, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "qnet.pyx":607
 *                     # it was an observed event
 *                     d_min = evt.q.when_clear (result)
 *                     if d_min > evt.d:             # <<<<<<<<<<<<<<
 *                         # oops. backtrack
 * #                        print "BACKTRACK: Wanted to add %s to [s_max %f]\n%s" % (evt, s_max, result)
 */
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = PyObject_RichCompare(__pyx_v_d_min, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (__pyx_t_7) {

          /* "qnet.pyx":610
 *                         # oops. backtrack
 * #                        print "BACKTRACK: Wanted to add %s to [s_max %f]\n%s" % (evt, s_max, result)
 *                         prev_d = evt.q.when_clear (result_snapshot)             # <<<<<<<<<<<<<<
 *                         s_max = evt.d - prev_d
 *                         result = None
 */
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_when_clear); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_8 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_8)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_8);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          if (!__pyx_t_8) {
            __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_result_snapshot); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
          } else {
            __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
            __Pyx_INCREF(__pyx_v_result_snapshot);
            PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_result_snapshot);
            __Pyx_GIVEREF(__pyx_v_result_snapshot);
            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          }
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_XDECREF_SET(__pyx_v_prev_d, __pyx_t_9);
          __pyx_t_9 = 0;

          /* "qnet.pyx":611
 * #                        print "BACKTRACK: Wanted to add %s to [s_max %f]\n%s" % (evt, s_max, result)
 *                         prev_d = evt.q.when_clear (result_snapshot)
 *                         s_max = evt.d - prev_d             # <<<<<<<<<<<<<<
 *                         result = None
 *                         break
 */
          __pyx_t_9 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 611; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_1 = PyNumber_Subtract(__pyx_t_9, __pyx_v_prev_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 611; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF_SET(__pyx_v_s_max, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "qnet.pyx":612
 *                         prev_d = evt.q.when_clear (result_snapshot)
 *                         s_max = evt.d - prev_d
 *                         result = None             # <<<<<<<<<<<<<<
 *                         break
 *                     else:
 */
          __Pyx_INCREF(Py_None);
          __Pyx_DECREF_SET(__pyx_v_result, Py_None);

          /* "qnet.pyx":613
 *                         s_max = evt.d - prev_d
 *                         result = None
 *                         break             # <<<<<<<<<<<<<<
 *                     else:
 *                         evt_new = evt.duplicate()
 */
          goto __pyx_L6_break;
        }
        /*else*/ {

          /* "qnet.pyx":615
 *                         break
 *                     else:
 *                         evt_new = evt.duplicate()             # <<<<<<<<<<<<<<
 *                         evt_new.eid = eid
 *                         result.append (evt_new)
 */
          __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->duplicate(__pyx_v_evt, 0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_XDECREF_SET(__pyx_v_evt_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "qnet.pyx":616
 *                     else:
 *                         evt_new = evt.duplicate()
 *                         evt_new.eid = eid             # <<<<<<<<<<<<<<
 *                         result.append (evt_new)
 *                         evt_new.q.recompute_service (evt_new)
 */
          __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_eid); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_v_evt_new->eid = __pyx_t_12;

          /* "qnet.pyx":617
 *                         evt_new = evt.duplicate()
 *                         evt_new.eid = eid
 *                         result.append (evt_new)             # <<<<<<<<<<<<<<
 *                         evt_new.q.recompute_service (evt_new)
 * 
 */
          __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_result, ((PyObject *)__pyx_v_evt_new)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":618
 *                         evt_new.eid = eid
 *                         result.append (evt_new)
 *                         evt_new.q.recompute_service (evt_new)             # <<<<<<<<<<<<<<
 * 
 *                         # create new snapshot
 */
          __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt_new->q->__pyx_vtab)->recompute_service(__pyx_v_evt_new->q, __pyx_v_evt_new, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "qnet.pyx":621
 * 
 *                         # create new snapshot
 *                         eid_snapshot = eid+1             # <<<<<<<<<<<<<<
 *                         heap_snapshot = heap[:]
 *                         result_snapshot = result.duplicate()
 */
          __pyx_t_1 = PyNumber_Add(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF_SET(__pyx_v_eid_snapshot, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "qnet.pyx":622
 *                         # create new snapshot
 *                         eid_snapshot = eid+1
 *                         heap_snapshot = heap[:]             # <<<<<<<<<<<<<<
 *                         result_snapshot = result.duplicate()
 * #                        print "SNAPSHOT: %s" % result_snapshot
 */
          __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_heap, 0, 0, NULL, NULL, &__pyx_slice__9, 0, 0, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF_SET(__pyx_v_heap_snapshot, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "qnet.pyx":623
 *                         eid_snapshot = eid+1
 *                         heap_snapshot = heap[:]
 *                         result_snapshot = result.duplicate()             # <<<<<<<<<<<<<<
 * #                        print "SNAPSHOT: %s" % result_snapshot
 *                         s_max = numpy.inf
 */
          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_duplicate); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_3 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
            __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
            if (likely(__pyx_t_3)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
              __Pyx_INCREF(__pyx_t_3);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_9, function);
            }
          }
          if (__pyx_t_3) {
            __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          } else {
            __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF_SET(__pyx_v_result_snapshot, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "qnet.pyx":625
 *                         result_snapshot = result.duplicate()
 * #                        print "SNAPSHOT: %s" % result_snapshot
 *                         s_max = numpy.inf             # <<<<<<<<<<<<<<
 *                 else:
 *                     # create new event
 */
          __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_inf); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF_SET(__pyx_v_s_max, __pyx_t_9);
          __pyx_t_9 = 0;
        }
        goto __pyx_L9;
      }
      /*else*/ {

        /* "qnet.pyx":628
 *                 else:
 *                     # create new event
 *                     qid = self.fsm.sample_one_obs (sid)             # <<<<<<<<<<<<<<
 *                     q = self.queues[qid]
 * 
 */
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_one_obs); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_1, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_sid); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
        } else {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(__pyx_v_sid);
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_sid);
          __Pyx_GIVEREF(__pyx_v_sid);
          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_9);
        __pyx_t_9 = 0;

        /* "qnet.pyx":629
 *                     # create new event
 *                     qid = self.fsm.sample_one_obs (sid)
 *                     q = self.queues[qid]             # <<<<<<<<<<<<<<
 * 
 *                     if sid == s_initial: # sample initial arrivals
 */
        __pyx_t_9 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_9);
        if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 629; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_9));
        __pyx_t_9 = 0;

        /* "qnet.pyx":631
 *                     q = self.queues[qid]
 * 
 *                     if sid == s_initial: # sample initial arrivals             # <<<<<<<<<<<<<<
 *                         s_i = numpy.inf
 *                         while s_i >= s_max:
 */
        __pyx_t_9 = PyObject_RichCompare(__pyx_v_sid, __pyx_v_s_initial, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (__pyx_t_7) {

          /* "qnet.pyx":632
 * 
 *                     if sid == s_initial: # sample initial arrivals
 *                         s_i = numpy.inf             # <<<<<<<<<<<<<<
 *                         while s_i >= s_max:
 *                             s_i, aux = q.sample_service()
 */
          __pyx_t_9 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_inf); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_XDECREF_SET(__pyx_v_s_i, __pyx_t_1);
          __pyx_t_1 = 0;

          /* "qnet.pyx":633
 *                     if sid == s_initial: # sample initial arrivals
 *                         s_i = numpy.inf
 *                         while s_i >= s_max:             # <<<<<<<<<<<<<<
 *                             s_i, aux = q.sample_service()
 *                     else:
 */
          while (1) {
            __pyx_t_1 = PyObject_RichCompare(__pyx_v_s_i, __pyx_v_s_max, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            if (!__pyx_t_7) break;

            /* "qnet.pyx":634
 *                         s_i = numpy.inf
 *                         while s_i >= s_max:
 *                             s_i, aux = q.sample_service()             # <<<<<<<<<<<<<<
 *                     else:
 *                         s_i = 0
 */
            __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_sample_service); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __pyx_t_8 = NULL;
            if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
              __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
              if (likely(__pyx_t_8)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
                __Pyx_INCREF(__pyx_t_8);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_9, function);
              }
            }
            if (__pyx_t_8) {
              __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            } else {
              __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            }
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
              PyObject* sequence = __pyx_t_1;
              #if CYTHON_COMPILING_IN_CPYTHON
              Py_ssize_t size = Py_SIZE(sequence);
              #else
              Py_ssize_t size = PySequence_Size(sequence);
              #endif
              if (unlikely(size != 2)) {
                if (size > 2) __Pyx_RaiseTooManyValuesError(2);
                else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
                {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              }
              #if CYTHON_COMPILING_IN_CPYTHON
              if (likely(PyTuple_CheckExact(sequence))) {
                __pyx_t_9 = PyTuple_GET_ITEM(sequence, 0); 
                __pyx_t_8 = PyTuple_GET_ITEM(sequence, 1); 
              } else {
                __pyx_t_9 = PyList_GET_ITEM(sequence, 0); 
                __pyx_t_8 = PyList_GET_ITEM(sequence, 1); 
              }
              __Pyx_INCREF(__pyx_t_9);
              __Pyx_INCREF(__pyx_t_8);
              #else
              __pyx_t_9 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_8 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_8);
              #endif
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            } else {
              Py_ssize_t index = -1;
              __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
              __pyx_t_11 = Py_TYPE(__pyx_t_3)->tp_iternext;
              index = 0; __pyx_t_9 = __pyx_t_11(__pyx_t_3); if (unlikely(!__pyx_t_9)) goto __pyx_L14_unpacking_failed;
              __Pyx_GOTREF(__pyx_t_9);
              index = 1; __pyx_t_8 = __pyx_t_11(__pyx_t_3); if (unlikely(!__pyx_t_8)) goto __pyx_L14_unpacking_failed;
              __Pyx_GOTREF(__pyx_t_8);
              if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_3), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __pyx_t_11 = NULL;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              goto __pyx_L15_unpacking_done;
              __pyx_L14_unpacking_failed:;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_11 = NULL;
              if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
              {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __pyx_L15_unpacking_done:;
            }
            __Pyx_DECREF_SET(__pyx_v_s_i, __pyx_t_9);
            __pyx_t_9 = 0;
            __Pyx_XDECREF_SET(__pyx_v_aux, __pyx_t_8);
            __pyx_t_8 = 0;
          }
          goto __pyx_L11;
        }
        /*else*/ {

          /* "qnet.pyx":636
 *                             s_i, aux = q.sample_service()
 *                     else:
 *                         s_i = 0             # <<<<<<<<<<<<<<
 * 
 *                     evt = Event (eid, tid, qid, q, a_i, s_i, 0.0, sid, obs_a=0, obs_d=0, proc=0, aux=aux)
 */
          __Pyx_INCREF(__pyx_int_0);
          __Pyx_XDECREF_SET(__pyx_v_s_i, __pyx_int_0);
        }
        __pyx_L11:;

        /* "qnet.pyx":638
 *                         s_i = 0
 * 
 *                     evt = Event (eid, tid, qid, q, a_i, s_i, 0.0, sid, obs_a=0, obs_d=0, proc=0, aux=aux)             # <<<<<<<<<<<<<<
 *                     result.append (evt)
 *                     q.recompute_departure (result, evt)
 */
        __pyx_t_1 = PyTuple_New(8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_v_eid);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_eid);
        __Pyx_GIVEREF(__pyx_v_eid);
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __Pyx_INCREF(__pyx_v_qid);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_qid);
        __Pyx_GIVEREF(__pyx_v_qid);
        __Pyx_INCREF(((PyObject *)__pyx_v_q));
        PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_v_q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
        __Pyx_INCREF(__pyx_v_a_i);
        PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_v_a_i);
        __Pyx_GIVEREF(__pyx_v_a_i);
        __Pyx_INCREF(__pyx_v_s_i);
        PyTuple_SET_ITEM(__pyx_t_1, 5, __pyx_v_s_i);
        __Pyx_GIVEREF(__pyx_v_s_i);
        __Pyx_INCREF(__pyx_float_0_0);
        PyTuple_SET_ITEM(__pyx_t_1, 6, __pyx_float_0_0);
        __Pyx_GIVEREF(__pyx_float_0_0);
        __Pyx_INCREF(__pyx_v_sid);
        PyTuple_SET_ITEM(__pyx_t_1, 7, __pyx_v_sid);
        __Pyx_GIVEREF(__pyx_v_sid);
        __pyx_t_8 = PyDict_New(); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_obs_a, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_obs_d, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_proc, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (unlikely(!__pyx_v_aux)) { __Pyx_RaiseUnboundLocalError("aux"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
        if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_aux, __pyx_v_aux) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_9 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_9));
        __pyx_t_9 = 0;

        /* "qnet.pyx":639
 * 
 *                     evt = Event (eid, tid, qid, q, a_i, s_i, 0.0, sid, obs_a=0, obs_d=0, proc=0, aux=aux)
 *                     result.append (evt)             # <<<<<<<<<<<<<<
 *                     q.recompute_departure (result, evt)
 * 
 */
        __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_result, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 639; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "qnet.pyx":640
 *                     evt = Event (eid, tid, qid, q, a_i, s_i, 0.0, sid, obs_a=0, obs_d=0, proc=0, aux=aux)
 *                     result.append (evt)
 *                     q.recompute_departure (result, evt)             # <<<<<<<<<<<<<<
 * 
 *                     s_next = self.fsm.sample_state (sid)
 */
        if (!(likely(((__pyx_v_result) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_result, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_9 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_departure(__pyx_v_q, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_result), __pyx_v_evt, 0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "qnet.pyx":642
 *                     q.recompute_departure (result, evt)
 * 
 *                     s_next = self.fsm.sample_state (sid)             # <<<<<<<<<<<<<<
 *                     if s_next: heappush (heap, (evt.d, tid, s_next, None))
 * 
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_state); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
          }
        }
        if (!__pyx_t_1) {
          __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_sid); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
        } else {
          __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
          __Pyx_INCREF(__pyx_v_sid);
          PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_sid);
          __Pyx_GIVEREF(__pyx_v_sid);
          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        }
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF_SET(__pyx_v_s_next, __pyx_t_9);
        __pyx_t_9 = 0;

        /* "qnet.pyx":643
 * 
 *                     s_next = self.fsm.sample_state (sid)
 *                     if s_next: heappush (heap, (evt.d, tid, s_next, None))             # <<<<<<<<<<<<<<
 * 
 *                 eid = eid + 1
 */
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_s_next); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__pyx_t_7) {
          __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_3 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_v_tid);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
          __Pyx_GIVEREF(__pyx_v_tid);
          __Pyx_INCREF(__pyx_v_s_next);
          PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_s_next);
          __Pyx_GIVEREF(__pyx_v_s_next);
          __Pyx_INCREF(Py_None);
          PyTuple_SET_ITEM(__pyx_t_1, 3, Py_None);
          __Pyx_GIVEREF(Py_None);
          __pyx_t_3 = 0;
          __pyx_t_3 = NULL;
          __pyx_t_14 = 0;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
            __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
            if (likely(__pyx_t_3)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
              __Pyx_INCREF(__pyx_t_3);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_8, function);
              __pyx_t_14 = 1;
            }
          }
          __pyx_t_4 = PyTuple_New(2+__pyx_t_14); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          if (__pyx_t_3) {
            PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          }
          __Pyx_INCREF(__pyx_v_heap);
          PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_14, __pyx_v_heap);
          __Pyx_GIVEREF(__pyx_v_heap);
          PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_14, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          __pyx_t_1 = 0;
          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          goto __pyx_L16;
        }
        __pyx_L16:;
      }
      __pyx_L9:;

      /* "qnet.pyx":645
 *                     if s_next: heappush (heap, (evt.d, tid, s_next, None))
 * 
 *                 eid = eid + 1             # <<<<<<<<<<<<<<
 * 
 *             if result: break  # we made it!
 */
      __pyx_t_9 = PyNumber_Add(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_9);
      __pyx_t_9 = 0;
    }
    __pyx_L6_break:;

    /* "qnet.pyx":647
 *                 eid = eid + 1
 * 
 *             if result: break  # we made it!             # <<<<<<<<<<<<<<
 * 
 *         # max backtracks reached, no initialization
 */
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_result); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_7) {
      goto __pyx_L4_break;
    }

    /* "qnet.pyx":596
 *         s_max = numpy.inf
 * 
 *         for rep in xrange (max_backtracks):             # <<<<<<<<<<<<<<
 *             eid = eid_snapshot
 *             heap = heap_snapshot[:]
 */
  }
  __pyx_L4_break:;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":650
 * 
 *         # max backtracks reached, no initialization
 *         print "Gibbs initialization: Num backtracks = %d" % rep             # <<<<<<<<<<<<<<
 *         if not result:
 *             raise Exception ("Could not initialize\n%s" % arrv)
 */
  if (unlikely(!__pyx_v_rep)) { __Pyx_RaiseUnboundLocalError("rep"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_Gibbs_initialization_Num_backtra, __pyx_v_rep); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (__Pyx_PrintOne(0, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":651
 *         # max backtracks reached, no initialization
 *         print "Gibbs initialization: Num backtracks = %d" % rep
 *         if not result:             # <<<<<<<<<<<<<<
 *             raise Exception ("Could not initialize\n%s" % arrv)
 * 
 */
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_result); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_15 = ((!__pyx_t_7) != 0);
  if (__pyx_t_15) {

    /* "qnet.pyx":652
 *         print "Gibbs initialization: Num backtracks = %d" % rep
 *         if not result:
 *             raise Exception ("Could not initialize\n%s" % arrv)             # <<<<<<<<<<<<<<
 * 
 *         return result
 */
    __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_Could_not_initialize_s, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "qnet.pyx":654
 *             raise Exception ("Could not initialize\n%s" % arrv)
 * 
 *         return result             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":578
 *             (<Queue>self.queues[i]).service = old_tmpls[i]
 * 
 *     def gibbs_initialize_via_rejection (self, Arrivals arrv):             # <<<<<<<<<<<<<<
 *         # Initialize by sampling response times from initial distribution
 *         #  Assumes that data is sampled by task
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_initialize_via_rejection", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_new);
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XDECREF(__pyx_v_result_snapshot);
  __Pyx_XDECREF(__pyx_v_heap_snapshot);
  __Pyx_XDECREF(__pyx_v_eid_snapshot);
  __Pyx_XDECREF(__pyx_v_s_max);
  __Pyx_XDECREF(__pyx_v_rep);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_a_i);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_d_min);
  __Pyx_XDECREF(__pyx_v_prev_d);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_s_i);
  __Pyx_XDECREF(__pyx_v_aux);
  __Pyx_XDECREF(__pyx_v_s_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":659
 *     # Event-wise slice sampling
 * 
 *     def slice_resample (self, Arrivals arrv, int num_iter, report_fn=None, return_arrv=False, reverse=False, return_lp=False):             # <<<<<<<<<<<<<<
 * 
 *         cdef int ne = 0
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_49slice_resample(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_49slice_resample(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_v_num_iter;
  PyObject *__pyx_v_report_fn = 0;
  PyObject *__pyx_v_return_arrv = 0;
  PyObject *__pyx_v_reverse = 0;
  PyObject *__pyx_v_return_lp = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("slice_resample (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_num_iter,&__pyx_n_s_report_fn,&__pyx_n_s_return_arrv,&__pyx_n_s_reverse,&__pyx_n_s_return_lp,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[2] = ((PyObject *)Py_None);
    values[3] = ((PyObject *)Py_False);
    values[4] = ((PyObject *)Py_False);
    values[5] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_num_iter)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("slice_resample", 0, 2, 6, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_report_fn);
          if (value) { values[2] = value; kw_args--; }
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_return_arrv);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_reverse);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_return_lp);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "slice_resample") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[0]);
    __pyx_v_num_iter = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_num_iter == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_report_fn = values[2];
    __pyx_v_return_arrv = values[3];
    __pyx_v_reverse = values[4];
    __pyx_v_return_lp = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("slice_resample", 0, 2, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.slice_resample", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_48slice_resample(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_arrv, __pyx_v_num_iter, __pyx_v_report_fn, __pyx_v_return_arrv, __pyx_v_reverse, __pyx_v_return_lp);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_48slice_resample(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, int __pyx_v_num_iter, PyObject *__pyx_v_report_fn, PyObject *__pyx_v_return_arrv, PyObject *__pyx_v_reverse, PyObject *__pyx_v_return_lp) {
  int __pyx_v_ne;
  int __pyx_v_gi;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_next = 0;
  double __pyx_v_upper;
  double __pyx_v_d_new;
  double __pyx_v_lik;
  PyObject *__pyx_v_all_arrv = NULL;
  PyObject *__pyx_v_Tmax = NULL;
  PyObject *__pyx_v_allEvents = NULL;
  PyObject *__pyx_v_dfn = NULL;
  PyObject *__pyx_v_a2 = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  double __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_t_15;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("slice_resample", 0);

  /* "qnet.pyx":661
 *     def slice_resample (self, Arrivals arrv, int num_iter, report_fn=None, return_arrv=False, reverse=False, return_lp=False):
 * 
 *         cdef int ne = 0             # <<<<<<<<<<<<<<
 *         cdef int gi
 *         cdef Event evt, evt_next
 */
  __pyx_v_ne = 0;

  /* "qnet.pyx":669
 *         global nevents
 * 
 *         all_arrv = []             # <<<<<<<<<<<<<<
 * 
 *         lik = self.log_prob (arrv)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 669; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_all_arrv = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":671
 *         all_arrv = []
 * 
 *         lik = self.log_prob (arrv)             # <<<<<<<<<<<<<<
 *         Tmax = 2 * max([ e.d for e in arrv ])
 *         if DEBUG: print "slice_resample: initial log_prob ", lik
 */
  __pyx_t_2 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, __pyx_v_arrv, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 671; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_lik = __pyx_t_2;

  /* "qnet.pyx":672
 * 
 *         lik = self.log_prob (arrv)
 *         Tmax = 2 * max([ e.d for e in arrv ])             # <<<<<<<<<<<<<<
 *         if DEBUG: print "slice_resample: initial log_prob ", lik
 *         if DEBUG: print "slice_resample: Tmax ", Tmax
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_d); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_6))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_max, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(__pyx_int_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_Tmax = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "qnet.pyx":673
 *         lik = self.log_prob (arrv)
 *         Tmax = 2 * max([ e.d for e in arrv ])
 *         if DEBUG: print "slice_resample: initial log_prob ", lik             # <<<<<<<<<<<<<<
 *         if DEBUG: print "slice_resample: Tmax ", Tmax
 * 
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_3 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_s_slice_resample_initial_log_prob);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_slice_resample_initial_log_prob);
    __Pyx_GIVEREF(__pyx_kp_s_slice_resample_initial_log_prob);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "qnet.pyx":674
 *         Tmax = 2 * max([ e.d for e in arrv ])
 *         if DEBUG: print "slice_resample: initial log_prob ", lik
 *         if DEBUG: print "slice_resample: Tmax ", Tmax             # <<<<<<<<<<<<<<
 * 
 *         for gi in range(num_iter):
 */
  if (__pyx_e_4qnet_DEBUG) {
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_s_slice_resample_Tmax);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_slice_resample_Tmax);
    __Pyx_GIVEREF(__pyx_kp_s_slice_resample_Tmax);
    __Pyx_INCREF(__pyx_v_Tmax);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_Tmax);
    __Pyx_GIVEREF(__pyx_v_Tmax);
    if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 674; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "qnet.pyx":676
 *         if DEBUG: print "slice_resample: Tmax ", Tmax
 * 
 *         for gi in range(num_iter):             # <<<<<<<<<<<<<<
 * 
 *             # resample latent variables for all factors
 */
  __pyx_t_7 = __pyx_v_num_iter;
  for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_gi = __pyx_t_8;

    /* "qnet.pyx":679
 * 
 *             # resample latent variables for all factors
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.resample_auxiliaries (evt)
 * 
 */
    if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
      __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
      __pyx_t_5 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_5)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_5(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "qnet.pyx":680
 *             # resample latent variables for all factors
 *             for evt in arrv:
 *                 evt.q.resample_auxiliaries (evt)             # <<<<<<<<<<<<<<
 * 
 *             allEvents = arrv.all_events()
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_resample_auxiliaries); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_9 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_9) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_10, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 680; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "qnet.pyx":679
 * 
 *             # resample latent variables for all factors
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.resample_auxiliaries (evt)
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":682
 *                 evt.q.resample_auxiliaries (evt)
 * 
 *             allEvents = arrv.all_events()             # <<<<<<<<<<<<<<
 *             if is_slice_sorted: allEvents.sort(reverse=True, key=get_departure)
 *             if reverse: allEvents.reverse()
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_events); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 682; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_allEvents, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":683
 * 
 *             allEvents = arrv.all_events()
 *             if is_slice_sorted: allEvents.sort(reverse=True, key=get_departure)             # <<<<<<<<<<<<<<
 *             if reverse: allEvents.reverse()
 * 
 */
    __pyx_t_11 = (__pyx_v_4qnet_is_slice_sorted != 0);
    if (__pyx_t_11) {
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_allEvents, __pyx_n_s_sort); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_reverse, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_get_departure); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_key, __pyx_t_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L11;
    }
    __pyx_L11:;

    /* "qnet.pyx":684
 *             allEvents = arrv.all_events()
 *             if is_slice_sorted: allEvents.sort(reverse=True, key=get_departure)
 *             if reverse: allEvents.reverse()             # <<<<<<<<<<<<<<
 * 
 *             for evt in allEvents:
 */
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_reverse); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_11) {
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_allEvents, __pyx_n_s_reverse); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (__pyx_t_1) {
        __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "qnet.pyx":686
 *             if reverse: allEvents.reverse()
 * 
 *             for evt in allEvents:             # <<<<<<<<<<<<<<
 *                 evt_next = evt.next_byt
 *                 if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 */
    if (likely(PyList_CheckExact(__pyx_v_allEvents)) || PyTuple_CheckExact(__pyx_v_allEvents)) {
      __pyx_t_6 = __pyx_v_allEvents; __Pyx_INCREF(__pyx_t_6); __pyx_t_4 = 0;
      __pyx_t_5 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_allEvents); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_5)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_6, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_5(__pyx_t_6);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 686; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "qnet.pyx":687
 * 
 *             for evt in allEvents:
 *                 evt_next = evt.next_byt             # <<<<<<<<<<<<<<
 *                 if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 *                     if DEBUG: print "=========\nslice_resampling EID: %d\n%s" % (evt.eid, format_six(evt))
 */
      if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 687; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_3 = __pyx_v_evt->next_byt;
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_evt_next, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "qnet.pyx":688
 *             for evt in allEvents:
 *                 evt_next = evt.next_byt
 *                 if not evt.obs_d and (not evt_next or not evt_next.obs_a):             # <<<<<<<<<<<<<<
 *                     if DEBUG: print "=========\nslice_resampling EID: %d\n%s" % (evt.eid, format_six(evt))
 * 
 */
      __pyx_t_12 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_11 = __pyx_t_12;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_12 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_next)); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_13 = ((!__pyx_t_12) != 0);
      if (!__pyx_t_13) {
      } else {
        __pyx_t_11 = __pyx_t_13;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_13 = ((!(__pyx_v_evt_next->obs_a != 0)) != 0);
      __pyx_t_11 = __pyx_t_13;
      __pyx_L16_bool_binop_done:;
      if (__pyx_t_11) {

        /* "qnet.pyx":689
 *                 evt_next = evt.next_byt
 *                 if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 *                     if DEBUG: print "=========\nslice_resampling EID: %d\n%s" % (evt.eid, format_six(evt))             # <<<<<<<<<<<<<<
 * 
 *                     if lik == -INFINITY:
 */
        if (__pyx_e_4qnet_DEBUG) {
          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          __pyx_t_3 = 0;
          __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_slice_resampling_EID_d_s, __pyx_t_10); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 689; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          goto __pyx_L19;
        }
        __pyx_L19:;

        /* "qnet.pyx":691
 *                     if DEBUG: print "=========\nslice_resampling EID: %d\n%s" % (evt.eid, format_six(evt))
 * 
 *                     if lik == -INFINITY:             # <<<<<<<<<<<<<<
 *                         print "Before update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 */
        __pyx_t_11 = ((__pyx_v_lik == (-INFINITY)) != 0);
        if (__pyx_t_11) {

          /* "qnet.pyx":692
 * 
 *                     if lik == -INFINITY:
 *                         print "Before update: lik is infinity"             # <<<<<<<<<<<<<<
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 *                         arrv.validate()
 */
          if (__Pyx_PrintOne(0, __pyx_kp_s_Before_update_lik_is_infinity) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 692; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":693
 *                     if lik == -INFINITY:
 *                         print "Before update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))             # <<<<<<<<<<<<<<
 *                         arrv.validate()
 * 
 */
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          __pyx_t_1 = 0;
          __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_EID_d_s, __pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_10) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "qnet.pyx":694
 *                         print "Before update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 *                         arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *                     ne += 1
 */
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          if (__pyx_t_1) {
            __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          } else {
            __pyx_t_10 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          goto __pyx_L20;
        }
        __pyx_L20:;

        /* "qnet.pyx":696
 *                         arrv.validate()
 * 
 *                     ne += 1             # <<<<<<<<<<<<<<
 *                     dfn = GGkGibbs (self, arrv, evt, lik).dfn()
 *                     upper = self.determine_upper (evt)
 */
        __pyx_v_ne = (__pyx_v_ne + 1);

        /* "qnet.pyx":697
 * 
 *                     ne += 1
 *                     dfn = GGkGibbs (self, arrv, evt, lik).dfn()             # <<<<<<<<<<<<<<
 *                     upper = self.determine_upper (evt)
 *                     upper = min(upper, Tmax)
 */
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4qnet_GGkGibbs)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_dfn); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_1, function);
          }
        }
        if (__pyx_t_3) {
          __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else {
          __pyx_t_10 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF_SET(__pyx_v_dfn, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "qnet.pyx":698
 *                     ne += 1
 *                     dfn = GGkGibbs (self, arrv, evt, lik).dfn()
 *                     upper = self.determine_upper (evt)             # <<<<<<<<<<<<<<
 *                     upper = min(upper, Tmax)
 * 
 */
        __pyx_v_upper = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->determine_upper(__pyx_v_self, __pyx_v_evt);

        /* "qnet.pyx":699
 *                     dfn = GGkGibbs (self, arrv, evt, lik).dfn()
 *                     upper = self.determine_upper (evt)
 *                     upper = min(upper, Tmax)             # <<<<<<<<<<<<<<
 * 
 *                     d_new = _slice (evt.d, dfn, evt.a, upper)
 */
        __Pyx_INCREF(__pyx_v_Tmax);
        __pyx_t_10 = __pyx_v_Tmax;
        __pyx_t_2 = __pyx_v_upper;
        __pyx_t_3 = PyFloat_FromDouble(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_9 = PyObject_RichCompare(__pyx_t_10, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (__pyx_t_11) {
          __Pyx_INCREF(__pyx_t_10);
          __pyx_t_1 = __pyx_t_10;
        } else {
          __pyx_t_9 = PyFloat_FromDouble(__pyx_t_2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_1 = __pyx_t_9;
          __pyx_t_9 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_upper = __pyx_t_2;

        /* "qnet.pyx":701
 *                     upper = min(upper, Tmax)
 * 
 *                     d_new = _slice (evt.d, dfn, evt.a, upper)             # <<<<<<<<<<<<<<
 *                     lik = apply_departure (arrv, evt, d_new, lik)
 * 
 */
        __pyx_t_2 = __pyx_f_8sampling__slice(__pyx_v_evt->d, __pyx_v_dfn, __pyx_v_evt->a, __pyx_v_upper); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 701; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_v_d_new = __pyx_t_2;

        /* "qnet.pyx":702
 * 
 *                     d_new = _slice (evt.d, dfn, evt.a, upper)
 *                     lik = apply_departure (arrv, evt, d_new, lik)             # <<<<<<<<<<<<<<
 * 
 *                     if lik == -INFINITY:
 */
        __pyx_t_2 = __pyx_f_4qnet_apply_departure(__pyx_v_arrv, __pyx_v_evt, __pyx_v_d_new, __pyx_v_lik, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 702; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_v_lik = __pyx_t_2;

        /* "qnet.pyx":704
 *                     lik = apply_departure (arrv, evt, d_new, lik)
 * 
 *                     if lik == -INFINITY:             # <<<<<<<<<<<<<<
 *                         print "After update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 */
        __pyx_t_11 = ((__pyx_v_lik == (-INFINITY)) != 0);
        if (__pyx_t_11) {

          /* "qnet.pyx":705
 * 
 *                     if lik == -INFINITY:
 *                         print "After update: lik is infinity"             # <<<<<<<<<<<<<<
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 *                         arrv.validate()
 */
          if (__Pyx_PrintOne(0, __pyx_kp_s_After_update_lik_is_infinity) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":706
 *                     if lik == -INFINITY:
 *                         print "After update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))             # <<<<<<<<<<<<<<
 *                         arrv.validate()
 * 
 */
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          __pyx_t_1 = 0;
          __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_EID_d_s, __pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_10) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "qnet.pyx":707
 *                         print "After update: lik is infinity"
 *                         print "    EID: %d\n%s" % (evt.eid, format_six(evt))
 *                         arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *                     nevents += 1
 */
          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_9);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_9, function);
            }
          }
          if (__pyx_t_1) {
            __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          } else {
            __pyx_t_10 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          goto __pyx_L21;
        }
        __pyx_L21:;

        /* "qnet.pyx":709
 *                         arrv.validate()
 * 
 *                     nevents += 1             # <<<<<<<<<<<<<<
 * 
 *                     if DEBUG:
 */
        __pyx_v_4qnet_nevents = (__pyx_v_4qnet_nevents + 1);

        /* "qnet.pyx":711
 *                     nevents += 1
 * 
 *                     if DEBUG:             # <<<<<<<<<<<<<<
 *                         print "Sampled: ", d_new
 *                         arrv.validate()
 */
        if (__pyx_e_4qnet_DEBUG) {

          /* "qnet.pyx":712
 * 
 *                     if DEBUG:
 *                         print "Sampled: ", d_new             # <<<<<<<<<<<<<<
 *                         arrv.validate()
 * 
 */
          __pyx_t_10 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_INCREF(__pyx_kp_s_Sampled);
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_s_Sampled);
          __Pyx_GIVEREF(__pyx_kp_s_Sampled);
          PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          __pyx_t_10 = 0;
          if (__Pyx_Print(0, __pyx_t_9, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

          /* "qnet.pyx":713
 *                     if DEBUG:
 *                         print "Sampled: ", d_new
 *                         arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *             if report_fn:
 */
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          if (__pyx_t_1) {
            __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          } else {
            __pyx_t_9 = __Pyx_PyObject_CallNoArg(__pyx_t_10); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          goto __pyx_L22;
        }
        __pyx_L22:;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "qnet.pyx":686
 *             if reverse: allEvents.reverse()
 * 
 *             for evt in allEvents:             # <<<<<<<<<<<<<<
 *                 evt_next = evt.next_byt
 *                 if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 */
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":715
 *                         arrv.validate()
 * 
 *             if report_fn:             # <<<<<<<<<<<<<<
 *                 report_fn (self, arrv, gi, lik)
 *             if return_arrv:
 */
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_report_fn); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_11) {

      /* "qnet.pyx":716
 * 
 *             if report_fn:
 *                 report_fn (self, arrv, gi, lik)             # <<<<<<<<<<<<<<
 *             if return_arrv:
 *                 a2 = arrv.duplicate()
 */
      __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_gi); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_v_report_fn);
      __pyx_t_1 = __pyx_v_report_fn; __pyx_t_3 = NULL;
      __pyx_t_4 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_4 = 1;
        }
      }
      __pyx_t_14 = PyTuple_New(4+__pyx_t_4); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      if (__pyx_t_3) {
        PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_4, ((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_14, 2+__pyx_t_4, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_14, 3+__pyx_t_4, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_14, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L23;
    }
    __pyx_L23:;

    /* "qnet.pyx":717
 *             if report_fn:
 *                 report_fn (self, arrv, gi, lik)
 *             if return_arrv:             # <<<<<<<<<<<<<<
 *                 a2 = arrv.duplicate()
 *                 all_arrv.append (a2)
 */
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_return_arrv); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_11) {

      /* "qnet.pyx":718
 *                 report_fn (self, arrv, gi, lik)
 *             if return_arrv:
 *                 a2 = arrv.duplicate()             # <<<<<<<<<<<<<<
 *                 all_arrv.append (a2)
 * 
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_14 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      if (__pyx_t_14) {
        __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_14); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      } else {
        __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_a2, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "qnet.pyx":719
 *             if return_arrv:
 *                 a2 = arrv.duplicate()
 *                 all_arrv.append (a2)             # <<<<<<<<<<<<<<
 * 
 *         # sanity check
 */
      __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_all_arrv, __pyx_v_a2); if (unlikely(__pyx_t_15 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L24;
    }
    __pyx_L24:;
  }

  /* "qnet.pyx":725
 * #        assert abs(lik - self.log_prob (arrv)) < 1e-5, "Log prob mismatch! Cached %.5f true %.5f" % (lik, self.log_prob(arrv))
 * 
 *         if not return_arrv: all_arrv = [arrv]             # <<<<<<<<<<<<<<
 * 
 *         if return_lp:
 */
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_return_arrv); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_13 = ((!__pyx_t_11) != 0);
  if (__pyx_t_13) {
    __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyList_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __Pyx_DECREF_SET(__pyx_v_all_arrv, ((PyObject*)__pyx_t_6));
    __pyx_t_6 = 0;
    goto __pyx_L25;
  }
  __pyx_L25:;

  /* "qnet.pyx":727
 *         if not return_arrv: all_arrv = [arrv]
 * 
 *         if return_lp:             # <<<<<<<<<<<<<<
 *             return all_arrv, lik
 *         else:
 */
  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_return_lp); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 727; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_13) {

    /* "qnet.pyx":728
 * 
 *         if return_lp:
 *             return all_arrv, lik             # <<<<<<<<<<<<<<
 *         else:
 *             return all_arrv
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 728; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_all_arrv);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_all_arrv);
    __Pyx_GIVEREF(__pyx_v_all_arrv);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":730
 *             return all_arrv, lik
 *         else:
 *             return all_arrv             # <<<<<<<<<<<<<<
 * 
 *     cdef double determine_upper (self, Event evt):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_all_arrv);
    __pyx_r = __pyx_v_all_arrv;
    goto __pyx_L0;
  }

  /* "qnet.pyx":659
 *     # Event-wise slice sampling
 * 
 *     def slice_resample (self, Arrivals arrv, int num_iter, report_fn=None, return_arrv=False, reverse=False, return_lp=False):             # <<<<<<<<<<<<<<
 * 
 *         cdef int ne = 0
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("qnet.Qnet.slice_resample", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_next);
  __Pyx_XDECREF(__pyx_v_all_arrv);
  __Pyx_XDECREF(__pyx_v_Tmax);
  __Pyx_XDECREF(__pyx_v_allEvents);
  __Pyx_XDECREF(__pyx_v_dfn);
  __Pyx_XDECREF(__pyx_v_a2);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":732
 *             return all_arrv
 * 
 *     cdef double determine_upper (self, Event evt):             # <<<<<<<<<<<<<<
 *         next = evt.next_by_task()
 *         return next.d if next else numpy.inf
 */

static double __pyx_f_4qnet_4Qnet_determine_upper(CYTHON_UNUSED struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_v_next = NULL;
  double __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  double __pyx_t_4;
  int __pyx_t_5;
  double __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("determine_upper", 0);

  /* "qnet.pyx":733
 * 
 *     cdef double determine_upper (self, Event evt):
 *         next = evt.next_by_task()             # <<<<<<<<<<<<<<
 *         return next.d if next else numpy.inf
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_next_by_task); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 733; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_next = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":734
 *     cdef double determine_upper (self, Event evt):
 *         next = evt.next_by_task()
 *         return next.d if next else numpy.inf             # <<<<<<<<<<<<<<
 * 
 *     cdef object dfn_range (self, Arrivals arrv, Event evt):
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_next); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_next, __pyx_n_s_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_4 = __pyx_t_6;
  } else {
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __pyx_t_6;
  }
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;

  /* "qnet.pyx":732
 *             return all_arrv
 * 
 *     cdef double determine_upper (self, Event evt):             # <<<<<<<<<<<<<<
 *         next = evt.next_by_task()
 *         return next.d if next else numpy.inf
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_WriteUnraisable("qnet.Qnet.determine_upper", __pyx_clineno, __pyx_lineno, __pyx_filename, 0);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_next);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":736
 *         return next.d if next else numpy.inf
 * 
 *     cdef object dfn_range (self, Arrivals arrv, Event evt):             # <<<<<<<<<<<<<<
 *         return (evt.a, self.determine_upper(evt))
 * 
 */

static PyObject *__pyx_f_4qnet_4Qnet_dfn_range(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("dfn_range", 0);

  /* "qnet.pyx":737
 * 
 *     cdef object dfn_range (self, Arrivals arrv, Event evt):
 *         return (evt.a, self.determine_upper(evt))             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->determine_upper(__pyx_v_self, __pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":736
 *         return next.d if next else numpy.inf
 * 
 *     cdef object dfn_range (self, Arrivals arrv, Event evt):             # <<<<<<<<<<<<<<
 *         return (evt.a, self.determine_upper(evt))
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.Qnet.dfn_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":741
 * 
 *     ## Computing the exact Gibbs kernel
 *     def gibbs_kernel (self, Arrivals arrv_from, Arrivals arrv_to, double lik=-INFINITY):             # <<<<<<<<<<<<<<
 * 
 *       cdef Event evt, evt_next
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_51gibbs_kernel(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_51gibbs_kernel(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_from = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_to = 0;
  double __pyx_v_lik;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_kernel (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv_from,&__pyx_n_s_arrv_to,&__pyx_n_s_lik,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv_from)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv_to)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_kernel", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_lik);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_kernel") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arrv_from = ((struct __pyx_obj_8arrivals_Arrivals *)values[0]);
    __pyx_v_arrv_to = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    if (values[2]) {
      __pyx_v_lik = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_lik == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    } else {
      __pyx_v_lik = __pyx_k__10;
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_kernel", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.gibbs_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv_from), __pyx_ptype_8arrivals_Arrivals, 1, "arrv_from", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv_to), __pyx_ptype_8arrivals_Arrivals, 1, "arrv_to", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_50gibbs_kernel(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_arrv_from, __pyx_v_arrv_to, __pyx_v_lik);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_50gibbs_kernel(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_from, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_to, double __pyx_v_lik) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_next = 0;
  double __pyx_v_upper;
  double __pyx_v_lower;
  double __pyx_v_d_new;
  double __pyx_v_prob;
  double __pyx_v_Z;
  PyObject *__pyx_v_arrv_new = NULL;
  PyObject *__pyx_v_evtlst = NULL;
  PyObject *__pyx_v_deferred = NULL;
  Py_ssize_t __pyx_v_ne;
  struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_gibbs = NULL;
  PyObject *__pyx_v_log_fn = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_to = NULL;
  PyObject *__pyx_v_lf_new = NULL;
  double __pyx_v_x;
  CYTHON_UNUSED long __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  double __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  long __pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_kernel", 0);

  /* "qnet.pyx":745
 *       cdef Event evt, evt_next
 *       cdef double upper, lower, d_new
 *       cdef double prob = 0, Z             # <<<<<<<<<<<<<<
 * 
 *       if lik == -INFINITY:
 */
  __pyx_v_prob = 0.0;

  /* "qnet.pyx":747
 *       cdef double prob = 0, Z
 * 
 *       if lik == -INFINITY:             # <<<<<<<<<<<<<<
 *            lik = self.log_prob (arrv_from)
 * 
 */
  __pyx_t_1 = ((__pyx_v_lik == (-INFINITY)) != 0);
  if (__pyx_t_1) {

    /* "qnet.pyx":748
 * 
 *       if lik == -INFINITY:
 *            lik = self.log_prob (arrv_from)             # <<<<<<<<<<<<<<
 * 
 *       arrv_new = arrv_from.duplicate()
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, __pyx_v_arrv_from, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_lik = __pyx_t_2;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":750
 *            lik = self.log_prob (arrv_from)
 * 
 *       arrv_new = arrv_from.duplicate()             # <<<<<<<<<<<<<<
 *       evtlst = arrv_new.all_events()
 * #        arrivals.sort_by_departure (evtlst)
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_from), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_arrv_new = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "qnet.pyx":751
 * 
 *       arrv_new = arrv_from.duplicate()
 *       evtlst = arrv_new.all_events()             # <<<<<<<<<<<<<<
 * #        arrivals.sort_by_departure (evtlst)
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv_new, __pyx_n_s_all_events); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_evtlst = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "qnet.pyx":756
 *         # logic to really try to find a good order
 * 
 *       deferred = arrv_new.all_events()             # <<<<<<<<<<<<<<
 *       while deferred:
 *         evtlst = deferred
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv_new, __pyx_n_s_all_events); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_deferred = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "qnet.pyx":757
 * 
 *       deferred = arrv_new.all_events()
 *       while deferred:             # <<<<<<<<<<<<<<
 *         evtlst = deferred
 *         deferred = []
 */
  while (1) {
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_deferred); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_1) break;

    /* "qnet.pyx":758
 *       deferred = arrv_new.all_events()
 *       while deferred:
 *         evtlst = deferred             # <<<<<<<<<<<<<<
 *         deferred = []
 *         ne = len (evtlst)
 */
    __Pyx_INCREF(__pyx_v_deferred);
    __Pyx_DECREF_SET(__pyx_v_evtlst, __pyx_v_deferred);

    /* "qnet.pyx":759
 *       while deferred:
 *         evtlst = deferred
 *         deferred = []             # <<<<<<<<<<<<<<
 *         ne = len (evtlst)
 *         for evt in evtlst:
 */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_deferred, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":760
 *         evtlst = deferred
 *         deferred = []
 *         ne = len (evtlst)             # <<<<<<<<<<<<<<
 *         for evt in evtlst:
 *             evt_next = evt.next_byt
 */
    __pyx_t_6 = PyObject_Length(__pyx_v_evtlst); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_ne = __pyx_t_6;

    /* "qnet.pyx":761
 *         deferred = []
 *         ne = len (evtlst)
 *         for evt in evtlst:             # <<<<<<<<<<<<<<
 *             evt_next = evt.next_byt
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 */
    if (likely(PyList_CheckExact(__pyx_v_evtlst)) || PyTuple_CheckExact(__pyx_v_evtlst)) {
      __pyx_t_3 = __pyx_v_evtlst; __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_evtlst); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_7(__pyx_t_3);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
      __pyx_t_4 = 0;

      /* "qnet.pyx":762
 *         ne = len (evtlst)
 *         for evt in evtlst:
 *             evt_next = evt.next_byt             # <<<<<<<<<<<<<<
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 *                 gibbs = GGkGibbs (self, arrv_new, evt, lik)
 */
      if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_4 = __pyx_v_evt->next_byt;
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_XDECREF_SET(__pyx_v_evt_next, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
      __pyx_t_4 = 0;

      /* "qnet.pyx":763
 *         for evt in evtlst:
 *             evt_next = evt.next_byt
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):             # <<<<<<<<<<<<<<
 *                 gibbs = GGkGibbs (self, arrv_new, evt, lik)
 *                 log_fn = gibbs.dfn()
 */
      __pyx_t_8 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_1 = __pyx_t_8;
        goto __pyx_L9_bool_binop_done;
      }
      __pyx_t_8 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_next)); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 763; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_9 = ((!__pyx_t_8) != 0);
      if (!__pyx_t_9) {
      } else {
        __pyx_t_1 = __pyx_t_9;
        goto __pyx_L9_bool_binop_done;
      }
      __pyx_t_9 = ((!(__pyx_v_evt_next->obs_a != 0)) != 0);
      __pyx_t_1 = __pyx_t_9;
      __pyx_L9_bool_binop_done:;
      if (__pyx_t_1) {

        /* "qnet.pyx":764
 *             evt_next = evt.next_byt
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 *                 gibbs = GGkGibbs (self, arrv_new, evt, lik)             # <<<<<<<<<<<<<<
 *                 log_fn = gibbs.dfn()
 * 
 */
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        __Pyx_INCREF(__pyx_v_arrv_new);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_arrv_new);
        __Pyx_GIVEREF(__pyx_v_arrv_new);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_4qnet_GGkGibbs)), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF_SET(__pyx_v_gibbs, ((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "qnet.pyx":765
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 *                 gibbs = GGkGibbs (self, arrv_new, evt, lik)
 *                 log_fn = gibbs.dfn()             # <<<<<<<<<<<<<<
 * 
 *                 lower = evt.a
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_gibbs), __pyx_n_s_dfn); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_10 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        if (__pyx_t_10) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_10); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        } else {
          __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 765; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF_SET(__pyx_v_log_fn, __pyx_t_4);
        __pyx_t_4 = 0;

        /* "qnet.pyx":767
 *                 log_fn = gibbs.dfn()
 * 
 *                 lower = evt.a             # <<<<<<<<<<<<<<
 *                 upper = self.determine_upper (evt)
 *                 evt_to = arrv_to.event (evt.eid)
 */
        __pyx_t_2 = __pyx_v_evt->a;
        __pyx_v_lower = __pyx_t_2;

        /* "qnet.pyx":768
 * 
 *                 lower = evt.a
 *                 upper = self.determine_upper (evt)             # <<<<<<<<<<<<<<
 *                 evt_to = arrv_to.event (evt.eid)
 *                 d_new = evt_to.d
 */
        __pyx_v_upper = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->determine_upper(__pyx_v_self, __pyx_v_evt);

        /* "qnet.pyx":769
 *                 lower = evt.a
 *                 upper = self.determine_upper (evt)
 *                 evt_to = arrv_to.event (evt.eid)             # <<<<<<<<<<<<<<
 *                 d_new = evt_to.d
 *                 lf_new = log_fn(d_new)
 */
        __pyx_t_4 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_arrv_to->__pyx_vtab)->event(__pyx_v_arrv_to, __pyx_v_evt->eid, 0)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_XDECREF_SET(__pyx_v_evt_to, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "qnet.pyx":770
 *                 upper = self.determine_upper (evt)
 *                 evt_to = arrv_to.event (evt.eid)
 *                 d_new = evt_to.d             # <<<<<<<<<<<<<<
 *                 lf_new = log_fn(d_new)
 * 
 */
        __pyx_t_2 = __pyx_v_evt_to->d;
        __pyx_v_d_new = __pyx_t_2;

        /* "qnet.pyx":771
 *                 evt_to = arrv_to.event (evt.eid)
 *                 d_new = evt_to.d
 *                 lf_new = log_fn(d_new)             # <<<<<<<<<<<<<<
 * 
 *                 # Not reachable
 */
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_log_fn);
        __pyx_t_10 = __pyx_v_log_fn; __pyx_t_11 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
          }
        }
        if (!__pyx_t_11) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
          PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_XDECREF_SET(__pyx_v_lf_new, __pyx_t_4);
        __pyx_t_4 = 0;

        /* "qnet.pyx":774
 * 
 *                 # Not reachable
 *                 if d_new <= lower or upper <= d_new:             # <<<<<<<<<<<<<<
 *                     print "gibbs_kernel: Kernel 0: %.5f not in %.5f .. %.5f\n  %s" % (d_new, lower, upper, evt)
 *                     deferred.append (evt)
 */
        __pyx_t_9 = ((__pyx_v_d_new <= __pyx_v_lower) != 0);
        if (!__pyx_t_9) {
        } else {
          __pyx_t_1 = __pyx_t_9;
          goto __pyx_L13_bool_binop_done;
        }
        __pyx_t_9 = ((__pyx_v_upper <= __pyx_v_d_new) != 0);
        __pyx_t_1 = __pyx_t_9;
        __pyx_L13_bool_binop_done:;
        if (__pyx_t_1) {

          /* "qnet.pyx":775
 *                 # Not reachable
 *                 if d_new <= lower or upper <= d_new:
 *                     print "gibbs_kernel: Kernel 0: %.5f not in %.5f .. %.5f\n  %s" % (d_new, lower, upper, evt)             # <<<<<<<<<<<<<<
 *                     deferred.append (evt)
 *                     continue
 */
          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_10 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_12 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_12);
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_5, 3, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_4 = 0;
          __pyx_t_10 = 0;
          __pyx_t_12 = 0;
          __pyx_t_12 = __Pyx_PyString_Format(__pyx_kp_s_gibbs_kernel_Kernel_0_5f_not_in, __pyx_t_5); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 775; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

          /* "qnet.pyx":776
 *                 if d_new <= lower or upper <= d_new:
 *                     print "gibbs_kernel: Kernel 0: %.5f not in %.5f .. %.5f\n  %s" % (d_new, lower, upper, evt)
 *                     deferred.append (evt)             # <<<<<<<<<<<<<<
 *                     continue
 * #                    return -numpy.inf
 */
          __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_deferred, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":777
 *                     print "gibbs_kernel: Kernel 0: %.5f not in %.5f .. %.5f\n  %s" % (d_new, lower, upper, evt)
 *                     deferred.append (evt)
 *                     continue             # <<<<<<<<<<<<<<
 * #                    return -numpy.inf
 *                 if lf_new == -numpy.inf:
 */
          goto __pyx_L6_continue;
        }

        /* "qnet.pyx":779
 *                     continue
 * #                    return -numpy.inf
 *                 if lf_new == -numpy.inf:             # <<<<<<<<<<<<<<
 *                     print "gibbs_kernel -inf: Kernel 0\nFROM  %s\nTO    %s" % (evt, evt_to)
 *                     deferred.append (evt)
 */
        __pyx_t_12 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_inf); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyNumber_Negative(__pyx_t_5); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = PyObject_RichCompare(__pyx_v_lf_new, __pyx_t_12, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 779; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_1) {

          /* "qnet.pyx":780
 * #                    return -numpy.inf
 *                 if lf_new == -numpy.inf:
 *                     print "gibbs_kernel -inf: Kernel 0\nFROM  %s\nTO    %s" % (evt, evt_to)             # <<<<<<<<<<<<<<
 *                     deferred.append (evt)
 *                     continue
 */
          __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __Pyx_INCREF(((PyObject *)__pyx_v_evt_to));
          PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_evt_to));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_to));
          __pyx_t_12 = __Pyx_PyString_Format(__pyx_kp_s_gibbs_kernel_inf_Kernel_0_FROM_s, __pyx_t_5); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

          /* "qnet.pyx":781
 *                 if lf_new == -numpy.inf:
 *                     print "gibbs_kernel -inf: Kernel 0\nFROM  %s\nTO    %s" % (evt, evt_to)
 *                     deferred.append (evt)             # <<<<<<<<<<<<<<
 *                     continue
 * #                    return -numpy.inf
 */
          __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_deferred, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 781; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":782
 *                     print "gibbs_kernel -inf: Kernel 0\nFROM  %s\nTO    %s" % (evt, evt_to)
 *                     deferred.append (evt)
 *                     continue             # <<<<<<<<<<<<<<
 * #                    return -numpy.inf
 * 
 */
          goto __pyx_L6_continue;
        }

        /* "qnet.pyx":785
 * #                    return -numpy.inf
 * 
 *                 Z = gibbs.integrate(lf_new) # pre-normalize by lf_new             # <<<<<<<<<<<<<<
 * 
 *                 if Z == 0:
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_gibbs), __pyx_n_s_integrate); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_10 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        if (!__pyx_t_10) {
          __pyx_t_12 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_lf_new); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
        } else {
          __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
          __Pyx_INCREF(__pyx_v_lf_new);
          PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_lf_new);
          __Pyx_GIVEREF(__pyx_v_lf_new);
          __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_12); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_v_Z = __pyx_t_2;

        /* "qnet.pyx":787
 *                 Z = gibbs.integrate(lf_new) # pre-normalize by lf_new
 * 
 *                 if Z == 0:             # <<<<<<<<<<<<<<
 *                     print "Bad event:", evt
 *                     print "Initial log prob", self.log_prob (arrv_from)
 */
        __pyx_t_1 = ((__pyx_v_Z == 0.0) != 0);
        if (__pyx_t_1) {

          /* "qnet.pyx":788
 * 
 *                 if Z == 0:
 *                     print "Bad event:", evt             # <<<<<<<<<<<<<<
 *                     print "Initial log prob", self.log_prob (arrv_from)
 *                     print "Log prob (from scratch)", self.log_prob (arrv_new)
 */
          __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_INCREF(__pyx_kp_s_Bad_event);
          PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_kp_s_Bad_event);
          __Pyx_GIVEREF(__pyx_kp_s_Bad_event);
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_12, 1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          if (__Pyx_Print(0, __pyx_t_12, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

          /* "qnet.pyx":789
 *                 if Z == 0:
 *                     print "Bad event:", evt
 *                     print "Initial log prob", self.log_prob (arrv_from)             # <<<<<<<<<<<<<<
 *                     print "Log prob (from scratch)", self.log_prob (arrv_new)
 *                     if upper == numpy.inf: upper = lower + 5
 */
          __pyx_t_2 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, __pyx_v_arrv_from, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_12 = PyFloat_FromDouble(__pyx_t_2); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_INCREF(__pyx_kp_s_Initial_log_prob);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_s_Initial_log_prob);
          __Pyx_GIVEREF(__pyx_kp_s_Initial_log_prob);
          PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_12);
          __pyx_t_12 = 0;
          if (__Pyx_Print(0, __pyx_t_5, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 789; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "qnet.pyx":790
 *                     print "Bad event:", evt
 *                     print "Initial log prob", self.log_prob (arrv_from)
 *                     print "Log prob (from scratch)", self.log_prob (arrv_new)             # <<<<<<<<<<<<<<
 *                     if upper == numpy.inf: upper = lower + 5
 *                     x = lower
 */
          if (!(likely(((__pyx_v_arrv_new) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_arrv_new, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_2 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv_new), 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_5 = PyFloat_FromDouble(__pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_INCREF(__pyx_kp_s_Log_prob_from_scratch);
          PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_kp_s_Log_prob_from_scratch);
          __Pyx_GIVEREF(__pyx_kp_s_Log_prob_from_scratch);
          PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_5);
          __pyx_t_5 = 0;
          if (__Pyx_Print(0, __pyx_t_12, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

          /* "qnet.pyx":791
 *                     print "Initial log prob", self.log_prob (arrv_from)
 *                     print "Log prob (from scratch)", self.log_prob (arrv_new)
 *                     if upper == numpy.inf: upper = lower + 5             # <<<<<<<<<<<<<<
 *                     x = lower
 *                     for i in range(1000):
 */
          __pyx_t_12 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_inf); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyObject_RichCompare(__pyx_t_12, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (__pyx_t_1) {
            __pyx_v_upper = (__pyx_v_lower + 5.0);
            goto __pyx_L17;
          }
          __pyx_L17:;

          /* "qnet.pyx":792
 *                     print "Log prob (from scratch)", self.log_prob (arrv_new)
 *                     if upper == numpy.inf: upper = lower + 5
 *                     x = lower             # <<<<<<<<<<<<<<
 *                     for i in range(1000):
 *                         print x, log_fn(x)
 */
          __pyx_v_x = __pyx_v_lower;

          /* "qnet.pyx":793
 *                     if upper == numpy.inf: upper = lower + 5
 *                     x = lower
 *                     for i in range(1000):             # <<<<<<<<<<<<<<
 *                         print x, log_fn(x)
 *                         x += (upper - lower) / 1000
 */
          for (__pyx_t_14 = 0; __pyx_t_14 < 1000; __pyx_t_14+=1) {
            __pyx_v_i = __pyx_t_14;

            /* "qnet.pyx":794
 *                     x = lower
 *                     for i in range(1000):
 *                         print x, log_fn(x)             # <<<<<<<<<<<<<<
 *                         x += (upper - lower) / 1000
 *                     print "arrv_new"
 */
            __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_t_12 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_INCREF(__pyx_v_log_fn);
            __pyx_t_10 = __pyx_v_log_fn; __pyx_t_11 = NULL;
            if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_10))) {
              __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
              if (likely(__pyx_t_11)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
                __Pyx_INCREF(__pyx_t_11);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_10, function);
              }
            }
            if (!__pyx_t_11) {
              __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_12); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
              __Pyx_GOTREF(__pyx_t_4);
            } else {
              __pyx_t_15 = PyTuple_New(1+1); if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_15);
              PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
              PyTuple_SET_ITEM(__pyx_t_15, 0+1, __pyx_t_12);
              __Pyx_GIVEREF(__pyx_t_12);
              __pyx_t_12 = 0;
              __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_15, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            }
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_10);
            PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_5);
            __Pyx_GIVEREF(__pyx_t_5);
            PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_4);
            __Pyx_GIVEREF(__pyx_t_4);
            __pyx_t_5 = 0;
            __pyx_t_4 = 0;
            if (__Pyx_Print(0, __pyx_t_10, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 794; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

            /* "qnet.pyx":795
 *                     for i in range(1000):
 *                         print x, log_fn(x)
 *                         x += (upper - lower) / 1000             # <<<<<<<<<<<<<<
 *                     print "arrv_new"
 *                     arrv_new.write_csv(sys.stdout)
 */
            __pyx_v_x = (__pyx_v_x + ((__pyx_v_upper - __pyx_v_lower) / 1000.0));
          }

          /* "qnet.pyx":796
 *                         print x, log_fn(x)
 *                         x += (upper - lower) / 1000
 *                     print "arrv_new"             # <<<<<<<<<<<<<<
 *                     arrv_new.write_csv(sys.stdout)
 *                     raise Exception ("Huh? Z=0. Lik ", lik)
 */
          if (__Pyx_PrintOne(0, __pyx_n_s_arrv_new) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":797
 *                         x += (upper - lower) / 1000
 *                     print "arrv_new"
 *                     arrv_new.write_csv(sys.stdout)             # <<<<<<<<<<<<<<
 *                     raise Exception ("Huh? Z=0. Lik ", lik)
 * 
 */
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv_new, __pyx_n_s_write_csv); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_sys); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_stdout); if (unlikely(!__pyx_t_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_15);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_4, function);
            }
          }
          if (!__pyx_t_5) {
            __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_15); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else {
            __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_12);
            PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
            PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_t_15);
            __Pyx_GIVEREF(__pyx_t_15);
            __pyx_t_15 = 0;
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_12, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          }
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "qnet.pyx":798
 *                     print "arrv_new"
 *                     arrv_new.write_csv(sys.stdout)
 *                     raise Exception ("Huh? Z=0. Lik ", lik)             # <<<<<<<<<<<<<<
 * 
 * #                print "d: %.5f  lp: %.5f  log(Z): %.5f  lower: %.5f  upper: %.5f\n   %s\n   %s" % (d_new, lf_new, log(Z), lower, upper, evt, evt_to)
 */
          __pyx_t_10 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_kp_s_Huh_Z_0_Lik);
          PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_s_Huh_Z_0_Lik);
          __Pyx_GIVEREF(__pyx_kp_s_Huh_Z_0_Lik);
          PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_4, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_Raise(__pyx_t_10, 0, 0, 0);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }

        /* "qnet.pyx":802
 * #                print "d: %.5f  lp: %.5f  log(Z): %.5f  lower: %.5f  upper: %.5f\n   %s\n   %s" % (d_new, lf_new, log(Z), lower, upper, evt, evt_to)
 * 
 *                 prob +=  - log(Z) # lf_new cancels out prenormalization             # <<<<<<<<<<<<<<
 * 
 *                 lik = apply_departure (arrv_new, evt, d_new, lik)
 */
        __pyx_v_prob = (__pyx_v_prob + (-log(__pyx_v_Z)));

        /* "qnet.pyx":804
 *                 prob +=  - log(Z) # lf_new cancels out prenormalization
 * 
 *                 lik = apply_departure (arrv_new, evt, d_new, lik)             # <<<<<<<<<<<<<<
 *         if len(deferred) == ne:  # no progress
 *             print "gibbs_kernel=0 : Could not process events"
 */
        if (!(likely(((__pyx_v_arrv_new) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_arrv_new, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_2 = __pyx_f_4qnet_apply_departure(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv_new), __pyx_v_evt, __pyx_v_d_new, __pyx_v_lik, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_v_lik = __pyx_t_2;
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "qnet.pyx":761
 *         deferred = []
 *         ne = len (evtlst)
 *         for evt in evtlst:             # <<<<<<<<<<<<<<
 *             evt_next = evt.next_byt
 *             if not evt.obs_d and (not evt_next or not evt_next.obs_a):
 */
      __pyx_L6_continue:;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":805
 * 
 *                 lik = apply_departure (arrv_new, evt, d_new, lik)
 *         if len(deferred) == ne:  # no progress             # <<<<<<<<<<<<<<
 *             print "gibbs_kernel=0 : Could not process events"
 *             return -numpy.inf
 */
    __pyx_t_6 = PyObject_Length(__pyx_v_deferred); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 805; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = ((__pyx_t_6 == __pyx_v_ne) != 0);
    if (__pyx_t_1) {

      /* "qnet.pyx":806
 *                 lik = apply_departure (arrv_new, evt, d_new, lik)
 *         if len(deferred) == ne:  # no progress
 *             print "gibbs_kernel=0 : Could not process events"             # <<<<<<<<<<<<<<
 *             return -numpy.inf
 * 
 */
      if (__Pyx_PrintOne(0, __pyx_kp_s_gibbs_kernel_0_Could_not_process) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 806; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":807
 *         if len(deferred) == ne:  # no progress
 *             print "gibbs_kernel=0 : Could not process events"
 *             return -numpy.inf             # <<<<<<<<<<<<<<
 * 
 *       return prob
 */
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inf); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_Negative(__pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 807; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;
    }
  }

  /* "qnet.pyx":809
 *             return -numpy.inf
 * 
 *       return prob             # <<<<<<<<<<<<<<
 * 
 *     def parameter_kernel (self, theta_from, theta_to, arrvl):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_prob); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":741
 * 
 *     ## Computing the exact Gibbs kernel
 *     def gibbs_kernel (self, Arrivals arrv_from, Arrivals arrv_to, double lik=-INFINITY):             # <<<<<<<<<<<<<<
 * 
 *       cdef Event evt, evt_next
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("qnet.Qnet.gibbs_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_next);
  __Pyx_XDECREF(__pyx_v_arrv_new);
  __Pyx_XDECREF(__pyx_v_evtlst);
  __Pyx_XDECREF(__pyx_v_deferred);
  __Pyx_XDECREF((PyObject *)__pyx_v_gibbs);
  __Pyx_XDECREF(__pyx_v_log_fn);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_to);
  __Pyx_XDECREF(__pyx_v_lf_new);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":811
 *       return prob
 * 
 *     def parameter_kernel (self, theta_from, theta_to, arrvl):             # <<<<<<<<<<<<<<
 *         """Returns the value of the transition kernel used by sample_parameters
 *            when it is given arrv."""
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_53parameter_kernel(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4qnet_4Qnet_52parameter_kernel[] = "Returns the value of the transition kernel used by sample_parameters\n           when it is given arrv.";
static PyObject *__pyx_pw_4qnet_4Qnet_53parameter_kernel(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_theta_from = 0;
  PyObject *__pyx_v_theta_to = 0;
  PyObject *__pyx_v_arrvl = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("parameter_kernel (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_theta_from,&__pyx_n_s_theta_to,&__pyx_n_s_arrvl,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_theta_from)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_theta_to)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("parameter_kernel", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrvl)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("parameter_kernel", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "parameter_kernel") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_theta_from = values[0];
    __pyx_v_theta_to = values[1];
    __pyx_v_arrvl = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("parameter_kernel", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.Qnet.parameter_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_4Qnet_52parameter_kernel(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), __pyx_v_theta_from, __pyx_v_theta_to, __pyx_v_arrvl);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_52parameter_kernel(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_theta_from, PyObject *__pyx_v_theta_to, PyObject *__pyx_v_arrvl) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_a = 0;
  double __pyx_v_ret;
  struct __pyx_obj_6queues_FactorTemplate *__pyx_v_factor = 0;
  PyObject *__pyx_v_evtl = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_mini_from = NULL;
  PyObject *__pyx_v_mini_to = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  double __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("parameter_kernel", 0);
  __Pyx_INCREF(__pyx_v_theta_from);
  __Pyx_INCREF(__pyx_v_theta_to);
  __Pyx_INCREF(__pyx_v_arrvl);

  /* "qnet.pyx":814
 *         """Returns the value of the transition kernel used by sample_parameters
 *            when it is given arrv."""
 *         if isinstance (arrvl, Arrivals):             # <<<<<<<<<<<<<<
 *             arrvl = [ arrvl ]
 * 
 */
  __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_arrvl, ((PyObject*)__pyx_ptype_8arrivals_Arrivals)); 
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":815
 *            when it is given arrv."""
 *         if isinstance (arrvl, Arrivals):
 *             arrvl = [ arrvl ]             # <<<<<<<<<<<<<<
 * 
 *         cdef Queue q
 */
    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_arrvl);
    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_arrvl);
    __Pyx_GIVEREF(__pyx_v_arrvl);
    __Pyx_DECREF_SET(__pyx_v_arrvl, __pyx_t_3);
    __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":819
 *         cdef Queue q
 *         cdef Arrivals a
 *         cdef double ret = 0             # <<<<<<<<<<<<<<
 *         cdef FactorTemplate factor
 * 
 */
  __pyx_v_ret = 0.0;

  /* "qnet.pyx":822
 *         cdef FactorTemplate factor
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_3 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":823
 * 
 *         for q in self.queues:
 *             evtl = []             # <<<<<<<<<<<<<<
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))
 */
    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_evtl, ((PyObject*)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":824
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 * 
 */
    if (likely(PyList_CheckExact(__pyx_v_arrvl)) || PyTuple_CheckExact(__pyx_v_arrvl)) {
      __pyx_t_6 = __pyx_v_arrvl; __Pyx_INCREF(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_arrvl); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_9 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_9);
      }
      if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_a, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_9));
      __pyx_t_9 = 0;

      /* "qnet.pyx":825
 *             evtl = []
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))             # <<<<<<<<<<<<<<
 * 
 *             n = q.service.numParameters()
 */
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_a), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_q)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_q));
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_13 = __Pyx_PyList_Extend(__pyx_v_evtl, __pyx_t_9); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "qnet.pyx":824
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":827
 *                 evtl.extend (a.events_of_queue (q))
 * 
 *             n = q.service.numParameters()             # <<<<<<<<<<<<<<
 *             mini_from = theta_from[0:n]
 *             mini_to = theta_to[0:n]
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q->service), __pyx_n_s_numParameters); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (__pyx_t_10) {
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    } else {
      __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF_SET(__pyx_v_n, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "qnet.pyx":828
 * 
 *             n = q.service.numParameters()
 *             mini_from = theta_from[0:n]             # <<<<<<<<<<<<<<
 *             mini_to = theta_to[0:n]
 * 
 */
    __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_theta_from, 0, 0, NULL, &__pyx_v_n, NULL, 1, 0, 1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_mini_from, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "qnet.pyx":829
 *             n = q.service.numParameters()
 *             mini_from = theta_from[0:n]
 *             mini_to = theta_to[0:n]             # <<<<<<<<<<<<<<
 * 
 *             factor = q.service
 */
    __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_theta_to, 0, 0, NULL, &__pyx_v_n, NULL, 1, 0, 1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_mini_to, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "qnet.pyx":831
 *             mini_to = theta_to[0:n]
 * 
 *             factor = q.service             # <<<<<<<<<<<<<<
 *             ret += factor.parameter_kernel (mini_from, mini_to, evtl)
 * 
 */
    __pyx_t_6 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_factor, ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":832
 * 
 *             factor = q.service
 *             ret += factor.parameter_kernel (mini_from, mini_to, evtl)             # <<<<<<<<<<<<<<
 * 
 *             theta_from = theta_from[n:]
 */
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_ret); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_factor), __pyx_n_s_parameter_kernel); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_12 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_12)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_12);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_7 = 1;
      }
    }
    __pyx_t_11 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    if (__pyx_t_12) {
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
    }
    __Pyx_INCREF(__pyx_v_mini_from);
    PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_7, __pyx_v_mini_from);
    __Pyx_GIVEREF(__pyx_v_mini_from);
    __Pyx_INCREF(__pyx_v_mini_to);
    PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_7, __pyx_v_mini_to);
    __Pyx_GIVEREF(__pyx_v_mini_to);
    __Pyx_INCREF(__pyx_v_evtl);
    PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_7, __pyx_v_evtl);
    __Pyx_GIVEREF(__pyx_v_evtl);
    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_11, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_t_10); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_v_ret = __pyx_t_14;

    /* "qnet.pyx":834
 *             ret += factor.parameter_kernel (mini_from, mini_to, evtl)
 * 
 *             theta_from = theta_from[n:]             # <<<<<<<<<<<<<<
 *             theta_to = theta_to[n:]
 * 
 */
    __pyx_t_10 = __Pyx_PyObject_GetSlice(__pyx_v_theta_from, 0, 0, &__pyx_v_n, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 834; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF_SET(__pyx_v_theta_from, __pyx_t_10);
    __pyx_t_10 = 0;

    /* "qnet.pyx":835
 * 
 *             theta_from = theta_from[n:]
 *             theta_to = theta_to[n:]             # <<<<<<<<<<<<<<
 * 
 *         return ret
 */
    __pyx_t_10 = __Pyx_PyObject_GetSlice(__pyx_v_theta_to, 0, 0, &__pyx_v_n, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 835; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF_SET(__pyx_v_theta_to, __pyx_t_10);
    __pyx_t_10 = 0;

    /* "qnet.pyx":822
 *         cdef FactorTemplate factor
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":837
 *             theta_to = theta_to[n:]
 * 
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     ########################
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_ret); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 837; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":811
 *       return prob
 * 
 *     def parameter_kernel (self, theta_from, theta_to, arrvl):             # <<<<<<<<<<<<<<
 *         """Returns the value of the transition kernel used by sample_parameters
 *            when it is given arrv."""
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.Qnet.parameter_kernel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_a);
  __Pyx_XDECREF((PyObject *)__pyx_v_factor);
  __Pyx_XDECREF(__pyx_v_evtl);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_mini_from);
  __Pyx_XDECREF(__pyx_v_mini_to);
  __Pyx_XDECREF(__pyx_v_theta_from);
  __Pyx_XDECREF(__pyx_v_theta_to);
  __Pyx_XDECREF(__pyx_v_arrvl);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":844
 * 
 *     # todo: assumes exactly one factor per queue.  Not sure what the best way to generalize this is
 *     def estimate (self, arrvl):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given arrivals list
 *            Returns the paramters, and also updates the parameters of this net."""
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_55estimate(PyObject *__pyx_v_self, PyObject *__pyx_v_arrvl); /*proto*/
static char __pyx_doc_4qnet_4Qnet_54estimate[] = "Computes ML estimates for the parameters of all queues from the given arrivals list\n           Returns the paramters, and also updates the parameters of this net.";
static PyObject *__pyx_pw_4qnet_4Qnet_55estimate(PyObject *__pyx_v_self, PyObject *__pyx_v_arrvl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("estimate (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_54estimate(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_arrvl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_54estimate(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrvl) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_a = 0;
  PyObject *__pyx_v_evtl = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("estimate", 0);
  __Pyx_INCREF(__pyx_v_arrvl);

  /* "qnet.pyx":847
 *         """Computes ML estimates for the parameters of all queues from the given arrivals list
 *            Returns the paramters, and also updates the parameters of this net."""
 *         if isinstance (arrvl, Arrivals):             # <<<<<<<<<<<<<<
 *             arrvl = [ arrvl ]
 * 
 */
  __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_arrvl, ((PyObject*)__pyx_ptype_8arrivals_Arrivals)); 
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":848
 *            Returns the paramters, and also updates the parameters of this net."""
 *         if isinstance (arrvl, Arrivals):
 *             arrvl = [ arrvl ]             # <<<<<<<<<<<<<<
 * 
 *         cdef Queue q
 */
    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 848; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_arrvl);
    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_arrvl);
    __Pyx_GIVEREF(__pyx_v_arrvl);
    __Pyx_DECREF_SET(__pyx_v_arrvl, __pyx_t_3);
    __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":853
 *         cdef Arrivals a
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_3 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 853; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":854
 * 
 *         for q in self.queues:
 *             evtl = []             # <<<<<<<<<<<<<<
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))
 */
    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 854; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_evtl, ((PyObject*)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":855
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).estimate (evtl)
 */
    if (likely(PyList_CheckExact(__pyx_v_arrvl)) || PyTuple_CheckExact(__pyx_v_arrvl)) {
      __pyx_t_6 = __pyx_v_arrvl; __Pyx_INCREF(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_arrvl); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_9 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_9);
      }
      if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 855; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_a, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_9));
      __pyx_t_9 = 0;

      /* "qnet.pyx":856
 *             evtl = []
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))             # <<<<<<<<<<<<<<
 *             (<FactorTemplate>q.service).estimate (evtl)
 *         return self.parameters
 */
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_a), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_q)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_q));
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_13 = __Pyx_PyList_Extend(__pyx_v_evtl, __pyx_t_9); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "qnet.pyx":855
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).estimate (evtl)
 */
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":857
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).estimate (evtl)             # <<<<<<<<<<<<<<
 *         return self.parameters
 * 
 */
    __pyx_t_6 = ((struct __pyx_vtabstruct_6queues_FactorTemplate *)((struct __pyx_obj_6queues_FactorTemplate *)__pyx_v_q->service)->__pyx_vtab)->estimate(((struct __pyx_obj_6queues_FactorTemplate *)__pyx_v_q->service), __pyx_v_evtl); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 857; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":853
 *         cdef Arrivals a
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":858
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).estimate (evtl)
 *         return self.parameters             # <<<<<<<<<<<<<<
 * 
 *     def estimate_from_obs (self, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 858; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":844
 * 
 *     # todo: assumes exactly one factor per queue.  Not sure what the best way to generalize this is
 *     def estimate (self, arrvl):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given arrivals list
 *            Returns the paramters, and also updates the parameters of this net."""
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.Qnet.estimate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_a);
  __Pyx_XDECREF(__pyx_v_evtl);
  __Pyx_XDECREF(__pyx_v_arrvl);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":860
 *         return self.parameters
 * 
 *     def estimate_from_obs (self, Arrivals arrv):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given arrivals list.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_57estimate_from_obs(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv); /*proto*/
static char __pyx_doc_4qnet_4Qnet_56estimate_from_obs[] = "Computes ML estimates for the parameters of all queues from the given arrivals list.\n           Returns the paramters, and also updates the parameters of this net.";
static PyObject *__pyx_pw_4qnet_4Qnet_57estimate_from_obs(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("estimate_from_obs (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 860; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_56estimate_from_obs(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_56estimate_from_obs(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_6queues_FactorTemplate *__pyx_v_f = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_evts = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("estimate_from_obs", 0);

  /* "qnet.pyx":865
 *         cdef FactorTemplate f
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             f = q.service
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 865; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":866
 *         cdef Queue q
 *         for q in self.queues:
 *             f = q.service             # <<<<<<<<<<<<<<
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]
 *             f.estimate (evts)
 */
    __pyx_t_4 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_f, ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":867
 *         for q in self.queues:
 *             f = q.service
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]             # <<<<<<<<<<<<<<
 *             f.estimate (evts)
 *         return self.parameters
 */
    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_q)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_q));
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_6 = __pyx_t_5; __Pyx_INCREF(__pyx_t_6); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_9); __Pyx_INCREF(__pyx_t_5); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_6, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_9); __Pyx_INCREF(__pyx_t_5); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_6, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_10(__pyx_t_6);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_12) {
      } else {
        __pyx_t_11 = __pyx_t_12;
        goto __pyx_L8_bool_binop_done;
      }
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_11 = __pyx_t_12;
      __pyx_L8_bool_binop_done:;
      if (__pyx_t_11) {
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_v_e))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 867; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":868
 *             f = q.service
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]
 *             f.estimate (evts)             # <<<<<<<<<<<<<<
 *         return self.parameters
 * 
 */
    __pyx_t_4 = ((struct __pyx_vtabstruct_6queues_FactorTemplate *)__pyx_v_f->__pyx_vtab)->estimate(__pyx_v_f, __pyx_v_evts); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 868; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":865
 *         cdef FactorTemplate f
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             f = q.service
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":869
 *             evts = [ e for e in arrv.events_of_queue (q) if (e.obs_a and e.obs_d) ]
 *             f.estimate (evts)
 *         return self.parameters             # <<<<<<<<<<<<<<
 * 
 *     def estimate_from_events (self, evts):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 869; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":860
 *         return self.parameters
 * 
 *     def estimate_from_obs (self, Arrivals arrv):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given arrivals list.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("qnet.Qnet.estimate_from_obs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_f);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_evts);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":871
 *         return self.parameters
 * 
 *     def estimate_from_events (self, evts):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given list of events.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_59estimate_from_events(PyObject *__pyx_v_self, PyObject *__pyx_v_evts); /*proto*/
static char __pyx_doc_4qnet_4Qnet_58estimate_from_events[] = "Computes ML estimates for the parameters of all queues from the given list of events.\n           Returns the paramters, and also updates the parameters of this net.";
static PyObject *__pyx_pw_4qnet_4Qnet_59estimate_from_events(PyObject *__pyx_v_self, PyObject *__pyx_v_evts) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("estimate_from_events (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_58estimate_from_events(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_evts));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_58estimate_from_events(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_evts) {
  struct __pyx_obj_6queues_FactorTemplate *__pyx_v_f = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_evts_of_q = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("estimate_from_events", 0);

  /* "qnet.pyx":876
 *         cdef FactorTemplate f
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             f = q.service
 *             evts_of_q = [ e for e in evts if e.queue() == q ]
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 876; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":877
 *         cdef Queue q
 *         for q in self.queues:
 *             f = q.service             # <<<<<<<<<<<<<<
 *             evts_of_q = [ e for e in evts if e.queue() == q ]
 *             f.estimate (evts_of_q)
 */
    __pyx_t_4 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_f, ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":878
 *         for q in self.queues:
 *             f = q.service
 *             evts_of_q = [ e for e in evts if e.queue() == q ]             # <<<<<<<<<<<<<<
 *             f.estimate (evts_of_q)
 *         return self.parameters
 */
    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (likely(PyList_CheckExact(__pyx_v_evts)) || PyTuple_CheckExact(__pyx_v_evts)) {
      __pyx_t_5 = __pyx_v_evts; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_evts); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_7)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_8 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_8 = __pyx_t_7(__pyx_t_5);
        if (unlikely(!__pyx_t_8)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_8);
      }
      __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_queue); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
        }
      }
      if (__pyx_t_10) {
        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else {
        __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_8, ((PyObject *)__pyx_v_q), Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_11) {
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_v_e))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 878; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts_of_q, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":879
 *             f = q.service
 *             evts_of_q = [ e for e in evts if e.queue() == q ]
 *             f.estimate (evts_of_q)             # <<<<<<<<<<<<<<
 *         return self.parameters
 * 
 */
    __pyx_t_4 = ((struct __pyx_vtabstruct_6queues_FactorTemplate *)__pyx_v_f->__pyx_vtab)->estimate(__pyx_v_f, __pyx_v_evts_of_q); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 879; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":876
 *         cdef FactorTemplate f
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             f = q.service
 *             evts_of_q = [ e for e in evts if e.queue() == q ]
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":880
 *             evts_of_q = [ e for e in evts if e.queue() == q ]
 *             f.estimate (evts_of_q)
 *         return self.parameters             # <<<<<<<<<<<<<<
 * 
 *     def sample_parameters (self, arrvl):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 880; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":871
 *         return self.parameters
 * 
 *     def estimate_from_events (self, evts):             # <<<<<<<<<<<<<<
 *         """Computes ML estimates for the parameters of all queues from the given list of events.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("qnet.Qnet.estimate_from_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_f);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_evts_of_q);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":882
 *         return self.parameters
 * 
 *     def sample_parameters (self, arrvl):             # <<<<<<<<<<<<<<
 *         """Samples the parameters from the posterior given the full obseravtions in ARRVL.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_61sample_parameters(PyObject *__pyx_v_self, PyObject *__pyx_v_arrvl); /*proto*/
static char __pyx_doc_4qnet_4Qnet_60sample_parameters[] = "Samples the parameters from the posterior given the full obseravtions in ARRVL.\n           Returns the paramters, and also updates the parameters of this net.";
static PyObject *__pyx_pw_4qnet_4Qnet_61sample_parameters(PyObject *__pyx_v_self, PyObject *__pyx_v_arrvl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sample_parameters (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_60sample_parameters(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_arrvl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_60sample_parameters(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_arrvl) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_a = 0;
  PyObject *__pyx_v_evtl = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sample_parameters", 0);
  __Pyx_INCREF(__pyx_v_arrvl);

  /* "qnet.pyx":885
 *         """Samples the parameters from the posterior given the full obseravtions in ARRVL.
 *            Returns the paramters, and also updates the parameters of this net."""
 *         if isinstance (arrvl, Arrivals):             # <<<<<<<<<<<<<<
 *             arrvl = [ arrvl ]
 * 
 */
  __pyx_t_1 = __Pyx_TypeCheck(__pyx_v_arrvl, ((PyObject*)__pyx_ptype_8arrivals_Arrivals)); 
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "qnet.pyx":886
 *            Returns the paramters, and also updates the parameters of this net."""
 *         if isinstance (arrvl, Arrivals):
 *             arrvl = [ arrvl ]             # <<<<<<<<<<<<<<
 * 
 *         cdef Queue q
 */
    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 886; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_arrvl);
    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_arrvl);
    __Pyx_GIVEREF(__pyx_v_arrvl);
    __Pyx_DECREF_SET(__pyx_v_arrvl, __pyx_t_3);
    __pyx_t_3 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":891
 *         cdef Arrivals a
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_3 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 891; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":892
 * 
 *         for q in self.queues:
 *             evtl = []             # <<<<<<<<<<<<<<
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))
 */
    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 892; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_evtl, ((PyObject*)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "qnet.pyx":893
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).sample_parameters (evtl)
 */
    if (likely(PyList_CheckExact(__pyx_v_arrvl)) || PyTuple_CheckExact(__pyx_v_arrvl)) {
      __pyx_t_6 = __pyx_v_arrvl; __Pyx_INCREF(__pyx_t_6); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_arrvl); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = Py_TYPE(__pyx_t_6)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_6)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_6, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_9 = __pyx_t_8(__pyx_t_6);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_9);
      }
      if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 893; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_a, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_9));
      __pyx_t_9 = 0;

      /* "qnet.pyx":894
 *             evtl = []
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))             # <<<<<<<<<<<<<<
 *             (<FactorTemplate>q.service).sample_parameters (evtl)
 *         return self.parameters
 */
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_a), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_q)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_q));
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_13 = __Pyx_PyList_Extend(__pyx_v_evtl, __pyx_t_9); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "qnet.pyx":893
 *         for q in self.queues:
 *             evtl = []
 *             for a in arrvl:             # <<<<<<<<<<<<<<
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).sample_parameters (evtl)
 */
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":895
 *             for a in arrvl:
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).sample_parameters (evtl)             # <<<<<<<<<<<<<<
 *         return self.parameters
 * 
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q->service), __pyx_n_s_sample_parameters); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_10) {
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_evtl); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
    } else {
      __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
      __Pyx_INCREF(__pyx_v_evtl);
      PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_v_evtl);
      __Pyx_GIVEREF(__pyx_v_evtl);
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 895; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "qnet.pyx":891
 *         cdef Arrivals a
 * 
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             evtl = []
 *             for a in arrvl:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":896
 *                 evtl.extend (a.events_of_queue (q))
 *             (<FactorTemplate>q.service).sample_parameters (evtl)
 *         return self.parameters             # <<<<<<<<<<<<<<
 * 
 *     property parameters:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_parameters); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":882
 *         return self.parameters
 * 
 *     def sample_parameters (self, arrvl):             # <<<<<<<<<<<<<<
 *         """Samples the parameters from the posterior given the full obseravtions in ARRVL.
 *            Returns the paramters, and also updates the parameters of this net."""
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.Qnet.sample_parameters", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_a);
  __Pyx_XDECREF(__pyx_v_evtl);
  __Pyx_XDECREF(__pyx_v_arrvl);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":900
 *     property parameters:
 * 
 *         def __get__ (self):             # <<<<<<<<<<<<<<
 *             r = []
 *             cdef Queue q
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_10parameters_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_10parameters_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_10parameters___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_10parameters___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_v_r = NULL;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_6queues_FactorTemplate *__pyx_v_t = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);

  /* "qnet.pyx":901
 * 
 *         def __get__ (self):
 *             r = []             # <<<<<<<<<<<<<<
 *             cdef Queue q
 *             cdef FactorTemplate t
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 901; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_r = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":904
 *             cdef Queue q
 *             cdef FactorTemplate t
 *             for q in self.queues:             # <<<<<<<<<<<<<<
 *                 t = q.service
 *                 r.extend (t.parameters)
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":905
 *             cdef FactorTemplate t
 *             for q in self.queues:
 *                 t = q.service             # <<<<<<<<<<<<<<
 *                 r.extend (t.parameters)
 *             return r
 */
    __pyx_t_4 = ((PyObject *)__pyx_v_q->service);
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_t, ((struct __pyx_obj_6queues_FactorTemplate *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":906
 *             for q in self.queues:
 *                 t = q.service
 *                 r.extend (t.parameters)             # <<<<<<<<<<<<<<
 *             return r
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_t), __pyx_n_s_parameters); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyList_Extend(__pyx_v_r, __pyx_t_4); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 906; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":904
 *             cdef Queue q
 *             cdef FactorTemplate t
 *             for q in self.queues:             # <<<<<<<<<<<<<<
 *                 t = q.service
 *                 r.extend (t.parameters)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":907
 *                 t = q.service
 *                 r.extend (t.parameters)
 *             return r             # <<<<<<<<<<<<<<
 * 
 *         def __set__ (self, v):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_r);
  __pyx_r = __pyx_v_r;
  goto __pyx_L0;

  /* "qnet.pyx":900
 *     property parameters:
 * 
 *         def __get__ (self):             # <<<<<<<<<<<<<<
 *             r = []
 *             cdef Queue q
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.Qnet.parameters.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_t);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":909
 *             return r
 * 
 *         def __set__ (self, v):             # <<<<<<<<<<<<<<
 *             r = v[:]
 *             cdef Queue q
 */

/* Python wrapper */
static int __pyx_pw_4qnet_4Qnet_10parameters_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_v); /*proto*/
static int __pyx_pw_4qnet_4Qnet_10parameters_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_v) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_10parameters_2__set__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((PyObject *)__pyx_v_v));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_4qnet_4Qnet_10parameters_2__set__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, PyObject *__pyx_v_v) {
  PyObject *__pyx_v_r = NULL;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_n = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__set__", 0);

  /* "qnet.pyx":910
 * 
 *         def __set__ (self, v):
 *             r = v[:]             # <<<<<<<<<<<<<<
 *             cdef Queue q
 *             for q in self.queues:
 */
  __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_v, 0, 0, NULL, NULL, &__pyx_slice__11, 0, 0, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_r = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":912
 *             r = v[:]
 *             cdef Queue q
 *             for q in self.queues:             # <<<<<<<<<<<<<<
 *                 n = q.service.numParameters()
 *                 q.service.setParameters (r[0:n])
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":913
 *             cdef Queue q
 *             for q in self.queues:
 *                 n = q.service.numParameters()             # <<<<<<<<<<<<<<
 *                 q.service.setParameters (r[0:n])
 *                 r = r[n:]
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q->service), __pyx_n_s_numParameters); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 913; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 913; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 913; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_n, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":914
 *             for q in self.queues:
 *                 n = q.service.numParameters()
 *                 q.service.setParameters (r[0:n])             # <<<<<<<<<<<<<<
 *                 r = r[n:]
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q->service), __pyx_n_s_setParameters); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_r, 0, 0, NULL, &__pyx_v_n, NULL, 1, 0, 1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 914; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":915
 *                 n = q.service.numParameters()
 *                 q.service.setParameters (r[0:n])
 *                 r = r[n:]             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_r, 0, 0, &__pyx_v_n, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 915; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF_SET(__pyx_v_r, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":912
 *             r = v[:]
 *             cdef Queue q
 *             for q in self.queues:             # <<<<<<<<<<<<<<
 *                 n = q.service.numParameters()
 *                 q.service.setParameters (r[0:n])
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":909
 *             return r
 * 
 *         def __set__ (self, v):             # <<<<<<<<<<<<<<
 *             r = v[:]
 *             cdef Queue q
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("qnet.Qnet.parameters.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_r);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":922
 * 
 *     # N.B. The acceptance ratio for this is certainly wrong
 *     def remove_task_proposal (self, Arrivals arrv_old):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv = arrv_old.duplicate()
 *         cdef Event last_evt = arrv.final_arrival_by_qid (0)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_63remove_task_proposal(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv_old); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_63remove_task_proposal(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv_old) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("remove_task_proposal (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv_old), __pyx_ptype_8arrivals_Arrivals, 1, "arrv_old", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 922; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_62remove_task_proposal(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv_old));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_62remove_task_proposal(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_old) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_last_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  PyObject *__pyx_v_tasks = NULL;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_task_old = NULL;
  PyObject *__pyx_v_d_new = NULL;
  PyObject *__pyx_v_dl = NULL;
  PyObject *__pyx_v_path = NULL;
  double __pyx_v_log_trans1;
  double __pyx_v_log_trans0;
  CYTHON_UNUSED struct __pyx_obj_5pwfun_Pwfun *__pyx_v_dfn = NULL;
  PyObject *__pyx_v_diff_list = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  double __pyx_v_pi0;
  double __pyx_v_pi1;
  double __pyx_v_u;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  double __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *(*__pyx_t_12)(PyObject *);
  PyObject *__pyx_t_13 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("remove_task_proposal", 0);

  /* "qnet.pyx":923
 *     # N.B. The acceptance ratio for this is certainly wrong
 *     def remove_task_proposal (self, Arrivals arrv_old):
 *         cdef Arrivals arrv = arrv_old.duplicate()             # <<<<<<<<<<<<<<
 *         cdef Event last_evt = arrv.final_arrival_by_qid (0)
 *         cdef Event evt
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_old), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":924
 *     def remove_task_proposal (self, Arrivals arrv_old):
 *         cdef Arrivals arrv = arrv_old.duplicate()
 *         cdef Event last_evt = arrv.final_arrival_by_qid (0)             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         cdef Queue q
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_final_arrival_by_qid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_last_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":928
 *         cdef Queue q
 * 
 *         if self.eidx < 0:             # <<<<<<<<<<<<<<
 *             self.eidx = arrv_old.max_eidx() + 1
 * 
 */
  __pyx_t_4 = ((__pyx_v_self->eidx < 0) != 0);
  if (__pyx_t_4) {

    /* "qnet.pyx":929
 * 
 *         if self.eidx < 0:
 *             self.eidx = arrv_old.max_eidx() + 1             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_RTP:
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_old), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_self->eidx = __pyx_t_5;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":931
 *             self.eidx = arrv_old.max_eidx() + 1
 * 
 *         if DEBUG_RTP:             # <<<<<<<<<<<<<<
 *             print "RTP"
 *             print arrv
 */
  if (__pyx_e_4qnet_DEBUG_RTP) {

    /* "qnet.pyx":932
 * 
 *         if DEBUG_RTP:
 *             print "RTP"             # <<<<<<<<<<<<<<
 *             print arrv
 *             arrv.validate()
 */
    if (__Pyx_PrintOne(0, __pyx_n_s_RTP) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 932; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "qnet.pyx":933
 *         if DEBUG_RTP:
 *             print "RTP"
 *             print arrv             # <<<<<<<<<<<<<<
 *             arrv.validate()
 * 
 */
    if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_arrv)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "qnet.pyx":934
 *             print "RTP"
 *             print arrv
 *             arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *         tasks = arrv.all_tasks()
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (__pyx_t_3) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "qnet.pyx":936
 *             arrv.validate()
 * 
 *         tasks = arrv.all_tasks()             # <<<<<<<<<<<<<<
 *         k = last_evt.tid
 *         while k == last_evt.tid or arrv.events_of_task(k)[0].obs_d:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_tasks = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":937
 * 
 *         tasks = arrv.all_tasks()
 *         k = last_evt.tid             # <<<<<<<<<<<<<<
 *         while k == last_evt.tid or arrv.events_of_task(k)[0].obs_d:
 *             k = sampling.random_elt (tasks)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_last_evt->tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 937; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_k = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":938
 *         tasks = arrv.all_tasks()
 *         k = last_evt.tid
 *         while k == last_evt.tid or arrv.events_of_task(k)[0].obs_d:             # <<<<<<<<<<<<<<
 *             k = sampling.random_elt (tasks)
 *         task_old = arrv.events_of_task(k)
 */
  while (1) {
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_last_evt->tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_k, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!__pyx_t_6) {
    } else {
      __pyx_t_4 = __pyx_t_6;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_k); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_k);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_k);
      __Pyx_GIVEREF(__pyx_v_k);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 938; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __pyx_t_6;
    __pyx_L7_bool_binop_done:;
    if (!__pyx_t_4) break;

    /* "qnet.pyx":939
 *         k = last_evt.tid
 *         while k == last_evt.tid or arrv.events_of_task(k)[0].obs_d:
 *             k = sampling.random_elt (tasks)             # <<<<<<<<<<<<<<
 *         task_old = arrv.events_of_task(k)
 * 
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_sampling); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_random_elt); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
      __Pyx_INCREF(__pyx_v_tasks);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_tasks);
      __Pyx_GIVEREF(__pyx_v_tasks);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 939; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_k, __pyx_t_2);
    __pyx_t_2 = 0;
  }

  /* "qnet.pyx":940
 *         while k == last_evt.tid or arrv.events_of_task(k)[0].obs_d:
 *             k = sampling.random_elt (tasks)
 *         task_old = arrv.events_of_task(k)             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_RTP: print "Deleting task %s\n  %s" % (k, task_old)
 */
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_k); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  } else {
    __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(__pyx_v_k);
    PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_k);
    __Pyx_GIVEREF(__pyx_v_k);
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_task_old = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":942
 *         task_old = arrv.events_of_task(k)
 * 
 *         if DEBUG_RTP: print "Deleting task %s\n  %s" % (k, task_old)             # <<<<<<<<<<<<<<
 * 
 *         # Step 1: delete old task
 */
  if (__pyx_e_4qnet_DEBUG_RTP) {
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_k);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_k);
    __Pyx_GIVEREF(__pyx_v_k);
    __Pyx_INCREF(__pyx_v_task_old);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_task_old);
    __Pyx_GIVEREF(__pyx_v_task_old);
    __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_Deleting_task_s_s, __pyx_t_2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__Pyx_PrintOne(0, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 942; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "qnet.pyx":945
 * 
 *         # Step 1: delete old task
 *         for evt in task_old:             # <<<<<<<<<<<<<<
 *             q = evt.q
 *             d_new = evt.wait() + evt.a
 */
  if (likely(PyList_CheckExact(__pyx_v_task_old)) || PyTuple_CheckExact(__pyx_v_task_old)) {
    __pyx_t_7 = __pyx_v_task_old; __Pyx_INCREF(__pyx_t_7); __pyx_t_8 = 0;
    __pyx_t_9 = NULL;
  } else {
    __pyx_t_8 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_task_old); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_9)) {
      if (likely(PyList_CheckExact(__pyx_t_7))) {
        if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_9(__pyx_t_7);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 945; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":946
 *         # Step 1: delete old task
 *         for evt in task_old:
 *             q = evt.q             # <<<<<<<<<<<<<<
 *             d_new = evt.wait() + evt.a
 *             dl = q.diffListForDeparture (evt, d_new)
 */
    __pyx_t_2 = ((PyObject *)__pyx_v_evt->q);
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":947
 *         for evt in task_old:
 *             q = evt.q
 *             d_new = evt.wait() + evt.a             # <<<<<<<<<<<<<<
 *             dl = q.diffListForDeparture (evt, d_new)
 *             arrv.applyDiffList (dl)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_wait); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 947; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_d_new, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":948
 *             q = evt.q
 *             d_new = evt.wait() + evt.a
 *             dl = q.diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 *             arrv.applyDiffList (dl)
 *         arrv.delete_task (k)
 */
    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_v_d_new); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, __pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 948; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_dl, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":949
 *             d_new = evt.wait() + evt.a
 *             dl = q.diffListForDeparture (evt, d_new)
 *             arrv.applyDiffList (dl)             # <<<<<<<<<<<<<<
 *         arrv.delete_task (k)
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_2) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_dl); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
      __Pyx_INCREF(__pyx_v_dl);
      PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_dl);
      __Pyx_GIVEREF(__pyx_v_dl);
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 949; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":945
 * 
 *         # Step 1: delete old task
 *         for evt in task_old:             # <<<<<<<<<<<<<<
 *             q = evt.q
 *             d_new = evt.wait() + evt.a
 */
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "qnet.pyx":950
 *             dl = q.diffListForDeparture (evt, d_new)
 *             arrv.applyDiffList (dl)
 *         arrv.delete_task (k)             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_RTP: arrv.validate()
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_delete_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_1) {
    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_k); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
  } else {
    __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
    __Pyx_INCREF(__pyx_v_k);
    PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_k);
    __Pyx_GIVEREF(__pyx_v_k);
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 950; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "qnet.pyx":952
 *         arrv.delete_task (k)
 * 
 *         if DEBUG_RTP: arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *         # Step 2: compute random path for task
 */
  if (__pyx_e_4qnet_DEBUG_RTP) {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_11 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (__pyx_t_11) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_11); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    } else {
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 952; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;

  /* "qnet.pyx":955
 * 
 *         # Step 2: compute random path for task
 *         path = self.sample_path ()             # <<<<<<<<<<<<<<
 * 
 *         cdef Event prev_evt
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_sample_path); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_11 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_11)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_11) {
    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_11); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  } else {
    __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 955; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_path = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "qnet.pyx":958
 * 
 *         cdef Event prev_evt
 *         cdef double log_trans1 = 0, log_trans0 = 0             # <<<<<<<<<<<<<<
 * 
 *         # Step 3: add events back, one_by_one, using departure proposal
 */
  __pyx_v_log_trans1 = 0.0;
  __pyx_v_log_trans0 = 0.0;

  /* "qnet.pyx":961
 * 
 *         # Step 3: add events back, one_by_one, using departure proposal
 *         evt = task_old[0]             # <<<<<<<<<<<<<<
 *         global nrtp_reject, nrtp_calls
 * 
 */
  __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_task_old, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 961; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_7);
  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 961; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
  __pyx_t_7 = 0;

  /* "qnet.pyx":964
 *         global nrtp_reject, nrtp_calls
 * 
 *         while True:             # <<<<<<<<<<<<<<
 *             q = evt.q
 *             arrv.insert (evt)
 */
  while (1) {

    /* "qnet.pyx":965
 * 
 *         while True:
 *             q = evt.q             # <<<<<<<<<<<<<<
 *             arrv.insert (evt)
 *             q.recompute_departure (arrv, evt)
 */
    __pyx_t_7 = ((PyObject *)__pyx_v_evt->q);
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":966
 *         while True:
 *             q = evt.q
 *             arrv.insert (evt)             # <<<<<<<<<<<<<<
 *             q.recompute_departure (arrv, evt)
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_insert); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_11 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_11) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
    } else {
      __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 966; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "qnet.pyx":967
 *             q = evt.q
 *             arrv.insert (evt)
 *             q.recompute_departure (arrv, evt)             # <<<<<<<<<<<<<<
 * 
 *             if DEBUG_RTP:
 */
    __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_departure(__pyx_v_q, __pyx_v_arrv, __pyx_v_evt, 0); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 967; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "qnet.pyx":969
 *             q.recompute_departure (arrv, evt)
 * 
 *             if DEBUG_RTP:             # <<<<<<<<<<<<<<
 *                 print "++++++++++++++++\nRTP: Resampling departure"
 *                 print evt.prev_byq
 */
    if (__pyx_e_4qnet_DEBUG_RTP) {

      /* "qnet.pyx":970
 * 
 *             if DEBUG_RTP:
 *                 print "++++++++++++++++\nRTP: Resampling departure"             # <<<<<<<<<<<<<<
 *                 print evt.prev_byq
 *                 print evt
 */
      if (__Pyx_PrintOne(0, __pyx_kp_s_RTP_Resampling_departure) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 970; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":971
 *             if DEBUG_RTP:
 *                 print "++++++++++++++++\nRTP: Resampling departure"
 *                 print evt.prev_byq             # <<<<<<<<<<<<<<
 *                 print evt
 *                 print evt.next_byq
 */
      if (__Pyx_PrintOne(0, __pyx_v_evt->prev_byq) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 971; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":972
 *                 print "++++++++++++++++\nRTP: Resampling departure"
 *                 print evt.prev_byq
 *                 print evt             # <<<<<<<<<<<<<<
 *                 print evt.next_byq
 * 
 */
      if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_evt)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 972; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":973
 *                 print evt.prev_byq
 *                 print evt
 *                 print evt.next_byq             # <<<<<<<<<<<<<<
 * 
 *             dfn = q.departureLik (arrv, evt)
 */
      if (__Pyx_PrintOne(0, __pyx_v_evt->next_byq) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 973; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "qnet.pyx":975
 *                 print evt.next_byq
 * 
 *             dfn = q.departureLik (arrv, evt)             # <<<<<<<<<<<<<<
 *             d_new, diff_list = sample_d_until_acceptance (self, arrv, evt)
 * 
 */
    __pyx_t_7 = ((PyObject *)((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->departureLik(__pyx_v_q, __pyx_v_arrv, __pyx_v_evt)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 975; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_dfn, ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "qnet.pyx":976
 * 
 *             dfn = q.departureLik (arrv, evt)
 *             d_new, diff_list = sample_d_until_acceptance (self, arrv, evt)             # <<<<<<<<<<<<<<
 * 
 *             if DEBUG_RTP:
 */
    __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_sample_d_until_acceptance); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    __pyx_t_11 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    if (__pyx_t_1) {
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_8, ((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_8, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_8, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_11, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
      PyObject* sequence = __pyx_t_7;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_11);
      #else
      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      #endif
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_1 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = Py_TYPE(__pyx_t_1)->tp_iternext;
      index = 0; __pyx_t_3 = __pyx_t_12(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L16_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 1; __pyx_t_11 = __pyx_t_12(__pyx_t_1); if (unlikely(!__pyx_t_11)) goto __pyx_L16_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_11);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_1), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_12 = NULL;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L17_unpacking_done;
      __pyx_L16_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 976; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L17_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_d_new, __pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_11);
    __pyx_t_11 = 0;

    /* "qnet.pyx":978
 *             d_new, diff_list = sample_d_until_acceptance (self, arrv, evt)
 * 
 *             if DEBUG_RTP:             # <<<<<<<<<<<<<<
 *                 print "+++++++++++++++++"
 *                 print "RTP: Adding event"
 */
    if (__pyx_e_4qnet_DEBUG_RTP) {

      /* "qnet.pyx":979
 * 
 *             if DEBUG_RTP:
 *                 print "+++++++++++++++++"             # <<<<<<<<<<<<<<
 *                 print "RTP: Adding event"
 *                 print diff_list
 */
      if (__Pyx_PrintOne(0, __pyx_kp_s__13) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 979; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":980
 *             if DEBUG_RTP:
 *                 print "+++++++++++++++++"
 *                 print "RTP: Adding event"             # <<<<<<<<<<<<<<
 *                 print diff_list
 * 
 */
      if (__Pyx_PrintOne(0, __pyx_kp_s_RTP_Adding_event) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 980; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":981
 *                 print "+++++++++++++++++"
 *                 print "RTP: Adding event"
 *                 print diff_list             # <<<<<<<<<<<<<<
 * 
 *             diff_list = q.diffListForDeparture (evt, d_new)
 */
      if (__Pyx_PrintOne(0, __pyx_v_diff_list) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 981; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L18;
    }
    __pyx_L18:;

    /* "qnet.pyx":983
 *                 print diff_list
 * 
 *             diff_list = q.diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 *             arrv.applyDiffList (diff_list)
 *             if evt.s == 0.0:
 */
    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_v_d_new); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, __pyx_t_10); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 983; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF_SET(__pyx_v_diff_list, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "qnet.pyx":984
 * 
 *             diff_list = q.diffListForDeparture (evt, d_new)
 *             arrv.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 *             if evt.s == 0.0:
 *                 if DEBUG_RTP: print "Rejecting: zero service on %s" % evt
 */
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 984; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_diff_list); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 984; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
    } else {
      __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 984; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 984; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "qnet.pyx":985
 *             diff_list = q.diffListForDeparture (evt, d_new)
 *             arrv.applyDiffList (diff_list)
 *             if evt.s == 0.0:             # <<<<<<<<<<<<<<
 *                 if DEBUG_RTP: print "Rejecting: zero service on %s" % evt
 *                 nrtp_calls += 1
 */
    __pyx_t_4 = ((__pyx_v_evt->s == 0.0) != 0);
    if (__pyx_t_4) {

      /* "qnet.pyx":986
 *             arrv.applyDiffList (diff_list)
 *             if evt.s == 0.0:
 *                 if DEBUG_RTP: print "Rejecting: zero service on %s" % evt             # <<<<<<<<<<<<<<
 *                 nrtp_calls += 1
 *                 nrtp_reject += 1
 */
      if (__pyx_e_4qnet_DEBUG_RTP) {
        __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_Rejecting_zero_service_on_s, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 986; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        if (__Pyx_PrintOne(0, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 986; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        goto __pyx_L20;
      }
      __pyx_L20:;

      /* "qnet.pyx":987
 *             if evt.s == 0.0:
 *                 if DEBUG_RTP: print "Rejecting: zero service on %s" % evt
 *                 nrtp_calls += 1             # <<<<<<<<<<<<<<
 *                 nrtp_reject += 1
 *                 return arrv_old
 */
      __pyx_v_4qnet_nrtp_calls = (__pyx_v_4qnet_nrtp_calls + 1);

      /* "qnet.pyx":988
 *                 if DEBUG_RTP: print "Rejecting: zero service on %s" % evt
 *                 nrtp_calls += 1
 *                 nrtp_reject += 1             # <<<<<<<<<<<<<<
 *                 return arrv_old
 *             # todo: log_trans0, log_trans1
 */
      __pyx_v_4qnet_nrtp_reject = (__pyx_v_4qnet_nrtp_reject + 1);

      /* "qnet.pyx":989
 *                 nrtp_calls += 1
 *                 nrtp_reject += 1
 *                 return arrv_old             # <<<<<<<<<<<<<<
 *             # todo: log_trans0, log_trans1
 * 
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv_old));
      __pyx_r = ((PyObject *)__pyx_v_arrv_old);
      goto __pyx_L0;
    }

    /* "qnet.pyx":992
 *             # todo: log_trans0, log_trans1
 * 
 *             if  len(path) == 0: break             # <<<<<<<<<<<<<<
 * 
 *             # compute new evt
 */
    __pyx_t_8 = PyObject_Length(__pyx_v_path); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 992; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = ((__pyx_t_8 == 0) != 0);
    if (__pyx_t_4) {
      goto __pyx_L14_break;
    }

    /* "qnet.pyx":995
 * 
 *             # compute new evt
 *             sid, qid = path.pop(0)             # <<<<<<<<<<<<<<
 *             evt = Event (self.eidx, k, qid, self.queues[qid], d_new, 0.0, d_new, sid, 0)
 *             self.eidx += 1
 */
    __pyx_t_7 = __Pyx_PyObject_PopIndex(__pyx_v_path, 0, 1, Py_ssize_t, PyInt_FromSsize_t); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
      PyObject* sequence = __pyx_t_7;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_11 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_11 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_1);
      #else
      __pyx_t_11 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      #endif
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_3 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = Py_TYPE(__pyx_t_3)->tp_iternext;
      index = 0; __pyx_t_11 = __pyx_t_12(__pyx_t_3); if (unlikely(!__pyx_t_11)) goto __pyx_L22_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_11);
      index = 1; __pyx_t_1 = __pyx_t_12(__pyx_t_3); if (unlikely(!__pyx_t_1)) goto __pyx_L22_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_3), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_12 = NULL;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L23_unpacking_done;
      __pyx_L22_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_12 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L23_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_11);
    __pyx_t_11 = 0;
    __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":996
 *             # compute new evt
 *             sid, qid = path.pop(0)
 *             evt = Event (self.eidx, k, qid, self.queues[qid], d_new, 0.0, d_new, sid, 0)             # <<<<<<<<<<<<<<
 *             self.eidx += 1
 * 
 */
    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->eidx); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = PyObject_GetItem(__pyx_v_self->queues, __pyx_v_qid); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_11 = PyTuple_New(9); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_v_k);
    PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_k);
    __Pyx_GIVEREF(__pyx_v_k);
    __Pyx_INCREF(__pyx_v_qid);
    PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_v_qid);
    __Pyx_GIVEREF(__pyx_v_qid);
    PyTuple_SET_ITEM(__pyx_t_11, 3, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_d_new);
    PyTuple_SET_ITEM(__pyx_t_11, 4, __pyx_v_d_new);
    __Pyx_GIVEREF(__pyx_v_d_new);
    __Pyx_INCREF(__pyx_float_0_0);
    PyTuple_SET_ITEM(__pyx_t_11, 5, __pyx_float_0_0);
    __Pyx_GIVEREF(__pyx_float_0_0);
    __Pyx_INCREF(__pyx_v_d_new);
    PyTuple_SET_ITEM(__pyx_t_11, 6, __pyx_v_d_new);
    __Pyx_GIVEREF(__pyx_v_d_new);
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_11, 7, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_11, 8, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_7 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":997
 *             sid, qid = path.pop(0)
 *             evt = Event (self.eidx, k, qid, self.queues[qid], d_new, 0.0, d_new, sid, 0)
 *             self.eidx += 1             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_RTP:
 */
    __pyx_v_self->eidx = (__pyx_v_self->eidx + 1);
  }
  __pyx_L14_break:;

  /* "qnet.pyx":999
 *             self.eidx += 1
 * 
 *         if DEBUG_RTP:             # <<<<<<<<<<<<<<
 *             print "New task ", arrv.events_of_task(k)
 * 
 */
  if (__pyx_e_4qnet_DEBUG_RTP) {

    /* "qnet.pyx":1000
 * 
 *         if DEBUG_RTP:
 *             print "New task ", arrv.events_of_task(k)             # <<<<<<<<<<<<<<
 * 
 *         # step 4: acceptance ratio
 */
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_k); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(__pyx_v_k);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_k);
      __Pyx_GIVEREF(__pyx_v_k);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_kp_s_New_task);
    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_s_New_task);
    __Pyx_GIVEREF(__pyx_kp_s_New_task);
    PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_11, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1000; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    goto __pyx_L24;
  }
  __pyx_L24:;

  /* "qnet.pyx":1003
 * 
 *         # step 4: acceptance ratio
 *         pi0 = self.log_prob (arrv_old) + log_trans1             # <<<<<<<<<<<<<<
 *         pi1 = self.log_prob (arrv) + log_trans0
 * 
 */
  __pyx_t_10 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, __pyx_v_arrv_old, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1003; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_pi0 = (__pyx_t_10 + __pyx_v_log_trans1);

  /* "qnet.pyx":1004
 *         # step 4: acceptance ratio
 *         pi0 = self.log_prob (arrv_old) + log_trans1
 *         pi1 = self.log_prob (arrv) + log_trans0             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_RTP: print "pi0: %.10f  pi1: %.10f" % (pi0, pi1)
 */
  __pyx_t_10 = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->__pyx_vtab)->log_prob(__pyx_v_self, __pyx_v_arrv, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1004; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_pi1 = (__pyx_t_10 + __pyx_v_log_trans0);

  /* "qnet.pyx":1006
 *         pi1 = self.log_prob (arrv) + log_trans0
 * 
 *         if DEBUG_RTP: print "pi0: %.10f  pi1: %.10f" % (pi0, pi1)             # <<<<<<<<<<<<<<
 * 
 *         nrtp_calls += 1
 */
  if (__pyx_e_4qnet_DEBUG_RTP) {
    __pyx_t_11 = PyFloat_FromDouble(__pyx_v_pi0); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_pi1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_11);
    __Pyx_GIVEREF(__pyx_t_11);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_11 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_pi0_10f_pi1_10f, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L25;
  }
  __pyx_L25:;

  /* "qnet.pyx":1008
 *         if DEBUG_RTP: print "pi0: %.10f  pi1: %.10f" % (pi0, pi1)
 * 
 *         nrtp_calls += 1             # <<<<<<<<<<<<<<
 * 
 *         u = rand()
 */
  __pyx_v_4qnet_nrtp_calls = (__pyx_v_4qnet_nrtp_calls + 1);

  /* "qnet.pyx":1010
 *         nrtp_calls += 1
 * 
 *         u = rand()             # <<<<<<<<<<<<<<
 * 
 *         if u < math.exp(pi1 - pi0):
 */
  __pyx_v_u = __pyx_f_8sampling_rand();

  /* "qnet.pyx":1012
 *         u = rand()
 * 
 *         if u < math.exp(pi1 - pi0):             # <<<<<<<<<<<<<<
 *             # accept
 *             if DEBUG_RTP: arrv.validate()
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_u); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_11 = __Pyx_GetModuleGlobalName(__pyx_n_s_math); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_exp); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PyFloat_FromDouble((__pyx_v_pi1 - __pyx_v_pi0)); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_GOTREF(__pyx_t_3);
  } else {
    __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_13);
    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_t_11);
    __Pyx_GIVEREF(__pyx_t_11);
    __pyx_t_11 = 0;
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_13, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = PyObject_RichCompare(__pyx_t_1, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1012; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (__pyx_t_4) {

    /* "qnet.pyx":1014
 *         if u < math.exp(pi1 - pi0):
 *             # accept
 *             if DEBUG_RTP: arrv.validate()             # <<<<<<<<<<<<<<
 *             return arrv
 *         else:
 */
    if (__pyx_e_4qnet_DEBUG_RTP) {
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (__pyx_t_1) {
        __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L27;
    }
    __pyx_L27:;

    /* "qnet.pyx":1015
 *             # accept
 *             if DEBUG_RTP: arrv.validate()
 *             return arrv             # <<<<<<<<<<<<<<
 *         else:
 *             # reject
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    __pyx_r = ((PyObject *)__pyx_v_arrv);
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":1018
 *         else:
 *             # reject
 *             nrtp_reject += 1             # <<<<<<<<<<<<<<
 *             return arrv_old
 * 
 */
    __pyx_v_4qnet_nrtp_reject = (__pyx_v_4qnet_nrtp_reject + 1);

    /* "qnet.pyx":1019
 *             # reject
 *             nrtp_reject += 1
 *             return arrv_old             # <<<<<<<<<<<<<<
 * 
 *     # samples a path from the FSM.  Does not include initial state in
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv_old));
    __pyx_r = ((PyObject *)__pyx_v_arrv_old);
    goto __pyx_L0;
  }

  /* "qnet.pyx":922
 * 
 *     # N.B. The acceptance ratio for this is certainly wrong
 *     def remove_task_proposal (self, Arrivals arrv_old):             # <<<<<<<<<<<<<<
 *         cdef Arrivals arrv = arrv_old.duplicate()
 *         cdef Event last_evt = arrv.final_arrival_by_qid (0)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("qnet.Qnet.remove_task_proposal", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF((PyObject *)__pyx_v_last_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_tasks);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_task_old);
  __Pyx_XDECREF(__pyx_v_d_new);
  __Pyx_XDECREF(__pyx_v_dl);
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF((PyObject *)__pyx_v_dfn);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1023
 *     # samples a path from the FSM.  Does not include initial state in
 *     # the returned path
 *     def sample_path (self):             # <<<<<<<<<<<<<<
 *         path = []
 *         sid = self.fsm.sample_state (self.fsm.initial_state())
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_65sample_path(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_65sample_path(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sample_path (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_64sample_path(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_64sample_path(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_v_path = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sample_path", 0);

  /* "qnet.pyx":1024
 *     # the returned path
 *     def sample_path (self):
 *         path = []             # <<<<<<<<<<<<<<
 *         sid = self.fsm.sample_state (self.fsm.initial_state())
 *         while sid:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1024; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_path = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1025
 *     def sample_path (self):
 *         path = []
 *         sid = self.fsm.sample_state (self.fsm.initial_state())             # <<<<<<<<<<<<<<
 *         while sid:
 *             qid = self.fsm.sample_one_obs (sid)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1025; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_sid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1026
 *         path = []
 *         sid = self.fsm.sample_state (self.fsm.initial_state())
 *         while sid:             # <<<<<<<<<<<<<<
 *             qid = self.fsm.sample_one_obs (sid)
 *             path.append ( (sid,qid) )
 */
  while (1) {
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_sid); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1026; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_6) break;

    /* "qnet.pyx":1027
 *         sid = self.fsm.sample_state (self.fsm.initial_state())
 *         while sid:
 *             qid = self.fsm.sample_one_obs (sid)             # <<<<<<<<<<<<<<
 *             path.append ( (sid,qid) )
 *             sid = self.fsm.sample_state (sid)
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_one_obs); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      __Pyx_INCREF(__pyx_v_sid);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_sid);
      __Pyx_GIVEREF(__pyx_v_sid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1027; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1028
 *         while sid:
 *             qid = self.fsm.sample_one_obs (sid)
 *             path.append ( (sid,qid) )             # <<<<<<<<<<<<<<
 *             sid = self.fsm.sample_state (sid)
 *         return path
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __Pyx_INCREF(__pyx_v_qid);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_qid);
    __Pyx_GIVEREF(__pyx_v_qid);
    __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_path, __pyx_t_1); if (unlikely(__pyx_t_7 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":1029
 *             qid = self.fsm.sample_one_obs (sid)
 *             path.append ( (sid,qid) )
 *             sid = self.fsm.sample_state (sid)             # <<<<<<<<<<<<<<
 *         return path
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->fsm, __pyx_n_s_sample_state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_sid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_sid);
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_v_sid);
      __Pyx_GIVEREF(__pyx_v_sid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_sid, __pyx_t_1);
    __pyx_t_1 = 0;
  }

  /* "qnet.pyx":1030
 *             path.append ( (sid,qid) )
 *             sid = self.fsm.sample_state (sid)
 *         return path             # <<<<<<<<<<<<<<
 * 
 *     cpdef double log_prob (self, Arrivals arrv) except *:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_path);
  __pyx_r = __pyx_v_path;
  goto __pyx_L0;

  /* "qnet.pyx":1023
 *     # samples a path from the FSM.  Does not include initial state in
 *     # the returned path
 *     def sample_path (self):             # <<<<<<<<<<<<<<
 *         path = []
 *         sid = self.fsm.sample_state (self.fsm.initial_state())
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.sample_path", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1032
 *         return path
 * 
 *     cpdef double log_prob (self, Arrivals arrv) except *:             # <<<<<<<<<<<<<<
 *         cdef double result = 0
 *         cdef Queue q
 */

static PyObject *__pyx_pw_4qnet_4Qnet_67log_prob(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv); /*proto*/
static double __pyx_f_4qnet_4Qnet_log_prob(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, int __pyx_skip_dispatch) {
  double __pyx_v_result;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  double __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  double __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("log_prob", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_log_prob); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_4qnet_4Qnet_67log_prob)) {
      __Pyx_INCREF(__pyx_t_1);
      __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (!__pyx_t_4) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_5, 0+1, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_r = __pyx_t_6;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "qnet.pyx":1033
 * 
 *     cpdef double log_prob (self, Arrivals arrv) except *:
 *         cdef double result = 0             # <<<<<<<<<<<<<<
 *         cdef Queue q
 *         for q in self.queues:
 */
  __pyx_v_result = 0.0;

  /* "qnet.pyx":1035
 *         cdef double result = 0
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             result += q.allEventLik (arrv)
 *         return result
 */
  if (likely(PyList_CheckExact(__pyx_v_self->queues)) || PyTuple_CheckExact(__pyx_v_self->queues)) {
    __pyx_t_1 = __pyx_v_self->queues; __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1036
 *         cdef Queue q
 *         for q in self.queues:
 *             result += q.allEventLik (arrv)             # <<<<<<<<<<<<<<
 *         return result
 * 
 */
    __pyx_t_6 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->allEventLik(__pyx_v_q, __pyx_v_arrv); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1036; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_result = (__pyx_v_result + __pyx_t_6);

    /* "qnet.pyx":1035
 *         cdef double result = 0
 *         cdef Queue q
 *         for q in self.queues:             # <<<<<<<<<<<<<<
 *             result += q.allEventLik (arrv)
 *         return result
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1037
 *         for q in self.queues:
 *             result += q.allEventLik (arrv)
 *         return result             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":1032
 *         return path
 * 
 *     cpdef double log_prob (self, Arrivals arrv) except *:             # <<<<<<<<<<<<<<
 *         cdef double result = 0
 *         cdef Queue q
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.Qnet.log_prob", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_67log_prob(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_67log_prob(PyObject *__pyx_v_self, PyObject *__pyx_v_arrv) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("log_prob (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_4Qnet_66log_prob(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_66log_prob(struct __pyx_obj_4qnet_Qnet *__pyx_v_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("log_prob", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_4qnet_4Qnet_log_prob(__pyx_v_self, __pyx_v_arrv, 1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("qnet.Qnet.log_prob", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":8
 * cdef class Qnet:
 * 
 *     cdef readonly object queues     # List of Queues             # <<<<<<<<<<<<<<
 *     cdef readonly object templates    # List of all object that have parameters
 *     cdef readonly object fsm     # HMM object
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_6queues_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_6queues_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_6queues___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_6queues___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->queues);
  __pyx_r = __pyx_v_self->queues;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":9
 * 
 *     cdef readonly object queues     # List of Queues
 *     cdef readonly object templates    # List of all object that have parameters             # <<<<<<<<<<<<<<
 *     cdef readonly object fsm     # HMM object
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_9templates_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_9templates_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_9templates___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_9templates___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->templates);
  __pyx_r = __pyx_v_self->templates;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":10
 *     cdef readonly object queues     # List of Queues
 *     cdef readonly object templates    # List of all object that have parameters
 *     cdef readonly object fsm     # HMM object             # <<<<<<<<<<<<<<
 * 
 *     cdef readonly object universe # for auxiliary variables :: maps names to domains
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_3fsm_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_3fsm_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_3fsm___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_3fsm___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->fsm);
  __pyx_r = __pyx_v_self->fsm;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":12
 *     cdef readonly object fsm     # HMM object
 * 
 *     cdef readonly object universe # for auxiliary variables :: maps names to domains             # <<<<<<<<<<<<<<
 * 
 *     cdef readonly object qname2id
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_8universe_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_8universe_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_8universe___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_8universe___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->universe);
  __pyx_r = __pyx_v_self->universe;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":14
 *     cdef readonly object universe # for auxiliary variables :: maps names to domains
 * 
 *     cdef readonly object qname2id             # <<<<<<<<<<<<<<
 *     cdef readonly object sname2id
 *     cdef readonly int eidx
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_8qname2id_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_8qname2id_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_8qname2id___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_8qname2id___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->qname2id);
  __pyx_r = __pyx_v_self->qname2id;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":15
 * 
 *     cdef readonly object qname2id
 *     cdef readonly object sname2id             # <<<<<<<<<<<<<<
 *     cdef readonly int eidx
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_8sname2id_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_8sname2id_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_8sname2id___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_8sname2id___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->sname2id);
  __pyx_r = __pyx_v_self->sname2id;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pxd":16
 *     cdef readonly object qname2id
 *     cdef readonly object sname2id
 *     cdef readonly int eidx             # <<<<<<<<<<<<<<
 * 
 *     # private
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_4Qnet_4eidx_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_4qnet_4Qnet_4eidx_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_4Qnet_4eidx___get__(((struct __pyx_obj_4qnet_Qnet *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_4Qnet_4eidx___get__(struct __pyx_obj_4qnet_Qnet *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.Qnet.eidx.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1047
 * # Utilities
 * 
 * def is_sampled_by_task (arrv):             # <<<<<<<<<<<<<<
 *     tasks_in = {}
 *     tasks_out = {}
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_15is_sampled_by_task(PyObject *__pyx_self, PyObject *__pyx_v_arrv); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_15is_sampled_by_task = {"is_sampled_by_task", (PyCFunction)__pyx_pw_4qnet_15is_sampled_by_task, METH_O, 0};
static PyObject *__pyx_pw_4qnet_15is_sampled_by_task(PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_sampled_by_task (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_14is_sampled_by_task(__pyx_self, ((PyObject *)__pyx_v_arrv));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_14is_sampled_by_task(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_v_tasks_in = NULL;
  PyObject *__pyx_v_tasks_out = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("is_sampled_by_task", 0);

  /* "qnet.pyx":1048
 * 
 * def is_sampled_by_task (arrv):
 *     tasks_in = {}             # <<<<<<<<<<<<<<
 *     tasks_out = {}
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1048; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_tasks_in = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1049
 * def is_sampled_by_task (arrv):
 *     tasks_in = {}
 *     tasks_out = {}             # <<<<<<<<<<<<<<
 * 
 *     for evt in arrv:
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_tasks_out = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1051
 *     tasks_out = {}
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             if not evt.obs_a: return False
 */
  if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
    __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1052
 * 
 *     for evt in arrv:
 *         if evt.obs_d:             # <<<<<<<<<<<<<<
 *             if not evt.obs_a: return False
 *             if evt.tid in tasks_out: return False
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1052; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1052; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {

      /* "qnet.pyx":1053
 *     for evt in arrv:
 *         if evt.obs_d:
 *             if not evt.obs_a: return False             # <<<<<<<<<<<<<<
 *             if evt.tid in tasks_out: return False
 *             tasks_in[evt.tid] = True
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1053; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1053; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_6 = ((!__pyx_t_5) != 0);
      if (__pyx_t_6) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }

      /* "qnet.pyx":1054
 *         if evt.obs_d:
 *             if not evt.obs_a: return False
 *             if evt.tid in tasks_out: return False             # <<<<<<<<<<<<<<
 *             tasks_in[evt.tid] = True
 *         else:
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1054; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = (__Pyx_PyDict_Contains(__pyx_t_4, __pyx_v_tasks_out, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1054; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = (__pyx_t_6 != 0);
      if (__pyx_t_5) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }

      /* "qnet.pyx":1055
 *             if not evt.obs_a: return False
 *             if evt.tid in tasks_out: return False
 *             tasks_in[evt.tid] = True             # <<<<<<<<<<<<<<
 *         else:
 *             if evt.obs_a: return False
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1055; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if (unlikely(PyDict_SetItem(__pyx_v_tasks_in, __pyx_t_4, Py_True) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1055; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L5;
    }
    /*else*/ {

      /* "qnet.pyx":1057
 *             tasks_in[evt.tid] = True
 *         else:
 *             if evt.obs_a: return False             # <<<<<<<<<<<<<<
 *             if evt.tid in tasks_in: return False
 *             tasks_out[evt.tid] = True
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_5) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }

      /* "qnet.pyx":1058
 *         else:
 *             if evt.obs_a: return False
 *             if evt.tid in tasks_in: return False             # <<<<<<<<<<<<<<
 *             tasks_out[evt.tid] = True
 * 
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = (__Pyx_PyDict_Contains(__pyx_t_4, __pyx_v_tasks_in, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_6 = (__pyx_t_5 != 0);
      if (__pyx_t_6) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(Py_False);
        __pyx_r = Py_False;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }

      /* "qnet.pyx":1059
 *             if evt.obs_a: return False
 *             if evt.tid in tasks_in: return False
 *             tasks_out[evt.tid] = True             # <<<<<<<<<<<<<<
 * 
 *     return True
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1059; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if (unlikely(PyDict_SetItem(__pyx_v_tasks_out, __pyx_t_4, Py_True) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1059; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_L5:;

    /* "qnet.pyx":1051
 *     tasks_out = {}
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             if not evt.obs_a: return False
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1061
 *             tasks_out[evt.tid] = True
 * 
 *     return True             # <<<<<<<<<<<<<<
 * 
 * def has_tau (Event evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_True);
  __pyx_r = Py_True;
  goto __pyx_L0;

  /* "qnet.pyx":1047
 * # Utilities
 * 
 * def is_sampled_by_task (arrv):             # <<<<<<<<<<<<<<
 *     tasks_in = {}
 *     tasks_out = {}
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.is_sampled_by_task", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_tasks_in);
  __Pyx_XDECREF(__pyx_v_tasks_out);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1063
 *     return True
 * 
 * def has_tau (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byq = evt.prev_byq
 * #    if evt.prev_byt != None: return False
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_17has_tau(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_17has_tau = {"has_tau", (PyCFunction)__pyx_pw_4qnet_17has_tau, METH_O, 0};
static PyObject *__pyx_pw_4qnet_17has_tau(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("has_tau (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_16has_tau(__pyx_self, ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_16has_tau(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_byq = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("has_tau", 0);

  /* "qnet.pyx":1064
 * 
 * def has_tau (Event evt):
 *     cdef Event byq = evt.prev_byq             # <<<<<<<<<<<<<<
 * #    if evt.prev_byt != None: return False
 *     if byq:
 */
  if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt->prev_byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_byq = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1066
 *     cdef Event byq = evt.prev_byq
 * #    if evt.prev_byt != None: return False
 *     if byq:             # <<<<<<<<<<<<<<
 *         return not evt.obs_a or not byq.obs_a
 *     else:
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1066; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {

    /* "qnet.pyx":1067
 * #    if evt.prev_byt != None: return False
 *     if byq:
 *         return not evt.obs_a or not byq.obs_a             # <<<<<<<<<<<<<<
 *     else:
 *         return not evt.obs_a
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = (!(__pyx_v_evt->obs_a != 0));
    if (!__pyx_t_2) {
    } else {
      __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1067; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L4_bool_binop_done;
    }
    __pyx_t_2 = (!(__pyx_v_byq->obs_a != 0));
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1067; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __pyx_t_3;
    __pyx_t_3 = 0;
    __pyx_L4_bool_binop_done:;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":1069
 *         return not evt.obs_a or not byq.obs_a
 *     else:
 *         return not evt.obs_a             # <<<<<<<<<<<<<<
 * 
 * def create_qp (a, reg):
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = __Pyx_PyBool_FromLong((!(__pyx_v_evt->obs_a != 0))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1069; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
  }

  /* "qnet.pyx":1063
 *     return True
 * 
 * def has_tau (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byq = evt.prev_byq
 * #    if evt.prev_byt != None: return False
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.has_tau", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_byq);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1071
 *         return not evt.obs_a
 * 
 * def create_qp (a, reg):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_19create_qp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_19create_qp = {"create_qp", (PyCFunction)__pyx_pw_4qnet_19create_qp, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_19create_qp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_a = 0;
  CYTHON_UNUSED PyObject *__pyx_v_reg = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("create_qp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_a,&__pyx_n_s_reg,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_reg)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("create_qp", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "create_qp") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_a = values[0];
    __pyx_v_reg = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("create_qp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.create_qp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_18create_qp(__pyx_self, __pyx_v_a, __pyx_v_reg);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_18create_qp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_a, CYTHON_UNUSED PyObject *__pyx_v_reg) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  CYTHON_UNUSED PyObject *__pyx_v_ne = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_nt = NULL;
  PyObject *__pyx_v_qp = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_eid = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_byq = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("create_qp", 0);

  /* "qnet.pyx":1072
 * 
 * def create_qp (a, reg):
 *     cdef Arrivals arrv = a             # <<<<<<<<<<<<<<
 *     ne = arrv.max_eidx()
 *     nt = arrv.num_tasks()
 */
  if (!(likely(((__pyx_v_a) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_a, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1072; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_a;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1073
 * def create_qp (a, reg):
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()             # <<<<<<<<<<<<<<
 *     nt = arrv.num_tasks()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1074
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()
 *     nt = arrv.num_tasks()             # <<<<<<<<<<<<<<
 * 
 *     qp = stupidlp.QP()
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_num_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1076
 *     nt = arrv.num_tasks()
 * 
 *     qp = stupidlp.QP()             # <<<<<<<<<<<<<<
 * 
 *     cdef Event evt
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_stupidlp); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_QP); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1076; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_qp = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1079
 * 
 *     cdef Event evt
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         eid = evt.eid
 *         if has_tau(evt):
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1079; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1080
 *     cdef Event evt
 *     for evt in arrv:
 *         eid = evt.eid             # <<<<<<<<<<<<<<
 *         if has_tau(evt):
 *             qp.add_var_ge ("TAU%d"%eid, 1e-9)
 */
    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1080; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1081
 *     for evt in arrv:
 *         eid = evt.eid
 *         if has_tau(evt):             # <<<<<<<<<<<<<<
 *             qp.add_var_ge ("TAU%d"%eid, 1e-9)
 * 
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_has_tau); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":1082
 *         eid = evt.eid
 *         if has_tau(evt):
 *             qp.add_var_ge ("TAU%d"%eid, 1e-9)             # <<<<<<<<<<<<<<
 * 
 *     # objective
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_qp, __pyx_n_s_add_var_ge); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_TAU_d, __pyx_v_eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      if (__pyx_t_6) {
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      }
      PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __Pyx_INCREF(__pyx_float_1eneg_9);
      PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_float_1eneg_9);
      __Pyx_GIVEREF(__pyx_float_1eneg_9);
      __pyx_t_7 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1079
 * 
 *     cdef Event evt
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         eid = evt.eid
 *         if has_tau(evt):
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1085
 * 
 *     # objective
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byq = evt.prev_byq
 *         if has_tau (evt):
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1085; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1086
 *     # objective
 *     for evt in arrv:
 *         byq = evt.prev_byq             # <<<<<<<<<<<<<<
 *         if has_tau (evt):
 *             qp.add_objsq (1.0, "TAU%d" % evt.eid)
 */
    __pyx_t_3 = __pyx_v_evt->prev_byq;
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_byq, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1087
 *     for evt in arrv:
 *         byq = evt.prev_byq
 *         if has_tau (evt):             # <<<<<<<<<<<<<<
 *             qp.add_objsq (1.0, "TAU%d" % evt.eid)
 * 
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_has_tau); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_10 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_10) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1087; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":1088
 *         byq = evt.prev_byq
 *         if has_tau (evt):
 *             qp.add_objsq (1.0, "TAU%d" % evt.eid)             # <<<<<<<<<<<<<<
 * 
 *     for evt in arrv:
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_qp, __pyx_n_s_add_objsq); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_TAU_d, __pyx_t_7); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      __pyx_t_9 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_9 = 1;
        }
      }
      __pyx_t_6 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_7) {
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(__pyx_float_1_0);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_9, __pyx_float_1_0);
      __Pyx_GIVEREF(__pyx_float_1_0);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_9, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1088; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L8;
    }
    __pyx_L8:;

    /* "qnet.pyx":1085
 * 
 *     # objective
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byq = evt.prev_byq
 *         if has_tau (evt):
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1090
 *             qp.add_objsq (1.0, "TAU%d" % evt.eid)
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         evt.q.add_initialization_constraints (qp, evt)
 * 
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1090; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1091
 * 
 *     for evt in arrv:
 *         evt.q.add_initialization_constraints (qp, evt)             # <<<<<<<<<<<<<<
 * 
 *     return qp
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_add_initialization_constraints); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1091; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_9 = 1;
      }
    }
    __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1091; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    if (__pyx_t_6) {
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(__pyx_v_qp);
    PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_v_qp);
    __Pyx_GIVEREF(__pyx_v_qp);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1091; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":1090
 *             qp.add_objsq (1.0, "TAU%d" % evt.eid)
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         evt.q.add_initialization_constraints (qp, evt)
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1093
 *         evt.q.add_initialization_constraints (qp, evt)
 * 
 *     return qp             # <<<<<<<<<<<<<<
 * 
 * cdef setup_initialization_lp (Arrivals arrv, reg):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_qp);
  __pyx_r = __pyx_v_qp;
  goto __pyx_L0;

  /* "qnet.pyx":1071
 *         return not evt.obs_a
 * 
 * def create_qp (a, reg):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("qnet.create_qp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XDECREF(__pyx_v_nt);
  __Pyx_XDECREF(__pyx_v_qp);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_byq);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1095
 *     return qp
 * 
 * cdef setup_initialization_lp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *         lp = stupidlp.LP()
 *         r_means = compute_obs_means (arrv)
 */

static PyObject *__pyx_f_4qnet_setup_initialization_lp(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_reg) {
  PyObject *__pyx_v_lp = NULL;
  PyObject *__pyx_v_r_means = NULL;
  PyObject *__pyx_v_tau_mean = NULL;
  PyObject *__pyx_v_ne = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_nt = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byq = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byt = 0;
  PyObject *__pyx_v_val = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("setup_initialization_lp", 0);

  /* "qnet.pyx":1096
 * 
 * cdef setup_initialization_lp (Arrivals arrv, reg):
 *         lp = stupidlp.LP()             # <<<<<<<<<<<<<<
 *         r_means = compute_obs_means (arrv)
 *         tau_mean = compute_obs_mean_ia (arrv)
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_stupidlp); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_LP); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1096; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_lp = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1097
 * cdef setup_initialization_lp (Arrivals arrv, reg):
 *         lp = stupidlp.LP()
 *         r_means = compute_obs_means (arrv)             # <<<<<<<<<<<<<<
 *         tau_mean = compute_obs_mean_ia (arrv)
 *         if tau_mean < 1e-5: tau_mean = 1e-5
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_compute_obs_means); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1097; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_r_means = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1098
 *         lp = stupidlp.LP()
 *         r_means = compute_obs_means (arrv)
 *         tau_mean = compute_obs_mean_ia (arrv)             # <<<<<<<<<<<<<<
 *         if tau_mean < 1e-5: tau_mean = 1e-5
 * 
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_compute_obs_mean_ia); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_2, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1098; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_tau_mean = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1099
 *         r_means = compute_obs_means (arrv)
 *         tau_mean = compute_obs_mean_ia (arrv)
 *         if tau_mean < 1e-5: tau_mean = 1e-5             # <<<<<<<<<<<<<<
 * 
 *         ne = arrv.max_eidx()
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_tau_mean, __pyx_float_1eneg_5, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1099; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1099; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {
    __Pyx_INCREF(__pyx_float_1eneg_5);
    __Pyx_DECREF_SET(__pyx_v_tau_mean, __pyx_float_1eneg_5);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1101
 *         if tau_mean < 1e-5: tau_mean = 1e-5
 * 
 *         ne = arrv.max_eidx()             # <<<<<<<<<<<<<<
 *         nt = arrv.num_tasks()
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1102
 * 
 *         ne = arrv.max_eidx()
 *         nt = arrv.num_tasks()             # <<<<<<<<<<<<<<
 * 
 *         lp.add_vars ("set E := 0 .. %d;\n" % ne)
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_num_tasks); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_nt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1104
 *         nt = arrv.num_tasks()
 * 
 *         lp.add_vars ("set E := 0 .. %d;\n" % ne)             # <<<<<<<<<<<<<<
 * 
 *         lp.add_vars ("var d{i in E} >= 0;")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_set_E_0_d, __pyx_v_ne); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1106
 *         lp.add_vars ("set E := 0 .. %d;\n" % ne)
 * 
 *         lp.add_vars ("var d{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1107
 * 
 *         lp.add_vars ("var d{i in E} >= 0;")
 *         lp.add_vars ("var r{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1108
 *         lp.add_vars ("var d{i in E} >= 0;")
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1109
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1110
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1111
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1112
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1113
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 *         lp.add_vars ("var slack4{i in E} >= 0;")             # <<<<<<<<<<<<<<
 * 
 *         lp.set_objective ("minimize cost: sum{i in E} slack1[i] + sum{i in E} slack2[i] + sum{i in E} slack3[i] + sum{i in E} slack4[i];\n")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1115
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 * 
 *         lp.set_objective ("minimize cost: sum{i in E} slack1[i] + sum{i in E} slack2[i] + sum{i in E} slack3[i] + sum{i in E} slack4[i];\n")             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 1. d_e = a_e + r_e
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_set_objective); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1118
 * 
 *         # Constraint 1. d_e = a_e + r_e
 *         lp.add_constraint ("s.t. allr{i in E}: d[i] = a[i] + r[i];")             # <<<<<<<<<<<<<<
 * 
 *         cdef Event evt, byq, byt
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1123
 * 
 *         # Constraint 1b. d_e > a_e
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if (not evt.obs_d) or (not evt.obs_a):
 *                 lp.add_constraint ("s.t. d_ge_a%d: d[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, evt.eid, reg))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1124
 *         # Constraint 1b. d_e > a_e
 *         for evt in arrv:
 *             if (not evt.obs_d) or (not evt.obs_a):             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. d_ge_a%d: d[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, evt.eid, reg))
 * 
 */
    __pyx_t_9 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    if (!__pyx_t_9) {
    } else {
      __pyx_t_5 = __pyx_t_9;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_9 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
    __pyx_t_5 = __pyx_t_9;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_5) {

      /* "qnet.pyx":1125
 *         for evt in arrv:
 *             if (not evt.obs_d) or (not evt.obs_a):
 *                 lp.add_constraint ("s.t. d_ge_a%d: d[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, evt.eid, reg))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 2. d_pi(e) = a_e
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = PyTuple_New(4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_v_reg);
      PyTuple_SET_ITEM(__pyx_t_11, 3, __pyx_v_reg);
      __Pyx_GIVEREF(__pyx_v_reg);
      __pyx_t_2 = 0;
      __pyx_t_4 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_s_t_d_ge_a_d_d_d_a_d_s, __pyx_t_11); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1123
 * 
 *         # Constraint 1b. d_e > a_e
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if (not evt.obs_d) or (not evt.obs_a):
 *                 lp.add_constraint ("s.t. d_ge_a%d: d[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, evt.eid, reg))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1128
 * 
 *         # Constraint 2. d_pi(e) = a_e
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byt = evt.prev_byt
 *             if not byt:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1129
 *         # Constraint 2. d_pi(e) = a_e
 *         for evt in arrv:
 *             byt = evt.prev_byt             # <<<<<<<<<<<<<<
 *             if not byt:
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = 0;\n" % (evt.eid, evt.eid))
 */
    if (!(likely(((__pyx_v_evt->prev_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = __pyx_v_evt->prev_byt;
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_byt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1130
 *         for evt in arrv:
 *             byt = evt.prev_byt
 *             if not byt:             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = 0;\n" % (evt.eid, evt.eid))
 *             else:
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byt)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_9 = ((!__pyx_t_5) != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1131
 *             byt = evt.prev_byt
 *             if not byt:
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = 0;\n" % (evt.eid, evt.eid))             # <<<<<<<<<<<<<<
 *             else:
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = d[%d];\n" % (evt.eid, evt.eid, byt.eid))
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_4 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_s_t_a_pi_d_a_d_0, __pyx_t_11); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L11;
    }
    /*else*/ {

      /* "qnet.pyx":1133
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = 0;\n" % (evt.eid, evt.eid))
 *             else:
 *                 lp.add_constraint ("s.t. a_pi%d: a[%d] = d[%d];\n" % (evt.eid, evt.eid, byt.eid))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 3. d_e >= d_(rho(e))
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_byt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      __pyx_t_4 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_s_t_a_pi_d_a_d_d_d, __pyx_t_2); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_2) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
        PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        __pyx_t_11 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_L11:;

    /* "qnet.pyx":1128
 * 
 *         # Constraint 2. d_pi(e) = a_e
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byt = evt.prev_byt
 *             if not byt:
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1136
 * 
 *         # Constraint 3. d_e >= d_(rho(e))
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byq = evt.q.previous_departing (evt)
 *             if byq:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1137
 *         # Constraint 3. d_e >= d_(rho(e))
 *         for evt in arrv:
 *             byq = evt.q.previous_departing (evt)             # <<<<<<<<<<<<<<
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_previous_departing); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_10 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (!__pyx_t_10) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_byq, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1138
 *         for evt in arrv:
 *             byq = evt.q.previous_departing (evt)
 *             if byq:             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     lp.add_constraint ("s.t. d_rho%d: d[%d] - d[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))
 */
    __pyx_t_9 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_9) {

      /* "qnet.pyx":1139
 *             byq = evt.q.previous_departing (evt)
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):             # <<<<<<<<<<<<<<
 *                     lp.add_constraint ("s.t. d_rho%d: d[%d] - d[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))
 * 
 */
      __pyx_t_5 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
      if (!__pyx_t_5) {
      } else {
        __pyx_t_9 = __pyx_t_5;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_5 = ((!(__pyx_v_byq->obs_d != 0)) != 0);
      __pyx_t_9 = __pyx_t_5;
      __pyx_L16_bool_binop_done:;
      if (__pyx_t_9) {

        /* "qnet.pyx":1140
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     lp.add_constraint ("s.t. d_rho%d: d[%d] - d[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 3b. a_e >= a_(rho(e))
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_byq->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_v_reg);
        PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_reg);
        __Pyx_GIVEREF(__pyx_v_reg);
        __pyx_t_11 = 0;
        __pyx_t_10 = 0;
        __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_s_t_d_rho_d_d_d_d_d_s, __pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_4) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
          PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          __pyx_t_2 = 0;
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L15;
      }
      __pyx_L15:;
      goto __pyx_L14;
    }
    __pyx_L14:;

    /* "qnet.pyx":1136
 * 
 *         # Constraint 3. d_e >= d_(rho(e))
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byq = evt.q.previous_departing (evt)
 *             if byq:
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1143
 * 
 *         # Constraint 3b. a_e >= a_(rho(e))
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byq = evt.prev_byq #  evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1144
 *         # Constraint 3b. a_e >= a_(rho(e))
 *         for evt in arrv:
 *             byq = evt.prev_byq #  evt.q.previous_departing (evt)             # <<<<<<<<<<<<<<
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):
 */
    if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = __pyx_v_evt->prev_byq;
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_byq, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1145
 *         for evt in arrv:
 *             byq = evt.prev_byq #  evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     lp.add_constraint ("s.t. a_rho%d: a[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_5) {
    } else {
      __pyx_t_9 = __pyx_t_5;
      goto __pyx_L21_bool_binop_done;
    }
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_9 = __pyx_t_5;
    __pyx_L21_bool_binop_done:;
    if (__pyx_t_9) {

      /* "qnet.pyx":1146
 *             byq = evt.prev_byq #  evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):             # <<<<<<<<<<<<<<
 *                     lp.add_constraint ("s.t. a_rho%d: a[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))
 * 
 */
      __pyx_t_5 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
      if (!__pyx_t_5) {
      } else {
        __pyx_t_9 = __pyx_t_5;
        goto __pyx_L24_bool_binop_done;
      }
      __pyx_t_5 = ((!(__pyx_v_byq->obs_a != 0)) != 0);
      __pyx_t_9 = __pyx_t_5;
      __pyx_L24_bool_binop_done:;
      if (__pyx_t_9) {

        /* "qnet.pyx":1147
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     lp.add_constraint ("s.t. a_rho%d: a[%d] - a[%d] >= %s;\n" % (evt.eid, evt.eid, byq.eid, reg))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 4. Define tau
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_byq->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_11 = PyTuple_New(4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_v_reg);
        PyTuple_SET_ITEM(__pyx_t_11, 3, __pyx_v_reg);
        __Pyx_GIVEREF(__pyx_v_reg);
        __pyx_t_10 = 0;
        __pyx_t_2 = 0;
        __pyx_t_4 = 0;
        __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_s_t_a_rho_d_a_d_a_d_s, __pyx_t_11); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_11) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
          PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_4);
          __pyx_t_4 = 0;
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L23;
      }
      __pyx_L23:;
      goto __pyx_L20;
    }
    __pyx_L20:;

    /* "qnet.pyx":1143
 * 
 *         # Constraint 3b. a_e >= a_(rho(e))
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             byq = evt.prev_byq #  evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1150
 * 
 *         # Constraint 4. Define tau
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if not evt.prev_byt:
 *                 byq = evt.q.previous_departing (evt)
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1151
 *         # Constraint 4. Define tau
 *         for evt in arrv:
 *             if not evt.prev_byt:             # <<<<<<<<<<<<<<
 *                 byq = evt.q.previous_departing (evt)
 *                 if byq:
 */
    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = ((!__pyx_t_9) != 0);
    if (__pyx_t_5) {

      /* "qnet.pyx":1152
 *         for evt in arrv:
 *             if not evt.prev_byt:
 *                 byq = evt.q.previous_departing (evt)             # <<<<<<<<<<<<<<
 *                 if byq:
 *                     lp.add_constraint ("s.t. tau%d: d[%d] + tau[%d] = d[%d];\n" % (evt.eid, byq.eid, evt.eid, evt.eid))
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_previous_departing); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_2 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_2) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_byq, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "qnet.pyx":1153
 *             if not evt.prev_byt:
 *                 byq = evt.q.previous_departing (evt)
 *                 if byq:             # <<<<<<<<<<<<<<
 *                     lp.add_constraint ("s.t. tau%d: d[%d] + tau[%d] = d[%d];\n" % (evt.eid, byq.eid, evt.eid, evt.eid))
 *                 else:
 */
      __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_5) {

        /* "qnet.pyx":1154
 *                 byq = evt.q.previous_departing (evt)
 *                 if byq:
 *                     lp.add_constraint ("s.t. tau%d: d[%d] + tau[%d] = d[%d];\n" % (evt.eid, byq.eid, evt.eid, evt.eid))             # <<<<<<<<<<<<<<
 *                 else:
 *                     lp.add_constraint ("s.t. tau%d: d[%d] = tau[%d];\n" % (evt.eid, evt.eid, evt.eid))
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_byq->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_12 = PyTuple_New(4); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_4 = 0;
        __pyx_t_2 = 0;
        __pyx_t_11 = 0;
        __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_s_t_tau_d_d_d_tau_d_d_d, __pyx_t_12); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_12)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_12);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_12) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
          PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          __pyx_t_10 = 0;
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L29;
      }
      /*else*/ {

        /* "qnet.pyx":1156
 *                     lp.add_constraint ("s.t. tau%d: d[%d] + tau[%d] = d[%d];\n" % (evt.eid, byq.eid, evt.eid, evt.eid))
 *                 else:
 *                     lp.add_constraint ("s.t. tau%d: d[%d] = tau[%d];\n" % (evt.eid, evt.eid, evt.eid))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 5. slacks on R
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_12);
        __Pyx_GIVEREF(__pyx_t_12);
        __pyx_t_11 = 0;
        __pyx_t_10 = 0;
        __pyx_t_12 = 0;
        __pyx_t_12 = __Pyx_PyString_Format(__pyx_kp_s_s_t_tau_d_d_d_tau_d, __pyx_t_2); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_2) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
          PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_12);
          __pyx_t_12 = 0;
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __pyx_L29:;
      goto __pyx_L28;
    }
    __pyx_L28:;

    /* "qnet.pyx":1150
 * 
 *         # Constraint 4. Define tau
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if not evt.prev_byt:
 *                 byq = evt.q.previous_departing (evt)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1159
 * 
 *         # Constraint 5. slacks on R
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             val = r_means [evt.qid]
 *             lp.add_constraint ("s.t. slack1%d: r[%d] + slack1[%d] - slack2[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, val))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1160
 *         # Constraint 5. slacks on R
 *         for evt in arrv:
 *             val = r_means [evt.qid]             # <<<<<<<<<<<<<<
 *             lp.add_constraint ("s.t. slack1%d: r[%d] + slack1[%d] - slack2[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, val))
 * 
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_r_means, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1160; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_val, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1161
 *         for evt in arrv:
 *             val = r_means [evt.qid]
 *             lp.add_constraint ("s.t. slack1%d: r[%d] + slack1[%d] - slack2[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, val))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 5. slacks on tau
 */
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_12);
    __Pyx_GIVEREF(__pyx_t_12);
    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_t_11);
    __Pyx_GIVEREF(__pyx_t_11);
    __Pyx_INCREF(__pyx_v_val);
    PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_v_val);
    __Pyx_GIVEREF(__pyx_v_val);
    __pyx_t_10 = 0;
    __pyx_t_12 = 0;
    __pyx_t_2 = 0;
    __pyx_t_11 = 0;
    __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_s_t_slack1_d_r_d_slack1_d_slack2, __pyx_t_4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (!__pyx_t_4) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      __pyx_t_11 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1161; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":1159
 * 
 *         # Constraint 5. slacks on R
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             val = r_means [evt.qid]
 *             lp.add_constraint ("s.t. slack1%d: r[%d] + slack1[%d] - slack2[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, val))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1164
 * 
 *         # Constraint 5. slacks on tau
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if not evt.prev_byt:
 *                 lp.add_constraint ("s.t. slack_b%d: tau[%d] + slack3[%d] - slack4[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, tau_mean))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1165
 *         # Constraint 5. slacks on tau
 *         for evt in arrv:
 *             if not evt.prev_byt:             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. slack_b%d: tau[%d] + slack3[%d] - slack4[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, tau_mean))
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_9 = ((!__pyx_t_5) != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1166
 *         for evt in arrv:
 *             if not evt.prev_byt:
 *                 lp.add_constraint ("s.t. slack_b%d: tau[%d] + slack3[%d] - slack4[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, tau_mean))             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 4. Equality if event observed
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_10 = PyTuple_New(5); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_10, 3, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_12);
      __Pyx_INCREF(__pyx_v_tau_mean);
      PyTuple_SET_ITEM(__pyx_t_10, 4, __pyx_v_tau_mean);
      __Pyx_GIVEREF(__pyx_v_tau_mean);
      __pyx_t_2 = 0;
      __pyx_t_11 = 0;
      __pyx_t_4 = 0;
      __pyx_t_12 = 0;
      __pyx_t_12 = __Pyx_PyString_Format(__pyx_kp_s_s_t_slack_b_d_tau_d_slack3_d_sla, __pyx_t_10); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_10) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
        PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_t_12);
        __Pyx_GIVEREF(__pyx_t_12);
        __pyx_t_12 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L34;
    }
    __pyx_L34:;

    /* "qnet.pyx":1164
 * 
 *         # Constraint 5. slacks on tau
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if not evt.prev_byt:
 *                 lp.add_constraint ("s.t. slack_b%d: tau[%d] + slack3[%d] - slack4[%d] = %s;\n" % (evt.eid, evt.eid, evt.eid, evt.eid, tau_mean))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1169
 * 
 *         # Constraint 4. Equality if event observed
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if evt.obs_d:
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1170
 *         # Constraint 4. Equality if event observed
 *         for evt in arrv:
 *             if evt.obs_d:             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))
 *             if evt.obs_a:
 */
    __pyx_t_9 = (__pyx_v_evt->obs_d != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1171
 *         for evt in arrv:
 *             if evt.obs_d:
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))             # <<<<<<<<<<<<<<
 *             if evt.obs_a:
 *                 lp.add_constraint ("s.t. aobs_%d: a[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.a))
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_10 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_4 = 0;
      __pyx_t_12 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_s_t_dobs__d_d_d_17g, __pyx_t_11); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_10); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_12, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L37;
    }
    __pyx_L37:;

    /* "qnet.pyx":1172
 *             if evt.obs_d:
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))
 *             if evt.obs_a:             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. aobs_%d: a[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.a))
 * 
 */
    __pyx_t_9 = (__pyx_v_evt->obs_a != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1173
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))
 *             if evt.obs_a:
 *                 lp.add_constraint ("s.t. aobs_%d: a[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.a))             # <<<<<<<<<<<<<<
 * 
 *         return lp
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      __pyx_t_12 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_s_t_aobs__d_a_d_17g, __pyx_t_4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_4) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
        PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        __pyx_t_11 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L38;
    }
    __pyx_L38:;

    /* "qnet.pyx":1169
 * 
 *         # Constraint 4. Equality if event observed
 *         for evt in arrv:             # <<<<<<<<<<<<<<
 *             if evt.obs_d:
 *                 lp.add_constraint ("s.t. dobs_%d: d[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.d))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1175
 *                 lp.add_constraint ("s.t. aobs_%d: a[%d] = %.17g;\n" % (evt.eid, evt.eid, evt.a))
 * 
 *         return lp             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_lp);
  __pyx_r = __pyx_v_lp;
  goto __pyx_L0;

  /* "qnet.pyx":1095
 *     return qp
 * 
 * cdef setup_initialization_lp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *         lp = stupidlp.LP()
 *         r_means = compute_obs_means (arrv)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.setup_initialization_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_lp);
  __Pyx_XDECREF(__pyx_v_r_means);
  __Pyx_XDECREF(__pyx_v_tau_mean);
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XDECREF(__pyx_v_nt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_byq);
  __Pyx_XDECREF((PyObject *)__pyx_v_byt);
  __Pyx_XDECREF(__pyx_v_val);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1178
 * 
 * 
 * def compute_obs_means (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_21compute_obs_means(PyObject *__pyx_self, PyObject *__pyx_v_arrv); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_21compute_obs_means = {"compute_obs_means", (PyCFunction)__pyx_pw_4qnet_21compute_obs_means, METH_O, 0};
static PyObject *__pyx_pw_4qnet_21compute_obs_means(PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_obs_means (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_20compute_obs_means(__pyx_self, ((PyObject *)__pyx_v_arrv));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_20compute_obs_means(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_tots = NULL;
  PyObject *__pyx_v_Ns = NULL;
  Py_ssize_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("compute_obs_means", 0);

  /* "qnet.pyx":1180
 * def compute_obs_means (arrv):
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()             # <<<<<<<<<<<<<<
 *     Ns = [1] * arrv.num_queues()
 *     for evt in arrv:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_num_queues); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_float_1eneg_5);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_float_1eneg_5);
  __Pyx_GIVEREF(__pyx_float_1eneg_5);
  { PyObject* __pyx_temp = PyNumber_InPlaceMultiply(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_temp)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_temp);
    __Pyx_DECREF(__pyx_t_2);
    __pyx_t_2 = __pyx_temp;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_tots = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1181
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()
 *     Ns = [1] * arrv.num_queues()             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if evt.obs_d and evt.obs_a:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_num_queues); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_int_1);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  { PyObject* __pyx_temp = PyNumber_InPlaceMultiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_temp)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_temp);
    __Pyx_DECREF(__pyx_t_1);
    __pyx_t_1 = __pyx_temp;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_Ns = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1182
 *     tots = [1e-5] * arrv.num_queues()
 *     Ns = [1] * arrv.num_queues()
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d and evt.obs_a:
 *             tots[evt.qid] += (evt.d - evt.a)
 */
  if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
    __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1183
 *     Ns = [1] * arrv.num_queues()
 *     for evt in arrv:
 *         if evt.obs_d and evt.obs_a:             # <<<<<<<<<<<<<<
 *             tots[evt.qid] += (evt.d - evt.a)
 *             Ns[evt.qid] += 1
 */
    __pyx_t_7 = (__pyx_v_evt->obs_d != 0);
    if (__pyx_t_7) {
    } else {
      __pyx_t_6 = __pyx_t_7;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_7 = (__pyx_v_evt->obs_a != 0);
    __pyx_t_6 = __pyx_t_7;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_6) {

      /* "qnet.pyx":1184
 *     for evt in arrv:
 *         if evt.obs_d and evt.obs_a:
 *             tots[evt.qid] += (evt.d - evt.a)             # <<<<<<<<<<<<<<
 *             Ns[evt.qid] += 1
 *     for i in xrange(len(tots)):
 */
      __pyx_t_8 = __pyx_v_evt->qid;
      __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_tots, __pyx_t_8, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyFloat_FromDouble((__pyx_v_evt->d - __pyx_v_evt->a)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = PyNumber_InPlaceAdd(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(__Pyx_SetItemInt(__pyx_v_tots, __pyx_t_8, __pyx_t_9, int, 1, __Pyx_PyInt_From_int, 1, 1, 1) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "qnet.pyx":1185
 *         if evt.obs_d and evt.obs_a:
 *             tots[evt.qid] += (evt.d - evt.a)
 *             Ns[evt.qid] += 1             # <<<<<<<<<<<<<<
 *     for i in xrange(len(tots)):
 *         tots[i] = tots[i] / Ns[i]
 */
      __pyx_t_8 = __pyx_v_evt->qid;
      __pyx_t_9 = __Pyx_GetItemInt_List(__pyx_v_Ns, __pyx_t_8, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1185; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_t_9, __pyx_int_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(__Pyx_SetItemInt(__pyx_v_Ns, __pyx_t_8, __pyx_t_3, int, 1, __Pyx_PyInt_From_int, 1, 1, 1) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1182
 *     tots = [1e-5] * arrv.num_queues()
 *     Ns = [1] * arrv.num_queues()
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d and evt.obs_a:
 *             tots[evt.qid] += (evt.d - evt.a)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1186
 *             tots[evt.qid] += (evt.d - evt.a)
 *             Ns[evt.qid] += 1
 *     for i in xrange(len(tots)):             # <<<<<<<<<<<<<<
 *         tots[i] = tots[i] / Ns[i]
 *     return tots
 */
  __pyx_t_4 = PyList_GET_SIZE(__pyx_v_tots); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_4; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;

    /* "qnet.pyx":1187
 *             Ns[evt.qid] += 1
 *     for i in xrange(len(tots)):
 *         tots[i] = tots[i] / Ns[i]             # <<<<<<<<<<<<<<
 *     return tots
 * 
 */
    __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_tots, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_GetItemInt_List(__pyx_v_Ns, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(__Pyx_SetItemInt(__pyx_v_tots, __pyx_v_i, __pyx_t_9, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }

  /* "qnet.pyx":1188
 *     for i in xrange(len(tots)):
 *         tots[i] = tots[i] / Ns[i]
 *     return tots             # <<<<<<<<<<<<<<
 * 
 * def compute_obs_mean_ia (arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_tots);
  __pyx_r = __pyx_v_tots;
  goto __pyx_L0;

  /* "qnet.pyx":1178
 * 
 * 
 * def compute_obs_means (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.compute_obs_means", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_tots);
  __Pyx_XDECREF(__pyx_v_Ns);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1190
 *     return tots
 * 
 * def compute_obs_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     last_a = 0.
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_23compute_obs_mean_ia(PyObject *__pyx_self, PyObject *__pyx_v_arrv); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_23compute_obs_mean_ia = {"compute_obs_mean_ia", (PyCFunction)__pyx_pw_4qnet_23compute_obs_mean_ia, METH_O, 0};
static PyObject *__pyx_pw_4qnet_23compute_obs_mean_ia(PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_obs_mean_ia (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_22compute_obs_mean_ia(__pyx_self, ((PyObject *)__pyx_v_arrv));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_22compute_obs_mean_ia(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_last_a;
  PyObject *__pyx_v_N = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  double __pyx_t_7;
  double __pyx_t_8;
  double __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("compute_obs_mean_ia", 0);

  /* "qnet.pyx":1192
 * def compute_obs_mean_ia (arrv):
 *     cdef Event evt
 *     last_a = 0.             # <<<<<<<<<<<<<<
 *     N = 0
 *     for evt in arrv:
 */
  __pyx_v_last_a = 0.;

  /* "qnet.pyx":1193
 *     cdef Event evt
 *     last_a = 0.
 *     N = 0             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if not evt.prev_byt:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_N = __pyx_int_0;

  /* "qnet.pyx":1194
 *     last_a = 0.
 *     N = 0
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if not evt.prev_byt:
 *             if evt.obs_a:
 */
  if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
    __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1195
 *     N = 0
 *     for evt in arrv:
 *         if not evt.prev_byt:             # <<<<<<<<<<<<<<
 *             if evt.obs_a:
 *                 last_a = max (last_a, evt.d)
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_6 = ((!__pyx_t_5) != 0);
    if (__pyx_t_6) {

      /* "qnet.pyx":1196
 *     for evt in arrv:
 *         if not evt.prev_byt:
 *             if evt.obs_a:             # <<<<<<<<<<<<<<
 *                 last_a = max (last_a, evt.d)
 *                 N = N + 1
 */
      __pyx_t_6 = (__pyx_v_evt->obs_a != 0);
      if (__pyx_t_6) {

        /* "qnet.pyx":1197
 *         if not evt.prev_byt:
 *             if evt.obs_a:
 *                 last_a = max (last_a, evt.d)             # <<<<<<<<<<<<<<
 *                 N = N + 1
 *     if N > 0:
 */
        __pyx_t_7 = __pyx_v_evt->d;
        __pyx_t_8 = __pyx_v_last_a;
        if (((__pyx_t_7 > __pyx_t_8) != 0)) {
          __pyx_t_9 = __pyx_t_7;
        } else {
          __pyx_t_9 = __pyx_t_8;
        }
        __pyx_v_last_a = __pyx_t_9;

        /* "qnet.pyx":1198
 *             if evt.obs_a:
 *                 last_a = max (last_a, evt.d)
 *                 N = N + 1             # <<<<<<<<<<<<<<
 *     if N > 0:
 *         return last_a / N
 */
        __pyx_t_4 = PyNumber_Add(__pyx_v_N, __pyx_int_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF_SET(__pyx_v_N, __pyx_t_4);
        __pyx_t_4 = 0;
        goto __pyx_L6;
      }
      __pyx_L6:;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1194
 *     last_a = 0.
 *     N = 0
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if not evt.prev_byt:
 *             if evt.obs_a:
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1199
 *                 last_a = max (last_a, evt.d)
 *                 N = N + 1
 *     if N > 0:             # <<<<<<<<<<<<<<
 *         return last_a / N
 *     else: return 0
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_N, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "qnet.pyx":1200
 *                 N = N + 1
 *     if N > 0:
 *         return last_a / N             # <<<<<<<<<<<<<<
 *     else: return 0
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_last_a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_v_N); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
  /*else*/ {

    /* "qnet.pyx":1201
 *     if N > 0:
 *         return last_a / N
 *     else: return 0             # <<<<<<<<<<<<<<
 * 
 * def compute_mean_ia (arrv):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_int_0);
    __pyx_r = __pyx_int_0;
    goto __pyx_L0;
  }

  /* "qnet.pyx":1190
 *     return tots
 * 
 * def compute_obs_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     last_a = 0.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.compute_obs_mean_ia", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_N);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1203
 *     else: return 0
 * 
 * def compute_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     times = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_25compute_mean_ia(PyObject *__pyx_self, PyObject *__pyx_v_arrv); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_25compute_mean_ia = {"compute_mean_ia", (PyCFunction)__pyx_pw_4qnet_25compute_mean_ia, METH_O, 0};
static PyObject *__pyx_pw_4qnet_25compute_mean_ia(PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_mean_ia (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_24compute_mean_ia(__pyx_self, ((PyObject *)__pyx_v_arrv));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_24compute_mean_ia(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_times = NULL;
  PyObject *__pyx_v_time_next = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("compute_mean_ia", 0);

  /* "qnet.pyx":1205
 * def compute_mean_ia (arrv):
 *     cdef Event evt
 *     times = []             # <<<<<<<<<<<<<<
 *     for evt in arrv.initial_events():
 *         if evt.next_byq:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_times = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1206
 *     cdef Event evt
 *     times = []
 *     for evt in arrv.initial_events():             # <<<<<<<<<<<<<<
 *         if evt.next_byq:
 *             time_next = evt.next_byq.d - evt.d
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_initial_events); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":1207
 *     times = []
 *     for evt in arrv.initial_events():
 *         if evt.next_byq:             # <<<<<<<<<<<<<<
 *             time_next = evt.next_byq.d - evt.d
 *             if time_next >= 0:   # zeroing out unobserved event can do this
 */
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_6) {

      /* "qnet.pyx":1208
 *     for evt in arrv.initial_events():
 *         if evt.next_byq:
 *             time_next = evt.next_byq.d - evt.d             # <<<<<<<<<<<<<<
 *             if time_next >= 0:   # zeroing out unobserved event can do this
 *                 times.append (time_next)
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->next_byq, __pyx_n_s_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = PyNumber_Subtract(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_time_next, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "qnet.pyx":1209
 *         if evt.next_byq:
 *             time_next = evt.next_byq.d - evt.d
 *             if time_next >= 0:   # zeroing out unobserved event can do this             # <<<<<<<<<<<<<<
 *                 times.append (time_next)
 *     return numpy.mean (times)
 */
      __pyx_t_7 = PyObject_RichCompare(__pyx_v_time_next, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_6) {

        /* "qnet.pyx":1210
 *             time_next = evt.next_byq.d - evt.d
 *             if time_next >= 0:   # zeroing out unobserved event can do this
 *                 times.append (time_next)             # <<<<<<<<<<<<<<
 *     return numpy.mean (times)
 * 
 */
        __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_times, __pyx_v_time_next); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        goto __pyx_L6;
      }
      __pyx_L6:;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1206
 *     cdef Event evt
 *     times = []
 *     for evt in arrv.initial_events():             # <<<<<<<<<<<<<<
 *         if evt.next_byq:
 *             time_next = evt.next_byq.d - evt.d
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1211
 *             if time_next >= 0:   # zeroing out unobserved event can do this
 *                 times.append (time_next)
 *     return numpy.mean (times)             # <<<<<<<<<<<<<<
 * 
 * def sorted_uniforms (n, L, U):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_mean); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_times); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
  } else {
    __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    __Pyx_INCREF(__pyx_v_times);
    PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_times);
    __Pyx_GIVEREF(__pyx_v_times);
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1203
 *     else: return 0
 * 
 * def compute_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     times = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.compute_mean_ia", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_times);
  __Pyx_XDECREF(__pyx_v_time_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1213
 *     return numpy.mean (times)
 * 
 * def sorted_uniforms (n, L, U):             # <<<<<<<<<<<<<<
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_27sorted_uniforms(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_27sorted_uniforms = {"sorted_uniforms", (PyCFunction)__pyx_pw_4qnet_27sorted_uniforms, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_27sorted_uniforms(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_n = 0;
  PyObject *__pyx_v_L = 0;
  PyObject *__pyx_v_U = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sorted_uniforms (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_n,&__pyx_n_s_L,&__pyx_n_s_U,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_n)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_L)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("sorted_uniforms", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_U)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("sorted_uniforms", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sorted_uniforms") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_n = values[0];
    __pyx_v_L = values[1];
    __pyx_v_U = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("sorted_uniforms", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.sorted_uniforms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_26sorted_uniforms(__pyx_self, __pyx_v_n, __pyx_v_L, __pyx_v_U);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_26sorted_uniforms(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_n, PyObject *__pyx_v_L, PyObject *__pyx_v_U) {
  PyObject *__pyx_v_l = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  double __pyx_t_6;
  double __pyx_t_7;
  int __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sorted_uniforms", 0);

  /* "qnet.pyx":1214
 * 
 * def sorted_uniforms (n, L, U):
 *     l = [ uniform(L,U) for i in xrange (n) ]             # <<<<<<<<<<<<<<
 *     l.sort()
 *     return l
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_n);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_n);
  __Pyx_GIVEREF(__pyx_v_n);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_v_L); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_v_U); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = PyFloat_FromDouble(__pyx_f_8sampling_uniform(__pyx_t_6, __pyx_t_7)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_3))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_l = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1215
 * def sorted_uniforms (n, L, U):
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()             # <<<<<<<<<<<<<<
 *     return l
 * 
 */
  __pyx_t_8 = PyList_Sort(__pyx_v_l); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1216
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()
 *     return l             # <<<<<<<<<<<<<<
 * 
 * def setup_minilp (Arrivals arrv, reg):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_l);
  __pyx_r = __pyx_v_l;
  goto __pyx_L0;

  /* "qnet.pyx":1213
 *     return numpy.mean (times)
 * 
 * def sorted_uniforms (n, L, U):             # <<<<<<<<<<<<<<
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.sorted_uniforms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_l);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1218
 *     return l
 * 
 * def setup_minilp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_29setup_minilp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_29setup_minilp = {"setup_minilp", (PyCFunction)__pyx_pw_4qnet_29setup_minilp, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_29setup_minilp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  PyObject *__pyx_v_reg = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("setup_minilp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_reg,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_reg)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("setup_minilp", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "setup_minilp") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[0]);
    __pyx_v_reg = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("setup_minilp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.setup_minilp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_28setup_minilp(__pyx_self, __pyx_v_arrv, __pyx_v_reg);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_28setup_minilp(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_reg) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_lp = NULL;
  PyObject *__pyx_v_ne = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_nt = NULL;
  PyObject *__pyx_v_byt = NULL;
  PyObject *__pyx_v_byq = NULL;
  PyObject *__pyx_v_order = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("setup_minilp", 0);

  /* "qnet.pyx":1221
 *     cdef Event evt
 * 
 *     lp = stupidlp.LP()             # <<<<<<<<<<<<<<
 * 
 *     ne = arrv.max_eidx()
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_stupidlp); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_LP); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_lp = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1223
 *     lp = stupidlp.LP()
 * 
 *     ne = arrv.max_eidx()             # <<<<<<<<<<<<<<
 *     nt = arrv.num_tasks()
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_ne = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1224
 * 
 *     ne = arrv.max_eidx()
 *     nt = arrv.num_tasks()             # <<<<<<<<<<<<<<
 * 
 *     lp.add_vars ("set E := 0 .. %d;\n" % ne)
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_num_tasks); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_nt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1226
 *     nt = arrv.num_tasks()
 * 
 *     lp.add_vars ("set E := 0 .. %d;\n" % ne)             # <<<<<<<<<<<<<<
 * 
 *     lp.add_vars ("var d{i in E} >= 0;")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_set_E_0_d, __pyx_v_ne); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1228
 *     lp.add_vars ("set E := 0 .. %d;\n" % ne)
 * 
 *     lp.add_vars ("var d{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *     lp.add_vars ("var a{i in E} >= 0;")
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1229
 * 
 *     lp.add_vars ("var d{i in E} >= 0;")
 *     lp.add_vars ("var a{i in E} >= 0;")             # <<<<<<<<<<<<<<
 * 
 *     lp.set_objective ("minimize cost: 0;\n")
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_vars); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1231
 *     lp.add_vars ("var a{i in E} >= 0;")
 * 
 *     lp.set_objective ("minimize cost: 0;\n")             # <<<<<<<<<<<<<<
 * 
 *     # Constraint 1. d_e > a_e
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_set_objective); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1234
 * 
 *     # Constraint 1. d_e > a_e
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if (not evt.obs_a) or (not evt.obs_d):
 *             lp.add_constraint ("s.t. d_ge_a%d: %s - %s >= %s;\n" % (evt.eid, dstr(evt), astr(evt), reg))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":1235
 *     # Constraint 1. d_e > a_e
 *     for evt in arrv:
 *         if (not evt.obs_a) or (not evt.obs_d):             # <<<<<<<<<<<<<<
 *             lp.add_constraint ("s.t. d_ge_a%d: %s - %s >= %s;\n" % (evt.eid, dstr(evt), astr(evt), reg))
 *             print "s.t. d_ge_a%d: %s - %s >= %s;" % (evt.eid, dstr(evt), astr(evt), reg)
 */
    __pyx_t_9 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
    if (!__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_9 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_8) {

      /* "qnet.pyx":1236
 *     for evt in arrv:
 *         if (not evt.obs_a) or (not evt.obs_d):
 *             lp.add_constraint ("s.t. d_ge_a%d: %s - %s >= %s;\n" % (evt.eid, dstr(evt), astr(evt), reg))             # <<<<<<<<<<<<<<
 *             print "s.t. d_ge_a%d: %s - %s >= %s;" % (evt.eid, dstr(evt), astr(evt), reg)
 * 
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = __Pyx_GetModuleGlobalName(__pyx_n_s_dstr); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_12 = __Pyx_GetModuleGlobalName(__pyx_n_s_astr); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_12, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
      } else {
        __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_13);
        PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_13, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_13, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = PyTuple_New(4); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_v_reg);
      PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_v_reg);
      __Pyx_GIVEREF(__pyx_v_reg);
      __pyx_t_2 = 0;
      __pyx_t_4 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_s_t_d_ge_a_d_s_s_s, __pyx_t_12); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_12)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_12);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_12) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_10); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
        PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "qnet.pyx":1237
 *         if (not evt.obs_a) or (not evt.obs_d):
 *             lp.add_constraint ("s.t. d_ge_a%d: %s - %s >= %s;\n" % (evt.eid, dstr(evt), astr(evt), reg))
 *             print "s.t. d_ge_a%d: %s - %s >= %s;" % (evt.eid, dstr(evt), astr(evt), reg)             # <<<<<<<<<<<<<<
 * 
 *     # Constraint 2. d_pi(e) = a_e
 */
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_dstr); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      if (!__pyx_t_10) {
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
      } else {
        __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_12, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_12 = __Pyx_GetModuleGlobalName(__pyx_n_s_astr); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_10 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      if (!__pyx_t_10) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
      } else {
        __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_2, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_12 = PyTuple_New(4); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_reg);
      PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_v_reg);
      __Pyx_GIVEREF(__pyx_v_reg);
      __pyx_t_1 = 0;
      __pyx_t_5 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_s_t_d_ge_a_d_s_s_s_2, __pyx_t_12); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      if (__Pyx_PrintOne(0, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1237; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1234
 * 
 *     # Constraint 1. d_e > a_e
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if (not evt.obs_a) or (not evt.obs_d):
 *             lp.add_constraint ("s.t. d_ge_a%d: %s - %s >= %s;\n" % (evt.eid, dstr(evt), astr(evt), reg))
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1240
 * 
 *     # Constraint 2. d_pi(e) = a_e
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1240; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1241
 *     # Constraint 2. d_pi(e) = a_e
 *     for evt in arrv:
 *         byt = evt.prev_byt             # <<<<<<<<<<<<<<
 *         if byt:
 *             if (not evt.prev_byt.obs_d) or (not evt.obs_a):
 */
    __pyx_t_4 = __pyx_v_evt->prev_byt;
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_byt, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1242
 *     for evt in arrv:
 *         byt = evt.prev_byt
 *         if byt:             # <<<<<<<<<<<<<<
 *             if (not evt.prev_byt.obs_d) or (not evt.obs_a):
 *                 lp.add_constraint ("s.t. a_pi%d: %s = %s;\n" % (evt.eid, dstr(byt), astr(evt)))
 */
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_byt); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_8) {

      /* "qnet.pyx":1243
 *         byt = evt.prev_byt
 *         if byt:
 *             if (not evt.prev_byt.obs_d) or (not evt.obs_a):             # <<<<<<<<<<<<<<
 *                 lp.add_constraint ("s.t. a_pi%d: %s = %s;\n" % (evt.eid, dstr(byt), astr(evt)))
 * 
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->prev_byt, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_14 = ((!__pyx_t_9) != 0);
      if (!__pyx_t_14) {
      } else {
        __pyx_t_8 = __pyx_t_14;
        goto __pyx_L12_bool_binop_done;
      }
      __pyx_t_14 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
      __pyx_t_8 = __pyx_t_14;
      __pyx_L12_bool_binop_done:;
      if (__pyx_t_8) {

        /* "qnet.pyx":1244
 *         if byt:
 *             if (not evt.prev_byt.obs_d) or (not evt.obs_a):
 *                 lp.add_constraint ("s.t. a_pi%d: %s = %s;\n" % (evt.eid, dstr(byt), astr(evt)))             # <<<<<<<<<<<<<<
 * 
 *     # Constraint 3. Initial Queue
 */
        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_dstr); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_10 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_10) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_byt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_13);
          PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
          __Pyx_INCREF(__pyx_v_byt);
          PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_v_byt);
          __Pyx_GIVEREF(__pyx_v_byt);
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_13, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_13 = __Pyx_GetModuleGlobalName(__pyx_n_s_astr); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_13);
        __pyx_t_10 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_13))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_13);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_13, function);
          }
        }
        if (!__pyx_t_10) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_13, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_11, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        }
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = PyTuple_New(3); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_13);
        PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_13, 2, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_5 = 0;
        __pyx_t_1 = 0;
        __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_s_t_a_pi_d_s_s, __pyx_t_13); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_t_13 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_12, function);
          }
        }
        if (!__pyx_t_13) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
          PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          __pyx_t_2 = 0;
          __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        }
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        goto __pyx_L11;
      }
      __pyx_L11:;
      goto __pyx_L10;
    }
    __pyx_L10:;

    /* "qnet.pyx":1240
 * 
 *     # Constraint 2. d_pi(e) = a_e
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1247
 * 
 *     # Constraint 3. Initial Queue
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt is None and not evt.obs_a:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1248
 *     # Constraint 3. Initial Queue
 *     for evt in arrv:
 *         byt = evt.prev_byt             # <<<<<<<<<<<<<<
 *         if byt is None and not evt.obs_a:
 *             lp.add_constraint ("s.t. a_ini%d: a[%d] = 0;\n" % (evt.eid, evt.eid))
 */
    __pyx_t_4 = __pyx_v_evt->prev_byt;
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_byt, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1249
 *     for evt in arrv:
 *         byt = evt.prev_byt
 *         if byt is None and not evt.obs_a:             # <<<<<<<<<<<<<<
 *             lp.add_constraint ("s.t. a_ini%d: a[%d] = 0;\n" % (evt.eid, evt.eid))
 * 
 */
    __pyx_t_14 = (__pyx_v_byt == Py_None);
    __pyx_t_9 = (__pyx_t_14 != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L17_bool_binop_done;
    }
    __pyx_t_9 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L17_bool_binop_done:;
    if (__pyx_t_8) {

      /* "qnet.pyx":1250
 *         byt = evt.prev_byt
 *         if byt is None and not evt.obs_a:
 *             lp.add_constraint ("s.t. a_ini%d: a[%d] = 0;\n" % (evt.eid, evt.eid))             # <<<<<<<<<<<<<<
 * 
 *     # Constraint 4: ORDER
 */
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_13);
      PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_s_t_a_ini_d_a_d_0, __pyx_t_13); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      __pyx_t_13 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      if (!__pyx_t_13) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_GOTREF(__pyx_t_4);
      } else {
        __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
        PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L16;
    }
    __pyx_L16:;

    /* "qnet.pyx":1247
 * 
 *     # Constraint 3. Initial Queue
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt is None and not evt.obs_a:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1253
 * 
 *     # Constraint 4: ORDER
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byq = evt.prev_byq
 *         if byq is not None:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1254
 *     # Constraint 4: ORDER
 *     for evt in arrv:
 *         byq = evt.prev_byq             # <<<<<<<<<<<<<<
 *         if byq is not None:
 *             order = evt.q.queue_order()
 */
    __pyx_t_4 = __pyx_v_evt->prev_byq;
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_byq, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1255
 *     for evt in arrv:
 *         byq = evt.prev_byq
 *         if byq is not None:             # <<<<<<<<<<<<<<
 *             order = evt.q.queue_order()
 *             if order == arrivals.ARRV_BY_A:
 */
    __pyx_t_8 = (__pyx_v_byq != Py_None);
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1256
 *         byq = evt.prev_byq
 *         if byq is not None:
 *             order = evt.q.queue_order()             # <<<<<<<<<<<<<<
 *             if order == arrivals.ARRV_BY_A:
 *                 if (not evt.obs_a) or (not byq.obs_a):
 */
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_queue_order); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_1 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      if (__pyx_t_1) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_12); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_XDECREF_SET(__pyx_v_order, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "qnet.pyx":1257
 *         if byq is not None:
 *             order = evt.q.queue_order()
 *             if order == arrivals.ARRV_BY_A:             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, astr(evt), astr(byq)))
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_arrivals); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ARRV_BY_A); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_order, __pyx_t_12, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_9) {

        /* "qnet.pyx":1258
 *             order = evt.q.queue_order()
 *             if order == arrivals.ARRV_BY_A:
 *                 if (not evt.obs_a) or (not byq.obs_a):             # <<<<<<<<<<<<<<
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, astr(evt), astr(byq)))
 *             elif order == arrivals.ARRV_BY_D:
 */
        __pyx_t_8 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
        if (!__pyx_t_8) {
        } else {
          __pyx_t_9 = __pyx_t_8;
          goto __pyx_L24_bool_binop_done;
        }
        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_byq, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_14 = ((!__pyx_t_8) != 0);
        __pyx_t_9 = __pyx_t_14;
        __pyx_L24_bool_binop_done:;
        if (__pyx_t_9) {

          /* "qnet.pyx":1259
 *             if order == arrivals.ARRV_BY_A:
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, astr(evt), astr(byq)))             # <<<<<<<<<<<<<<
 *             elif order == arrivals.ARRV_BY_D:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 */
          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_13 = __Pyx_GetModuleGlobalName(__pyx_n_s_astr); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_13);
          __pyx_t_5 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_13))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_13);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_13, function);
            }
          }
          if (!__pyx_t_5) {
            __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_13, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_2);
          } else {
            __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_11);
            PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_evt));
            PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_11, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          }
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_11 = __Pyx_GetModuleGlobalName(__pyx_n_s_astr); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_5 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_11))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_11);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_11, function);
            }
          }
          if (!__pyx_t_5) {
            __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_byq); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_13);
          } else {
            __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_10);
            PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
            __Pyx_INCREF(__pyx_v_byq);
            PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_v_byq);
            __Pyx_GIVEREF(__pyx_v_byq);
            __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_10, NULL); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_13);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          }
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_13);
          __Pyx_GIVEREF(__pyx_t_13);
          __pyx_t_1 = 0;
          __pyx_t_2 = 0;
          __pyx_t_13 = 0;
          __pyx_t_13 = __Pyx_PyString_Format(__pyx_kp_s_s_t_order_d_s_s, __pyx_t_11); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_13);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_11 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
            __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
            if (likely(__pyx_t_11)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
              __Pyx_INCREF(__pyx_t_11);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_12, function);
            }
          }
          if (!__pyx_t_11) {
            __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else {
            __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_2);
            PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
            PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_t_13);
            __Pyx_GIVEREF(__pyx_t_13);
            __pyx_t_13 = 0;
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          }
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L23;
        }
        __pyx_L23:;
        goto __pyx_L22;
      }

      /* "qnet.pyx":1260
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, astr(evt), astr(byq)))
 *             elif order == arrivals.ARRV_BY_D:             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, dstr(evt), dstr(byq)))
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_arrivals); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ARRV_BY_D); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_order, __pyx_t_12, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_9) {

        /* "qnet.pyx":1261
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, astr(evt), astr(byq)))
 *             elif order == arrivals.ARRV_BY_D:
 *                 if (not evt.obs_d) or (not byq.obs_d):             # <<<<<<<<<<<<<<
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, dstr(evt), dstr(byq)))
 *             else:
 */
        __pyx_t_14 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
        if (!__pyx_t_14) {
        } else {
          __pyx_t_9 = __pyx_t_14;
          goto __pyx_L27_bool_binop_done;
        }
        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_byq, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_14 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_8 = ((!__pyx_t_14) != 0);
        __pyx_t_9 = __pyx_t_8;
        __pyx_L27_bool_binop_done:;
        if (__pyx_t_9) {

          /* "qnet.pyx":1262
 *             elif order == arrivals.ARRV_BY_D:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, dstr(evt), dstr(byq)))             # <<<<<<<<<<<<<<
 *             else:
 *                 raise Exception ("Huh? Unknown queue order %d" % order)
 */
          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_add_constraint); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_11 = __Pyx_GetModuleGlobalName(__pyx_n_s_dstr); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_11))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_11);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_11, function);
            }
          }
          if (!__pyx_t_1) {
            __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_t_11, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_13);
          } else {
            __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_10);
            PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_evt));
            PyTuple_SET_ITEM(__pyx_t_10, 0+1, ((PyObject *)__pyx_v_evt));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
            __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_10, NULL); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_13);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          }
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_10 = __Pyx_GetModuleGlobalName(__pyx_n_s_dstr); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          if (!__pyx_t_1) {
            __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_v_byq); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_11);
          } else {
            __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_5);
            PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
            __Pyx_INCREF(__pyx_v_byq);
            PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_v_byq);
            __Pyx_GIVEREF(__pyx_v_byq);
            __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_5, NULL); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_11);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          }
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2);
          __Pyx_GIVEREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_13);
          __Pyx_GIVEREF(__pyx_t_13);
          PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_11);
          __Pyx_GIVEREF(__pyx_t_11);
          __pyx_t_2 = 0;
          __pyx_t_13 = 0;
          __pyx_t_11 = 0;
          __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_s_t_order_d_s_s, __pyx_t_10); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_12);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_12, function);
            }
          }
          if (!__pyx_t_10) {
            __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_11); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else {
            __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_13);
            PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
            PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_t_11);
            __Pyx_GIVEREF(__pyx_t_11);
            __pyx_t_11 = 0;
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          }
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          goto __pyx_L26;
        }
        __pyx_L26:;
        goto __pyx_L22;
      }
      /*else*/ {

        /* "qnet.pyx":1264
 *                     lp.add_constraint ("s.t. order%d: %s >= %s;\n" % (evt.eid, dstr(evt), dstr(byq)))
 *             else:
 *                 raise Exception ("Huh? Unknown queue order %d" % order)             # <<<<<<<<<<<<<<
 * 
 *     return lp
 */
        __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Huh_Unknown_queue_order_d, __pyx_v_order); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_12 = PyTuple_New(1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_Exception, __pyx_t_12, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_Raise(__pyx_t_4, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __pyx_L22:;
      goto __pyx_L21;
    }
    __pyx_L21:;

    /* "qnet.pyx":1253
 * 
 *     # Constraint 4: ORDER
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byq = evt.prev_byq
 *         if byq is not None:
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1266
 *                 raise Exception ("Huh? Unknown queue order %d" % order)
 * 
 *     return lp             # <<<<<<<<<<<<<<
 * 
 * def astr (evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_lp);
  __pyx_r = __pyx_v_lp;
  goto __pyx_L0;

  /* "qnet.pyx":1218
 *     return l
 * 
 * def setup_minilp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("qnet.setup_minilp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_lp);
  __Pyx_XDECREF(__pyx_v_ne);
  __Pyx_XDECREF(__pyx_v_nt);
  __Pyx_XDECREF(__pyx_v_byt);
  __Pyx_XDECREF(__pyx_v_byq);
  __Pyx_XDECREF(__pyx_v_order);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1268
 *     return lp
 * 
 * def astr (evt):             # <<<<<<<<<<<<<<
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_31astr(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_31astr = {"astr", (PyCFunction)__pyx_pw_4qnet_31astr, METH_O, 0};
static PyObject *__pyx_pw_4qnet_31astr(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("astr (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_30astr(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_30astr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("astr", 0);

  /* "qnet.pyx":1269
 * 
 * def astr (evt):
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a             # <<<<<<<<<<<<<<
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (((!__pyx_t_3) != 0)) {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_a_d, __pyx_t_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __pyx_t_4;
    __pyx_t_4 = 0;
  } else {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_10f, __pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1268
 *     return lp
 * 
 * def astr (evt):             # <<<<<<<<<<<<<<
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.astr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1270
 * def astr (evt):
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):             # <<<<<<<<<<<<<<
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_33dstr(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_33dstr = {"dstr", (PyCFunction)__pyx_pw_4qnet_33dstr, METH_O, 0};
static PyObject *__pyx_pw_4qnet_33dstr(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("dstr (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_32dstr(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_32dstr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("dstr", 0);

  /* "qnet.pyx":1271
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d             # <<<<<<<<<<<<<<
 * def compactify_soln (arrv, soln):
 *     for evt in arrv:
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (((!__pyx_t_3) != 0)) {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_d_d, __pyx_t_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = __pyx_t_4;
    __pyx_t_4 = 0;
  } else {
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_10f, __pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1270
 * def astr (evt):
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):             # <<<<<<<<<<<<<<
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.dstr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1272
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_35compactify_soln(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_35compactify_soln = {"compactify_soln", (PyCFunction)__pyx_pw_4qnet_35compactify_soln, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_35compactify_soln(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_arrv = 0;
  PyObject *__pyx_v_soln = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compactify_soln (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_soln,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_soln)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("compactify_soln", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compactify_soln") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_arrv = values[0];
    __pyx_v_soln = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compactify_soln", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.compactify_soln", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_34compactify_soln(__pyx_self, __pyx_v_arrv, __pyx_v_soln);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_34compactify_soln(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv, PyObject *__pyx_v_soln) {
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("compactify_soln", 0);

  /* "qnet.pyx":1273
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d
 */
  if (likely(PyList_CheckExact(__pyx_v_arrv)) || PyTuple_CheckExact(__pyx_v_arrv)) {
    __pyx_t_1 = __pyx_v_arrv; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1274
 * def compactify_soln (arrv, soln):
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a             # <<<<<<<<<<<<<<
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_a_d, __pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(PyObject_SetItem(__pyx_v_soln, __pyx_t_7, __pyx_t_4) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1275
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d             # <<<<<<<<<<<<<<
 * 
 * cdef format_six (Event evt):
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_5) {
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_d_d, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(PyObject_SetItem(__pyx_v_soln, __pyx_t_6, __pyx_t_4) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1273
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1272
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.compactify_soln", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1277
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d
 * 
 * cdef format_six (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byt, byq, byt_minus1, byt_plus1, next_byq
 *     byq = evt.prev_byq
 */

static PyObject *__pyx_f_4qnet_format_six(struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_byt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byq = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byt_minus1 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byt_plus1 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_next_byq = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("format_six", 0);

  /* "qnet.pyx":1279
 * cdef format_six (Event evt):
 *     cdef Event byt, byq, byt_minus1, byt_plus1, next_byq
 *     byq = evt.prev_byq             # <<<<<<<<<<<<<<
 *     byt = evt.next_byt
 *     byt_minus1 = byt.prev_byq if byt else None
 */
  if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt->prev_byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_byq = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1280
 *     cdef Event byt, byq, byt_minus1, byt_plus1, next_byq
 *     byq = evt.prev_byq
 *     byt = evt.next_byt             # <<<<<<<<<<<<<<
 *     byt_minus1 = byt.prev_byq if byt else None
 *     byt_plus1 = byt.next_byq if byt else None
 */
  if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt->next_byt;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_byt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1281
 *     byq = evt.prev_byq
 *     byt = evt.next_byt
 *     byt_minus1 = byt.prev_byq if byt else None             # <<<<<<<<<<<<<<
 *     byt_plus1 = byt.next_byq if byt else None
 *     next_byq = evt.next_byq
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byt)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {
    if (!(likely(((__pyx_v_byt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_byt->prev_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_INCREF(__pyx_v_byt->prev_byq);
    __pyx_t_1 = __pyx_v_byt->prev_byq;
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_1 = Py_None;
  }
  __pyx_v_byt_minus1 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1282
 *     byt = evt.next_byt
 *     byt_minus1 = byt.prev_byq if byt else None
 *     byt_plus1 = byt.next_byq if byt else None             # <<<<<<<<<<<<<<
 *     next_byq = evt.next_byq
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byt)); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_2) {
    if (!(likely(((__pyx_v_byt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_byt->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_INCREF(__pyx_v_byt->next_byq);
    __pyx_t_1 = __pyx_v_byt->next_byq;
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_1 = Py_None;
  }
  __pyx_v_byt_plus1 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1283
 *     byt_minus1 = byt.prev_byq if byt else None
 *     byt_plus1 = byt.next_byq if byt else None
 *     next_byq = evt.next_byq             # <<<<<<<<<<<<<<
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 * 
 */
  if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt->next_byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_next_byq = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1284
 *     byt_plus1 = byt.next_byq if byt else None
 *     next_byq = evt.next_byq
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)             # <<<<<<<<<<<<<<
 * 
 * def _compute_task_order (Event evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_byq));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_byq));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_byq));
  __Pyx_INCREF(((PyObject *)__pyx_v_byt_minus1));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_byt_minus1));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_byt_minus1));
  __Pyx_INCREF(((PyObject *)__pyx_v_evt));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_evt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
  __Pyx_INCREF(((PyObject *)__pyx_v_byt));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_v_byt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_byt));
  __Pyx_INCREF(((PyObject *)__pyx_v_next_byq));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_v_next_byq));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_next_byq));
  __Pyx_INCREF(((PyObject *)__pyx_v_byt_plus1));
  PyTuple_SET_ITEM(__pyx_t_1, 5, ((PyObject *)__pyx_v_byt_plus1));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_byt_plus1));
  __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_75s_s_75s_s_75s_s, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1284; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1277
 *         if evt.obs_d: soln["d[%d]" % evt.eid] = evt.d
 * 
 * cdef format_six (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byt, byq, byt_minus1, byt_plus1, next_byq
 *     byq = evt.prev_byq
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("qnet.format_six", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_byt);
  __Pyx_XDECREF((PyObject *)__pyx_v_byq);
  __Pyx_XDECREF((PyObject *)__pyx_v_byt_minus1);
  __Pyx_XDECREF((PyObject *)__pyx_v_byt_plus1);
  __Pyx_XDECREF((PyObject *)__pyx_v_next_byq);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1286
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 * 
 * def _compute_task_order (Event evt):             # <<<<<<<<<<<<<<
 *     i = 0
 *     while evt.prev_byt:
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_37_compute_task_order(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_37_compute_task_order = {"_compute_task_order", (PyCFunction)__pyx_pw_4qnet_37_compute_task_order, METH_O, 0};
static PyObject *__pyx_pw_4qnet_37_compute_task_order(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_compute_task_order (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_36_compute_task_order(__pyx_self, ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_36_compute_task_order(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_compute_task_order", 0);
  __Pyx_INCREF((PyObject *)__pyx_v_evt);

  /* "qnet.pyx":1287
 * 
 * def _compute_task_order (Event evt):
 *     i = 0             # <<<<<<<<<<<<<<
 *     while evt.prev_byt:
 *         evt = evt.prev_byt
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_i = __pyx_int_0;

  /* "qnet.pyx":1288
 * def _compute_task_order (Event evt):
 *     i = 0
 *     while evt.prev_byt:             # <<<<<<<<<<<<<<
 *         evt = evt.prev_byt
 *         i = i + 1
 */
  while (1) {
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_1) break;

    /* "qnet.pyx":1289
 *     i = 0
 *     while evt.prev_byt:
 *         evt = evt.prev_byt             # <<<<<<<<<<<<<<
 *         i = i + 1
 *     return i
 */
    if (!(likely(((__pyx_v_evt->prev_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __pyx_v_evt->prev_byt;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1290
 *     while evt.prev_byt:
 *         evt = evt.prev_byt
 *         i = i + 1             # <<<<<<<<<<<<<<
 *     return i
 * 
 */
    __pyx_t_2 = PyNumber_Add(__pyx_v_i, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_2 = 0;
  }

  /* "qnet.pyx":1291
 *         evt = evt.prev_byt
 *         i = i + 1
 *     return i             # <<<<<<<<<<<<<<
 * 
 * cdef double call_sampler (Pwfun fn, double x_initial) except *:
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_i);
  __pyx_r = __pyx_v_i;
  goto __pyx_L0;

  /* "qnet.pyx":1286
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 * 
 * def _compute_task_order (Event evt):             # <<<<<<<<<<<<<<
 *     i = 0
 *     while evt.prev_byt:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("qnet._compute_task_order", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1293
 *     return i
 * 
 * cdef double call_sampler (Pwfun fn, double x_initial) except *:             # <<<<<<<<<<<<<<
 *     if sampler == ARS_PWFUN:
 *         return sampling.arms_pwfun (fn, x_initial)
 */

static double __pyx_f_4qnet_call_sampler(struct __pyx_obj_5pwfun_Pwfun *__pyx_v_fn, double __pyx_v_x_initial) {
  double __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  double __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("call_sampler", 0);

  /* "qnet.pyx":1300
 *     elif sampler == SLICE:
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)
 *     elif sampler == STUPID_REJECT:             # <<<<<<<<<<<<<<
 *         return sampling.rejection (fn)
 * 
 */
  switch (__pyx_v_4qnet_sampler) {

    /* "qnet.pyx":1294
 * 
 * cdef double call_sampler (Pwfun fn, double x_initial) except *:
 *     if sampler == ARS_PWFUN:             # <<<<<<<<<<<<<<
 *         return sampling.arms_pwfun (fn, x_initial)
 *     elif sampler == SLICE_PWFUN:
 */
    case __pyx_e_4qnet_ARS_PWFUN:

    /* "qnet.pyx":1295
 * cdef double call_sampler (Pwfun fn, double x_initial) except *:
 *     if sampler == ARS_PWFUN:
 *         return sampling.arms_pwfun (fn, x_initial)             # <<<<<<<<<<<<<<
 *     elif sampler == SLICE_PWFUN:
 *         return _slice_pwfun (fn, x_initial)
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_sampling); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arms_pwfun); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_x_initial); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_4) {
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, ((PyObject *)__pyx_v_fn));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_7;
    goto __pyx_L0;
    break;

    /* "qnet.pyx":1296
 *     if sampler == ARS_PWFUN:
 *         return sampling.arms_pwfun (fn, x_initial)
 *     elif sampler == SLICE_PWFUN:             # <<<<<<<<<<<<<<
 *         return _slice_pwfun (fn, x_initial)
 *     elif sampler == SLICE:
 */
    case __pyx_e_4qnet_SLICE_PWFUN:

    /* "qnet.pyx":1297
 *         return sampling.arms_pwfun (fn, x_initial)
 *     elif sampler == SLICE_PWFUN:
 *         return _slice_pwfun (fn, x_initial)             # <<<<<<<<<<<<<<
 *     elif sampler == SLICE:
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)
 */
    __pyx_t_7 = __pyx_f_8sampling__slice_pwfun(__pyx_v_fn, __pyx_v_x_initial); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_r = __pyx_t_7;
    goto __pyx_L0;
    break;

    /* "qnet.pyx":1298
 *     elif sampler == SLICE_PWFUN:
 *         return _slice_pwfun (fn, x_initial)
 *     elif sampler == SLICE:             # <<<<<<<<<<<<<<
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)
 *     elif sampler == STUPID_REJECT:
 */
    case __pyx_e_4qnet_SLICE:

    /* "qnet.pyx":1299
 *         return _slice_pwfun (fn, x_initial)
 *     elif sampler == SLICE:
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)             # <<<<<<<<<<<<<<
 *     elif sampler == STUPID_REJECT:
 *         return sampling.rejection (fn)
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_sampling); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_slice); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x_initial); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_INCREF(((PyObject *)__pyx_v_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_fn));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_fn));
    PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_fn->__pyx_vtab)->L(__pyx_v_fn)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_lower, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyFloat_FromDouble(((struct __pyx_vtabstruct_5pwfun_Pwfun *)__pyx_v_fn->__pyx_vtab)->U(__pyx_v_fn)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_upper, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_thin, __pyx_int_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_7;
    goto __pyx_L0;
    break;

    /* "qnet.pyx":1300
 *     elif sampler == SLICE:
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)
 *     elif sampler == STUPID_REJECT:             # <<<<<<<<<<<<<<
 *         return sampling.rejection (fn)
 * 
 */
    case __pyx_e_4qnet_STUPID_REJECT:

    /* "qnet.pyx":1301
 *         return sampling.slice (fn, x_initial, lower=fn.L(), upper=fn.U(), thin=2)
 *     elif sampler == STUPID_REJECT:
 *         return sampling.rejection (fn)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_sampling); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_rejection); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_fn)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_fn));
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, ((PyObject *)__pyx_v_fn));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_fn));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_7;
    goto __pyx_L0;
    break;
    default: break;
  }

  /* "qnet.pyx":1293
 *     return i
 * 
 * cdef double call_sampler (Pwfun fn, double x_initial) except *:             # <<<<<<<<<<<<<<
 *     if sampler == ARS_PWFUN:
 *         return sampling.arms_pwfun (fn, x_initial)
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.call_sampler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1305
 * 
 * 
 * def display_diff_list (arrv, Event e, diff_list):             # <<<<<<<<<<<<<<
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_39display_diff_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_39display_diff_list = {"display_diff_list", (PyCFunction)__pyx_pw_4qnet_39display_diff_list, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_39display_diff_list(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e = 0;
  PyObject *__pyx_v_diff_list = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("display_diff_list (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_e,&__pyx_n_s_diff_list,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_e)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("display_diff_list", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_diff_list)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("display_diff_list", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "display_diff_list") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_arrv = values[0];
    __pyx_v_e = ((struct __pyx_obj_8arrivals_Event *)values[1]);
    __pyx_v_diff_list = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("display_diff_list", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.display_diff_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_38display_diff_list(__pyx_self, __pyx_v_arrv, __pyx_v_e, __pyx_v_diff_list);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_38display_diff_list(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_e, PyObject *__pyx_v_diff_list) {
  PyObject *__pyx_v_result = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_evt_old = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("display_diff_list", 0);

  /* "qnet.pyx":1306
 * 
 * def display_diff_list (arrv, Event e, diff_list):
 *     result = "EID: %d\n" % e.eid             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     for evt in diff_list:
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_e->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_EID_d, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1308
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 *     for evt in diff_list:             # <<<<<<<<<<<<<<
 *         evt_old = arrv.event (evt.eid)
 *         result += "OLD %s\nNEW %s\n\n" % (evt_old, evt)
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_2 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":1309
 *     cdef Event evt
 *     for evt in diff_list:
 *         evt_old = arrv.event (evt.eid)             # <<<<<<<<<<<<<<
 *         result += "OLD %s\nNEW %s\n\n" % (evt_old, evt)
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_event); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evt_old, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1310
 *     for evt in diff_list:
 *         evt_old = arrv.event (evt.eid)
 *         result += "OLD %s\nNEW %s\n\n" % (evt_old, evt)             # <<<<<<<<<<<<<<
 * 
 *     return result
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_evt_old);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_evt_old);
    __Pyx_GIVEREF(__pyx_v_evt_old);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_OLD_s_NEW_s, __pyx_t_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_result, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_result, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1308
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 *     for evt in diff_list:             # <<<<<<<<<<<<<<
 *         evt_old = arrv.event (evt.eid)
 *         result += "OLD %s\nNEW %s\n\n" % (evt_old, evt)
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1312
 *         result += "OLD %s\nNEW %s\n\n" % (evt_old, evt)
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def any_zero_service (diff_list):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":1305
 * 
 * 
 * def display_diff_list (arrv, Event e, diff_list):             # <<<<<<<<<<<<<<
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("qnet.display_diff_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_evt_old);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1314
 *     return result
 * 
 * def any_zero_service (diff_list):             # <<<<<<<<<<<<<<
 *     for evt in diff_list:
 *         if evt.s < 0:
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_41any_zero_service(PyObject *__pyx_self, PyObject *__pyx_v_diff_list); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_41any_zero_service = {"any_zero_service", (PyCFunction)__pyx_pw_4qnet_41any_zero_service, METH_O, 0};
static PyObject *__pyx_pw_4qnet_41any_zero_service(PyObject *__pyx_self, PyObject *__pyx_v_diff_list) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("any_zero_service (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_40any_zero_service(__pyx_self, ((PyObject *)__pyx_v_diff_list));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_40any_zero_service(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_diff_list) {
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("any_zero_service", 0);

  /* "qnet.pyx":1315
 * 
 * def any_zero_service (diff_list):
 *     for evt in diff_list:             # <<<<<<<<<<<<<<
 *         if evt.s < 0:
 *             return True
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_1 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1316
 * def any_zero_service (diff_list):
 *     for evt in diff_list:
 *         if evt.s < 0:             # <<<<<<<<<<<<<<
 *             return True
 *     return False
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_s); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {

      /* "qnet.pyx":1317
 *     for evt in diff_list:
 *         if evt.s < 0:
 *             return True             # <<<<<<<<<<<<<<
 *     return False
 * 
 */
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }

    /* "qnet.pyx":1315
 * 
 * def any_zero_service (diff_list):
 *     for evt in diff_list:             # <<<<<<<<<<<<<<
 *         if evt.s < 0:
 *             return True
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1318
 *         if evt.s < 0:
 *             return True
 *     return False             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "qnet.pyx":1314
 *     return result
 * 
 * def any_zero_service (diff_list):             # <<<<<<<<<<<<<<
 *     for evt in diff_list:
 *         if evt.s < 0:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.any_zero_service", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1333
 *     cdef Qnet net
 * 
 *     def __init__(self, Qnet net, Arrivals arrv, Event evt, double lik0):             # <<<<<<<<<<<<<<
 *         self.lik0 = lik0
 *         self.net = net
 */

/* Python wrapper */
static int __pyx_pw_4qnet_8GGkGibbs_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_4qnet_8GGkGibbs_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_lik0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,&__pyx_n_s_evt,&__pyx_n_s_lik0,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_lik0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[2]);
    __pyx_v_lik0 = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_lik0 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.GGkGibbs.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_8GGkGibbs___init__(((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_v_self), __pyx_v_net, __pyx_v_arrv, __pyx_v_evt, __pyx_v_lik0);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_4qnet_8GGkGibbs___init__(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_lik0) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "qnet.pyx":1334
 * 
 *     def __init__(self, Qnet net, Arrivals arrv, Event evt, double lik0):
 *         self.lik0 = lik0             # <<<<<<<<<<<<<<
 *         self.net = net
 *         self.evt = evt
 */
  __pyx_v_self->lik0 = __pyx_v_lik0;

  /* "qnet.pyx":1335
 *     def __init__(self, Qnet net, Arrivals arrv, Event evt, double lik0):
 *         self.lik0 = lik0
 *         self.net = net             # <<<<<<<<<<<<<<
 *         self.evt = evt
 *         self.evt_next = evt.next_byt
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __Pyx_GOTREF(__pyx_v_self->net);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->net));
  __pyx_v_self->net = __pyx_v_net;

  /* "qnet.pyx":1336
 *         self.lik0 = lik0
 *         self.net = net
 *         self.evt = evt             # <<<<<<<<<<<<<<
 *         self.evt_next = evt.next_byt
 *         self.arrv = arrv
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_evt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
  __Pyx_GOTREF(__pyx_v_self->evt);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->evt));
  __pyx_v_self->evt = __pyx_v_evt;

  /* "qnet.pyx":1337
 *         self.net = net
 *         self.evt = evt
 *         self.evt_next = evt.next_byt             # <<<<<<<<<<<<<<
 *         self.arrv = arrv
 * 
 */
  if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = __pyx_v_evt->next_byt;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->evt_next);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->evt_next));
  __pyx_v_self->evt_next = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1338
 *         self.evt = evt
 *         self.evt_next = evt.next_byt
 *         self.arrv = arrv             # <<<<<<<<<<<<<<
 * 
 *     def inner_dfun (self, double d):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_GOTREF(__pyx_v_self->arrv);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->arrv));
  __pyx_v_self->arrv = __pyx_v_arrv;

  /* "qnet.pyx":1333
 *     cdef Qnet net
 * 
 *     def __init__(self, Qnet net, Arrivals arrv, Event evt, double lik0):             # <<<<<<<<<<<<<<
 *         self.lik0 = lik0
 *         self.net = net
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.GGkGibbs.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1340
 *         self.arrv = arrv
 * 
 *     def inner_dfun (self, double d):             # <<<<<<<<<<<<<<
 *         cdef double lik = self.lik0
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_8GGkGibbs_3inner_dfun(PyObject *__pyx_v_self, PyObject *__pyx_arg_d); /*proto*/
static PyObject *__pyx_pw_4qnet_8GGkGibbs_3inner_dfun(PyObject *__pyx_v_self, PyObject *__pyx_arg_d) {
  double __pyx_v_d;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("inner_dfun (wrapper)", 0);
  assert(__pyx_arg_d); {
    __pyx_v_d = __pyx_PyFloat_AsDouble(__pyx_arg_d); if (unlikely((__pyx_v_d == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1340; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.GGkGibbs.inner_dfun", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_8GGkGibbs_2inner_dfun(((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_v_self), ((double)__pyx_v_d));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_8GGkGibbs_2inner_dfun(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, double __pyx_v_d) {
  double __pyx_v_lik;
  struct __pyx_obj_6queues_Queue *__pyx_v_q0 = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q1 = 0;
  PyObject *__pyx_v_dl0 = NULL;
  PyObject *__pyx_v_dl1 = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  double __pyx_t_7;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("inner_dfun", 0);

  /* "qnet.pyx":1341
 * 
 *     def inner_dfun (self, double d):
 *         cdef double lik = self.lik0             # <<<<<<<<<<<<<<
 * 
 *         cdef Event e_new, e_old
 */
  __pyx_t_1 = __pyx_v_self->lik0;
  __pyx_v_lik = __pyx_t_1;

  /* "qnet.pyx":1344
 * 
 *         cdef Event e_new, e_old
 *         cdef Queue q0 = self.evt.q             # <<<<<<<<<<<<<<
 *         cdef Queue q1 = self.evt_next.q if self.evt_next else None
 *         dl0 = q0.diffListForDeparture (self.evt, d)
 */
  __pyx_t_2 = ((PyObject *)__pyx_v_self->evt->q);
  __Pyx_INCREF(__pyx_t_2);
  __pyx_v_q0 = ((struct __pyx_obj_6queues_Queue *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1345
 *         cdef Event e_new, e_old
 *         cdef Queue q0 = self.evt.q
 *         cdef Queue q1 = self.evt_next.q if self.evt_next else None             # <<<<<<<<<<<<<<
 *         dl0 = q0.diffListForDeparture (self.evt, d)
 *         dl1 = q1.diffListForArrival(self.evt_next, d) if q1 else []
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->evt_next)); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_3) {
    __Pyx_INCREF(((PyObject *)__pyx_v_self->evt_next->q));
    __pyx_t_2 = ((PyObject *)__pyx_v_self->evt_next->q);
  } else {
    __Pyx_INCREF(Py_None);
    __pyx_t_2 = Py_None;
  }
  __pyx_v_q1 = ((struct __pyx_obj_6queues_Queue *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1346
 *         cdef Queue q0 = self.evt.q
 *         cdef Queue q1 = self.evt_next.q if self.evt_next else None
 *         dl0 = q0.diffListForDeparture (self.evt, d)             # <<<<<<<<<<<<<<
 *         dl1 = q1.diffListForArrival(self.evt_next, d) if q1 else []
 * 
 */
  __pyx_t_2 = ((PyObject *)__pyx_v_self->evt);
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_4 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q0->__pyx_vtab)->diffListForDeparture(__pyx_v_q0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2), __pyx_v_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dl0 = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "qnet.pyx":1347
 *         cdef Queue q1 = self.evt_next.q if self.evt_next else None
 *         dl0 = q0.diffListForDeparture (self.evt, d)
 *         dl1 = q1.diffListForArrival(self.evt_next, d) if q1 else []             # <<<<<<<<<<<<<<
 * 
 *         global diff_len, num_diff
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_q1)); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_3) {
    __pyx_t_2 = ((PyObject *)__pyx_v_self->evt_next);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_5 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q1->__pyx_vtab)->diffListForArrival(__pyx_v_q1, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2), __pyx_v_d); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = __pyx_t_5;
    __pyx_t_5 = 0;
  } else {
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __pyx_t_5;
    __pyx_t_5 = 0;
  }
  __pyx_v_dl1 = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "qnet.pyx":1350
 * 
 *         global diff_len, num_diff
 *         diff_len += len(dl0)             # <<<<<<<<<<<<<<
 *         diff_len += len(dl1)
 *         num_diff += 1
 */
  __pyx_t_6 = PyObject_Length(__pyx_v_dl0); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1350; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_diff_len = (__pyx_v_4qnet_diff_len + __pyx_t_6);

  /* "qnet.pyx":1351
 *         global diff_len, num_diff
 *         diff_len += len(dl0)
 *         diff_len += len(dl1)             # <<<<<<<<<<<<<<
 *         num_diff += 1
 * 
 */
  __pyx_t_6 = PyObject_Length(__pyx_v_dl1); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_4qnet_diff_len = (__pyx_v_4qnet_diff_len + __pyx_t_6);

  /* "qnet.pyx":1352
 *         diff_len += len(dl0)
 *         diff_len += len(dl1)
 *         num_diff += 1             # <<<<<<<<<<<<<<
 * 
 *         lik += q0.likelihoodDelta (self.arrv, dl0)
 */
  __pyx_v_4qnet_num_diff = (__pyx_v_4qnet_num_diff + 1);

  /* "qnet.pyx":1354
 *         num_diff += 1
 * 
 *         lik += q0.likelihoodDelta (self.arrv, dl0)             # <<<<<<<<<<<<<<
 *         lik += q1.likelihoodDelta (self.arrv, dl1) if q1 else 0
 * 
 */
  __pyx_t_4 = ((PyObject *)__pyx_v_self->arrv);
  __Pyx_INCREF(__pyx_t_4);
  __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q0->__pyx_vtab)->likelihoodDelta(__pyx_v_q0, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_4), __pyx_v_dl0, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_lik = (__pyx_v_lik + __pyx_t_1);

  /* "qnet.pyx":1355
 * 
 *         lik += q0.likelihoodDelta (self.arrv, dl0)
 *         lik += q1.likelihoodDelta (self.arrv, dl1) if q1 else 0             # <<<<<<<<<<<<<<
 * 
 *         return lik
 */
  __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_q1)); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_3) {
    __pyx_t_4 = ((PyObject *)__pyx_v_self->arrv);
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q1->__pyx_vtab)->likelihoodDelta(__pyx_v_q1, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_4), __pyx_v_dl1, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_1 = __pyx_t_7;
  } else {
    __pyx_t_1 = 0.0;
  }
  __pyx_v_lik = (__pyx_v_lik + __pyx_t_1);

  /* "qnet.pyx":1357
 *         lik += q1.likelihoodDelta (self.arrv, dl1) if q1 else 0
 * 
 *         return lik             # <<<<<<<<<<<<<<
 * 
 *     def dfn (self): return self.inner_dfun
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1340
 *         self.arrv = arrv
 * 
 *     def inner_dfun (self, double d):             # <<<<<<<<<<<<<<
 *         cdef double lik = self.lik0
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.GGkGibbs.inner_dfun", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q0);
  __Pyx_XDECREF((PyObject *)__pyx_v_q1);
  __Pyx_XDECREF(__pyx_v_dl0);
  __Pyx_XDECREF(__pyx_v_dl1);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1359
 *         return lik
 * 
 *     def dfn (self): return self.inner_dfun             # <<<<<<<<<<<<<<
 * 
 *     def integrate (self, C=0):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_8GGkGibbs_5dfn(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_4qnet_8GGkGibbs_5dfn(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("dfn (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_8GGkGibbs_4dfn(((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_8GGkGibbs_4dfn(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("dfn", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_inner_dfun); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.GGkGibbs.dfn", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1361
 *     def dfn (self): return self.inner_dfun
 * 
 *     def integrate (self, C=0):             # <<<<<<<<<<<<<<
 *         fn = netutils.expify(self.dfn(), -C)
 *         lower = self.evt.a
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_8GGkGibbs_7integrate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_8GGkGibbs_7integrate(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_C = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("integrate (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_C,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_C);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "integrate") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1361; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_C = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("integrate", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1361; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.GGkGibbs.integrate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_8GGkGibbs_6integrate(((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_v_self), __pyx_v_C);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_8GGkGibbs_6integrate(struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, PyObject *__pyx_v_C) {
  PyObject *__pyx_v_fn = NULL;
  double __pyx_v_lower;
  double __pyx_v_upper;
  PyObject *__pyx_v_points = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  double __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("integrate", 0);

  /* "qnet.pyx":1362
 * 
 *     def integrate (self, C=0):
 *         fn = netutils.expify(self.dfn(), -C)             # <<<<<<<<<<<<<<
 *         lower = self.evt.a
 *         upper = self.net.determine_upper (self.evt)
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_netutils); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_expify); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dfn); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Negative(__pyx_v_C); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  if (__pyx_t_5) {
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
  }
  PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_fn = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1363
 *     def integrate (self, C=0):
 *         fn = netutils.expify(self.dfn(), -C)
 *         lower = self.evt.a             # <<<<<<<<<<<<<<
 *         upper = self.net.determine_upper (self.evt)
 * 
 */
  __pyx_t_8 = __pyx_v_self->evt->a;
  __pyx_v_lower = __pyx_t_8;

  /* "qnet.pyx":1364
 *         fn = netutils.expify(self.dfn(), -C)
 *         lower = self.evt.a
 *         upper = self.net.determine_upper (self.evt)             # <<<<<<<<<<<<<<
 * 
 *         # heuristic: add integration points for past and next 5
 */
  __pyx_t_1 = ((PyObject *)__pyx_v_self->evt);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_upper = ((struct __pyx_vtabstruct_4qnet_Qnet *)__pyx_v_self->net->__pyx_vtab)->determine_upper(__pyx_v_self->net, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1367
 * 
 *         # heuristic: add integration points for past and next 5
 *         points = [lower, upper]             # <<<<<<<<<<<<<<
 *         self.add_points (points, self.evt, lower, upper, get_departure)
 *         if self.evt_next: self.add_points (points, self.evt_next, lower, upper, get_arrival)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = PyList_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  PyList_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_7, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_v_points = ((PyObject*)__pyx_t_7);
  __pyx_t_7 = 0;

  /* "qnet.pyx":1368
 *         # heuristic: add integration points for past and next 5
 *         points = [lower, upper]
 *         self.add_points (points, self.evt, lower, upper, get_departure)             # <<<<<<<<<<<<<<
 *         if self.evt_next: self.add_points (points, self.evt_next, lower, upper, get_arrival)
 * 
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_points); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_get_departure); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  __pyx_t_9 = PyTuple_New(5+__pyx_t_6); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (__pyx_t_5) {
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
  }
  __Pyx_INCREF(__pyx_v_points);
  PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_6, __pyx_v_points);
  __Pyx_GIVEREF(__pyx_v_points);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->evt));
  PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_6, ((PyObject *)__pyx_v_self->evt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->evt));
  PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_6, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_9, 3+__pyx_t_6, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_9, 4+__pyx_t_6, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_2 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "qnet.pyx":1369
 *         points = [lower, upper]
 *         self.add_points (points, self.evt, lower, upper, get_departure)
 *         if self.evt_next: self.add_points (points, self.evt_next, lower, upper, get_arrival)             # <<<<<<<<<<<<<<
 * 
 *         points.sort()
 */
  __pyx_t_10 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->evt_next)); if (unlikely(__pyx_t_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_10) {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add_points); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_get_arrival); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    __pyx_t_5 = PyTuple_New(5+__pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_1) {
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
    }
    __Pyx_INCREF(__pyx_v_points);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_v_points);
    __Pyx_GIVEREF(__pyx_v_points);
    __Pyx_INCREF(((PyObject *)__pyx_v_self->evt_next));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, ((PyObject *)__pyx_v_self->evt_next));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self->evt_next));
    PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_5, 3+__pyx_t_6, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 4+__pyx_t_6, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_9 = 0;
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1371
 *         if self.evt_next: self.add_points (points, self.evt_next, lower, upper, get_arrival)
 * 
 *         points.sort()             # <<<<<<<<<<<<<<
 *         return misc.integrate_by_points (fn, points)
 * 
 */
  __pyx_t_11 = PyList_Sort(__pyx_v_points); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1372
 * 
 *         points.sort()
 *         return misc.integrate_by_points (fn, points)             # <<<<<<<<<<<<<<
 * 
 *     def add_points (self, points, Event e0, double lower, double upper, fn):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_misc); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_integrate_by_points); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  __pyx_t_4 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_fn);
  PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_6, __pyx_v_fn);
  __Pyx_GIVEREF(__pyx_v_fn);
  __Pyx_INCREF(__pyx_v_points);
  PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_6, __pyx_v_points);
  __Pyx_GIVEREF(__pyx_v_points);
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1372; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1361
 *     def dfn (self): return self.inner_dfun
 * 
 *     def integrate (self, C=0):             # <<<<<<<<<<<<<<
 *         fn = netutils.expify(self.dfn(), -C)
 *         lower = self.evt.a
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.GGkGibbs.integrate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_fn);
  __Pyx_XDECREF(__pyx_v_points);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1374
 *         return misc.integrate_by_points (fn, points)
 * 
 *     def add_points (self, points, Event e0, double lower, double upper, fn):             # <<<<<<<<<<<<<<
 *         cdef Event e_curr = e0
 *         for i in range(NUM_INTEGRATION_POINTS):
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_8GGkGibbs_9add_points(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_8GGkGibbs_9add_points(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_points = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e0 = 0;
  double __pyx_v_lower;
  double __pyx_v_upper;
  PyObject *__pyx_v_fn = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("add_points (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_points,&__pyx_n_s_e0,&__pyx_n_s_lower,&__pyx_n_s_upper,&__pyx_n_s_fn,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_points)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_e0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("add_points", 1, 5, 5, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_lower)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("add_points", 1, 5, 5, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_upper)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("add_points", 1, 5, 5, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  4:
        if (likely((values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_fn)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("add_points", 1, 5, 5, 4); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "add_points") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
    }
    __pyx_v_points = values[0];
    __pyx_v_e0 = ((struct __pyx_obj_8arrivals_Event *)values[1]);
    __pyx_v_lower = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_lower == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_upper = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_upper == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_fn = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("add_points", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.GGkGibbs.add_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e0), __pyx_ptype_8arrivals_Event, 1, "e0", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_8GGkGibbs_8add_points(((struct __pyx_obj_4qnet_GGkGibbs *)__pyx_v_self), __pyx_v_points, __pyx_v_e0, __pyx_v_lower, __pyx_v_upper, __pyx_v_fn);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_8GGkGibbs_8add_points(CYTHON_UNUSED struct __pyx_obj_4qnet_GGkGibbs *__pyx_v_self, PyObject *__pyx_v_points, struct __pyx_obj_8arrivals_Event *__pyx_v_e0, double __pyx_v_lower, double __pyx_v_upper, PyObject *__pyx_v_fn) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_curr = 0;
  CYTHON_UNUSED PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_val = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("add_points", 0);

  /* "qnet.pyx":1375
 * 
 *     def add_points (self, points, Event e0, double lower, double upper, fn):
 *         cdef Event e_curr = e0             # <<<<<<<<<<<<<<
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e0));
  __pyx_v_e_curr = __pyx_v_e0;

  /* "qnet.pyx":1376
 *     def add_points (self, points, Event e0, double lower, double upper, fn):
 *         cdef Event e_curr = e0
 *         for i in range(NUM_INTEGRATION_POINTS):             # <<<<<<<<<<<<<<
 *             if not e_curr: break
 *             val = fn(e_curr)
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_NUM_INTEGRATION_POINTS); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1377
 *         cdef Event e_curr = e0
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break             # <<<<<<<<<<<<<<
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_e_curr)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_6 = ((!__pyx_t_5) != 0);
    if (__pyx_t_6) {
      goto __pyx_L4_break;
    }

    /* "qnet.pyx":1378
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break
 *             val = fn(e_curr)             # <<<<<<<<<<<<<<
 *             if lower <= val and val <= upper:
 *                 points.append (val)
 */
    __Pyx_INCREF(__pyx_v_fn);
    __pyx_t_7 = __pyx_v_fn; __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_e_curr)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_9 = PyTuple_New(1+1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_e_curr));
      PyTuple_SET_ITEM(__pyx_t_9, 0+1, ((PyObject *)__pyx_v_e_curr));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_curr));
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_val, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1379
 *             if not e_curr: break
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:             # <<<<<<<<<<<<<<
 *                 points.append (val)
 *             e_curr = e_curr.prev_byq
 */
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_1, __pyx_v_val, Py_LE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_5) {
    } else {
      __pyx_t_6 = __pyx_t_5;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_7 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_val, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1379; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __pyx_t_5;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_6) {

      /* "qnet.pyx":1380
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:
 *                 points.append (val)             # <<<<<<<<<<<<<<
 *             e_curr = e_curr.prev_byq
 *         e_curr = e0.next_byq
 */
      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_points, __pyx_v_val); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1381
 *             if lower <= val and val <= upper:
 *                 points.append (val)
 *             e_curr = e_curr.prev_byq             # <<<<<<<<<<<<<<
 *         e_curr = e0.next_byq
 *         for i in range(NUM_INTEGRATION_POINTS):
 */
    if (!(likely(((__pyx_v_e_curr->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e_curr->prev_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = __pyx_v_e_curr->prev_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_e_curr, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":1376
 *     def add_points (self, points, Event e0, double lower, double upper, fn):
 *         cdef Event e_curr = e0
 *         for i in range(NUM_INTEGRATION_POINTS):             # <<<<<<<<<<<<<<
 *             if not e_curr: break
 *             val = fn(e_curr)
 */
  }
  __pyx_L4_break:;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1382
 *                 points.append (val)
 *             e_curr = e_curr.prev_byq
 *         e_curr = e0.next_byq             # <<<<<<<<<<<<<<
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break
 */
  if (!(likely(((__pyx_v_e0->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e0->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __pyx_v_e0->next_byq;
  __Pyx_INCREF(__pyx_t_2);
  __Pyx_DECREF_SET(__pyx_v_e_curr, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
  __pyx_t_2 = 0;

  /* "qnet.pyx":1383
 *             e_curr = e_curr.prev_byq
 *         e_curr = e0.next_byq
 *         for i in range(NUM_INTEGRATION_POINTS):             # <<<<<<<<<<<<<<
 *             if not e_curr: break
 *             val = fn(e_curr)
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_NUM_INTEGRATION_POINTS); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1384
 *         e_curr = e0.next_byq
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break             # <<<<<<<<<<<<<<
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:
 */
    __pyx_t_6 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_e_curr)); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = ((!__pyx_t_6) != 0);
    if (__pyx_t_5) {
      goto __pyx_L10_break;
    }

    /* "qnet.pyx":1385
 *         for i in range(NUM_INTEGRATION_POINTS):
 *             if not e_curr: break
 *             val = fn(e_curr)             # <<<<<<<<<<<<<<
 *             if lower <= val and val <= upper:
 *                 points.append (val)
 */
    __Pyx_INCREF(__pyx_v_fn);
    __pyx_t_7 = __pyx_v_fn; __pyx_t_9 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_e_curr)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_e_curr));
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_e_curr));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_curr));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_val, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1386
 *             if not e_curr: break
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:             # <<<<<<<<<<<<<<
 *                 points.append (val)
 *             e_curr = e_curr.next_byq
 */
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_lower); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_v_val, Py_LE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_6) {
    } else {
      __pyx_t_5 = __pyx_t_6;
      goto __pyx_L13_bool_binop_done;
    }
    __pyx_t_7 = PyFloat_FromDouble(__pyx_v_upper); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_val, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = __pyx_t_6;
    __pyx_L13_bool_binop_done:;
    if (__pyx_t_5) {

      /* "qnet.pyx":1387
 *             val = fn(e_curr)
 *             if lower <= val and val <= upper:
 *                 points.append (val)             # <<<<<<<<<<<<<<
 *             e_curr = e_curr.next_byq
 * 
 */
      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_points, __pyx_v_val); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "qnet.pyx":1388
 *             if lower <= val and val <= upper:
 *                 points.append (val)
 *             e_curr = e_curr.next_byq             # <<<<<<<<<<<<<<
 * 
 * 
 */
    if (!(likely(((__pyx_v_e_curr->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e_curr->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1388; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __pyx_v_e_curr->next_byq;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_e_curr, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1383
 *             e_curr = e_curr.prev_byq
 *         e_curr = e0.next_byq
 *         for i in range(NUM_INTEGRATION_POINTS):             # <<<<<<<<<<<<<<
 *             if not e_curr: break
 *             val = fn(e_curr)
 */
  }
  __pyx_L10_break:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1374
 *         return misc.integrate_by_points (fn, points)
 * 
 *     def add_points (self, points, Event e0, double lower, double upper, fn):             # <<<<<<<<<<<<<<
 *         cdef Event e_curr = e0
 *         for i in range(NUM_INTEGRATION_POINTS):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.GGkGibbs.add_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_e_curr);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_val);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1393
 * # Initializers
 * 
 * def gibbs_initialize_via_dfn1 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_43gibbs_initialize_via_dfn1(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_43gibbs_initialize_via_dfn1 = {"gibbs_initialize_via_dfn1", (PyCFunction)__pyx_pw_4qnet_43gibbs_initialize_via_dfn1, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_43gibbs_initialize_via_dfn1(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn1 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn1", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_dfn1") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn1", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_42gibbs_initialize_via_dfn1(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_42gibbs_initialize_via_dfn1(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_v_result = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn1", 0);

  /* "qnet.pyx":1394
 * 
 * def gibbs_initialize_via_dfn1 (net, Arrivals arrv):
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     for evt in result:
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_net);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_net);
  __Pyx_GIVEREF(__pyx_v_net);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(__pyx_float_1_0);
  PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_float_1_0);
  __Pyx_GIVEREF(__pyx_float_1_0);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1394; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1396
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  if (likely(PyList_CheckExact(__pyx_v_result)) || PyTuple_CheckExact(__pyx_v_result)) {
    __pyx_t_1 = __pyx_v_result; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_result); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1397
 *     cdef Event evt
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 *     result.regenerate_all_caches()
 *     return result
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1396
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1398
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 *     return result
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1399
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":1393
 * # Initializers
 * 
 * def gibbs_initialize_via_dfn1 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1401
 *     return result
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_45gibbs_initialize_via_dfn2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_45gibbs_initialize_via_dfn2 = {"gibbs_initialize_via_dfn2", (PyCFunction)__pyx_pw_4qnet_45gibbs_initialize_via_dfn2, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_45gibbs_initialize_via_dfn2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn2", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_dfn2") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn2", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_44gibbs_initialize_via_dfn2(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_44gibbs_initialize_via_dfn2(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_v_inner = NULL;
  PyObject *__pyx_v_result = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn2", 0);

  /* "qnet.pyx":1402
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 *     cdef Event evt
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_net);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_net);
  __Pyx_GIVEREF(__pyx_v_net);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(__pyx_float_1_0);
  PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_float_1_0);
  __Pyx_GIVEREF(__pyx_float_1_0);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_inner = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1403
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     for evt in result:
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_3 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (__pyx_t_5) {
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
  }
  __Pyx_INCREF(__pyx_v_net);
  PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_4, __pyx_v_net);
  __Pyx_GIVEREF(__pyx_v_net);
  __Pyx_INCREF(__pyx_v_inner);
  PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_4, __pyx_v_inner);
  __Pyx_GIVEREF(__pyx_v_inner);
  __Pyx_INCREF(__pyx_float_1_0);
  PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_4, __pyx_float_1_0);
  __Pyx_GIVEREF(__pyx_float_1_0);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1403; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1405
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  if (likely(PyList_CheckExact(__pyx_v_result)) || PyTuple_CheckExact(__pyx_v_result)) {
    __pyx_t_1 = __pyx_v_result; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_result); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1406
 *     cdef Event evt
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 *     result.regenerate_all_caches()
 *     return result
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1405
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1407
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 *     return result
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1408
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":1401
 *     return result
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_inner);
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1410
 *     return result
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_47gibbs_initialize_via_dfn3(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_47gibbs_initialize_via_dfn3 = {"gibbs_initialize_via_dfn3", (PyCFunction)__pyx_pw_4qnet_47gibbs_initialize_via_dfn3, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_47gibbs_initialize_via_dfn3(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn3 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn3", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_dfn3") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn3", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn3", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_46gibbs_initialize_via_dfn3(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_46gibbs_initialize_via_dfn3(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_v_result = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn3", 0);

  /* "qnet.pyx":1411
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     for evt in result:
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_dfn); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(__pyx_v_net);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_net);
  __Pyx_GIVEREF(__pyx_v_net);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(__pyx_float_1_1);
  PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_float_1_1);
  __Pyx_GIVEREF(__pyx_float_1_1);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1413
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  if (likely(PyList_CheckExact(__pyx_v_result)) || PyTuple_CheckExact(__pyx_v_result)) {
    __pyx_t_1 = __pyx_v_result; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_result); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1414
 *     cdef Event evt
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 *     result.regenerate_all_caches()
 *     return result
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1413
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1415
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 *     return result
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_result, __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1415; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1416
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def insert_implied_tasks (Qnet net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "qnet.pyx":1410
 *     return result
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn3", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1418
 *     return result
 * 
 * def insert_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, evt0, evt1
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_49insert_implied_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_49insert_implied_tasks = {"insert_implied_tasks", (PyCFunction)__pyx_pw_4qnet_49insert_implied_tasks, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_49insert_implied_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("insert_implied_tasks (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("insert_implied_tasks", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "insert_implied_tasks") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("insert_implied_tasks", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.insert_implied_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_48insert_implied_tasks(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_48insert_implied_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt0 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt1 = 0;
  PyObject *__pyx_v_eid = NULL;
  double __pyx_v_d0;
  PyObject *__pyx_v_tid0 = NULL;
  PyObject *__pyx_v_evt2 = NULL;
  PyObject *__pyx_v_initial_q = NULL;
  double __pyx_v_eps;
  PyObject *__pyx_v_tid2 = NULL;
  PyObject *__pyx_v_tid1 = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  double __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("insert_implied_tasks", 0);

  /* "qnet.pyx":1421
 *     cdef Event evt, evt0, evt1
 * 
 *     eid = arrv.max_eidx()+1             # <<<<<<<<<<<<<<
 *     d0 = 0
 *     tid0 = -1
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1421; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_eid = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1422
 * 
 *     eid = arrv.max_eidx()+1
 *     d0 = 0             # <<<<<<<<<<<<<<
 *     tid0 = -1
 *     evt2 = arrv.first_arrival_by_qid (INITIAL_QID)
 */
  __pyx_v_d0 = 0.0;

  /* "qnet.pyx":1423
 *     eid = arrv.max_eidx()+1
 *     d0 = 0
 *     tid0 = -1             # <<<<<<<<<<<<<<
 *     evt2 = arrv.first_arrival_by_qid (INITIAL_QID)
 *     initial_q = net.queues[INITIAL_QID]
 */
  __Pyx_INCREF(__pyx_int_neg_1);
  __pyx_v_tid0 = __pyx_int_neg_1;

  /* "qnet.pyx":1424
 *     d0 = 0
 *     tid0 = -1
 *     evt2 = arrv.first_arrival_by_qid (INITIAL_QID)             # <<<<<<<<<<<<<<
 *     initial_q = net.queues[INITIAL_QID]
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_first_arrival_by_qid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_INITIAL_QID); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_2);
  } else {
    __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1424; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_evt2 = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1425
 *     tid0 = -1
 *     evt2 = arrv.first_arrival_by_qid (INITIAL_QID)
 *     initial_q = net.queues[INITIAL_QID]             # <<<<<<<<<<<<<<
 * 
 *     eps = 1e-10
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_INITIAL_QID); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1425; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_GetItem(__pyx_v_net->queues, __pyx_t_2); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1425; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_initial_q = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1427
 *     initial_q = net.queues[INITIAL_QID]
 * 
 *     eps = 1e-10             # <<<<<<<<<<<<<<
 * 
 *     while evt2:
 */
  __pyx_v_eps = 1e-10;

  /* "qnet.pyx":1429
 *     eps = 1e-10
 * 
 *     while evt2:             # <<<<<<<<<<<<<<
 *         tid2 = evt2.tid
 *         if DEBUG_INITIAL: print "INIT  %s\n" % evt2
 */
  while (1) {
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_evt2); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1429; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_6) break;

    /* "qnet.pyx":1430
 * 
 *     while evt2:
 *         tid2 = evt2.tid             # <<<<<<<<<<<<<<
 *         if DEBUG_INITIAL: print "INIT  %s\n" % evt2
 *         if DEBUG_INITIAL: print "TIDS:",tid0, tid2
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt2, __pyx_n_s_tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_tid2, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1431
 *     while evt2:
 *         tid2 = evt2.tid
 *         if DEBUG_INITIAL: print "INIT  %s\n" % evt2             # <<<<<<<<<<<<<<
 *         if DEBUG_INITIAL: print "TIDS:",tid0, tid2
 * 
 */
    if (__pyx_e_4qnet_DEBUG_INITIAL) {
      __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_INIT_s, __pyx_v_evt2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1432
 *         tid2 = evt2.tid
 *         if DEBUG_INITIAL: print "INIT  %s\n" % evt2
 *         if DEBUG_INITIAL: print "TIDS:",tid0, tid2             # <<<<<<<<<<<<<<
 * 
 *         for tid1 in range(tid0+1, tid2):
 */
    if (__pyx_e_4qnet_DEBUG_INITIAL) {
      __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_kp_s_TIDS);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_TIDS);
      __Pyx_GIVEREF(__pyx_kp_s_TIDS);
      __Pyx_INCREF(__pyx_v_tid0);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid0);
      __Pyx_GIVEREF(__pyx_v_tid0);
      __Pyx_INCREF(__pyx_v_tid2);
      PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_tid2);
      __Pyx_GIVEREF(__pyx_v_tid2);
      if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1434
 *         if DEBUG_INITIAL: print "TIDS:",tid0, tid2
 * 
 *         for tid1 in range(tid0+1, tid2):             # <<<<<<<<<<<<<<
 *             evt1 = Event (eid, tid1, INITIAL_QID, initial_q, 0.0, 0.0, d0 + eps, INITIAL_STATE, obs_a=0, obs_d=0)
 *             if DEBUG_INITIAL: print tid1, evt1
 */
    __pyx_t_1 = PyNumber_Add(__pyx_v_tid0, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_tid2);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_tid2);
    __Pyx_GIVEREF(__pyx_v_tid2);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_8(__pyx_t_2);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_tid1, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1435
 * 
 *         for tid1 in range(tid0+1, tid2):
 *             evt1 = Event (eid, tid1, INITIAL_QID, initial_q, 0.0, 0.0, d0 + eps, INITIAL_STATE, obs_a=0, obs_d=0)             # <<<<<<<<<<<<<<
 *             if DEBUG_INITIAL: print tid1, evt1
 *             eid += 1
 */
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_INITIAL_QID); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyFloat_FromDouble((__pyx_v_d0 + __pyx_v_eps)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_INITIAL_STATE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyTuple_New(8); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_eid);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_eid);
      __Pyx_GIVEREF(__pyx_v_eid);
      __Pyx_INCREF(__pyx_v_tid1);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_tid1);
      __Pyx_GIVEREF(__pyx_v_tid1);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_initial_q);
      PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_initial_q);
      __Pyx_GIVEREF(__pyx_v_initial_q);
      __Pyx_INCREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_float_0_0);
      __Pyx_GIVEREF(__pyx_float_0_0);
      __Pyx_INCREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_4, 5, __pyx_float_0_0);
      __Pyx_GIVEREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_4, 6, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_4, 7, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_1 = 0;
      __pyx_t_5 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_obs_a, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_obs_d, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt1, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_5));
      __pyx_t_5 = 0;

      /* "qnet.pyx":1436
 *         for tid1 in range(tid0+1, tid2):
 *             evt1 = Event (eid, tid1, INITIAL_QID, initial_q, 0.0, 0.0, d0 + eps, INITIAL_STATE, obs_a=0, obs_d=0)
 *             if DEBUG_INITIAL: print tid1, evt1             # <<<<<<<<<<<<<<
 *             eid += 1
 *             arrv.insert (evt1)
 */
      if (__pyx_e_4qnet_DEBUG_INITIAL) {
        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_v_tid1);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_tid1);
        __Pyx_GIVEREF(__pyx_v_tid1);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
        PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_evt1));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
        if (__Pyx_Print(0, __pyx_t_5, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L9;
      }
      __pyx_L9:;

      /* "qnet.pyx":1437
 *             evt1 = Event (eid, tid1, INITIAL_QID, initial_q, 0.0, 0.0, d0 + eps, INITIAL_STATE, obs_a=0, obs_d=0)
 *             if DEBUG_INITIAL: print tid1, evt1
 *             eid += 1             # <<<<<<<<<<<<<<
 *             arrv.insert (evt1)
 *             evt1.q.recompute_service (evt1)
 */
      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "qnet.pyx":1438
 *             if DEBUG_INITIAL: print tid1, evt1
 *             eid += 1
 *             arrv.insert (evt1)             # <<<<<<<<<<<<<<
 *             evt1.q.recompute_service (evt1)
 *             # increment last event
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_insert); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (!__pyx_t_4) {
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
      } else {
        __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
        PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_evt1));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "qnet.pyx":1439
 *             eid += 1
 *             arrv.insert (evt1)
 *             evt1.q.recompute_service (evt1)             # <<<<<<<<<<<<<<
 *             # increment last event
 *             d0 = evt1.d
 */
      __pyx_t_5 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt1->q->__pyx_vtab)->recompute_service(__pyx_v_evt1->q, __pyx_v_evt1, 0); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1439; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "qnet.pyx":1441
 *             evt1.q.recompute_service (evt1)
 *             # increment last event
 *             d0 = evt1.d             # <<<<<<<<<<<<<<
 * 
 *         evt0 = evt2
 */
      __pyx_t_9 = __pyx_v_evt1->d;
      __pyx_v_d0 = __pyx_t_9;

      /* "qnet.pyx":1434
 *         if DEBUG_INITIAL: print "TIDS:",tid0, tid2
 * 
 *         for tid1 in range(tid0+1, tid2):             # <<<<<<<<<<<<<<
 *             evt1 = Event (eid, tid1, INITIAL_QID, initial_q, 0.0, 0.0, d0 + eps, INITIAL_STATE, obs_a=0, obs_d=0)
 *             if DEBUG_INITIAL: print tid1, evt1
 */
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1443
 *             d0 = evt1.d
 * 
 *         evt0 = evt2             # <<<<<<<<<<<<<<
 *         d0 = evt0.d
 *         tid0 = evt0.tid
 */
    if (!(likely(((__pyx_v_evt2) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1443; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __pyx_v_evt2;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1444
 * 
 *         evt0 = evt2
 *         d0 = evt0.d             # <<<<<<<<<<<<<<
 *         tid0 = evt0.tid
 *         evt2 = evt0.next_byq
 */
    __pyx_t_9 = __pyx_v_evt0->d;
    __pyx_v_d0 = __pyx_t_9;

    /* "qnet.pyx":1445
 *         evt0 = evt2
 *         d0 = evt0.d
 *         tid0 = evt0.tid             # <<<<<<<<<<<<<<
 *         evt2 = evt0.next_byq
 * 
 */
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_evt0->tid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1445; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_tid0, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1446
 *         d0 = evt0.d
 *         tid0 = evt0.tid
 *         evt2 = evt0.next_byq             # <<<<<<<<<<<<<<
 * 
 *     return arrv
 */
    __pyx_t_2 = __pyx_v_evt0->next_byq;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_evt2, __pyx_t_2);
    __pyx_t_2 = 0;
  }

  /* "qnet.pyx":1448
 *         evt2 = evt0.next_byq
 * 
 *     return arrv             # <<<<<<<<<<<<<<
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  __pyx_r = ((PyObject *)__pyx_v_arrv);
  goto __pyx_L0;

  /* "qnet.pyx":1418
 *     return result
 * 
 * def insert_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, evt0, evt1
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.insert_implied_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt0);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt1);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_tid0);
  __Pyx_XDECREF(__pyx_v_evt2);
  __Pyx_XDECREF(__pyx_v_initial_q);
  __Pyx_XDECREF(__pyx_v_tid2);
  __Pyx_XDECREF(__pyx_v_tid1);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1450
 *     return arrv
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     insert_implied_tasks (net, arrv)
 *     return initializer (net, arrv)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_51initialize_inserting_implied_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_51initialize_inserting_implied_tasks = {"initialize_inserting_implied_tasks", (PyCFunction)__pyx_pw_4qnet_51initialize_inserting_implied_tasks, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_51initialize_inserting_implied_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("initialize_inserting_implied_tasks (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("initialize_inserting_implied_tasks", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "initialize_inserting_implied_tasks") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("initialize_inserting_implied_tasks", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.initialize_inserting_implied_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_50initialize_inserting_implied_tasks(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_50initialize_inserting_implied_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("initialize_inserting_implied_tasks", 0);

  /* "qnet.pyx":1451
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):
 *     insert_implied_tasks (net, arrv)             # <<<<<<<<<<<<<<
 *     return initializer (net, arrv)
 * 
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_insert_implied_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1451; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1452
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):
 *     insert_implied_tasks (net, arrv)
 *     return initializer (net, arrv)             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_dfn (Qnet net, Arrivals arrv, scale):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_4qnet_initializer);
  __pyx_t_2 = __pyx_v_4qnet_initializer; __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  __pyx_t_3 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (__pyx_t_5) {
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_4, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_4, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1450
 *     return arrv
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     insert_implied_tasks (net, arrv)
 *     return initializer (net, arrv)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("qnet.initialize_inserting_implied_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1454
 *     return initializer (net, arrv)
 * 
 * def gibbs_initialize_via_dfn (Qnet net, Arrivals arrv, scale):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_53gibbs_initialize_via_dfn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_53gibbs_initialize_via_dfn = {"gibbs_initialize_via_dfn", (PyCFunction)__pyx_pw_4qnet_53gibbs_initialize_via_dfn, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_53gibbs_initialize_via_dfn(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  PyObject *__pyx_v_scale = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,&__pyx_n_s_scale,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_scale)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_dfn") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_scale = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_dfn", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_52gibbs_initialize_via_dfn(__pyx_self, __pyx_v_net, __pyx_v_arrv, __pyx_v_scale);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_52gibbs_initialize_via_dfn(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, PyObject *__pyx_v_scale) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_prev = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  CYTHON_UNUSED PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_dists = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_evts = NULL;
  PyObject *__pyx_v_diff_list = NULL;
  PyObject *__pyx_v_tasks = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_path = NULL;
  int __pyx_v_eid_prev;
  PyObject *__pyx_v_d_new = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  double __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  PyObject *(*__pyx_t_15)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_dfn", 0);

  /* "qnet.pyx":1460
 *     cdef Queue q
 *     cdef Event evt, evt_new, evt_prev, evt1
 *     cdef Arrivals result = Arrivals(net)             # <<<<<<<<<<<<<<
 * 
 *     s_initial = net.fsm.initial_state()
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1462
 *     cdef Arrivals result = Arrivals(net)
 * 
 *     s_initial = net.fsm.initial_state()             # <<<<<<<<<<<<<<
 *     eid = arrv.max_eidx()+1
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_net->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_s_initial = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1463
 * 
 *     s_initial = net.fsm.initial_state()
 *     eid = arrv.max_eidx()+1             # <<<<<<<<<<<<<<
 * 
 *     dists = net.markovize_from_arrivals (arrv)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_eid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1465
 *     eid = arrv.max_eidx()+1
 * 
 *     dists = net.markovize_from_arrivals (arrv)             # <<<<<<<<<<<<<<
 * 
 *     if DEBUG_INITIAL:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_markovize_from_arrivals); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dists = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1467
 *     dists = net.markovize_from_arrivals (arrv)
 * 
 *     if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"
 */
  if (__pyx_e_4qnet_DEBUG_INITIAL) {

    /* "qnet.pyx":1468
 * 
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters             # <<<<<<<<<<<<<<
 *         print "Adding observed events"
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_Parameters);
    __Pyx_GIVEREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1469
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"             # <<<<<<<<<<<<<<
 * 
 *     # first add observed events
 */
    if (__Pyx_PrintOne(0, __pyx_kp_s_Adding_observed_events) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1472
 * 
 *     # first add observed events
 *     for tid in arrv.all_tasks():             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1473
 *     # first add observed events
 *     for tid in arrv.all_tasks():
 *         evts = arrv.events_of_task(tid)             # <<<<<<<<<<<<<<
 *         if evts[0].obs_d:
 *             for evt in evts:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_tid); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1474
 *     for tid in arrv.all_tasks():
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:             # <<<<<<<<<<<<<<
 *             for evt in evts:
 *                 evt_new = evt.duplicate()
 */
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":1475
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 *             for evt in evts:             # <<<<<<<<<<<<<<
 *                 evt_new = evt.duplicate()
 *                 evt_new.s = 0.0
 */
      if (likely(PyList_CheckExact(__pyx_v_evts)) || PyTuple_CheckExact(__pyx_v_evts)) {
        __pyx_t_4 = __pyx_v_evts; __Pyx_INCREF(__pyx_t_4); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
      } else {
        __pyx_t_9 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_evts); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_10 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (likely(!__pyx_t_10)) {
          if (likely(PyList_CheckExact(__pyx_t_4))) {
            if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_4)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #endif
          } else {
            if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_10(__pyx_t_4);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1476
 *         if evts[0].obs_d:
 *             for evt in evts:
 *                 evt_new = evt.duplicate()             # <<<<<<<<<<<<<<
 *                 evt_new.s = 0.0
 *                 evt_new.d = evt_new.a + evt_new.wait()
 */
        __pyx_t_2 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->duplicate(__pyx_v_evt, 0)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_XDECREF_SET(__pyx_v_evt_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1477
 *             for evt in evts:
 *                 evt_new = evt.duplicate()
 *                 evt_new.s = 0.0             # <<<<<<<<<<<<<<
 *                 evt_new.d = evt_new.a + evt_new.wait()
 *                 result.insert (evt_new)
 */
        __pyx_v_evt_new->s = 0.0;

        /* "qnet.pyx":1478
 *                 evt_new = evt.duplicate()
 *                 evt_new.s = 0.0
 *                 evt_new.d = evt_new.a + evt_new.wait()             # <<<<<<<<<<<<<<
 *                 result.insert (evt_new)
 *                 diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 */
        __pyx_t_2 = PyFloat_FromDouble(__pyx_v_evt_new->a); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt_new), __pyx_n_s_wait); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_11 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_11) {
          __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_11); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        } else {
          __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_evt_new->d = __pyx_t_12;

        /* "qnet.pyx":1479
 *                 evt_new.s = 0.0
 *                 evt_new.d = evt_new.a + evt_new.wait()
 *                 result.insert (evt_new)             # <<<<<<<<<<<<<<
 *                 diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                 result.applyDiffList (diff_list)
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_2 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_2) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt_new)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
          PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt_new));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1480
 *                 evt_new.d = evt_new.a + evt_new.wait()
 *                 result.insert (evt_new)
 *                 diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)             # <<<<<<<<<<<<<<
 *                 result.applyDiffList (diff_list)
 *                 evt_new.q.initialize_auxiliaries (evt_new)
 */
        __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt_new->q->__pyx_vtab)->diffListForDeparture(__pyx_v_evt_new->q, __pyx_v_evt_new, __pyx_v_evt->d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "qnet.pyx":1481
 *                 result.insert (evt_new)
 *                 diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                 result.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 *                 evt_new.q.initialize_auxiliaries (evt_new)
 * 
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_11 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_11) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_diff_list); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
          __Pyx_INCREF(__pyx_v_diff_list);
          PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_v_diff_list);
          __Pyx_GIVEREF(__pyx_v_diff_list);
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1481; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1482
 *                 diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                 result.applyDiffList (diff_list)
 *                 evt_new.q.initialize_auxiliaries (evt_new)             # <<<<<<<<<<<<<<
 * 
 *     result.validate()
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt_new->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_2 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_2)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_2);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_2) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt_new)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
        } else {
          __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_11);
          PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
          PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt_new));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1482; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1475
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 *             for evt in evts:             # <<<<<<<<<<<<<<
 *                 evt_new = evt.duplicate()
 *                 evt_new.s = 0.0
 */
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1472
 * 
 *     # first add observed events
 *     for tid in arrv.all_tasks():             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1484
 *                 evt_new.q.initialize_auxiliaries (evt_new)
 * 
 *     result.validate()             # <<<<<<<<<<<<<<
 * 
 *     if DEBUG_INITIAL:
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_validate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1486
 *     result.validate()
 * 
 *     if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *         print "Adding unobserved events"
 *         print result
 */
  if (__pyx_e_4qnet_DEBUG_INITIAL) {

    /* "qnet.pyx":1487
 * 
 *     if DEBUG_INITIAL:
 *         print "Adding unobserved events"             # <<<<<<<<<<<<<<
 *         print result
 * 
 */
    if (__Pyx_PrintOne(0, __pyx_kp_s_Adding_unobserved_events) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "qnet.pyx":1488
 *     if DEBUG_INITIAL:
 *         print "Adding unobserved events"
 *         print result             # <<<<<<<<<<<<<<
 * 
 *     # now add unobserved events
 */
    if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_result)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "qnet.pyx":1491
 * 
 *     # now add unobserved events
 *     tasks = arrv.all_tasks()             # <<<<<<<<<<<<<<
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_tasks = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1492
 *     # now add unobserved events
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):             # <<<<<<<<<<<<<<
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_tasks); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_4 = __pyx_t_1; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_4);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1493
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if not evts[0].obs_d:
 */
    __pyx_t_1 = PyObject_GetItem(__pyx_v_tasks, __pyx_v_i); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1493; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1494
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)             # <<<<<<<<<<<<<<
 *         if not evts[0].obs_d:
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1495
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 *         if not evts[0].obs_d:             # <<<<<<<<<<<<<<
 * 
 *             path = net.sample_path()
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_13 = ((!__pyx_t_8) != 0);
    if (__pyx_t_13) {

      /* "qnet.pyx":1497
 *         if not evts[0].obs_d:
 * 
 *             path = net.sample_path()             # <<<<<<<<<<<<<<
 *             evt = (<Event> evts[0]).duplicate()
 * 
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_sample_path); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      if (__pyx_t_11) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      } else {
        __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_path, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "qnet.pyx":1498
 * 
 *             path = net.sample_path()
 *             evt = (<Event> evts[0]).duplicate()             # <<<<<<<<<<<<<<
 * 
 *             # special case: initial arrival (maintain initial arrival order)
 */
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)((struct __pyx_obj_8arrivals_Event *)__pyx_t_3)->__pyx_vtab)->duplicate(((struct __pyx_obj_8arrivals_Event *)__pyx_t_3), 0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1498; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "qnet.pyx":1501
 * 
 *             # special case: initial arrival (maintain initial arrival order)
 *             if i > 0:             # <<<<<<<<<<<<<<
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1501; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_13) {

        /* "qnet.pyx":1502
 *             # special case: initial arrival (maintain initial arrival order)
 *             if i > 0:
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid             # <<<<<<<<<<<<<<
 *                 evt_prev = result.event (eid_prev)
 *                 evt.s = 1e-10
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_11 = PyNumber_Subtract(__pyx_v_i, __pyx_int_1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_7 = PyObject_GetItem(__pyx_v_tasks, __pyx_t_11); if (unlikely(__pyx_t_7 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_11 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (!__pyx_t_11) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
          PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1502; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_14 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3)->eid;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_eid_prev = __pyx_t_14;

        /* "qnet.pyx":1503
 *             if i > 0:
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)             # <<<<<<<<<<<<<<
 *                 evt.s = 1e-10
 *                 evt.d = evt_prev.d + 1e-10
 */
        __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_result->__pyx_vtab)->event(__pyx_v_result, __pyx_v_eid_prev, 0)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1503; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_XDECREF_SET(__pyx_v_evt_prev, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
        __pyx_t_3 = 0;

        /* "qnet.pyx":1504
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)
 *                 evt.s = 1e-10             # <<<<<<<<<<<<<<
 *                 evt.d = evt_prev.d + 1e-10
 *                 if DEBUG_INITIAL:
 */
        __pyx_v_evt->s = 1e-10;

        /* "qnet.pyx":1505
 *                 evt_prev = result.event (eid_prev)
 *                 evt.s = 1e-10
 *                 evt.d = evt_prev.d + 1e-10             # <<<<<<<<<<<<<<
 *                 if DEBUG_INITIAL:
 *                     print "Pre add:\n  prev %s\n   evt %s" % (evt_prev.dump(), evt.dump())
 */
        __pyx_v_evt->d = (__pyx_v_evt_prev->d + 1e-10);

        /* "qnet.pyx":1506
 *                 evt.s = 1e-10
 *                 evt.d = evt_prev.d + 1e-10
 *                 if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *                     print "Pre add:\n  prev %s\n   evt %s" % (evt_prev.dump(), evt.dump())
 * 
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {

          /* "qnet.pyx":1507
 *                 evt.d = evt_prev.d + 1e-10
 *                 if DEBUG_INITIAL:
 *                     print "Pre add:\n  prev %s\n   evt %s" % (evt_prev.dump(), evt.dump())             # <<<<<<<<<<<<<<
 * 
 *             result.insert (evt)
 */
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt_prev), __pyx_n_s_dump); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          if (__pyx_t_2) {
            __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          } else {
            __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_dump); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_7 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_2, function);
            }
          }
          if (__pyx_t_7) {
            __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else {
            __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          __pyx_t_3 = 0;
          __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Pre_add_prev_s_evt_s, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1507; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          goto __pyx_L14;
        }
        __pyx_L14:;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "qnet.pyx":1509
 *                     print "Pre add:\n  prev %s\n   evt %s" % (evt_prev.dump(), evt.dump())
 * 
 *             result.insert (evt)             # <<<<<<<<<<<<<<
 * 
 *             q = evt.q
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      if (!__pyx_t_3) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "qnet.pyx":1511
 *             result.insert (evt)
 * 
 *             q = evt.q             # <<<<<<<<<<<<<<
 *             q.recompute_service (evt)
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 */
      __pyx_t_1 = ((PyObject *)__pyx_v_evt->q);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "qnet.pyx":1512
 * 
 *             q = evt.q
 *             q.recompute_service (evt)             # <<<<<<<<<<<<<<
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 * 
 */
      __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_service(__pyx_v_q, __pyx_v_evt, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "qnet.pyx":1513
 *             q = evt.q
 *             q.recompute_service (evt)
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)             # <<<<<<<<<<<<<<
 * 
 *             while True:
 */
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_13) {
        if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_1 = __pyx_v_evt->next_byq;
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_2 = ((struct __pyx_vtabstruct_6queues_Queue *)((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt->next_byq)->q->__pyx_vtab)->recompute_service(((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt->next_byq)->q, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1), 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "qnet.pyx":1515
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 * 
 *             while True:             # <<<<<<<<<<<<<<
 *                 d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=scale)
 * 
 */
      while (1) {

        /* "qnet.pyx":1516
 * 
 *             while True:
 *                 d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=scale)             # <<<<<<<<<<<<<<
 * 
 *                 if DEBUG_INITIAL:
 */
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_sample_d_until_acceptance); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(((PyObject *)__pyx_v_net));
        PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_net));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
        __Pyx_INCREF(((PyObject *)__pyx_v_result));
        PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_result));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_7 = PyDict_New(); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_service_only, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_scale, __pyx_v_scale) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
          PyObject* sequence = __pyx_t_3;
          #if CYTHON_COMPILING_IN_CPYTHON
          Py_ssize_t size = Py_SIZE(sequence);
          #else
          Py_ssize_t size = PySequence_Size(sequence);
          #endif
          if (unlikely(size != 2)) {
            if (size > 2) __Pyx_RaiseTooManyValuesError(2);
            else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          #if CYTHON_COMPILING_IN_CPYTHON
          if (likely(PyTuple_CheckExact(sequence))) {
            __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
            __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
          } else {
            __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
            __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
          }
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_1);
          #else
          __pyx_t_7 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          #endif
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else {
          Py_ssize_t index = -1;
          __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_15 = Py_TYPE(__pyx_t_2)->tp_iternext;
          index = 0; __pyx_t_7 = __pyx_t_15(__pyx_t_2); if (unlikely(!__pyx_t_7)) goto __pyx_L18_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_7);
          index = 1; __pyx_t_1 = __pyx_t_15(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L18_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_1);
          if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_2), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_15 = NULL;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L19_unpacking_done;
          __pyx_L18_unpacking_failed:;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_15 = NULL;
          if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1516; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_L19_unpacking_done:;
        }
        __Pyx_XDECREF_SET(__pyx_v_d_new, __pyx_t_7);
        __pyx_t_7 = 0;
        __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "qnet.pyx":1518
 *                 d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=scale)
 * 
 *                 if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *                     print "================="
 *                     print evt
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {

          /* "qnet.pyx":1519
 * 
 *                 if DEBUG_INITIAL:
 *                     print "================="             # <<<<<<<<<<<<<<
 *                     print evt
 *                     print "D_NEW ", d_new
 */
          if (__Pyx_PrintOne(0, __pyx_kp_s__27) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1519; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":1520
 *                 if DEBUG_INITIAL:
 *                     print "================="
 *                     print evt             # <<<<<<<<<<<<<<
 *                     print "D_NEW ", d_new
 *                     print "::::::::::::::::::::::::::"
 */
          if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_evt)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1520; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":1521
 *                     print "================="
 *                     print evt
 *                     print "D_NEW ", d_new             # <<<<<<<<<<<<<<
 *                     print "::::::::::::::::::::::::::"
 *                     print evt.prev_byq.dump() if evt.prev_byq else None
 */
          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_kp_s_D_NEW);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_s_D_NEW);
          __Pyx_GIVEREF(__pyx_kp_s_D_NEW);
          __Pyx_INCREF(__pyx_v_d_new);
          PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_d_new);
          __Pyx_GIVEREF(__pyx_v_d_new);
          if (__Pyx_Print(0, __pyx_t_3, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1521; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1522
 *                     print evt
 *                     print "D_NEW ", d_new
 *                     print "::::::::::::::::::::::::::"             # <<<<<<<<<<<<<<
 *                     print evt.prev_byq.dump() if evt.prev_byq else None
 *                     print evt.dump()
 */
          if (__Pyx_PrintOne(0, __pyx_kp_s__28) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1522; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":1523
 *                     print "D_NEW ", d_new
 *                     print "::::::::::::::::::::::::::"
 *                     print evt.prev_byq.dump() if evt.prev_byq else None             # <<<<<<<<<<<<<<
 *                     print evt.dump()
 *                     print evt.next_byq.dump() if evt.next_byq else None
 */
          __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byq); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__pyx_t_13) {
            __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->prev_byq, __pyx_n_s_dump); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __pyx_t_2 = NULL;
            if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
              __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
              if (likely(__pyx_t_2)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
                __Pyx_INCREF(__pyx_t_2);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_7, function);
              }
            }
            if (__pyx_t_2) {
              __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            } else {
              __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            }
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_3 = __pyx_t_1;
            __pyx_t_1 = 0;
          } else {
            __Pyx_INCREF(Py_None);
            __pyx_t_3 = Py_None;
          }
          if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1523; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1524
 *                     print "::::::::::::::::::::::::::"
 *                     print evt.prev_byq.dump() if evt.prev_byq else None
 *                     print evt.dump()             # <<<<<<<<<<<<<<
 *                     print evt.next_byq.dump() if evt.next_byq else None
 *                     print "::::::::::::::::::::::::::"
 */
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_dump); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_7 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          if (__pyx_t_7) {
            __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else {
            __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1524; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1525
 *                     print evt.prev_byq.dump() if evt.prev_byq else None
 *                     print evt.dump()
 *                     print evt.next_byq.dump() if evt.next_byq else None             # <<<<<<<<<<<<<<
 *                     print "::::::::::::::::::::::::::"
 *                     print "diff_list: ", diff_list
 */
          __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__pyx_t_13) {
            __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->next_byq, __pyx_n_s_dump); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __pyx_t_2 = NULL;
            if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
              __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
              if (likely(__pyx_t_2)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
                __Pyx_INCREF(__pyx_t_2);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_7, function);
              }
            }
            if (__pyx_t_2) {
              __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            } else {
              __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            }
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_3 = __pyx_t_1;
            __pyx_t_1 = 0;
          } else {
            __Pyx_INCREF(Py_None);
            __pyx_t_3 = Py_None;
          }
          if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1525; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1526
 *                     print evt.dump()
 *                     print evt.next_byq.dump() if evt.next_byq else None
 *                     print "::::::::::::::::::::::::::"             # <<<<<<<<<<<<<<
 *                     print "diff_list: ", diff_list
 *                     #print result
 */
          if (__Pyx_PrintOne(0, __pyx_kp_s__28) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1526; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "qnet.pyx":1527
 *                     print evt.next_byq.dump() if evt.next_byq else None
 *                     print "::::::::::::::::::::::::::"
 *                     print "diff_list: ", diff_list             # <<<<<<<<<<<<<<
 *                     #print result
 *                     print ":::::::  Event %d done :::::::::::::::::::\n"  % evt.eid
 */
          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_kp_s_diff_list_2);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_s_diff_list_2);
          __Pyx_GIVEREF(__pyx_kp_s_diff_list_2);
          __Pyx_INCREF(__pyx_v_diff_list);
          PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_diff_list);
          __Pyx_GIVEREF(__pyx_v_diff_list);
          if (__Pyx_Print(0, __pyx_t_3, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1529
 *                     print "diff_list: ", diff_list
 *                     #print result
 *                     print ":::::::  Event %d done :::::::::::::::::::\n"  % evt.eid             # <<<<<<<<<<<<<<
 * 
 *                 result.applyDiffList (diff_list)
 */
          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Event_d_done, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          goto __pyx_L20;
        }
        __pyx_L20:;

        /* "qnet.pyx":1531
 *                     print ":::::::  Event %d done :::::::::::::::::::\n"  % evt.eid
 * 
 *                 result.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 * 
 *                 if DEBUG_INITIAL:
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (!__pyx_t_7) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
          __Pyx_INCREF(__pyx_v_diff_list);
          PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_v_diff_list);
          __Pyx_GIVEREF(__pyx_v_diff_list);
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "qnet.pyx":1533
 *                 result.applyDiffList (diff_list)
 * 
 *                 if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *                     print "diff_list ", diff_list
 *                     result.validate()
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {

          /* "qnet.pyx":1534
 * 
 *                 if DEBUG_INITIAL:
 *                     print "diff_list ", diff_list             # <<<<<<<<<<<<<<
 *                     result.validate()
 * 
 */
          __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_INCREF(__pyx_kp_s_diff_list_3);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_diff_list_3);
          __Pyx_GIVEREF(__pyx_kp_s_diff_list_3);
          __Pyx_INCREF(__pyx_v_diff_list);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_diff_list);
          __Pyx_GIVEREF(__pyx_v_diff_list);
          if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1534; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "qnet.pyx":1535
 *                 if DEBUG_INITIAL:
 *                     print "diff_list ", diff_list
 *                     result.validate()             # <<<<<<<<<<<<<<
 * 
 *                 if len(path) == 0: break
 */
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_2 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          if (__pyx_t_2) {
            __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          } else {
            __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          goto __pyx_L21;
        }
        __pyx_L21:;

        /* "qnet.pyx":1537
 *                     result.validate()
 * 
 *                 if len(path) == 0: break             # <<<<<<<<<<<<<<
 * 
 *                 # compute new evt
 */
        __pyx_t_9 = PyObject_Length(__pyx_v_path); if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_13 = ((__pyx_t_9 == 0) != 0);
        if (__pyx_t_13) {
          goto __pyx_L17_break;
        }

        /* "qnet.pyx":1540
 * 
 *                 # compute new evt
 *                 sid, qid = path.pop (0)             # <<<<<<<<<<<<<<
 *                 if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)
 * 
 */
        __pyx_t_1 = __Pyx_PyObject_PopIndex(__pyx_v_path, 0, 1, Py_ssize_t, PyInt_FromSsize_t); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
          PyObject* sequence = __pyx_t_1;
          #if CYTHON_COMPILING_IN_CPYTHON
          Py_ssize_t size = Py_SIZE(sequence);
          #else
          Py_ssize_t size = PySequence_Size(sequence);
          #endif
          if (unlikely(size != 2)) {
            if (size > 2) __Pyx_RaiseTooManyValuesError(2);
            else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          #if CYTHON_COMPILING_IN_CPYTHON
          if (likely(PyTuple_CheckExact(sequence))) {
            __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
            __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
          } else {
            __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
            __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
          }
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_2);
          #else
          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          #endif
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        } else {
          Py_ssize_t index = -1;
          __pyx_t_7 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_15 = Py_TYPE(__pyx_t_7)->tp_iternext;
          index = 0; __pyx_t_3 = __pyx_t_15(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L23_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_3);
          index = 1; __pyx_t_2 = __pyx_t_15(__pyx_t_7); if (unlikely(!__pyx_t_2)) goto __pyx_L23_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_2);
          if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_7), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_t_15 = NULL;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          goto __pyx_L24_unpacking_done;
          __pyx_L23_unpacking_failed:;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_15 = NULL;
          if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_L24_unpacking_done:;
        }
        __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_3);
        __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":1541
 *                 # compute new evt
 *                 sid, qid = path.pop (0)
 *                 if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)             # <<<<<<<<<<<<<<
 * 
 *                 q = net.queues[qid]
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {
          __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_INCREF(__pyx_v_tid);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_tid);
          __Pyx_GIVEREF(__pyx_v_tid);
          __Pyx_INCREF(__pyx_v_sid);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sid);
          __Pyx_GIVEREF(__pyx_v_sid);
          __Pyx_INCREF(__pyx_v_qid);
          PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_qid);
          __Pyx_GIVEREF(__pyx_v_qid);
          __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_TID_s_SID_s_QID_s, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L25;
        }
        __pyx_L25:;

        /* "qnet.pyx":1543
 *                 if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)
 * 
 *                 q = net.queues[qid]             # <<<<<<<<<<<<<<
 *                 evt = Event (eid, tid, qid, q, d_new, 0.0, d_new, sid, 0)
 *                 eid += 1
 */
        __pyx_t_2 = PyObject_GetItem(__pyx_v_net->queues, __pyx_v_qid); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1543; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_2);
        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1543; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1544
 * 
 *                 q = net.queues[qid]
 *                 evt = Event (eid, tid, qid, q, d_new, 0.0, d_new, sid, 0)             # <<<<<<<<<<<<<<
 *                 eid += 1
 * 
 */
        __pyx_t_2 = PyTuple_New(9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_v_eid);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_eid);
        __Pyx_GIVEREF(__pyx_v_eid);
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __Pyx_INCREF(__pyx_v_qid);
        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_qid);
        __Pyx_GIVEREF(__pyx_v_qid);
        __Pyx_INCREF(((PyObject *)__pyx_v_q));
        PyTuple_SET_ITEM(__pyx_t_2, 3, ((PyObject *)__pyx_v_q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
        __Pyx_INCREF(__pyx_v_d_new);
        PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_v_d_new);
        __Pyx_GIVEREF(__pyx_v_d_new);
        __Pyx_INCREF(__pyx_float_0_0);
        PyTuple_SET_ITEM(__pyx_t_2, 5, __pyx_float_0_0);
        __Pyx_GIVEREF(__pyx_float_0_0);
        __Pyx_INCREF(__pyx_v_d_new);
        PyTuple_SET_ITEM(__pyx_t_2, 6, __pyx_v_d_new);
        __Pyx_GIVEREF(__pyx_v_d_new);
        __Pyx_INCREF(__pyx_v_sid);
        PyTuple_SET_ITEM(__pyx_t_2, 7, __pyx_v_sid);
        __Pyx_GIVEREF(__pyx_v_sid);
        __Pyx_INCREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_t_2, 8, __pyx_int_0);
        __Pyx_GIVEREF(__pyx_int_0);
        __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
        __pyx_t_1 = 0;

        /* "qnet.pyx":1545
 *                 q = net.queues[qid]
 *                 evt = Event (eid, tid, qid, q, d_new, 0.0, d_new, sid, 0)
 *                 eid += 1             # <<<<<<<<<<<<<<
 * 
 *                 result.insert (evt)
 */
        __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "qnet.pyx":1547
 *                 eid += 1
 * 
 *                 result.insert (evt)             # <<<<<<<<<<<<<<
 *                 q.recompute_departure (result, evt)
 *                 q.update_caches_for (evt)
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1547; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "qnet.pyx":1548
 * 
 *                 result.insert (evt)
 *                 q.recompute_departure (result, evt)             # <<<<<<<<<<<<<<
 *                 q.update_caches_for (evt)
 *                 q.initialize_auxiliaries (evt)
 */
        __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_departure(__pyx_v_q, __pyx_v_result, __pyx_v_evt, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "qnet.pyx":1549
 *                 result.insert (evt)
 *                 q.recompute_departure (result, evt)
 *                 q.update_caches_for (evt)             # <<<<<<<<<<<<<<
 *                 q.initialize_auxiliaries (evt)
 * 
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_update_caches_for); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_7 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_7) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_3, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1549; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "qnet.pyx":1550
 *                 q.recompute_departure (result, evt)
 *                 q.update_caches_for (evt)
 *                 q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 * 
 *     net.demarkovize (dists)
 */
        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt));
          PyTuple_SET_ITEM(__pyx_t_7, 0+1, ((PyObject *)__pyx_v_evt));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1550; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_L17_break:;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "qnet.pyx":1492
 *     # now add unobserved events
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):             # <<<<<<<<<<<<<<
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 */
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":1552
 *                 q.initialize_auxiliaries (evt)
 * 
 *     net.demarkovize (dists)             # <<<<<<<<<<<<<<
 * 
 *     return result
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_demarkovize); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_dists); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
  } else {
    __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(__pyx_v_dists);
    PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_dists);
    __Pyx_GIVEREF(__pyx_v_dists);
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1552; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":1554
 *     net.demarkovize (dists)
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  /* "qnet.pyx":1454
 *     return initializer (net, arrv)
 * 
 * def gibbs_initialize_via_dfn (Qnet net, Arrivals arrv, scale):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_dfn", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_prev);
  __Pyx_XDECREF((PyObject *)__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_dists);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_evts);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XDECREF(__pyx_v_tasks);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF(__pyx_v_d_new);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1557
 * 
 * 
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):             # <<<<<<<<<<<<<<
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_55init_insert_observed_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_55init_insert_observed_tasks = {"init_insert_observed_tasks", (PyCFunction)__pyx_pw_4qnet_55init_insert_observed_tasks, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_55init_insert_observed_tasks(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  PyObject *__pyx_v_add_initial = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("init_insert_observed_tasks (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_result,&__pyx_n_s_add_initial,0};
    PyObject* values[3] = {0,0,0};
    values[2] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_result)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("init_insert_observed_tasks", 0, 2, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_add_initial);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "init_insert_observed_tasks") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[0]);
    __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_add_initial = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("init_insert_observed_tasks", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.init_insert_observed_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_result), __pyx_ptype_8arrivals_Arrivals, 1, "result", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_54init_insert_observed_tasks(__pyx_self, __pyx_v_arrv, __pyx_v_result, __pyx_v_add_initial);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_54init_insert_observed_tasks(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result, PyObject *__pyx_v_add_initial) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_evts = NULL;
  PyObject *__pyx_v_diff_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  double __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("init_insert_observed_tasks", 0);

  /* "qnet.pyx":1559
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1559; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1560
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():
 *         evts = arrv.events_of_task(tid)             # <<<<<<<<<<<<<<
 *         if evts[0].obs_d:
 *             for evt in evts:
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1560; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1561
 *     for tid in arrv.all_tasks():
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:             # <<<<<<<<<<<<<<
 *             for evt in evts:
 *                 if add_initial or evt.qid > 0:
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1561; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":1562
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 *             for evt in evts:             # <<<<<<<<<<<<<<
 *                 if add_initial or evt.qid > 0:
 *                     evt_new = evt.duplicate()
 */
      if (likely(PyList_CheckExact(__pyx_v_evts)) || PyTuple_CheckExact(__pyx_v_evts)) {
        __pyx_t_3 = __pyx_v_evts; __Pyx_INCREF(__pyx_t_3); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
      } else {
        __pyx_t_9 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_evts); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (likely(!__pyx_t_10)) {
          if (likely(PyList_CheckExact(__pyx_t_3))) {
            if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_3)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #else
            __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #endif
          } else {
            if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
            #if CYTHON_COMPILING_IN_CPYTHON
            __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #else
            __pyx_t_1 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            #endif
          }
        } else {
          __pyx_t_1 = __pyx_t_10(__pyx_t_3);
          if (unlikely(!__pyx_t_1)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_1);
        }
        if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1562; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
        __pyx_t_1 = 0;

        /* "qnet.pyx":1563
 *         if evts[0].obs_d:
 *             for evt in evts:
 *                 if add_initial or evt.qid > 0:             # <<<<<<<<<<<<<<
 *                     evt_new = evt.duplicate()
 *                     evt_new.s = 0.0
 */
        __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_add_initial); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1563; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (!__pyx_t_11) {
        } else {
          __pyx_t_8 = __pyx_t_11;
          goto __pyx_L9_bool_binop_done;
        }
        __pyx_t_11 = ((__pyx_v_evt->qid > 0) != 0);
        __pyx_t_8 = __pyx_t_11;
        __pyx_L9_bool_binop_done:;
        if (__pyx_t_8) {

          /* "qnet.pyx":1564
 *             for evt in evts:
 *                 if add_initial or evt.qid > 0:
 *                     evt_new = evt.duplicate()             # <<<<<<<<<<<<<<
 *                     evt_new.s = 0.0
 *                     evt_new.d = evt_new.a + evt_new.wait()
 */
          __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->duplicate(__pyx_v_evt, 0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1564; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_XDECREF_SET(__pyx_v_evt_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "qnet.pyx":1565
 *                 if add_initial or evt.qid > 0:
 *                     evt_new = evt.duplicate()
 *                     evt_new.s = 0.0             # <<<<<<<<<<<<<<
 *                     evt_new.d = evt_new.a + evt_new.wait()
 *                     if DEBUG_INITIAL: print "Adding observed event ", evt_new
 */
          __pyx_v_evt_new->s = 0.0;

          /* "qnet.pyx":1566
 *                     evt_new = evt.duplicate()
 *                     evt_new.s = 0.0
 *                     evt_new.d = evt_new.a + evt_new.wait()             # <<<<<<<<<<<<<<
 *                     if DEBUG_INITIAL: print "Adding observed event ", evt_new
 *                     result.insert (evt_new)
 */
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt_new->a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt_new), __pyx_n_s_wait); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_12 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
            }
          }
          if (__pyx_t_12) {
            __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          } else {
            __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_6 = PyNumber_Add(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_v_evt_new->d = __pyx_t_13;

          /* "qnet.pyx":1567
 *                     evt_new.s = 0.0
 *                     evt_new.d = evt_new.a + evt_new.wait()
 *                     if DEBUG_INITIAL: print "Adding observed event ", evt_new             # <<<<<<<<<<<<<<
 *                     result.insert (evt_new)
 *                     diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 */
          if (__pyx_e_4qnet_DEBUG_INITIAL) {
            __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_INCREF(__pyx_kp_s_Adding_observed_event);
            PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_s_Adding_observed_event);
            __Pyx_GIVEREF(__pyx_kp_s_Adding_observed_event);
            __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
            PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_v_evt_new));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
            if (__Pyx_Print(0, __pyx_t_6, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1567; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L11;
          }
          __pyx_L11:;

          /* "qnet.pyx":1568
 *                     evt_new.d = evt_new.a + evt_new.wait()
 *                     if DEBUG_INITIAL: print "Adding observed event ", evt_new
 *                     result.insert (evt_new)             # <<<<<<<<<<<<<<
 *                     diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                     result.applyDiffList (diff_list)
 */
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
            }
          }
          if (!__pyx_t_1) {
            __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt_new)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
          } else {
            __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_12);
            PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
            PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_evt_new));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
            __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1568; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "qnet.pyx":1569
 *                     if DEBUG_INITIAL: print "Adding observed event ", evt_new
 *                     result.insert (evt_new)
 *                     diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)             # <<<<<<<<<<<<<<
 *                     result.applyDiffList (diff_list)
 *                     evt_new.q.initialize_auxiliaries (evt_new)
 */
          __pyx_t_6 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt_new->q->__pyx_vtab)->diffListForDeparture(__pyx_v_evt_new->q, __pyx_v_evt_new, __pyx_v_evt->d); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_6);
          __pyx_t_6 = 0;

          /* "qnet.pyx":1570
 *                     result.insert (evt_new)
 *                     diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                     result.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 *                     evt_new.q.initialize_auxiliaries (evt_new)
 * 
 */
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_12 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
            }
          }
          if (!__pyx_t_12) {
            __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_diff_list); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
          } else {
            __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_1);
            PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
            __Pyx_INCREF(__pyx_v_diff_list);
            PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_diff_list);
            __Pyx_GIVEREF(__pyx_v_diff_list);
            __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1570; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

          /* "qnet.pyx":1571
 *                     diff_list = evt_new.q.diffListForDeparture (evt_new, evt.d)
 *                     result.applyDiffList (diff_list)
 *                     evt_new.q.initialize_auxiliaries (evt_new)             # <<<<<<<<<<<<<<
 * 
 *     # now add unobserved initial events
 */
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt_new->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
            }
          }
          if (!__pyx_t_1) {
            __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt_new)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
          } else {
            __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_12);
            PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
            PyTuple_SET_ITEM(__pyx_t_12, 0+1, ((PyObject *)__pyx_v_evt_new));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
            __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1571; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L8;
        }
        __pyx_L8:;

        /* "qnet.pyx":1562
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 *             for evt in evts:             # <<<<<<<<<<<<<<
 *                 if add_initial or evt.qid > 0:
 *                     evt_new = evt.duplicate()
 */
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1559
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if evts[0].obs_d:
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1557
 * 
 * 
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):             # <<<<<<<<<<<<<<
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.init_insert_observed_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_evts);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1574
 * 
 *     # now add unobserved initial events
 * def init_add_initial_events (Qnet net, Arrivals arrv, Arrivals result):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     cdef Queue q
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_57init_add_initial_events(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_57init_add_initial_events = {"init_add_initial_events", (PyCFunction)__pyx_pw_4qnet_57init_add_initial_events, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_57init_add_initial_events(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("init_add_initial_events (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,&__pyx_n_s_result,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("init_add_initial_events", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_result)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("init_add_initial_events", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "init_add_initial_events") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("init_add_initial_events", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.init_add_initial_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_result), __pyx_ptype_8arrivals_Arrivals, 1, "result", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_56init_add_initial_events(__pyx_self, __pyx_v_net, __pyx_v_arrv, __pyx_v_result);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_56init_add_initial_events(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  double __pyx_v_d_prev;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_tasks = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_evts = NULL;
  PyObject *__pyx_v_path = NULL;
  int __pyx_v_eid_prev;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_prev = NULL;
  PyObject *__pyx_v_d_new = NULL;
  PyObject *__pyx_v_diff_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  double __pyx_t_12;
  PyObject *(*__pyx_t_13)(PyObject *);
  Py_ssize_t __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("init_add_initial_events", 0);

  /* "qnet.pyx":1578
 *     cdef Queue q
 *     cdef double d_prev
 *     heap = []             # <<<<<<<<<<<<<<
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1578; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_heap = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1579
 *     cdef double d_prev
 *     heap = []
 *     tasks = arrv.all_tasks()             # <<<<<<<<<<<<<<
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_all_tasks); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1579; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_tasks = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1580
 *     heap = []
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):             # <<<<<<<<<<<<<<
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 */
  __pyx_t_4 = PyObject_Length(__pyx_v_tasks); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_xrange, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1580; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1581
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]             # <<<<<<<<<<<<<<
 *         evts = arrv.events_of_task(tid)
 *         if not evts[0].obs_d:
 */
    __pyx_t_1 = PyObject_GetItem(__pyx_v_tasks, __pyx_v_i); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1581; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1582
 *     for i in xrange(len(tasks)):
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)             # <<<<<<<<<<<<<<
 *         if not evts[0].obs_d:
 *             path = net.sample_path()
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1582; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evts, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1583
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 *         if not evts[0].obs_d:             # <<<<<<<<<<<<<<
 *             path = net.sample_path()
 *             evt = (<Event> evts[0]).duplicate()
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1583; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1583; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_9 = ((!__pyx_t_8) != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1584
 *         evts = arrv.events_of_task(tid)
 *         if not evts[0].obs_d:
 *             path = net.sample_path()             # <<<<<<<<<<<<<<
 *             evt = (<Event> evts[0]).duplicate()
 * 
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_sample_path); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1584; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      if (__pyx_t_7) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1584; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else {
        __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1584; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_path, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "qnet.pyx":1585
 *         if not evts[0].obs_d:
 *             path = net.sample_path()
 *             evt = (<Event> evts[0]).duplicate()             # <<<<<<<<<<<<<<
 * 
 *             # special case: initial arrival (maintain initial arrival order)
 */
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1585; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)((struct __pyx_obj_8arrivals_Event *)__pyx_t_3)->__pyx_vtab)->duplicate(((struct __pyx_obj_8arrivals_Event *)__pyx_t_3), 0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1585; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "qnet.pyx":1588
 * 
 *             # special case: initial arrival (maintain initial arrival order)
 *             if i > 0:             # <<<<<<<<<<<<<<
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_9) {

        /* "qnet.pyx":1589
 *             # special case: initial arrival (maintain initial arrival order)
 *             if i > 0:
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid             # <<<<<<<<<<<<<<
 *                 evt_prev = result.event (eid_prev)
 *                 d_prev = evt_prev.d
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = PyNumber_Subtract(__pyx_v_i, __pyx_int_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyObject_GetItem(__pyx_v_tasks, __pyx_t_7); if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (!__pyx_t_7) {
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else {
          __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
          PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_6);
          __pyx_t_6 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1589; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_11 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3)->eid;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_eid_prev = __pyx_t_11;

        /* "qnet.pyx":1590
 *             if i > 0:
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)             # <<<<<<<<<<<<<<
 *                 d_prev = evt_prev.d
 *             else:
 */
        __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_result->__pyx_vtab)->event(__pyx_v_result, __pyx_v_eid_prev, 0)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1590; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_XDECREF_SET(__pyx_v_evt_prev, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
        __pyx_t_3 = 0;

        /* "qnet.pyx":1591
 *                 eid_prev = (<Event> arrv.events_of_task(tasks[i-1])[0]).eid
 *                 evt_prev = result.event (eid_prev)
 *                 d_prev = evt_prev.d             # <<<<<<<<<<<<<<
 *             else:
 *                 d_prev = 0
 */
        __pyx_t_12 = __pyx_v_evt_prev->d;
        __pyx_v_d_prev = __pyx_t_12;
        goto __pyx_L6;
      }
      /*else*/ {

        /* "qnet.pyx":1593
 *                 d_prev = evt_prev.d
 *             else:
 *                 d_prev = 0             # <<<<<<<<<<<<<<
 * 
 *             evt.s = 1e-10
 */
        __pyx_v_d_prev = 0.0;
      }
      __pyx_L6:;

      /* "qnet.pyx":1595
 *                 d_prev = 0
 * 
 *             evt.s = 1e-10             # <<<<<<<<<<<<<<
 *             evt.d = d_prev + 1e-10
 *             if DEBUG_INITIAL: print "Adding initial event ", evt
 */
      __pyx_v_evt->s = 1e-10;

      /* "qnet.pyx":1596
 * 
 *             evt.s = 1e-10
 *             evt.d = d_prev + 1e-10             # <<<<<<<<<<<<<<
 *             if DEBUG_INITIAL: print "Adding initial event ", evt
 * 
 */
      __pyx_v_evt->d = (__pyx_v_d_prev + 1e-10);

      /* "qnet.pyx":1597
 *             evt.s = 1e-10
 *             evt.d = d_prev + 1e-10
 *             if DEBUG_INITIAL: print "Adding initial event ", evt             # <<<<<<<<<<<<<<
 * 
 *             result.insert (evt)
 */
      if (__pyx_e_4qnet_DEBUG_INITIAL) {
        __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_kp_s_Adding_initial_event);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_s_Adding_initial_event);
        __Pyx_GIVEREF(__pyx_kp_s_Adding_initial_event);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        if (__Pyx_Print(0, __pyx_t_3, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "qnet.pyx":1599
 *             if DEBUG_INITIAL: print "Adding initial event ", evt
 * 
 *             result.insert (evt)             # <<<<<<<<<<<<<<
 *             q = evt.q
 *             q.recompute_service (evt)
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      if (!__pyx_t_10) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_10); __Pyx_GIVEREF(__pyx_t_10); __pyx_t_10 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_6, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "qnet.pyx":1600
 * 
 *             result.insert (evt)
 *             q = evt.q             # <<<<<<<<<<<<<<
 *             q.recompute_service (evt)
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 */
      __pyx_t_3 = ((PyObject *)__pyx_v_evt->q);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "qnet.pyx":1601
 *             result.insert (evt)
 *             q = evt.q
 *             q.recompute_service (evt)             # <<<<<<<<<<<<<<
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 * 
 */
      __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_service(__pyx_v_q, __pyx_v_evt, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "qnet.pyx":1602
 *             q = evt.q
 *             q.recompute_service (evt)
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)             # <<<<<<<<<<<<<<
 * 
 *             d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)
 */
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_9 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_9) {
        if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_3 = __pyx_v_evt->next_byq;
        __Pyx_INCREF(__pyx_t_3);
        __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt->next_byq)->q->__pyx_vtab)->recompute_service(((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt->next_byq)->q, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L8;
      }
      __pyx_L8:;

      /* "qnet.pyx":1604
 *             if evt.next_byq: (<Event> evt.next_byq).q.recompute_service (evt.next_byq)
 * 
 *             d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)             # <<<<<<<<<<<<<<
 *             result.applyDiffList (diff_list)
 * 
 */
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_sample_d_until_acceptance); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(((PyObject *)__pyx_v_net));
      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_net));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
      __Pyx_INCREF(((PyObject *)__pyx_v_result));
      PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_result));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_3, 2, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_6 = PyDict_New(); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_service_only, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_scale, __pyx_float_1_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
        PyObject* sequence = __pyx_t_10;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        #else
        __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        #endif
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_1 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_13 = Py_TYPE(__pyx_t_1)->tp_iternext;
        index = 0; __pyx_t_6 = __pyx_t_13(__pyx_t_1); if (unlikely(!__pyx_t_6)) goto __pyx_L9_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_6);
        index = 1; __pyx_t_3 = __pyx_t_13(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L9_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_3);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_13(__pyx_t_1), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_13 = NULL;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L10_unpacking_done;
        __pyx_L9_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_13 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L10_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_d_new, __pyx_t_6);
      __pyx_t_6 = 0;
      __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "qnet.pyx":1605
 * 
 *             d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)
 *             result.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 * 
 *             heappush (heap, (d_new, tid, path))
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_diff_list); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
      } else {
        __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_INCREF(__pyx_v_diff_list);
        PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_diff_list);
        __Pyx_GIVEREF(__pyx_v_diff_list);
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "qnet.pyx":1607
 *             result.applyDiffList (diff_list)
 * 
 *             heappush (heap, (d_new, tid, path))             # <<<<<<<<<<<<<<
 *     return heap
 * 
 */
      __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_d_new);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_d_new);
      __Pyx_GIVEREF(__pyx_v_d_new);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __Pyx_INCREF(__pyx_v_path);
      PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_path);
      __Pyx_GIVEREF(__pyx_v_path);
      __pyx_t_6 = NULL;
      __pyx_t_14 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_14 = 1;
        }
      }
      __pyx_t_7 = PyTuple_New(2+__pyx_t_14); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_6) {
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_14, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_14, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1580
 *     heap = []
 *     tasks = arrv.all_tasks()
 *     for i in xrange(len(tasks)):             # <<<<<<<<<<<<<<
 *         tid = tasks[i]
 *         evts = arrv.events_of_task(tid)
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1608
 * 
 *             heappush (heap, (d_new, tid, path))
 *     return heap             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_order (Qnet net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_heap);
  __pyx_r = __pyx_v_heap;
  goto __pyx_L0;

  /* "qnet.pyx":1574
 * 
 *     # now add unobserved initial events
 * def init_add_initial_events (Qnet net, Arrivals arrv, Arrivals result):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     cdef Queue q
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("qnet.init_add_initial_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_tasks);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_evts);
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_prev);
  __Pyx_XDECREF(__pyx_v_d_new);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1610
 *     return heap
 * 
 * def gibbs_initialize_via_order (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_59gibbs_initialize_via_order(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_59gibbs_initialize_via_order = {"gibbs_initialize_via_order", (PyCFunction)__pyx_pw_4qnet_59gibbs_initialize_via_order, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_59gibbs_initialize_via_order(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_order (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_order", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_order") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_order", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_order", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_58gibbs_initialize_via_order(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_58gibbs_initialize_via_order(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  CYTHON_UNUSED PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_dists = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_path = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_v_d_new = NULL;
  PyObject *__pyx_v_diff_list = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_order", 0);

  /* "qnet.pyx":1616
 *     cdef Queue q
 *     cdef Event evt, evt_new, evt_prev, evt1
 *     cdef Arrivals result = Arrivals(net)             # <<<<<<<<<<<<<<
 * 
 *     s_initial = net.fsm.initial_state()
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1618
 *     cdef Arrivals result = Arrivals(net)
 * 
 *     s_initial = net.fsm.initial_state()             # <<<<<<<<<<<<<<
 *     eid = arrv.max_eidx()+1
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_net->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_s_initial = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1619
 * 
 *     s_initial = net.fsm.initial_state()
 *     eid = arrv.max_eidx()+1             # <<<<<<<<<<<<<<
 * 
 *     dists = net.markovize_from_arrivals (arrv)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_eid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1621
 *     eid = arrv.max_eidx()+1
 * 
 *     dists = net.markovize_from_arrivals (arrv)             # <<<<<<<<<<<<<<
 * 
 *     if DEBUG_INITIAL:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_markovize_from_arrivals); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dists = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1623
 *     dists = net.markovize_from_arrivals (arrv)
 * 
 *     if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"
 */
  if (__pyx_e_4qnet_DEBUG_INITIAL) {

    /* "qnet.pyx":1624
 * 
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters             # <<<<<<<<<<<<<<
 *         print "Adding observed events"
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_Parameters);
    __Pyx_GIVEREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1625
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"             # <<<<<<<<<<<<<<
 * 
 *     # first add observed events
 */
    if (__Pyx_PrintOne(0, __pyx_kp_s_Adding_observed_events) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1628
 * 
 *     # first add observed events
 *     init_insert_observed_tasks (arrv, result)             # <<<<<<<<<<<<<<
 * 
 * #   This actually need not hold for GG1R queues
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_init_insert_observed_tasks); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (__pyx_t_4) {
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1633
 * #    result.validate()
 * 
 *     if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *         print "Adding unobserved events"
 *         print result
 */
  if (__pyx_e_4qnet_DEBUG_INITIAL) {

    /* "qnet.pyx":1634
 * 
 *     if DEBUG_INITIAL:
 *         print "Adding unobserved events"             # <<<<<<<<<<<<<<
 *         print result
 * 
 */
    if (__Pyx_PrintOne(0, __pyx_kp_s_Adding_unobserved_events) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

    /* "qnet.pyx":1635
 *     if DEBUG_INITIAL:
 *         print "Adding unobserved events"
 *         print result             # <<<<<<<<<<<<<<
 * 
 *     # now add unobserved initial events
 */
    if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_result)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "qnet.pyx":1638
 * 
 *     # now add unobserved initial events
 *     heap = init_add_initial_events (net, arrv, result)             # <<<<<<<<<<<<<<
 * 
 *     while heap:
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_init_add_initial_events); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_5, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_heap = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1640
 *     heap = init_add_initial_events (net, arrv, result)
 * 
 *     while heap:             # <<<<<<<<<<<<<<
 *         a, tid, path = heappop(heap)
 *         sid, qid = path.pop (0)
 */
  while (1) {
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_heap); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_6) break;

    /* "qnet.pyx":1641
 * 
 *     while heap:
 *         a, tid, path = heappop(heap)             # <<<<<<<<<<<<<<
 *         sid, qid = path.pop (0)
 *         if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappop); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_4) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_heap); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 3)) {
        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_8 = Py_TYPE(__pyx_t_7)->tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_1)) goto __pyx_L7_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_3 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L7_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 2; __pyx_t_4 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L7_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_7), 3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L8_unpacking_done;
      __pyx_L7_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1641; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L8_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_a, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_path, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1642
 *     while heap:
 *         a, tid, path = heappop(heap)
 *         sid, qid = path.pop (0)             # <<<<<<<<<<<<<<
 *         if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_PopIndex(__pyx_v_path, 0, 1, Py_ssize_t, PyInt_FromSsize_t); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      #else
      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_8 = Py_TYPE(__pyx_t_1)->tp_iternext;
      index = 0; __pyx_t_4 = __pyx_t_8(__pyx_t_1); if (unlikely(!__pyx_t_4)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      index = 1; __pyx_t_3 = __pyx_t_8(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_1), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L10_unpacking_done;
      __pyx_L9_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L10_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_4);
    __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1643
 *         a, tid, path = heappop(heap)
 *         sid, qid = path.pop (0)
 *         if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)             # <<<<<<<<<<<<<<
 * 
 *         q = net.queues[qid]
 */
    if (__pyx_e_4qnet_DEBUG_INITIAL) {
      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __Pyx_INCREF(__pyx_v_sid);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_sid);
      __Pyx_GIVEREF(__pyx_v_sid);
      __Pyx_INCREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_TID_s_SID_s_QID_s, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1643; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L11;
    }
    __pyx_L11:;

    /* "qnet.pyx":1645
 *         if DEBUG_INITIAL: print "TID: %s  SID: %s  QID: %s" % (tid, sid, qid)
 * 
 *         q = net.queues[qid]             # <<<<<<<<<<<<<<
 *         evt = Event (eid, tid, qid, q, a, 0.0, a, sid, 0)
 *         eid += 1
 */
    __pyx_t_3 = PyObject_GetItem(__pyx_v_net->queues, __pyx_v_qid); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_3);
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1645; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1646
 * 
 *         q = net.queues[qid]
 *         evt = Event (eid, tid, qid, q, a, 0.0, a, sid, 0)             # <<<<<<<<<<<<<<
 *         eid += 1
 * 
 */
    __pyx_t_3 = PyTuple_New(9); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_eid);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_eid);
    __Pyx_GIVEREF(__pyx_v_eid);
    __Pyx_INCREF(__pyx_v_tid);
    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_tid);
    __Pyx_GIVEREF(__pyx_v_tid);
    __Pyx_INCREF(__pyx_v_qid);
    PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_qid);
    __Pyx_GIVEREF(__pyx_v_qid);
    __Pyx_INCREF(((PyObject *)__pyx_v_q));
    PyTuple_SET_ITEM(__pyx_t_3, 3, ((PyObject *)__pyx_v_q));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
    __Pyx_INCREF(__pyx_v_a);
    PyTuple_SET_ITEM(__pyx_t_3, 4, __pyx_v_a);
    __Pyx_GIVEREF(__pyx_v_a);
    __Pyx_INCREF(__pyx_float_0_0);
    PyTuple_SET_ITEM(__pyx_t_3, 5, __pyx_float_0_0);
    __Pyx_GIVEREF(__pyx_float_0_0);
    __Pyx_INCREF(__pyx_v_a);
    PyTuple_SET_ITEM(__pyx_t_3, 6, __pyx_v_a);
    __Pyx_GIVEREF(__pyx_v_a);
    __Pyx_INCREF(__pyx_v_sid);
    PyTuple_SET_ITEM(__pyx_t_3, 7, __pyx_v_sid);
    __Pyx_GIVEREF(__pyx_v_sid);
    __Pyx_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_t_3, 8, __pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1646; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1647
 *         q = net.queues[qid]
 *         evt = Event (eid, tid, qid, q, a, 0.0, a, sid, 0)
 *         eid += 1             # <<<<<<<<<<<<<<
 * 
 *         result.insert (evt)
 */
    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1647; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1649
 *         eid += 1
 * 
 *         result.insert (evt)             # <<<<<<<<<<<<<<
 *         q.recompute_departure (result, evt)
 *         q.update_caches_for (evt)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_4) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1650
 * 
 *         result.insert (evt)
 *         q.recompute_departure (result, evt)             # <<<<<<<<<<<<<<
 *         q.update_caches_for (evt)
 *         q.initialize_auxiliaries (evt)
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->recompute_departure(__pyx_v_q, __pyx_v_result, __pyx_v_evt, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1650; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1651
 *         result.insert (evt)
 *         q.recompute_departure (result, evt)
 *         q.update_caches_for (evt)             # <<<<<<<<<<<<<<
 *         q.initialize_auxiliaries (evt)
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_update_caches_for); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_1) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1652
 *         q.recompute_departure (result, evt)
 *         q.update_caches_for (evt)
 *         q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 * 
 *         d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (!__pyx_t_4) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1652; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1654
 *         q.initialize_auxiliaries (evt)
 * 
 *         d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)             # <<<<<<<<<<<<<<
 *         if diff_list is None:
 *             # abort thin task
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_sample_d_until_acceptance); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(((PyObject *)__pyx_v_net));
    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_net));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
    __Pyx_INCREF(((PyObject *)__pyx_v_result));
    PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_result));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_3, 2, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_service_only, Py_True) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scale, __pyx_float_1_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
      PyObject* sequence = __pyx_t_4;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      #endif
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_2 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = Py_TYPE(__pyx_t_2)->tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L12_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_3 = __pyx_t_8(__pyx_t_2); if (unlikely(!__pyx_t_3)) goto __pyx_L12_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_2), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L13_unpacking_done;
      __pyx_L12_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L13_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_d_new, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1655
 * 
 *         d_new, diff_list = sample_d_until_acceptance (net, result, evt, service_only=True, scale=1.0)
 *         if diff_list is None:             # <<<<<<<<<<<<<<
 *             # abort thin task
 *             print "initialize_by_order: aborting task ", tid
 */
    __pyx_t_6 = (__pyx_v_diff_list == Py_None);
    __pyx_t_9 = (__pyx_t_6 != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1657
 *         if diff_list is None:
 *             # abort thin task
 *             print "initialize_by_order: aborting task ", tid             # <<<<<<<<<<<<<<
 *             result.delete_task (tid)
 *             continue
 */
      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_kp_s_initialize_by_order_aborting_tas);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_s_initialize_by_order_aborting_tas);
      __Pyx_GIVEREF(__pyx_kp_s_initialize_by_order_aborting_tas);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      if (__Pyx_Print(0, __pyx_t_4, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1657; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "qnet.pyx":1658
 *             # abort thin task
 *             print "initialize_by_order: aborting task ", tid
 *             result.delete_task (tid)             # <<<<<<<<<<<<<<
 *             continue
 * 
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_delete_task); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (!__pyx_t_1) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
      } else {
        __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
        __Pyx_INCREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1658; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "qnet.pyx":1659
 *             print "initialize_by_order: aborting task ", tid
 *             result.delete_task (tid)
 *             continue             # <<<<<<<<<<<<<<
 * 
 *         if DEBUG_INITIAL: print "DIFF LIST", "\n".join(map(str, diff_list))
 */
      goto __pyx_L5_continue;
    }

    /* "qnet.pyx":1661
 *             continue
 * 
 *         if DEBUG_INITIAL: print "DIFF LIST", "\n".join(map(str, diff_list))             # <<<<<<<<<<<<<<
 * 
 * #         for e0 in diff_list:
 */
    if (__pyx_e_4qnet_DEBUG_INITIAL) {
      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(((PyObject *)((PyObject*)(&PyString_Type))));
      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)((PyObject*)(&PyString_Type))));
      __Pyx_GIVEREF(((PyObject *)((PyObject*)(&PyString_Type))));
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyString_Join(__pyx_kp_s__2, __pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_kp_s_DIFF_LIST);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_s_DIFF_LIST);
      __Pyx_GIVEREF(__pyx_kp_s_DIFF_LIST);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      __pyx_t_4 = 0;
      if (__Pyx_Print(0, __pyx_t_3, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L15;
    }
    __pyx_L15:;

    /* "qnet.pyx":1670
 * #                 break
 * 
 *         result.applyDiffList (diff_list)             # <<<<<<<<<<<<<<
 * 
 *         if len(path) > 0:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_2) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_diff_list); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":1672
 *         result.applyDiffList (diff_list)
 * 
 *         if len(path) > 0:             # <<<<<<<<<<<<<<
 *             heappush (heap, (d_new, tid, path))
 * 
 */
    __pyx_t_5 = PyObject_Length(__pyx_v_path); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_9 = ((__pyx_t_5 > 0) != 0);
    if (__pyx_t_9) {

      /* "qnet.pyx":1673
 * 
 *         if len(path) > 0:
 *             heappush (heap, (d_new, tid, path))             # <<<<<<<<<<<<<<
 * 
 *     net.demarkovize (dists)
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_d_new);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_d_new);
      __Pyx_GIVEREF(__pyx_v_d_new);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __Pyx_INCREF(__pyx_v_path);
      PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_path);
      __Pyx_GIVEREF(__pyx_v_path);
      __pyx_t_2 = NULL;
      __pyx_t_5 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_5 = 1;
        }
      }
      __pyx_t_7 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_2) {
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
      }
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_5, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_5, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1673; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L16;
    }
    __pyx_L16:;
    __pyx_L5_continue:;
  }

  /* "qnet.pyx":1675
 *             heappush (heap, (d_new, tid, path))
 * 
 *     net.demarkovize (dists)             # <<<<<<<<<<<<<<
 * 
 *     for evt in result:
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_demarkovize); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_dists); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  } else {
    __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    __Pyx_INCREF(__pyx_v_dists);
    PyTuple_SET_ITEM(__pyx_t_1, 0+1, __pyx_v_dists);
    __Pyx_GIVEREF(__pyx_v_dists);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1675; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1677
 *     net.demarkovize (dists)
 * 
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_result))) || PyTuple_CheckExact(((PyObject *)__pyx_v_result))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_result); __Pyx_INCREF(__pyx_t_3); __pyx_t_5 = 0;
    __pyx_t_10 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_result)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_10)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_10(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1678
 * 
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 *     result.regenerate_all_caches()
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_2, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "qnet.pyx":1677
 *     net.demarkovize (dists)
 * 
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1679
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 * 
 *     result.recompute_all_service()
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1679; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1681
 *     result.regenerate_all_caches()
 * 
 *     result.recompute_all_service()             # <<<<<<<<<<<<<<
 * 
 *     print "Initialization done.  Service: ", qstats.mean_service (result)
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_recompute_all_service); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1683
 *     result.recompute_all_service()
 * 
 *     print "Initialization done.  Service: ", qstats.mean_service (result)             # <<<<<<<<<<<<<<
 *     result.report ()
 * 
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_qstats); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_mean_service); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_result)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  } else {
    __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_result));
    PyTuple_SET_ITEM(__pyx_t_2, 0+1, ((PyObject *)__pyx_v_result));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_s_Initialization_done_Service);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_Initialization_done_Service);
  __Pyx_GIVEREF(__pyx_kp_s_Initialization_done_Service);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1684
 * 
 *     print "Initialization done.  Service: ", qstats.mean_service (result)
 *     result.report ()             # <<<<<<<<<<<<<<
 * 
 *     return result
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_report); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1686
 *     result.report ()
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_for_gg1r (Qnet net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  /* "qnet.pyx":1610
 *     return heap
 * 
 * def gibbs_initialize_via_order (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_order", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_dists);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_a);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_d_new);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1688
 *     return result
 * 
 * def gibbs_initialize_for_gg1r (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_61gibbs_initialize_for_gg1r(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_61gibbs_initialize_for_gg1r = {"gibbs_initialize_for_gg1r", (PyCFunction)__pyx_pw_4qnet_61gibbs_initialize_for_gg1r, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_61gibbs_initialize_for_gg1r(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_4qnet_Qnet *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_for_gg1r (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_for_gg1r", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_for_gg1r") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = ((struct __pyx_obj_4qnet_Qnet *)values[0]);
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_for_gg1r", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_for_gg1r", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_net), __pyx_ptype_4qnet_Qnet, 1, "net", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_60gibbs_initialize_for_gg1r(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_60gibbs_initialize_for_gg1r(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_4qnet_Qnet *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  CYTHON_UNUSED PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_dists = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_unobs = NULL;
  PyObject *__pyx_v_elem = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_path = NULL;
  PyObject *__pyx_v_sid = NULL;
  PyObject *__pyx_v_qid = NULL;
  double __pyx_v_s;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_v_s_new = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_aux = NULL;
  PyObject *__pyx_v_N = NULL;
  PyObject *__pyx_v_to_fix = NULL;
  double __pyx_v_d_old;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  PyObject *(*__pyx_t_8)(PyObject *);
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  int __pyx_t_13;
  double __pyx_t_14;
  int __pyx_t_15;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_for_gg1r", 0);

  /* "qnet.pyx":1694
 *     cdef Queue q
 *     cdef Event evt, evt_new, evt_prev, evt1
 *     cdef Arrivals result = Arrivals(net)             # <<<<<<<<<<<<<<
 * 
 *     s_initial = net.fsm.initial_state()
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1694; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1696
 *     cdef Arrivals result = Arrivals(net)
 * 
 *     s_initial = net.fsm.initial_state()             # <<<<<<<<<<<<<<
 *     eid = arrv.max_eidx()+1
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_net->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1696; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_s_initial = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1697
 * 
 *     s_initial = net.fsm.initial_state()
 *     eid = arrv.max_eidx()+1             # <<<<<<<<<<<<<<
 * 
 *     dists = net.markovize_from_arrivals (arrv)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1697; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_eid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1699
 *     eid = arrv.max_eidx()+1
 * 
 *     dists = net.markovize_from_arrivals (arrv)             # <<<<<<<<<<<<<<
 * 
 *     if DEBUG_INITIAL:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_markovize_from_arrivals); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1699; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dists = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1701
 *     dists = net.markovize_from_arrivals (arrv)
 * 
 *     if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"
 */
  if (__pyx_e_4qnet_DEBUG_INITIAL) {

    /* "qnet.pyx":1702
 * 
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters             # <<<<<<<<<<<<<<
 *         print "Adding observed events"
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_parameters); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1702; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1702; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_Parameters);
    __Pyx_GIVEREF(__pyx_kp_s_Parameters);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1702; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1703
 *     if DEBUG_INITIAL:
 *         print "Parameters: ", net.parameters
 *         print "Adding observed events"             # <<<<<<<<<<<<<<
 * 
 *     # first add observed events
 */
    if (__Pyx_PrintOne(0, __pyx_kp_s_Adding_observed_events) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1703; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1706
 * 
 *     # first add observed events
 *     init_insert_observed_tasks (arrv, result)             # <<<<<<<<<<<<<<
 * 
 *     result.validate()
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_init_insert_observed_tasks); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  if (__pyx_t_4) {
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1708
 *     init_insert_observed_tasks (arrv, result)
 * 
 *     result.validate()             # <<<<<<<<<<<<<<
 * 
 *     # now add unobserved initial events
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_validate); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1708; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1708; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1708; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1711
 * 
 *     # now add unobserved initial events
 *     heap = init_add_initial_events (net, arrv, result)             # <<<<<<<<<<<<<<
 * 
 *     # now add all other events with zero service
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_init_add_initial_events); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  __pyx_t_4 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (__pyx_t_3) {
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
  }
  __Pyx_INCREF(((PyObject *)__pyx_v_net));
  PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_5, ((PyObject *)__pyx_v_net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_net));
  __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
  PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_5, ((PyObject *)__pyx_v_arrv));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_5, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_heap = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":1714
 * 
 *     # now add all other events with zero service
 *     unobs = []             # <<<<<<<<<<<<<<
 *     for elem in heap:
 *         a, tid, path = elem
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_unobs = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":1715
 *     # now add all other events with zero service
 *     unobs = []
 *     for elem in heap:             # <<<<<<<<<<<<<<
 *         a, tid, path = elem
 *         for sid, qid in path:
 */
  if (likely(PyList_CheckExact(__pyx_v_heap)) || PyTuple_CheckExact(__pyx_v_heap)) {
    __pyx_t_2 = __pyx_v_heap; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_heap); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_elem, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1716
 *     unobs = []
 *     for elem in heap:
 *         a, tid, path = elem             # <<<<<<<<<<<<<<
 *         for sid, qid in path:
 *             sid, qid = path.pop (0)
 */
    if ((likely(PyTuple_CheckExact(__pyx_v_elem))) || (PyList_CheckExact(__pyx_v_elem))) {
      PyObject* sequence = __pyx_v_elem;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 3)) {
        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 2); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
        __pyx_t_3 = PyList_GET_ITEM(sequence, 2); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      #endif
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = PyObject_GetIter(__pyx_v_elem); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = Py_TYPE(__pyx_t_7)->tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_1)) goto __pyx_L6_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_4 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L6_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      index = 2; __pyx_t_3 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L6_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_7), 3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L7_unpacking_done;
      __pyx_L6_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L7_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_a, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_4);
    __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_path, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1717
 *     for elem in heap:
 *         a, tid, path = elem
 *         for sid, qid in path:             # <<<<<<<<<<<<<<
 *             sid, qid = path.pop (0)
 *             q = net.queues[qid]
 */
    if (likely(PyList_CheckExact(__pyx_v_path)) || PyTuple_CheckExact(__pyx_v_path)) {
      __pyx_t_3 = __pyx_v_path; __Pyx_INCREF(__pyx_t_3); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_4); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_4); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_10(__pyx_t_3);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
        PyObject* sequence = __pyx_t_4;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        #else
        __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        #endif
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_11 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_8 = Py_TYPE(__pyx_t_11)->tp_iternext;
        index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_1)) goto __pyx_L10_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        index = 1; __pyx_t_7 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_7)) goto __pyx_L10_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_7);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_11), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_8 = NULL;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        goto __pyx_L11_unpacking_done;
        __pyx_L10_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_8 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1717; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L11_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_sid, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_qid, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "qnet.pyx":1718
 *         a, tid, path = elem
 *         for sid, qid in path:
 *             sid, qid = path.pop (0)             # <<<<<<<<<<<<<<
 *             q = net.queues[qid]
 *             s = 0.01
 */
      __pyx_t_4 = __Pyx_PyObject_PopIndex(__pyx_v_path, 0, 1, Py_ssize_t, PyInt_FromSsize_t); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
        PyObject* sequence = __pyx_t_4;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_1);
        #else
        __pyx_t_7 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        #endif
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_11 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_8 = Py_TYPE(__pyx_t_11)->tp_iternext;
        index = 0; __pyx_t_7 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_7)) goto __pyx_L12_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_7);
        index = 1; __pyx_t_1 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_1)) goto __pyx_L12_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_11), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_8 = NULL;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        goto __pyx_L13_unpacking_done;
        __pyx_L12_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_8 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L13_unpacking_done:;
      }
      __Pyx_DECREF_SET(__pyx_v_sid, __pyx_t_7);
      __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_qid, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1719
 *         for sid, qid in path:
 *             sid, qid = path.pop (0)
 *             q = net.queues[qid]             # <<<<<<<<<<<<<<
 *             s = 0.01
 *             d = a + s
 */
      __pyx_t_4 = PyObject_GetItem(__pyx_v_net->queues, __pyx_v_qid); if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1719; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_4);
      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_6queues_Queue))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_q, ((struct __pyx_obj_6queues_Queue *)__pyx_t_4));
      __pyx_t_4 = 0;

      /* "qnet.pyx":1720
 *             sid, qid = path.pop (0)
 *             q = net.queues[qid]
 *             s = 0.01             # <<<<<<<<<<<<<<
 *             d = a + s
 *             evt = Event (eid, tid, qid, q, a, s, d, sid, 0)
 */
      __pyx_v_s = 0.01;

      /* "qnet.pyx":1721
 *             q = net.queues[qid]
 *             s = 0.01
 *             d = a + s             # <<<<<<<<<<<<<<
 *             evt = Event (eid, tid, qid, q, a, s, d, sid, 0)
 *             result.insert (evt)
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_s); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = PyNumber_Add(__pyx_v_a, __pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_d, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1722
 *             s = 0.01
 *             d = a + s
 *             evt = Event (eid, tid, qid, q, a, s, d, sid, 0)             # <<<<<<<<<<<<<<
 *             result.insert (evt)
 *             unobs.append (evt)
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_s); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyTuple_New(9); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_eid);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_eid);
      __Pyx_GIVEREF(__pyx_v_eid);
      __Pyx_INCREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      __Pyx_INCREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      __Pyx_INCREF(((PyObject *)__pyx_v_q));
      PyTuple_SET_ITEM(__pyx_t_4, 3, ((PyObject *)__pyx_v_q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
      __Pyx_INCREF(__pyx_v_a);
      PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_v_a);
      __Pyx_GIVEREF(__pyx_v_a);
      PyTuple_SET_ITEM(__pyx_t_4, 5, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_d);
      PyTuple_SET_ITEM(__pyx_t_4, 6, __pyx_v_d);
      __Pyx_GIVEREF(__pyx_v_d);
      __Pyx_INCREF(__pyx_v_sid);
      PyTuple_SET_ITEM(__pyx_t_4, 7, __pyx_v_sid);
      __Pyx_GIVEREF(__pyx_v_sid);
      __Pyx_INCREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_4, 8, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1722; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "qnet.pyx":1723
 *             d = a + s
 *             evt = Event (eid, tid, qid, q, a, s, d, sid, 0)
 *             result.insert (evt)             # <<<<<<<<<<<<<<
 *             unobs.append (evt)
 *             eid += 1
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_insert); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1723; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "qnet.pyx":1724
 *             evt = Event (eid, tid, qid, q, a, s, d, sid, 0)
 *             result.insert (evt)
 *             unobs.append (evt)             # <<<<<<<<<<<<<<
 *             eid += 1
 *             assert evt.next_byt is not evt, "Huh? %s" % evt
 */
      __pyx_t_12 = __Pyx_PyList_Append(__pyx_v_unobs, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1724; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":1725
 *             result.insert (evt)
 *             unobs.append (evt)
 *             eid += 1             # <<<<<<<<<<<<<<
 *             assert evt.next_byt is not evt, "Huh? %s" % evt
 *             a = d
 */
      __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_eid, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1726
 *             unobs.append (evt)
 *             eid += 1
 *             assert evt.next_byt is not evt, "Huh? %s" % evt             # <<<<<<<<<<<<<<
 *             a = d
 * 
 */
      #ifndef CYTHON_WITHOUT_ASSERTIONS
      if (unlikely(!Py_OptimizeFlag)) {
        __pyx_t_13 = (__pyx_v_evt->next_byt != ((PyObject *)__pyx_v_evt));
        if (unlikely(!(__pyx_t_13 != 0))) {
          __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Huh_s, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
          PyErr_SetObject(PyExc_AssertionError, __pyx_t_1);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
      }
      #endif

      /* "qnet.pyx":1727
 *             eid += 1
 *             assert evt.next_byt is not evt, "Huh? %s" % evt
 *             a = d             # <<<<<<<<<<<<<<
 * 
 *     # sample service times
 */
      __Pyx_INCREF(__pyx_v_d);
      __Pyx_DECREF_SET(__pyx_v_a, __pyx_v_d);

      /* "qnet.pyx":1717
 *     for elem in heap:
 *         a, tid, path = elem
 *         for sid, qid in path:             # <<<<<<<<<<<<<<
 *             sid, qid = path.pop (0)
 *             q = net.queues[qid]
 */
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":1715
 *     # now add all other events with zero service
 *     unobs = []
 *     for elem in heap:             # <<<<<<<<<<<<<<
 *         a, tid, path = elem
 *         for sid, qid in path:
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1730
 * 
 *     # sample service times
 *     for evt in unobs:             # <<<<<<<<<<<<<<
 *         s_new, aux = evt.q.sample_service ()
 *         evt.s = s_new
 */
  __pyx_t_2 = __pyx_v_unobs; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
  for (;;) {
    if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1730; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1731
 *     # sample service times
 *     for evt in unobs:
 *         s_new, aux = evt.q.sample_service ()             # <<<<<<<<<<<<<<
 *         evt.s = s_new
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_sample_service); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (__pyx_t_4) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else {
      __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
      PyObject* sequence = __pyx_t_3;
      #if CYTHON_COMPILING_IN_CPYTHON
      Py_ssize_t size = Py_SIZE(sequence);
      #else
      Py_ssize_t size = PySequence_Size(sequence);
      #endif
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      #if CYTHON_COMPILING_IN_CPYTHON
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_11 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_8 = Py_TYPE(__pyx_t_11)->tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_1)) goto __pyx_L16_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_4 = __pyx_t_8(__pyx_t_11); if (unlikely(!__pyx_t_4)) goto __pyx_L16_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_11), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      goto __pyx_L17_unpacking_done;
      __pyx_L16_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_L17_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_s_new, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_aux, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1732
 *     for evt in unobs:
 *         s_new, aux = evt.q.sample_service ()
 *         evt.s = s_new             # <<<<<<<<<<<<<<
 * 
 *     # iterate:
 */
    __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_v_s_new); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_v_evt->s = __pyx_t_14;

    /* "qnet.pyx":1730
 * 
 *     # sample service times
 *     for evt in unobs:             # <<<<<<<<<<<<<<
 *         s_new, aux = evt.q.sample_service ()
 *         evt.s = s_new
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1735
 * 
 *     # iterate:
 *     N=0             # <<<<<<<<<<<<<<
 *     to_fix = set ([ e.eid for e in unobs])
 *     while to_fix:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_N = __pyx_int_0;

  /* "qnet.pyx":1736
 *     # iterate:
 *     N=0
 *     to_fix = set ([ e.eid for e in unobs])             # <<<<<<<<<<<<<<
 *     while to_fix:
 *         eid = to_fix.pop()
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __pyx_v_unobs; __Pyx_INCREF(__pyx_t_3); __pyx_t_5 = 0;
  for (;;) {
    if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_3)) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_eid); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_4))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PySet_New(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1736; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_to_fix = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "qnet.pyx":1737
 *     N=0
 *     to_fix = set ([ e.eid for e in unobs])
 *     while to_fix:             # <<<<<<<<<<<<<<
 *         eid = to_fix.pop()
 *         evt = result.event (eid)
 */
  while (1) {
    __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_to_fix); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1737; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!__pyx_t_13) break;

    /* "qnet.pyx":1738
 *     to_fix = set ([ e.eid for e in unobs])
 *     while to_fix:
 *         eid = to_fix.pop()             # <<<<<<<<<<<<<<
 *         evt = result.event (eid)
 *         d_old = evt.d
 */
    __pyx_t_3 = PySet_Pop(__pyx_v_to_fix); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_eid, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1739
 *     while to_fix:
 *         eid = to_fix.pop()
 *         evt = result.event (eid)             # <<<<<<<<<<<<<<
 *         d_old = evt.d
 *         evt.q.recompute_departure (result, evt)
 */
    __pyx_t_15 = __Pyx_PyInt_As_int(__pyx_v_eid); if (unlikely((__pyx_t_15 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Arrivals *)__pyx_v_result->__pyx_vtab)->event(__pyx_v_result, __pyx_t_15, 0)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1739; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
    __pyx_t_3 = 0;

    /* "qnet.pyx":1740
 *         eid = to_fix.pop()
 *         evt = result.event (eid)
 *         d_old = evt.d             # <<<<<<<<<<<<<<
 *         evt.q.recompute_departure (result, evt)
 *         if evt.d != d_old:
 */
    __pyx_t_14 = __pyx_v_evt->d;
    __pyx_v_d_old = __pyx_t_14;

    /* "qnet.pyx":1741
 *         evt = result.event (eid)
 *         d_old = evt.d
 *         evt.q.recompute_departure (result, evt)             # <<<<<<<<<<<<<<
 *         if evt.d != d_old:
 *             # add old next_byq
 */
    __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt->q->__pyx_vtab)->recompute_departure(__pyx_v_evt->q, __pyx_v_result, __pyx_v_evt, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1741; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "qnet.pyx":1742
 *         d_old = evt.d
 *         evt.q.recompute_departure (result, evt)
 *         if evt.d != d_old:             # <<<<<<<<<<<<<<
 *             # add old next_byq
 *             if evt.next_byq:
 */
    __pyx_t_13 = ((__pyx_v_evt->d != __pyx_v_d_old) != 0);
    if (__pyx_t_13) {

      /* "qnet.pyx":1744
 *         if evt.d != d_old:
 *             # add old next_byq
 *             if evt.next_byq:             # <<<<<<<<<<<<<<
 *                 to_fix.add (evt.next_byq.eid)
 *             # resort in queue
 */
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_13) {

        /* "qnet.pyx":1745
 *             # add old next_byq
 *             if evt.next_byq:
 *                 to_fix.add (evt.next_byq.eid)             # <<<<<<<<<<<<<<
 *             # resort in queue
 *             result.resort_byq (evt)
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->next_byq, __pyx_n_s_eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_12 = PySet_Add(__pyx_v_to_fix, __pyx_t_3); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L23;
      }
      __pyx_L23:;

      /* "qnet.pyx":1747
 *                 to_fix.add (evt.next_byq.eid)
 *             # resort in queue
 *             result.resort_byq (evt)             # <<<<<<<<<<<<<<
 *             if evt.next_byt:
 *                 evt.next_byt.a = evt.d
 */
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_resort_byq); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      if (!__pyx_t_4) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1747; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "qnet.pyx":1748
 *             # resort in queue
 *             result.resort_byq (evt)
 *             if evt.next_byt:             # <<<<<<<<<<<<<<
 *                 evt.next_byt.a = evt.d
 *                 to_fix.add (evt.next_byt.eid)
 */
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byt); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_13) {

        /* "qnet.pyx":1749
 *             result.resort_byq (evt)
 *             if evt.next_byt:
 *                 evt.next_byt.a = evt.d             # <<<<<<<<<<<<<<
 *                 to_fix.add (evt.next_byt.eid)
 *             # add new next_byq
 */
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        if (__Pyx_PyObject_SetAttrStr(__pyx_v_evt->next_byt, __pyx_n_s_a, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1750
 *             if evt.next_byt:
 *                 evt.next_byt.a = evt.d
 *                 to_fix.add (evt.next_byt.eid)             # <<<<<<<<<<<<<<
 *             # add new next_byq
 *             if evt.next_byq:
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->next_byt, __pyx_n_s_eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_12 = PySet_Add(__pyx_v_to_fix, __pyx_t_3); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1750; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L24;
      }
      __pyx_L24:;

      /* "qnet.pyx":1752
 *                 to_fix.add (evt.next_byt.eid)
 *             # add new next_byq
 *             if evt.next_byq:             # <<<<<<<<<<<<<<
 *                 to_fix.add (evt.next_byq.eid)
 * 
 */
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byq); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1752; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_13) {

        /* "qnet.pyx":1753
 *             # add new next_byq
 *             if evt.next_byq:
 *                 to_fix.add (evt.next_byq.eid)             # <<<<<<<<<<<<<<
 * 
 *         N += 1
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt->next_byq, __pyx_n_s_eid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_12 = PySet_Add(__pyx_v_to_fix, __pyx_t_3); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L25;
      }
      __pyx_L25:;
      goto __pyx_L22;
    }
    __pyx_L22:;

    /* "qnet.pyx":1755
 *                 to_fix.add (evt.next_byq.eid)
 * 
 *         N += 1             # <<<<<<<<<<<<<<
 *         if N % 1000 == 0:
 *             print "gg1r_initialize ", len(to_fix)
 */
    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_N, __pyx_int_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_N, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1756
 * 
 *         N += 1
 *         if N % 1000 == 0:             # <<<<<<<<<<<<<<
 *             print "gg1r_initialize ", len(to_fix)
 * 
 */
    __pyx_t_3 = PyNumber_Remainder(__pyx_v_N, __pyx_int_1000); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1756; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_13) {

      /* "qnet.pyx":1757
 *         N += 1
 *         if N % 1000 == 0:
 *             print "gg1r_initialize ", len(to_fix)             # <<<<<<<<<<<<<<
 * 
 *     for evt in result:
 */
      __pyx_t_5 = PySet_Size(__pyx_v_to_fix); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_kp_s_gg1r_initialize);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_s_gg1r_initialize);
      __Pyx_GIVEREF(__pyx_kp_s_gg1r_initialize);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_2);
      __pyx_t_2 = 0;
      if (__Pyx_Print(0, __pyx_t_3, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L26;
    }
    __pyx_L26:;
  }

  /* "qnet.pyx":1759
 *             print "gg1r_initialize ", len(to_fix)
 * 
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.recompute_all_service()
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_result))) || PyTuple_CheckExact(((PyObject *)__pyx_v_result))) {
    __pyx_t_3 = ((PyObject *)__pyx_v_result); __Pyx_INCREF(__pyx_t_3); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_result)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1759; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1760
 * 
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)             # <<<<<<<<<<<<<<
 *     result.recompute_all_service()
 *     result.regenerate_all_caches()
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_initialize_auxiliaries); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_4) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1760; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1759
 *             print "gg1r_initialize ", len(to_fix)
 * 
 *     for evt in result:             # <<<<<<<<<<<<<<
 *         evt.q.initialize_auxiliaries (evt)
 *     result.recompute_all_service()
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1761
 *     for evt in result:
 *         evt.q.initialize_auxiliaries (evt)
 *     result.recompute_all_service()             # <<<<<<<<<<<<<<
 *     result.regenerate_all_caches()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_recompute_all_service); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1762
 *         evt.q.initialize_auxiliaries (evt)
 *     result.recompute_all_service()
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 * 
 *     net.demarkovize (dists)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1764
 *     result.regenerate_all_caches()
 * 
 *     net.demarkovize (dists)             # <<<<<<<<<<<<<<
 * 
 *     print "GG1R initialization done.  Mean service: ", qstats.mean_service (result)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_net), __pyx_n_s_demarkovize); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_dists); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  } else {
    __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_11);
    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_1); __Pyx_GIVEREF(__pyx_t_1); __pyx_t_1 = NULL;
    __Pyx_INCREF(__pyx_v_dists);
    PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_dists);
    __Pyx_GIVEREF(__pyx_v_dists);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1764; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "qnet.pyx":1766
 *     net.demarkovize (dists)
 * 
 *     print "GG1R initialization done.  Mean service: ", qstats.mean_service (result)             # <<<<<<<<<<<<<<
 * 
 *     return result
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_qstats); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mean_service); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_11, ((PyObject *)__pyx_v_result)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
  } else {
    __pyx_t_1 = PyTuple_New(1+1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(((PyObject *)__pyx_v_result));
    PyTuple_SET_ITEM(__pyx_t_1, 0+1, ((PyObject *)__pyx_v_result));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(__pyx_kp_s_GG1R_initialization_done_Mean_se);
  PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_s_GG1R_initialization_done_Mean_se);
  __Pyx_GIVEREF(__pyx_kp_s_GG1R_initialization_done_Mean_se);
  PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  if (__Pyx_Print(0, __pyx_t_11, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1766; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "qnet.pyx":1768
 *     print "GG1R initialization done.  Mean service: ", qstats.mean_service (result)
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  /* "qnet.pyx":1688
 *     return result
 * 
 * def gibbs_initialize_for_gg1r (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("qnet.gibbs_initialize_for_gg1r", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_dists);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_unobs);
  __Pyx_XDECREF(__pyx_v_elem);
  __Pyx_XDECREF(__pyx_v_a);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_path);
  __Pyx_XDECREF(__pyx_v_sid);
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_XDECREF(__pyx_v_s_new);
  __Pyx_XDECREF(__pyx_v_aux);
  __Pyx_XDECREF(__pyx_v_N);
  __Pyx_XDECREF(__pyx_v_to_fix);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1770
 *     return result
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_63diff_list_definitely_bad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_63diff_list_definitely_bad = {"diff_list_definitely_bad", (PyCFunction)__pyx_pw_4qnet_63diff_list_definitely_bad, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_63diff_list_definitely_bad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_net = 0;
  PyObject *__pyx_v_arrv = 0;
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_v_diff_list = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("diff_list_definitely_bad (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,&__pyx_n_s_q,&__pyx_n_s_diff_list,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_list_definitely_bad", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_list_definitely_bad", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_diff_list)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("diff_list_definitely_bad", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "diff_list_definitely_bad") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = values[1];
    __pyx_v_q = values[2];
    __pyx_v_diff_list = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("diff_list_definitely_bad", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.diff_list_definitely_bad", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_62diff_list_definitely_bad(__pyx_self, __pyx_v_net, __pyx_v_arrv, __pyx_v_q, __pyx_v_diff_list);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_62diff_list_definitely_bad(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, PyObject *__pyx_v_arrv, PyObject *__pyx_v_q, PyObject *__pyx_v_diff_list) {
  PyObject *__pyx_v_evt1 = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("diff_list_definitely_bad", 0);

  /* "qnet.pyx":1771
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):
 *     for evt1 in diff_list:             # <<<<<<<<<<<<<<
 *         if evt1.s < 0: return True
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_1 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1771; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt1, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "qnet.pyx":1772
 * def diff_list_definitely_bad (net, arrv, q, diff_list):
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True             # <<<<<<<<<<<<<<
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):
 *         return True
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt1, __pyx_n_s_s); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }

    /* "qnet.pyx":1771
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):
 *     for evt1 in diff_list:             # <<<<<<<<<<<<<<
 *         if evt1.s < 0: return True
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1773
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):             # <<<<<<<<<<<<<<
 *         return True
 *     return False
 */
  __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_isinf); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_likelihoodDelta); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = NULL;
  __pyx_t_2 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_2 = 1;
    }
  }
  __pyx_t_9 = PyTuple_New(2+__pyx_t_2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (__pyx_t_8) {
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
  }
  __Pyx_INCREF(__pyx_v_arrv);
  PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_2, __pyx_v_arrv);
  __Pyx_GIVEREF(__pyx_v_arrv);
  __Pyx_INCREF(__pyx_v_diff_list);
  PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_2, __pyx_v_diff_list);
  __Pyx_GIVEREF(__pyx_v_diff_list);
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_9 = PyTuple_New(1+1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    PyTuple_SET_ITEM(__pyx_t_9, 0+1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1773; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "qnet.pyx":1774
 *         if evt1.s < 0: return True
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):
 *         return True             # <<<<<<<<<<<<<<
 *     return False
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_True);
    __pyx_r = Py_True;
    goto __pyx_L0;
  }

  /* "qnet.pyx":1775
 *     if numpy.isinf (q.likelihoodDelta(arrv, diff_list)):
 *         return True
 *     return False             # <<<<<<<<<<<<<<
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(Py_False);
  __pyx_r = Py_False;
  goto __pyx_L0;

  /* "qnet.pyx":1770
 *     return result
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("qnet.diff_list_definitely_bad", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_evt1);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1777
 *     return False
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):             # <<<<<<<<<<<<<<
 *     cdef Queue q = evt.q
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_65sample_d_until_acceptance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_65sample_d_until_acceptance = {"sample_d_until_acceptance", (PyCFunction)__pyx_pw_4qnet_65sample_d_until_acceptance, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_65sample_d_until_acceptance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_service_only = 0;
  PyObject *__pyx_v_scale = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sample_d_until_acceptance (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,&__pyx_n_s_evt,&__pyx_n_s_service_only,&__pyx_n_s_scale,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = ((PyObject *)Py_False);
    values[4] = ((PyObject *)__pyx_float_1_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("sample_d_until_acceptance", 0, 3, 5, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("sample_d_until_acceptance", 0, 3, 5, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_service_only);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_scale);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sample_d_until_acceptance") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[2]);
    __pyx_v_service_only = values[3];
    __pyx_v_scale = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("sample_d_until_acceptance", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.sample_d_until_acceptance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_64sample_d_until_acceptance(__pyx_self, __pyx_v_net, __pyx_v_arrv, __pyx_v_evt, __pyx_v_service_only, __pyx_v_scale);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_64sample_d_until_acceptance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, PyObject *__pyx_v_service_only, PyObject *__pyx_v_scale) {
  struct __pyx_obj_6queues_Queue *__pyx_v_q = 0;
  struct __pyx_obj_5pwfun_Pwfun *__pyx_v_dfn = NULL;
  double __pyx_v_d_initial;
  double __pyx_v_delta;
  PyObject *__pyx_v_diff_list = NULL;
  int __pyx_v_found_a_good_one;
  double __pyx_v_s_true;
  CYTHON_UNUSED double __pyx_v_wait;
  CYTHON_UNUSED long __pyx_v_j;
  PyObject *__pyx_v_s_new = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_aux = NULL;
  double __pyx_v_d_new;
  PyObject *__pyx_v_e0 = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_to_test = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  double __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  long __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *(*__pyx_t_11)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("sample_d_until_acceptance", 0);

  /* "qnet.pyx":1778
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):
 *     cdef Queue q = evt.q             # <<<<<<<<<<<<<<
 * 
 *     dfn = q.departureLik (arrv, evt)
 */
  __pyx_t_1 = ((PyObject *)__pyx_v_evt->q);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_q = ((struct __pyx_obj_6queues_Queue *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1780
 *     cdef Queue q = evt.q
 * 
 *     dfn = q.departureLik (arrv, evt)             # <<<<<<<<<<<<<<
 * 
 *     d_initial = evt.d
 */
  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->departureLik(__pyx_v_q, __pyx_v_arrv, __pyx_v_evt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1780; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_dfn = ((struct __pyx_obj_5pwfun_Pwfun *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1782
 *     dfn = q.departureLik (arrv, evt)
 * 
 *     d_initial = evt.d             # <<<<<<<<<<<<<<
 * 
 *     if evt.s == 0:
 */
  __pyx_t_2 = __pyx_v_evt->d;
  __pyx_v_d_initial = __pyx_t_2;

  /* "qnet.pyx":1784
 *     d_initial = evt.d
 * 
 *     if evt.s == 0:             # <<<<<<<<<<<<<<
 *         delta = 1.0
 *         while delta > 0:
 */
  __pyx_t_3 = ((__pyx_v_evt->s == 0.0) != 0);
  if (__pyx_t_3) {

    /* "qnet.pyx":1785
 * 
 *     if evt.s == 0:
 *         delta = 1.0             # <<<<<<<<<<<<<<
 *         while delta > 0:
 *             diff_list = q.diffListForDeparture (evt, evt.d + delta)
 */
    __pyx_v_delta = 1.0;

    /* "qnet.pyx":1786
 *     if evt.s == 0:
 *         delta = 1.0
 *         while delta > 0:             # <<<<<<<<<<<<<<
 *             diff_list = q.diffListForDeparture (evt, evt.d + delta)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list): break
 */
    while (1) {
      __pyx_t_3 = ((__pyx_v_delta > 0.0) != 0);
      if (!__pyx_t_3) break;

      /* "qnet.pyx":1787
 *         delta = 1.0
 *         while delta > 0:
 *             diff_list = q.diffListForDeparture (evt, evt.d + delta)             # <<<<<<<<<<<<<<
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list): break
 *             delta = delta/2.0
 */
      __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, (__pyx_v_evt->d + __pyx_v_delta)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1788
 *         while delta > 0:
 *             diff_list = q.diffListForDeparture (evt, evt.d + delta)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list): break             # <<<<<<<<<<<<<<
 *             delta = delta/2.0
 *         d_initial += delta
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_diff_list_definitely_bad); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = NULL;
      __pyx_t_6 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_6 = 1;
        }
      }
      __pyx_t_7 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_5) {
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_INCREF(__pyx_v_net);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_net);
      __Pyx_GIVEREF(__pyx_v_net);
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, ((PyObject *)__pyx_v_arrv));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
      __Pyx_INCREF(((PyObject *)__pyx_v_q));
      PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_8 = ((!__pyx_t_3) != 0);
      if (__pyx_t_8) {
        goto __pyx_L5_break;
      }

      /* "qnet.pyx":1789
 *             diff_list = q.diffListForDeparture (evt, evt.d + delta)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list): break
 *             delta = delta/2.0             # <<<<<<<<<<<<<<
 *         d_initial += delta
 * 
 */
      __pyx_v_delta = (__pyx_v_delta / 2.0);
    }
    __pyx_L5_break:;

    /* "qnet.pyx":1790
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list): break
 *             delta = delta/2.0
 *         d_initial += delta             # <<<<<<<<<<<<<<
 * 
 *     found_a_good_one = False
 */
    __pyx_v_d_initial = (__pyx_v_d_initial + __pyx_v_delta);
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":1792
 *         d_initial += delta
 * 
 *     found_a_good_one = False             # <<<<<<<<<<<<<<
 *     cdef double s_true, wait = evt.wait()
 *     for j in xrange(100):
 */
  __pyx_v_found_a_good_one = 0;

  /* "qnet.pyx":1793
 * 
 *     found_a_good_one = False
 *     cdef double s_true, wait = evt.wait()             # <<<<<<<<<<<<<<
 *     for j in xrange(100):
 *         if service_only:
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_wait); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_7) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_wait = __pyx_t_2;

  /* "qnet.pyx":1794
 *     found_a_good_one = False
 *     cdef double s_true, wait = evt.wait()
 *     for j in xrange(100):             # <<<<<<<<<<<<<<
 *         if service_only:
 *             s_new, aux = q.sample_service()
 */
  for (__pyx_t_9 = 0; __pyx_t_9 < 100; __pyx_t_9+=1) {
    __pyx_v_j = __pyx_t_9;

    /* "qnet.pyx":1795
 *     cdef double s_true, wait = evt.wait()
 *     for j in xrange(100):
 *         if service_only:             # <<<<<<<<<<<<<<
 *             s_new, aux = q.sample_service()
 *             s_new = s_new / scale
 */
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_service_only); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1795; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_8) {

      /* "qnet.pyx":1796
 *     for j in xrange(100):
 *         if service_only:
 *             s_new, aux = q.sample_service()             # <<<<<<<<<<<<<<
 *             s_new = s_new / scale
 *             d_new = q.departure_of_service (evt, s_new)
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_q), __pyx_n_s_sample_service); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      if (__pyx_t_7) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else {
        __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
        PyObject* sequence = __pyx_t_1;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = PySequence_Size(sequence);
        #endif
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_7);
        #else
        __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        #endif
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext;
        index = 0; __pyx_t_4 = __pyx_t_10(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L10_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_4);
        index = 1; __pyx_t_7 = __pyx_t_10(__pyx_t_5); if (unlikely(!__pyx_t_7)) goto __pyx_L10_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_7);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_5), 2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_10 = NULL;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        goto __pyx_L11_unpacking_done;
        __pyx_L10_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_10 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_L11_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_s_new, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_aux, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "qnet.pyx":1797
 *         if service_only:
 *             s_new, aux = q.sample_service()
 *             s_new = s_new / scale             # <<<<<<<<<<<<<<
 *             d_new = q.departure_of_service (evt, s_new)
 *         else:
 */
      __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_s_new, __pyx_v_scale); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1797; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_s_new, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "qnet.pyx":1798
 *             s_new, aux = q.sample_service()
 *             s_new = s_new / scale
 *             d_new = q.departure_of_service (evt, s_new)             # <<<<<<<<<<<<<<
 *         else:
 *             d_new = call_sampler (dfn, d_initial)
 */
      __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_v_s_new); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_v_d_new = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->departure_of_service(__pyx_v_q, __pyx_v_evt, __pyx_t_2);
      goto __pyx_L9;
    }
    /*else*/ {

      /* "qnet.pyx":1800
 *             d_new = q.departure_of_service (evt, s_new)
 *         else:
 *             d_new = call_sampler (dfn, d_initial)             # <<<<<<<<<<<<<<
 * 
 *         diff_list = q.diffListForDeparture (evt, d_new)
 */
      __pyx_t_2 = __pyx_f_4qnet_call_sampler(__pyx_v_dfn, __pyx_v_d_initial); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1800; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_v_d_new = __pyx_t_2;
    }
    __pyx_L9:;

    /* "qnet.pyx":1802
 *             d_new = call_sampler (dfn, d_initial)
 * 
 *         diff_list = q.diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 *         if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *             found_a_good_one = True
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, __pyx_v_d_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1803
 * 
 *         diff_list = q.diffListForDeparture (evt, d_new)
 *         if not diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *             found_a_good_one = True
 *             break
 */
    __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_diff_list_definitely_bad); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_4 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_6 = 1;
      }
    }
    __pyx_t_5 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_4) {
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __Pyx_GIVEREF(__pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_INCREF(__pyx_v_net);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_v_net);
    __Pyx_GIVEREF(__pyx_v_net);
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __Pyx_INCREF(((PyObject *)__pyx_v_q));
    PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, ((PyObject *)__pyx_v_q));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
    __Pyx_INCREF(__pyx_v_diff_list);
    PyTuple_SET_ITEM(__pyx_t_5, 3+__pyx_t_6, __pyx_v_diff_list);
    __Pyx_GIVEREF(__pyx_v_diff_list);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1803; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = ((!__pyx_t_8) != 0);
    if (__pyx_t_3) {

      /* "qnet.pyx":1804
 *         diff_list = q.diffListForDeparture (evt, d_new)
 *         if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *             found_a_good_one = True             # <<<<<<<<<<<<<<
 *             break
 * 
 */
      __pyx_v_found_a_good_one = 1;

      /* "qnet.pyx":1805
 *         if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *             found_a_good_one = True
 *             break             # <<<<<<<<<<<<<<
 * 
 *         # kind of a hack.  try to fix service being underinitialized, exp in GG1RSS
 */
      goto __pyx_L8_break;
    }

    /* "qnet.pyx":1808
 * 
 *         # kind of a hack.  try to fix service being underinitialized, exp in GG1RSS
 *         s_true = -1             # <<<<<<<<<<<<<<
 *         for e0 in diff_list:
 *             if e0.eid == evt.eid:
 */
    __pyx_v_s_true = -1.0;

    /* "qnet.pyx":1809
 *         # kind of a hack.  try to fix service being underinitialized, exp in GG1RSS
 *         s_true = -1
 *         for e0 in diff_list:             # <<<<<<<<<<<<<<
 *             if e0.eid == evt.eid:
 *                 s_true == e0.s
 */
    if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
      __pyx_t_1 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_1); __pyx_t_6 = 0;
      __pyx_t_11 = NULL;
    } else {
      __pyx_t_6 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_11 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (likely(!__pyx_t_11)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_7); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_6); __Pyx_INCREF(__pyx_t_7); __pyx_t_6++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_7 = PySequence_ITEM(__pyx_t_1, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_7 = __pyx_t_11(__pyx_t_1);
        if (unlikely(!__pyx_t_7)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_7);
      }
      __Pyx_XDECREF_SET(__pyx_v_e0, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "qnet.pyx":1810
 *         s_true = -1
 *         for e0 in diff_list:
 *             if e0.eid == evt.eid:             # <<<<<<<<<<<<<<
 *                 s_true == e0.s
 *                 wait = e0.wait()
 */
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_e0, __pyx_n_s_eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_7, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_3) {

        /* "qnet.pyx":1811
 *         for e0 in diff_list:
 *             if e0.eid == evt.eid:
 *                 s_true == e0.s             # <<<<<<<<<<<<<<
 *                 wait = e0.wait()
 *         if abs (s_new - s_true) < 0.1:
 */
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_s_true); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_e0, __pyx_n_s_s); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_7 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

        /* "qnet.pyx":1812
 *             if e0.eid == evt.eid:
 *                 s_true == e0.s
 *                 wait = e0.wait()             # <<<<<<<<<<<<<<
 *         if abs (s_new - s_true) < 0.1:
 *             break
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_e0, __pyx_n_s_wait); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_4 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        if (__pyx_t_4) {
          __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else {
          __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1812; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_v_wait = __pyx_t_2;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "qnet.pyx":1809
 *         # kind of a hack.  try to fix service being underinitialized, exp in GG1RSS
 *         s_true = -1
 *         for e0 in diff_list:             # <<<<<<<<<<<<<<
 *             if e0.eid == evt.eid:
 *                 s_true == e0.s
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":1813
 *                 s_true == e0.s
 *                 wait = e0.wait()
 *         if abs (s_new - s_true) < 0.1:             # <<<<<<<<<<<<<<
 *             break
 * 
 */
    if (unlikely(!__pyx_v_s_new)) { __Pyx_RaiseUnboundLocalError("s_new"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_s_true); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyNumber_Subtract(__pyx_v_s_new, __pyx_t_1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Absolute(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_1, __pyx_float_0_1, Py_LT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1813; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_3) {

      /* "qnet.pyx":1814
 *                 wait = e0.wait()
 *         if abs (s_new - s_true) < 0.1:
 *             break             # <<<<<<<<<<<<<<
 * 
 *     cdef Event evt_to_test
 */
      goto __pyx_L8_break;
    }
  }
  __pyx_L8_break:;

  /* "qnet.pyx":1817
 * 
 *     cdef Event evt_to_test
 *     if not found_a_good_one:             # <<<<<<<<<<<<<<
 *         # one more try
 *         evt_to_test = evt.next_byq
 */
  __pyx_t_3 = ((!(__pyx_v_found_a_good_one != 0)) != 0);
  if (__pyx_t_3) {

    /* "qnet.pyx":1819
 *     if not found_a_good_one:
 *         # one more try
 *         evt_to_test = evt.next_byq             # <<<<<<<<<<<<<<
 *         while evt_to_test:
 *             d_new = evt_to_test.d + 1e-5
 */
    if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_7 = __pyx_v_evt->next_byq;
    __Pyx_INCREF(__pyx_t_7);
    __pyx_v_evt_to_test = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7);
    __pyx_t_7 = 0;

    /* "qnet.pyx":1820
 *         # one more try
 *         evt_to_test = evt.next_byq
 *         while evt_to_test:             # <<<<<<<<<<<<<<
 *             d_new = evt_to_test.d + 1e-5
 *             diff_list = q.diffListForDeparture (evt, d_new)
 */
    while (1) {
      __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_to_test)); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (!__pyx_t_3) break;

      /* "qnet.pyx":1821
 *         evt_to_test = evt.next_byq
 *         while evt_to_test:
 *             d_new = evt_to_test.d + 1e-5             # <<<<<<<<<<<<<<
 *             diff_list = q.diffListForDeparture (evt, d_new)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list):
 */
      __pyx_v_d_new = (__pyx_v_evt_to_test->d + 1e-5);

      /* "qnet.pyx":1822
 *         while evt_to_test:
 *             d_new = evt_to_test.d + 1e-5
 *             diff_list = q.diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *                 found_a_good_one = True
 */
      __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, __pyx_v_d_new); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "qnet.pyx":1823
 *             d_new = evt_to_test.d + 1e-5
 *             diff_list = q.diffListForDeparture (evt, d_new)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *                 found_a_good_one = True
 *                 break
 */
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_diff_list_definitely_bad); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = NULL;
      __pyx_t_6 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      __pyx_t_4 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      if (__pyx_t_5) {
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_INCREF(__pyx_v_net);
      PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_6, __pyx_v_net);
      __Pyx_GIVEREF(__pyx_v_net);
      __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
      PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_6, ((PyObject *)__pyx_v_arrv));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
      __Pyx_INCREF(((PyObject *)__pyx_v_q));
      PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_6, ((PyObject *)__pyx_v_q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
      __Pyx_INCREF(__pyx_v_diff_list);
      PyTuple_SET_ITEM(__pyx_t_4, 3+__pyx_t_6, __pyx_v_diff_list);
      __Pyx_GIVEREF(__pyx_v_diff_list);
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = ((!__pyx_t_3) != 0);
      if (__pyx_t_8) {

        /* "qnet.pyx":1824
 *             diff_list = q.diffListForDeparture (evt, d_new)
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *                 found_a_good_one = True             # <<<<<<<<<<<<<<
 *                 break
 *             evt_to_test = evt_to_test.next_byq
 */
        __pyx_v_found_a_good_one = 1;

        /* "qnet.pyx":1825
 *             if not diff_list_definitely_bad (net, arrv, q, diff_list):
 *                 found_a_good_one = True
 *                 break             # <<<<<<<<<<<<<<
 *             evt_to_test = evt_to_test.next_byq
 * 
 */
        goto __pyx_L19_break;
      }

      /* "qnet.pyx":1826
 *                 found_a_good_one = True
 *                 break
 *             evt_to_test = evt_to_test.next_byq             # <<<<<<<<<<<<<<
 * 
 *     if not found_a_good_one:
 */
      if (!(likely(((__pyx_v_evt_to_test->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt_to_test->next_byq, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_7 = __pyx_v_evt_to_test->next_byq;
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_DECREF_SET(__pyx_v_evt_to_test, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
      __pyx_t_7 = 0;
    }
    __pyx_L19_break:;
    goto __pyx_L17;
  }
  __pyx_L17:;

  /* "qnet.pyx":1828
 *             evt_to_test = evt_to_test.next_byq
 * 
 *     if not found_a_good_one:             # <<<<<<<<<<<<<<
 *         print "s_d_u_a: Error: Could not find good initial time for EVT %d\n%s" % (evt.eid, format_six(evt))
 *         d_new = d_initial
 */
  __pyx_t_8 = ((!(__pyx_v_found_a_good_one != 0)) != 0);
  if (__pyx_t_8) {

    /* "qnet.pyx":1829
 * 
 *     if not found_a_good_one:
 *         print "s_d_u_a: Error: Could not find good initial time for EVT %d\n%s" % (evt.eid, format_six(evt))             # <<<<<<<<<<<<<<
 *         d_new = d_initial
 *         diff_list = q.diffListForDeparture (evt, d_new)
 */
    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = __pyx_f_4qnet_format_six(__pyx_v_evt); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_7 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_s_d_u_a_Error_Could_not_find_goo, __pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__Pyx_PrintOne(0, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "qnet.pyx":1830
 *     if not found_a_good_one:
 *         print "s_d_u_a: Error: Could not find good initial time for EVT %d\n%s" % (evt.eid, format_six(evt))
 *         d_new = d_initial             # <<<<<<<<<<<<<<
 *         diff_list = q.diffListForDeparture (evt, d_new)
 *         if diff_list_definitely_bad (net, arrv, q, diff_list):
 */
    __pyx_v_d_new = __pyx_v_d_initial;

    /* "qnet.pyx":1831
 *         print "s_d_u_a: Error: Could not find good initial time for EVT %d\n%s" % (evt.eid, format_six(evt))
 *         d_new = d_initial
 *         diff_list = q.diffListForDeparture (evt, d_new)             # <<<<<<<<<<<<<<
 *         if diff_list_definitely_bad (net, arrv, q, diff_list):
 *             d_new = 0
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_q->__pyx_vtab)->diffListForDeparture(__pyx_v_q, __pyx_v_evt, __pyx_v_d_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_diff_list, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "qnet.pyx":1832
 *         d_new = d_initial
 *         diff_list = q.diffListForDeparture (evt, d_new)
 *         if diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *             d_new = 0
 *             diff_list = None
 */
    __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_diff_list_definitely_bad); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_6 = 1;
      }
    }
    __pyx_t_5 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_7) {
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
    }
    __Pyx_INCREF(__pyx_v_net);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_v_net);
    __Pyx_GIVEREF(__pyx_v_net);
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __Pyx_INCREF(((PyObject *)__pyx_v_q));
    PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, ((PyObject *)__pyx_v_q));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_q));
    __Pyx_INCREF(__pyx_v_diff_list);
    PyTuple_SET_ITEM(__pyx_t_5, 3+__pyx_t_6, __pyx_v_diff_list);
    __Pyx_GIVEREF(__pyx_v_diff_list);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_8) {

      /* "qnet.pyx":1833
 *         diff_list = q.diffListForDeparture (evt, d_new)
 *         if diff_list_definitely_bad (net, arrv, q, diff_list):
 *             d_new = 0             # <<<<<<<<<<<<<<
 *             diff_list = None
 * 
 */
      __pyx_v_d_new = 0.0;

      /* "qnet.pyx":1834
 *         if diff_list_definitely_bad (net, arrv, q, diff_list):
 *             d_new = 0
 *             diff_list = None             # <<<<<<<<<<<<<<
 * 
 *     return d_new, diff_list
 */
      __Pyx_INCREF(Py_None);
      __Pyx_DECREF_SET(__pyx_v_diff_list, Py_None);
      goto __pyx_L22;
    }
    __pyx_L22:;
    goto __pyx_L21;
  }
  __pyx_L21:;

  /* "qnet.pyx":1836
 *             diff_list = None
 * 
 *     return d_new, diff_list             # <<<<<<<<<<<<<<
 * 
 * def heap_from_arrivals (net, Arrivals arrv):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_d_new); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(!__pyx_v_diff_list)) { __Pyx_RaiseUnboundLocalError("diff_list"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;} }
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1836; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_diff_list);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_diff_list);
  __Pyx_GIVEREF(__pyx_v_diff_list);
  __pyx_t_1 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "qnet.pyx":1777
 *     return False
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):             # <<<<<<<<<<<<<<
 *     cdef Queue q = evt.q
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("qnet.sample_d_until_acceptance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_q);
  __Pyx_XDECREF((PyObject *)__pyx_v_dfn);
  __Pyx_XDECREF(__pyx_v_diff_list);
  __Pyx_XDECREF(__pyx_v_s_new);
  __Pyx_XDECREF(__pyx_v_aux);
  __Pyx_XDECREF(__pyx_v_e0);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_to_test);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1838
 *     return d_new, diff_list
 * 
 * def heap_from_arrivals (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     heap = []
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_67heap_from_arrivals(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_67heap_from_arrivals = {"heap_from_arrivals", (PyCFunction)__pyx_pw_4qnet_67heap_from_arrivals, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_67heap_from_arrivals(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("heap_from_arrivals (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("heap_from_arrivals", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "heap_from_arrivals") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("heap_from_arrivals", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.heap_from_arrivals", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_66heap_from_arrivals(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_66heap_from_arrivals(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  PyObject *__pyx_v_heap = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_s_initial = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("heap_from_arrivals", 0);

  /* "qnet.pyx":1839
 * 
 * def heap_from_arrivals (net, Arrivals arrv):
 *     heap = []             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     for evt in arrv:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1839; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_heap = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":1841
 *     heap = []
 *     cdef Event evt
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             heappush (heap, (evt.a, evt.tid, evt.state, evt))
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1841; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "qnet.pyx":1842
 *     cdef Event evt
 *     for evt in arrv:
 *         if evt.obs_d:             # <<<<<<<<<<<<<<
 *             heappush (heap, (evt.a, evt.tid, evt.state, evt))
 *         # add initial event if necessary
 */
    __pyx_t_5 = (__pyx_v_evt->obs_d != 0);
    if (__pyx_t_5) {

      /* "qnet.pyx":1843
 *     for evt in arrv:
 *         if evt.obs_d:
 *             heappush (heap, (evt.a, evt.tid, evt.state, evt))             # <<<<<<<<<<<<<<
 *         # add initial event if necessary
 *         if not evt.prev_byt and not evt.obs_d:
 */
      __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_evt->state); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = PyTuple_New(4); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_10, 3, ((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __pyx_t_7 = 0;
      __pyx_t_8 = 0;
      __pyx_t_9 = 0;
      __pyx_t_9 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
          __pyx_t_11 = 1;
        }
      }
      __pyx_t_8 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_9) {
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_9); __Pyx_GIVEREF(__pyx_t_9); __pyx_t_9 = NULL;
      }
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_11, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_11, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1843; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L5;
    }
    __pyx_L5:;

    /* "qnet.pyx":1845
 *             heappush (heap, (evt.a, evt.tid, evt.state, evt))
 *         # add initial event if necessary
 *         if not evt.prev_byt and not evt.obs_d:             # <<<<<<<<<<<<<<
 *             s_initial = net.fsm.initial_state()
 *             heappush (heap, (0.0, evt.tid, s_initial, None))
 */
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1845; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_13 = ((!__pyx_t_12) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_5 = __pyx_t_13;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_13 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    __pyx_t_5 = __pyx_t_13;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_5) {

      /* "qnet.pyx":1846
 *         # add initial event if necessary
 *         if not evt.prev_byt and not evt.obs_d:
 *             s_initial = net.fsm.initial_state()             # <<<<<<<<<<<<<<
 *             heappush (heap, (0.0, evt.tid, s_initial, None))
 *     return heap
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_fsm); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      if (__pyx_t_6) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else {
        __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1846; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF_SET(__pyx_v_s_initial, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "qnet.pyx":1847
 *         if not evt.prev_byt and not evt.obs_d:
 *             s_initial = net.fsm.initial_state()
 *             heappush (heap, (0.0, evt.tid, s_initial, None))             # <<<<<<<<<<<<<<
 *     return heap
 * 
 */
      __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = PyTuple_New(4); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_float_0_0);
      __Pyx_GIVEREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_v_s_initial);
      PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_s_initial);
      __Pyx_GIVEREF(__pyx_v_s_initial);
      __Pyx_INCREF(Py_None);
      PyTuple_SET_ITEM(__pyx_t_10, 3, Py_None);
      __Pyx_GIVEREF(Py_None);
      __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      __pyx_t_11 = 0;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
          __pyx_t_11 = 1;
        }
      }
      __pyx_t_9 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_6) {
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_INCREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_11, __pyx_v_heap);
      __Pyx_GIVEREF(__pyx_v_heap);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_11, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1847; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L6;
    }
    __pyx_L6:;

    /* "qnet.pyx":1841
 *     heap = []
 *     cdef Event evt
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             heappush (heap, (evt.a, evt.tid, evt.state, evt))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1848
 *             s_initial = net.fsm.initial_state()
 *             heappush (heap, (0.0, evt.tid, s_initial, None))
 *     return heap             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_lp (net, Arrivals arrv_in):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_heap);
  __pyx_r = __pyx_v_heap;
  goto __pyx_L0;

  /* "qnet.pyx":1838
 *     return d_new, diff_list
 * 
 * def heap_from_arrivals (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     heap = []
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("qnet.heap_from_arrivals", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_s_initial);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1850
 *     return heap
 * 
 * def gibbs_initialize_via_lp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_69gibbs_initialize_via_lp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_69gibbs_initialize_via_lp = {"gibbs_initialize_via_lp", (PyCFunction)__pyx_pw_4qnet_69gibbs_initialize_via_lp, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_69gibbs_initialize_via_lp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_lp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv_in,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv_in)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_lp", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_lp") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv_in = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_lp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv_in), __pyx_ptype_8arrivals_Arrivals, 1, "arrv_in", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_68gibbs_initialize_via_lp(__pyx_self, __pyx_v_net, __pyx_v_arrv_in);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_68gibbs_initialize_via_lp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_soln = NULL;
  PyObject *__pyx_v_reg = NULL;
  PyObject *__pyx_v_lp = NULL;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  PyObject *(*__pyx_t_13)(PyObject *);
  PyObject *__pyx_t_14 = NULL;
  int __pyx_t_15;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_lp", 0);

  /* "qnet.pyx":1854
 *     cdef Event evt
 * 
 *     soln = dict()             # <<<<<<<<<<<<<<
 * 
 *     for reg in [ 1e-6, 1e-10, 0 ]:
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1854; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_soln = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1856
 *     soln = dict()
 * 
 *     for reg in [ 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  __pyx_t_1 = __pyx_tuple__29; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_2 >= 3) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    __Pyx_XDECREF_SET(__pyx_v_reg, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "qnet.pyx":1857
 * 
 *     for reg in [ 1e-6, 1e-10, 0 ]:
 *         try:             # <<<<<<<<<<<<<<
 * 
 *             arrv = arrv_in.duplicate()
 */
    {
      __Pyx_ExceptionSave(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      __Pyx_XGOTREF(__pyx_t_4);
      __Pyx_XGOTREF(__pyx_t_5);
      __Pyx_XGOTREF(__pyx_t_6);
      /*try:*/ {

        /* "qnet.pyx":1859
 *         try:
 * 
 *             arrv = arrv_in.duplicate()             # <<<<<<<<<<<<<<
 * 
 *             lp = setup_initialization_lp (arrv, reg)
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_in), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1859; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1859; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1859; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1859; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_XDECREF_SET(__pyx_v_arrv, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_3));
        __pyx_t_3 = 0;

        /* "qnet.pyx":1861
 *             arrv = arrv_in.duplicate()
 * 
 *             lp = setup_initialization_lp (arrv, reg)             # <<<<<<<<<<<<<<
 *             soln = lp.solve()
 *             print "***********"
 */
        __pyx_t_3 = __pyx_f_4qnet_setup_initialization_lp(__pyx_v_arrv, __pyx_v_reg); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1861; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_XDECREF_SET(__pyx_v_lp, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "qnet.pyx":1862
 * 
 *             lp = setup_initialization_lp (arrv, reg)
 *             soln = lp.solve()             # <<<<<<<<<<<<<<
 *             print "***********"
 * 
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_solve); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1862; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF_SET(__pyx_v_soln, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "qnet.pyx":1863
 *             lp = setup_initialization_lp (arrv, reg)
 *             soln = lp.solve()
 *             print "***********"             # <<<<<<<<<<<<<<
 * 
 *             if DEBUG_INITIAL:
 */
        if (__Pyx_PrintOne(0, __pyx_kp_s__30) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1863; __pyx_clineno = __LINE__; goto __pyx_L5_error;}

        /* "qnet.pyx":1865
 *             print "***********"
 * 
 *             if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *                 for k,v in soln.iteritems():
 *                     print "%s %.17g" % (k,v)
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {

          /* "qnet.pyx":1866
 * 
 *             if DEBUG_INITIAL:
 *                 for k,v in soln.iteritems():             # <<<<<<<<<<<<<<
 *                     print "%s %.17g" % (k,v)
 * 
 */
          __pyx_t_9 = 0;
          if (unlikely(__pyx_v_soln == Py_None)) {
            PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1866; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          }
          __pyx_t_7 = __Pyx_dict_iterator(__pyx_v_soln, 0, __pyx_n_s_iteritems, (&__pyx_t_10), (&__pyx_t_11)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1866; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_XDECREF(__pyx_t_3);
          __pyx_t_3 = __pyx_t_7;
          __pyx_t_7 = 0;
          while (1) {
            __pyx_t_12 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_10, &__pyx_t_9, &__pyx_t_7, &__pyx_t_8, NULL, __pyx_t_11);
            if (unlikely(__pyx_t_12 == 0)) break;
            if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1866; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_7);
            __pyx_t_7 = 0;
            __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_8);
            __pyx_t_8 = 0;

            /* "qnet.pyx":1867
 *             if DEBUG_INITIAL:
 *                 for k,v in soln.iteritems():
 *                     print "%s %.17g" % (k,v)             # <<<<<<<<<<<<<<
 * 
 *             for evt in arrv:
 */
            __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1867; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_INCREF(__pyx_v_k);
            PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_k);
            __Pyx_GIVEREF(__pyx_v_k);
            __Pyx_INCREF(__pyx_v_v);
            PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_v);
            __Pyx_GIVEREF(__pyx_v_v);
            __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_s_17g, __pyx_t_8); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1867; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (__Pyx_PrintOne(0, __pyx_t_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1867; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          }
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          goto __pyx_L13;
        }
        __pyx_L13:;

        /* "qnet.pyx":1869
 *                     print "%s %.17g" % (k,v)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.update_from_solution (soln)
 * 
 */
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_10 = 0;
          __pyx_t_13 = NULL;
        } else {
          __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_13)) {
            if (likely(PyList_CheckExact(__pyx_t_3))) {
              if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_7 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_7); __pyx_t_10++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_7); __pyx_t_10++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_7 = __pyx_t_13(__pyx_t_3);
            if (unlikely(!__pyx_t_7)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_7);
          }
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1869; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
          __pyx_t_7 = 0;

          /* "qnet.pyx":1870
 * 
 *             for evt in arrv:
 *                 evt.update_from_solution (soln)             # <<<<<<<<<<<<<<
 * 
 *             for evt in arrv:
 */
          ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->update_from_solution(__pyx_v_evt, __pyx_v_soln);

          /* "qnet.pyx":1869
 *                     print "%s %.17g" % (k,v)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.update_from_solution (soln)
 * 
 */
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1872
 *                 evt.update_from_solution (soln)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.recompute_service (evt)
 * 
 */
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_10 = 0;
          __pyx_t_13 = NULL;
        } else {
          __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_13)) {
            if (likely(PyList_CheckExact(__pyx_t_3))) {
              if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_7 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_7); __pyx_t_10++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_7); __pyx_t_10++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_7 = __pyx_t_13(__pyx_t_3);
            if (unlikely(!__pyx_t_7)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_7);
          }
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1872; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_7));
          __pyx_t_7 = 0;

          /* "qnet.pyx":1873
 * 
 *             for evt in arrv:
 *                 evt.q.recompute_service (evt)             # <<<<<<<<<<<<<<
 * 
 *             arrv.validate()
 */
          __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt->q->__pyx_vtab)->recompute_service(__pyx_v_evt->q, __pyx_v_evt, 0); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1873; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "qnet.pyx":1872
 *                 evt.update_from_solution (soln)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.recompute_service (evt)
 * 
 */
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1875
 *                 evt.q.recompute_service (evt)
 * 
 *             arrv.validate()             # <<<<<<<<<<<<<<
 *             lp.cleanup()
 * 
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1875; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1875; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1875; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1876
 * 
 *             arrv.validate()
 *             lp.cleanup()             # <<<<<<<<<<<<<<
 * 
 *             return arrv
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_cleanup); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1876; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

        /* "qnet.pyx":1878
 *             lp.cleanup()
 * 
 *             return arrv             # <<<<<<<<<<<<<<
 * 
 *         except Exception, e:
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        __pyx_r = ((PyObject *)__pyx_v_arrv);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L9_try_return;
      }
      __pyx_L5_error:;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "qnet.pyx":1880
 *             return arrv
 * 
 *         except Exception, e:             # <<<<<<<<<<<<<<
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():
 */
      __pyx_t_11 = PyErr_ExceptionMatches(__pyx_builtin_Exception);
      if (__pyx_t_11) {
        __Pyx_AddTraceback("qnet.gibbs_initialize_via_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_7, &__pyx_t_8) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1880; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_7);

        /* "qnet.pyx":1881
 * 
 *         except Exception, e:
 *             if reg == 0:  # give up             # <<<<<<<<<<<<<<
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)
 */
        __pyx_t_14 = PyObject_RichCompare(__pyx_v_reg, __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_14); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1881; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1881; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        if (__pyx_t_15) {

          /* "qnet.pyx":1882
 *         except Exception, e:
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():             # <<<<<<<<<<<<<<
 *                     print "%s %s" % (k,v)
 *                 print arrv
 */
          __pyx_t_10 = 0;
          if (unlikely(__pyx_v_soln == Py_None)) {
            PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1882; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          }
          __pyx_t_16 = __Pyx_dict_iterator(__pyx_v_soln, 0, __pyx_n_s_iteritems, (&__pyx_t_9), (&__pyx_t_11)); if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1882; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_16);
          __Pyx_XDECREF(__pyx_t_14);
          __pyx_t_14 = __pyx_t_16;
          __pyx_t_16 = 0;
          while (1) {
            __pyx_t_12 = __Pyx_dict_iter_next(__pyx_t_14, __pyx_t_9, &__pyx_t_10, &__pyx_t_16, &__pyx_t_17, NULL, __pyx_t_11);
            if (unlikely(__pyx_t_12 == 0)) break;
            if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1882; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_16);
            __Pyx_GOTREF(__pyx_t_17);
            __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_16);
            __pyx_t_16 = 0;
            __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_17);
            __pyx_t_17 = 0;

            /* "qnet.pyx":1883
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)             # <<<<<<<<<<<<<<
 *                 print arrv
 *                 raise e
 */
            __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_17);
            __Pyx_INCREF(__pyx_v_k);
            PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_v_k);
            __Pyx_GIVEREF(__pyx_v_k);
            __Pyx_INCREF(__pyx_v_v);
            PyTuple_SET_ITEM(__pyx_t_17, 1, __pyx_v_v);
            __Pyx_GIVEREF(__pyx_v_v);
            __pyx_t_16 = __Pyx_PyString_Format(__pyx_kp_s_s_s, __pyx_t_17); if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_16);
            __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
            if (__Pyx_PrintOne(0, __pyx_t_16) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1883; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
          }
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

          /* "qnet.pyx":1884
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)
 *                 print arrv             # <<<<<<<<<<<<<<
 *                 raise e
 *             else:
 */
          if (unlikely(!__pyx_v_arrv)) { __Pyx_RaiseUnboundLocalError("arrv"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;} }
          if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_arrv)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1884; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}

          /* "qnet.pyx":1885
 *                     print "%s %s" % (k,v)
 *                 print arrv
 *                 raise e             # <<<<<<<<<<<<<<
 *             else:
 *                 print "Initialization at %s failed: %s" % (reg, e)
 */
          __Pyx_Raise(__pyx_v_e, 0, 0, 0);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1885; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        }
        /*else*/ {

          /* "qnet.pyx":1887
 *                 raise e
 *             else:
 *                 print "Initialization at %s failed: %s" % (reg, e)             # <<<<<<<<<<<<<<
 * 
 * def visualize_initialization_lp (net, Arrivals arrv):
 */
          __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_INCREF(__pyx_v_reg);
          PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_reg);
          __Pyx_GIVEREF(__pyx_v_reg);
          __Pyx_INCREF(__pyx_v_e);
          PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_v_e);
          __Pyx_GIVEREF(__pyx_v_e);
          __pyx_t_16 = __Pyx_PyString_Format(__pyx_kp_s_Initialization_at_s_failed_s, __pyx_t_14); if (unlikely(!__pyx_t_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_16);
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_16) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1887; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L6_exception_handled;
      }
      goto __pyx_L7_except_error;
      __pyx_L7_except_error:;
      __Pyx_XGIVEREF(__pyx_t_4);
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      goto __pyx_L1_error;
      __pyx_L9_try_return:;
      __Pyx_XGIVEREF(__pyx_t_4);
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      goto __pyx_L0;
      __pyx_L6_exception_handled:;
      __Pyx_XGIVEREF(__pyx_t_4);
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
    }

    /* "qnet.pyx":1856
 *     soln = dict()
 * 
 *     for reg in [ 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1850
 *     return heap
 * 
 * def gibbs_initialize_via_lp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_16);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_soln);
  __Pyx_XDECREF(__pyx_v_reg);
  __Pyx_XDECREF(__pyx_v_lp);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1889
 *                 print "Initialization at %s failed: %s" % (reg, e)
 * 
 * def visualize_initialization_lp (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, byq, byt
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_71visualize_initialization_lp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_71visualize_initialization_lp = {"visualize_initialization_lp", (PyCFunction)__pyx_pw_4qnet_71visualize_initialization_lp, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_71visualize_initialization_lp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("visualize_initialization_lp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("visualize_initialization_lp", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "visualize_initialization_lp") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("visualize_initialization_lp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.visualize_initialization_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_70visualize_initialization_lp(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_70visualize_initialization_lp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byq = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_byt = 0;
  PyObject *__pyx_v_f = NULL;
  PyObject *__pyx_v_q = NULL;
  int __pyx_v_eid;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("visualize_initialization_lp", 0);

  /* "qnet.pyx":1892
 *     cdef Event evt, byq, byt
 * 
 *     f = open ("model.dot", "w")             # <<<<<<<<<<<<<<
 * 
 *     f.write ("digraph G {\n")
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1892; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_f = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1894
 *     f = open ("model.dot", "w")
 * 
 *     f.write ("digraph G {\n")             # <<<<<<<<<<<<<<
 * 
 *     for q in net.queues:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__32, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1896
 *     f.write ("digraph G {\n")
 * 
 *     for q in net.queues:             # <<<<<<<<<<<<<<
 * 
 *         f.write ("subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_queues); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1896; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1898
 *     for q in net.queues:
 * 
 *         f.write ("subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))             # <<<<<<<<<<<<<<
 * 
 *         for evt in arrv.events_of_queue (q):
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    __pyx_t_6 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_subgraph_cluster__s_D_label_s_co, __pyx_t_8); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
      PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1898; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1900
 *         f.write ("subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 *         for evt in arrv.events_of_queue (q):             # <<<<<<<<<<<<<<
 *             eid = evt.eid
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_q); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
      __pyx_t_5 = __pyx_t_2; __Pyx_INCREF(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1900; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":1901
 * 
 *         for evt in arrv.events_of_queue (q):
 *             eid = evt.eid             # <<<<<<<<<<<<<<
 * 
 *             # Constraint 3. d_e >= d_(rho(e))
 */
      __pyx_t_11 = __pyx_v_evt->eid;
      __pyx_v_eid = __pyx_t_11;

      /* "qnet.pyx":1904
 * 
 *             # Constraint 3. d_e >= d_(rho(e))
 *             byq = evt.q.previous_departing (evt)             # <<<<<<<<<<<<<<
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 */
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_previous_departing); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1904; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_byq, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":1905
 *             # Constraint 3. d_e >= d_(rho(e))
 *             byq = evt.q.previous_departing (evt)
 *             if byq:             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     f.write ("d%d -> d%d;\n" % (byq.eid, eid))
 */
      __pyx_t_12 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1905; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_12) {

        /* "qnet.pyx":1906
 *             byq = evt.q.previous_departing (evt)
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):             # <<<<<<<<<<<<<<
 *                     f.write ("d%d -> d%d;\n" % (byq.eid, eid))
 * 
 */
        __pyx_t_13 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
        if (!__pyx_t_13) {
        } else {
          __pyx_t_12 = __pyx_t_13;
          goto __pyx_L9_bool_binop_done;
        }
        __pyx_t_13 = ((!(__pyx_v_byq->obs_d != 0)) != 0);
        __pyx_t_12 = __pyx_t_13;
        __pyx_L9_bool_binop_done:;
        if (__pyx_t_12) {

          /* "qnet.pyx":1907
 *             if byq:
 *                 if (not evt.obs_d) or (not byq.obs_d):
 *                     f.write ("d%d -> d%d;\n" % (byq.eid, eid))             # <<<<<<<<<<<<<<
 * 
 *         f.write("}\n")
 */
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_byq->eid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_14);
          PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_6);
          __pyx_t_8 = 0;
          __pyx_t_6 = 0;
          __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_d_d_d_d, __pyx_t_14); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_14)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_14);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
            }
          }
          if (!__pyx_t_14) {
            __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __Pyx_GOTREF(__pyx_t_2);
          } else {
            __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_8);
            PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_14); __Pyx_GIVEREF(__pyx_t_14); __pyx_t_14 = NULL;
            PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
            __Pyx_GIVEREF(__pyx_t_6);
            __pyx_t_6 = 0;
            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1907; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L8;
        }
        __pyx_L8:;
        goto __pyx_L7;
      }
      __pyx_L7:;

      /* "qnet.pyx":1900
 *         f.write ("subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 *         for evt in arrv.events_of_queue (q):             # <<<<<<<<<<<<<<
 *             eid = evt.eid
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "qnet.pyx":1909
 *                     f.write ("d%d -> d%d;\n" % (byq.eid, eid))
 * 
 *         f.write("}\n")             # <<<<<<<<<<<<<<
 *         f.write ("subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__34, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1910
 * 
 *         f.write("}\n")
 *         f.write ("subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))             # <<<<<<<<<<<<<<
 * 
 *         for evt in arrv.events_of_queue (q):
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_8);
    __pyx_t_7 = 0;
    __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_subgraph_cluster__s_A_label_s_co, __pyx_t_6); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
      PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1912
 *         f.write ("subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 *         for evt in arrv.events_of_queue (q):             # <<<<<<<<<<<<<<
 *             eid = evt.eid
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_q); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
      __pyx_t_5 = __pyx_t_2; __Pyx_INCREF(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_2); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #else
          __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1912; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":1913
 * 
 *         for evt in arrv.events_of_queue (q):
 *             eid = evt.eid             # <<<<<<<<<<<<<<
 * 
 *             # Constraint 3b. a_e >= a_(rho(e))
 */
      __pyx_t_11 = __pyx_v_evt->eid;
      __pyx_v_eid = __pyx_t_11;

      /* "qnet.pyx":1916
 * 
 *             # Constraint 3b. a_e >= a_(rho(e))
 *             byq = evt.q.previous_departing (evt)             # <<<<<<<<<<<<<<
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_previous_departing); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_6, 0+1, ((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1916; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_XDECREF_SET(__pyx_v_byq, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;

      /* "qnet.pyx":1917
 *             # Constraint 3b. a_e >= a_(rho(e))
 *             byq = evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events             # <<<<<<<<<<<<<<
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     f.write ("a%d -> a%d;\n" % (byq.eid, eid))
 */
      __pyx_t_13 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byq)); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_13) {
      } else {
        __pyx_t_12 = __pyx_t_13;
        goto __pyx_L14_bool_binop_done;
      }
      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1917; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_12 = __pyx_t_13;
      __pyx_L14_bool_binop_done:;
      if (__pyx_t_12) {

        /* "qnet.pyx":1918
 *             byq = evt.q.previous_departing (evt)
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):             # <<<<<<<<<<<<<<
 *                     f.write ("a%d -> a%d;\n" % (byq.eid, eid))
 * 
 */
        __pyx_t_13 = ((!(__pyx_v_evt->obs_a != 0)) != 0);
        if (!__pyx_t_13) {
        } else {
          __pyx_t_12 = __pyx_t_13;
          goto __pyx_L17_bool_binop_done;
        }
        __pyx_t_13 = ((!(__pyx_v_byq->obs_a != 0)) != 0);
        __pyx_t_12 = __pyx_t_13;
        __pyx_L17_bool_binop_done:;
        if (__pyx_t_12) {

          /* "qnet.pyx":1919
 *             if byq and evt.prev_byt:  # don't do it for initial events
 *                 if (not evt.obs_a) or (not byq.obs_a):
 *                     f.write ("a%d -> a%d;\n" % (byq.eid, eid))             # <<<<<<<<<<<<<<
 * 
 *         f.write("}\n")
 */
          __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_byq->eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_14);
          PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_7);
          __pyx_t_6 = 0;
          __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_a_d_a_d, __pyx_t_14); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
            __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
            if (likely(__pyx_t_14)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
              __Pyx_INCREF(__pyx_t_14);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_8, function);
            }
          }
          if (!__pyx_t_14) {
            __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_7); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_2);
          } else {
            __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_6);
            PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_14); __Pyx_GIVEREF(__pyx_t_14); __pyx_t_14 = NULL;
            PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_7);
            __Pyx_GIVEREF(__pyx_t_7);
            __pyx_t_7 = 0;
            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1919; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          }
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L16;
        }
        __pyx_L16:;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "qnet.pyx":1912
 *         f.write ("subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 *         for evt in arrv.events_of_queue (q):             # <<<<<<<<<<<<<<
 *             eid = evt.eid
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "qnet.pyx":1921
 *                     f.write ("a%d -> a%d;\n" % (byq.eid, eid))
 * 
 *         f.write("}\n")             # <<<<<<<<<<<<<<
 * 
 *     for evt in arrv:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "qnet.pyx":1896
 *     f.write ("digraph G {\n")
 * 
 *     for q in net.queues:             # <<<<<<<<<<<<<<
 * 
 *         f.write ("subgraph cluster_%s_D {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1923
 *         f.write("}\n")
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt:
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_1); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_3); __Pyx_INCREF(__pyx_t_2); __pyx_t_3++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1923; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1924
 * 
 *     for evt in arrv:
 *         byt = evt.prev_byt             # <<<<<<<<<<<<<<
 *         if byt:
 *             f.write ("a%d -> d%d [color=gray60];\n" % (evt.eid, evt.eid))
 */
    if (!(likely(((__pyx_v_evt->prev_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byt, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_2 = __pyx_v_evt->prev_byt;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_byt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":1925
 *     for evt in arrv:
 *         byt = evt.prev_byt
 *         if byt:             # <<<<<<<<<<<<<<
 *             f.write ("a%d -> d%d [color=gray60];\n" % (evt.eid, evt.eid))
 *             f.write ("d%d -> a%d [color=lawngreen];\n" % (byt.eid, evt.eid))
 */
    __pyx_t_12 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_byt)); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1925; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_t_12) {

      /* "qnet.pyx":1926
 *         byt = evt.prev_byt
 *         if byt:
 *             f.write ("a%d -> d%d [color=gray60];\n" % (evt.eid, evt.eid))             # <<<<<<<<<<<<<<
 *             f.write ("d%d -> a%d [color=lawngreen];\n" % (byt.eid, evt.eid))
 *         if evt.obs_a:
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_8 = 0;
      __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_a_d_d_d_color_gray60, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1926; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "qnet.pyx":1927
 *         if byt:
 *             f.write ("a%d -> d%d [color=gray60];\n" % (evt.eid, evt.eid))
 *             f.write ("d%d -> a%d [color=lawngreen];\n" % (byt.eid, evt.eid))             # <<<<<<<<<<<<<<
 *         if evt.obs_a:
 *             f.write ("a%d [style=filled, color=grey80];\n" % evt.eid)
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_byt->eid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_6);
      __pyx_t_8 = 0;
      __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_d_d_a_d_color_lawngreen, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1927; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L21;
    }
    __pyx_L21:;

    /* "qnet.pyx":1928
 *             f.write ("a%d -> d%d [color=gray60];\n" % (evt.eid, evt.eid))
 *             f.write ("d%d -> a%d [color=lawngreen];\n" % (byt.eid, evt.eid))
 *         if evt.obs_a:             # <<<<<<<<<<<<<<
 *             f.write ("a%d [style=filled, color=grey80];\n" % evt.eid)
 *         if evt.obs_d:
 */
    __pyx_t_12 = (__pyx_v_evt->obs_a != 0);
    if (__pyx_t_12) {

      /* "qnet.pyx":1929
 *             f.write ("d%d -> a%d [color=lawngreen];\n" % (byt.eid, evt.eid))
 *         if evt.obs_a:
 *             f.write ("a%d [style=filled, color=grey80];\n" % evt.eid)             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             f.write ("d%d [style=filled, color=grey80];\n" % evt.eid)
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_a_d_style_filled_color_grey80, __pyx_t_8); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1929; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L22;
    }
    __pyx_L22:;

    /* "qnet.pyx":1930
 *         if evt.obs_a:
 *             f.write ("a%d [style=filled, color=grey80];\n" % evt.eid)
 *         if evt.obs_d:             # <<<<<<<<<<<<<<
 *             f.write ("d%d [style=filled, color=grey80];\n" % evt.eid)
 * 
 */
    __pyx_t_12 = (__pyx_v_evt->obs_d != 0);
    if (__pyx_t_12) {

      /* "qnet.pyx":1931
 *             f.write ("a%d [style=filled, color=grey80];\n" % evt.eid)
 *         if evt.obs_d:
 *             f.write ("d%d [style=filled, color=grey80];\n" % evt.eid)             # <<<<<<<<<<<<<<
 * 
 *     f.write ("}\n")
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_d_d_style_filled_color_grey80, __pyx_t_7); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __Pyx_GIVEREF(__pyx_t_7); __pyx_t_7 = NULL;
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1931; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L23;
    }
    __pyx_L23:;

    /* "qnet.pyx":1923
 *         f.write("}\n")
 * 
 *     for evt in arrv:             # <<<<<<<<<<<<<<
 *         byt = evt.prev_byt
 *         if byt:
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1933
 *             f.write ("d%d [style=filled, color=grey80];\n" % evt.eid)
 * 
 *     f.write ("}\n")             # <<<<<<<<<<<<<<
 *     f.close ()
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1934
 * 
 *     f.write ("}\n")
 *     f.close ()             # <<<<<<<<<<<<<<
 * 
 * def gibbs_initialize_via_minilp (net, Arrivals arrv_in):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_close); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1934; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":1889
 *                 print "Initialization at %s failed: %s" % (reg, e)
 * 
 * def visualize_initialization_lp (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, byq, byt
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("qnet.visualize_initialization_lp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_byq);
  __Pyx_XDECREF((PyObject *)__pyx_v_byt);
  __Pyx_XDECREF(__pyx_v_f);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1936
 *     f.close ()
 * 
 * def gibbs_initialize_via_minilp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_73gibbs_initialize_via_minilp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_73gibbs_initialize_via_minilp = {"gibbs_initialize_via_minilp", (PyCFunction)__pyx_pw_4qnet_73gibbs_initialize_via_minilp, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_73gibbs_initialize_via_minilp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_via_minilp (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv_in,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv_in)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_minilp", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_via_minilp") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv_in = ((struct __pyx_obj_8arrivals_Arrivals *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_via_minilp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_minilp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv_in), __pyx_ptype_8arrivals_Arrivals, 1, "arrv_in", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_72gibbs_initialize_via_minilp(__pyx_self, __pyx_v_net, __pyx_v_arrv_in);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_72gibbs_initialize_via_minilp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv_in) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_soln = NULL;
  PyObject *__pyx_v_reg = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_prev_dept_old = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_prev_arrv_old = NULL;
  PyObject *__pyx_v_lp = NULL;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_v_old_tmpls = NULL;
  PyObject *__pyx_v_arrvls = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  Py_ssize_t __pyx_t_14;
  int __pyx_t_15;
  int __pyx_t_16;
  int __pyx_t_17;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_via_minilp", 0);

  /* "qnet.pyx":1940
 *     cdef Event evt
 * 
 *     arrv_in.validate()             # <<<<<<<<<<<<<<
 *     soln = dict()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_in), __pyx_n_s_validate); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1940; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1941
 * 
 *     arrv_in.validate()
 *     soln = dict()             # <<<<<<<<<<<<<<
 * 
 *     for reg in [ 0.1, 0.01, 1e-4, 1e-6, 1e-10, 0 ]:
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1941; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_soln = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1943
 *     soln = dict()
 * 
 *     for reg in [ 0.1, 0.01, 1e-4, 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  __pyx_t_1 = __pyx_tuple__37; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
  for (;;) {
    if (__pyx_t_4 >= 6) break;
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1943; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #else
    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1943; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    #endif
    __Pyx_XDECREF_SET(__pyx_v_reg, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":1944
 * 
 *     for reg in [ 0.1, 0.01, 1e-4, 1e-6, 1e-10, 0 ]:
 *         try:             # <<<<<<<<<<<<<<
 * 
 *             arrv = arrv_in.duplicate()
 */
    {
      __Pyx_ExceptionSave(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_5);
      __Pyx_XGOTREF(__pyx_t_6);
      __Pyx_XGOTREF(__pyx_t_7);
      /*try:*/ {

        /* "qnet.pyx":1946
 *         try:
 * 
 *             arrv = arrv_in.duplicate()             # <<<<<<<<<<<<<<
 *             arrv.recompute_all_service() # hack for cases in which multiple events have same departure time at same queeu
 *             arrv.validate()
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv_in), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1946; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1946; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1946; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Arrivals))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1946; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_XDECREF_SET(__pyx_v_arrv, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1947
 * 
 *             arrv = arrv_in.duplicate()
 *             arrv.recompute_all_service() # hack for cases in which multiple events have same departure time at same queeu             # <<<<<<<<<<<<<<
 *             arrv.validate()
 * 
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_recompute_all_service); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1947; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1947; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1947; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1948
 *             arrv = arrv_in.duplicate()
 *             arrv.recompute_all_service() # hack for cases in which multiple events have same departure time at same queeu
 *             arrv.validate()             # <<<<<<<<<<<<<<
 * 
 *             prev_dept_old = [ e.queue().previous_departing(e) for e in arrv ]
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1948; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1948; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1948; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1950
 *             arrv.validate()
 * 
 *             prev_dept_old = [ e.queue().previous_departing(e) for e in arrv ]             # <<<<<<<<<<<<<<
 *             prev_arrv_old = [ e.queue().previous_arriving(e) for e in arrv ]
 * 
 */
        __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_9 = 0;
          __pyx_t_10 = NULL;
        } else {
          __pyx_t_9 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_10)) {
            if (likely(PyList_CheckExact(__pyx_t_3))) {
              if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_8 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_8); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_8); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_8 = __pyx_t_10(__pyx_t_3);
            if (unlikely(!__pyx_t_8)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_8);
          }
          __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_queue); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_13 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
            __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
            if (likely(__pyx_t_13)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
              __Pyx_INCREF(__pyx_t_13);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_12, function);
            }
          }
          if (__pyx_t_13) {
            __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          } else {
            __pyx_t_11 = __Pyx_PyObject_CallNoArg(__pyx_t_12); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          }
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_previous_departing); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_11 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_12))) {
            __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
            if (likely(__pyx_t_11)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
              __Pyx_INCREF(__pyx_t_11);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_12, function);
            }
          }
          if (!__pyx_t_11) {
            __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_v_e); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
          } else {
            __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_13);
            PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
            __Pyx_INCREF(__pyx_v_e);
            PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_v_e);
            __Pyx_GIVEREF(__pyx_v_e);
            __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_13, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          }
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_8))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1950; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_prev_dept_old, ((PyObject*)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1951
 * 
 *             prev_dept_old = [ e.queue().previous_departing(e) for e in arrv ]
 *             prev_arrv_old = [ e.queue().previous_arriving(e) for e in arrv ]             # <<<<<<<<<<<<<<
 * 
 *             print "********** RUNNING MINI-LP ", reg
 */
        __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_3 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_3); __pyx_t_9 = 0;
          __pyx_t_10 = NULL;
        } else {
          __pyx_t_9 = -1; __pyx_t_3 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_10)) {
            if (likely(PyList_CheckExact(__pyx_t_3))) {
              if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_8 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_8); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_9); __Pyx_INCREF(__pyx_t_8); __pyx_t_9++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_3, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_8 = __pyx_t_10(__pyx_t_3);
            if (unlikely(!__pyx_t_8)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_8);
          }
          __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_8);
          __pyx_t_8 = 0;
          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_queue); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_13);
          __pyx_t_11 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_13))) {
            __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_13);
            if (likely(__pyx_t_11)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
              __Pyx_INCREF(__pyx_t_11);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_13, function);
            }
          }
          if (__pyx_t_11) {
            __pyx_t_12 = __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_11); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          } else {
            __pyx_t_12 = __Pyx_PyObject_CallNoArg(__pyx_t_13); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          }
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_previous_arriving); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_13);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_13))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_13, function);
            }
          }
          if (!__pyx_t_12) {
            __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_v_e); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
          } else {
            __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_11);
            PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
            __Pyx_INCREF(__pyx_v_e);
            PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_v_e);
            __Pyx_GIVEREF(__pyx_v_e);
            __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          }
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_8))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1951; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_prev_arrv_old, ((PyObject*)__pyx_t_2));
        __pyx_t_2 = 0;

        /* "qnet.pyx":1953
 *             prev_arrv_old = [ e.queue().previous_arriving(e) for e in arrv ]
 * 
 *             print "********** RUNNING MINI-LP ", reg             # <<<<<<<<<<<<<<
 *             lp = setup_minilp (arrv, reg)
 *             soln = lp.solve()
 */
        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_kp_s_RUNNING_MINI_LP);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_RUNNING_MINI_LP);
        __Pyx_GIVEREF(__pyx_kp_s_RUNNING_MINI_LP);
        __Pyx_INCREF(__pyx_v_reg);
        PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_reg);
        __Pyx_GIVEREF(__pyx_v_reg);
        if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1953; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1954
 * 
 *             print "********** RUNNING MINI-LP ", reg
 *             lp = setup_minilp (arrv, reg)             # <<<<<<<<<<<<<<
 *             soln = lp.solve()
 *             compactify_soln (arrv, soln)
 */
        __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_setup_minilp); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
            __pyx_t_9 = 1;
          }
        }
        __pyx_t_13 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_13);
        if (__pyx_t_8) {
          PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
        }
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_9, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __Pyx_INCREF(__pyx_v_reg);
        PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_9, __pyx_v_reg);
        __Pyx_GIVEREF(__pyx_v_reg);
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_13, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1954; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_lp, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":1955
 *             print "********** RUNNING MINI-LP ", reg
 *             lp = setup_minilp (arrv, reg)
 *             soln = lp.solve()             # <<<<<<<<<<<<<<
 *             compactify_soln (arrv, soln)
 *             print "***********"
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_solve); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1955; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_13 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_13) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_13); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1955; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1955; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF_SET(__pyx_v_soln, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":1956
 *             lp = setup_minilp (arrv, reg)
 *             soln = lp.solve()
 *             compactify_soln (arrv, soln)             # <<<<<<<<<<<<<<
 *             print "***********"
 * 
 */
        __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_compactify_soln); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_13 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
            __pyx_t_9 = 1;
          }
        }
        __pyx_t_8 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_8);
        if (__pyx_t_13) {
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
        }
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_9, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __Pyx_INCREF(__pyx_v_soln);
        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_9, __pyx_v_soln);
        __Pyx_GIVEREF(__pyx_v_soln);
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1956; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1957
 *             soln = lp.solve()
 *             compactify_soln (arrv, soln)
 *             print "***********"             # <<<<<<<<<<<<<<
 * 
 *             if DEBUG_INITIAL:
 */
        if (__Pyx_PrintOne(0, __pyx_kp_s__30) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1957; __pyx_clineno = __LINE__; goto __pyx_L5_error;}

        /* "qnet.pyx":1959
 *             print "***********"
 * 
 *             if DEBUG_INITIAL:             # <<<<<<<<<<<<<<
 *                 for k,v in soln.iteritems():
 *                     print "%s %.17g" % (k,v)
 */
        if (__pyx_e_4qnet_DEBUG_INITIAL) {

          /* "qnet.pyx":1960
 * 
 *             if DEBUG_INITIAL:
 *                 for k,v in soln.iteritems():             # <<<<<<<<<<<<<<
 *                     print "%s %.17g" % (k,v)
 * 
 */
          __pyx_t_9 = 0;
          if (unlikely(__pyx_v_soln == Py_None)) {
            PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          }
          __pyx_t_3 = __Pyx_dict_iterator(__pyx_v_soln, 0, __pyx_n_s_iteritems, (&__pyx_t_14), (&__pyx_t_15)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_XDECREF(__pyx_t_2);
          __pyx_t_2 = __pyx_t_3;
          __pyx_t_3 = 0;
          while (1) {
            __pyx_t_16 = __Pyx_dict_iter_next(__pyx_t_2, __pyx_t_14, &__pyx_t_9, &__pyx_t_3, &__pyx_t_8, NULL, __pyx_t_15);
            if (unlikely(__pyx_t_16 == 0)) break;
            if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1960; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_3);
            __pyx_t_3 = 0;
            __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_8);
            __pyx_t_8 = 0;

            /* "qnet.pyx":1961
 *             if DEBUG_INITIAL:
 *                 for k,v in soln.iteritems():
 *                     print "%s %.17g" % (k,v)             # <<<<<<<<<<<<<<
 * 
 *             for evt in arrv:
 */
            __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1961; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_INCREF(__pyx_v_k);
            PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_k);
            __Pyx_GIVEREF(__pyx_v_k);
            __Pyx_INCREF(__pyx_v_v);
            PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_v);
            __Pyx_GIVEREF(__pyx_v_v);
            __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_s_17g, __pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1961; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (__Pyx_PrintOne(0, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1961; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          }
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          goto __pyx_L17;
        }
        __pyx_L17:;

        /* "qnet.pyx":1963
 *                     print "%s %.17g" % (k,v)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.update_from_solution (soln)
 * 
 */
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_2 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_2); __pyx_t_14 = 0;
          __pyx_t_10 = NULL;
        } else {
          __pyx_t_14 = -1; __pyx_t_2 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_10 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_10)) {
            if (likely(PyList_CheckExact(__pyx_t_2))) {
              if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_3); __pyx_t_14++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_3); __pyx_t_14++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_3 = __pyx_t_10(__pyx_t_2);
            if (unlikely(!__pyx_t_3)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_3);
          }
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1963; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
          __pyx_t_3 = 0;

          /* "qnet.pyx":1964
 * 
 *             for evt in arrv:
 *                 evt.update_from_solution (soln)             # <<<<<<<<<<<<<<
 * 
 *             for evt in arrv:
 */
          ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->update_from_solution(__pyx_v_evt, __pyx_v_soln);

          /* "qnet.pyx":1963
 *                     print "%s %.17g" % (k,v)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.update_from_solution (soln)
 * 
 */
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1966
 *                 evt.update_from_solution (soln)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.recompute_service (evt)
 * 
 */
        if (likely(PyList_CheckExact(((PyObject *)__pyx_v_arrv))) || PyTuple_CheckExact(((PyObject *)__pyx_v_arrv))) {
          __pyx_t_2 = ((PyObject *)__pyx_v_arrv); __Pyx_INCREF(__pyx_t_2); __pyx_t_14 = 0;
          __pyx_t_10 = NULL;
        } else {
          __pyx_t_14 = -1; __pyx_t_2 = PyObject_GetIter(((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_10 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        for (;;) {
          if (likely(!__pyx_t_10)) {
            if (likely(PyList_CheckExact(__pyx_t_2))) {
              if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_3); __pyx_t_14++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            } else {
              if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_COMPILING_IN_CPYTHON
              __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_3); __pyx_t_14++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #else
              __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              #endif
            }
          } else {
            __pyx_t_3 = __pyx_t_10(__pyx_t_2);
            if (unlikely(!__pyx_t_3)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_3);
          }
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1966; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
          __pyx_t_3 = 0;

          /* "qnet.pyx":1967
 * 
 *             for evt in arrv:
 *                 evt.q.recompute_service (evt)             # <<<<<<<<<<<<<<
 * 
 *             arrv.regenerate_all_caches()
 */
          __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt->q->__pyx_vtab)->recompute_service(__pyx_v_evt->q, __pyx_v_evt, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1967; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1966
 *                 evt.update_from_solution (soln)
 * 
 *             for evt in arrv:             # <<<<<<<<<<<<<<
 *                 evt.q.recompute_service (evt)
 * 
 */
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1969
 *                 evt.q.recompute_service (evt)
 * 
 *             arrv.regenerate_all_caches()             # <<<<<<<<<<<<<<
 *             arrv.validate()
 *             lp.cleanup()
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1969; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1970
 * 
 *             arrv.regenerate_all_caches()
 *             arrv.validate()             # <<<<<<<<<<<<<<
 *             lp.cleanup()
 * 
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_validate); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1970; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1970; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1970; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1971
 *             arrv.regenerate_all_caches()
 *             arrv.validate()
 *             lp.cleanup()             # <<<<<<<<<<<<<<
 * 
 *             old_tmpls = net.markovize_from_arrivals (arrv)
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lp, __pyx_n_s_cleanup); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1971; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1971; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1971; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1973
 *             lp.cleanup()
 * 
 *             old_tmpls = net.markovize_from_arrivals (arrv)             # <<<<<<<<<<<<<<
 *             estimate_minilp_params (net, arrv)
 *             arrvls = net.slice_resample (arrv, 10)
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_markovize_from_arrivals); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        if (!__pyx_t_8) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_arrv)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_13);
          PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
          PyTuple_SET_ITEM(__pyx_t_13, 0+1, ((PyObject *)__pyx_v_arrv));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_13, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1973; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_old_tmpls, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":1974
 * 
 *             old_tmpls = net.markovize_from_arrivals (arrv)
 *             estimate_minilp_params (net, arrv)             # <<<<<<<<<<<<<<
 *             arrvls = net.slice_resample (arrv, 10)
 *             arrvls[-1].validate()
 */
        __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_estimate_minilp_params); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_13 = NULL;
        __pyx_t_14 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
            __pyx_t_14 = 1;
          }
        }
        __pyx_t_8 = PyTuple_New(2+__pyx_t_14); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_8);
        if (__pyx_t_13) {
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13); __Pyx_GIVEREF(__pyx_t_13); __pyx_t_13 = NULL;
        }
        __Pyx_INCREF(__pyx_v_net);
        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_14, __pyx_v_net);
        __Pyx_GIVEREF(__pyx_v_net);
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_14, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1974; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1975
 *             old_tmpls = net.markovize_from_arrivals (arrv)
 *             estimate_minilp_params (net, arrv)
 *             arrvls = net.slice_resample (arrv, 10)             # <<<<<<<<<<<<<<
 *             arrvls[-1].validate()
 *             net.demarkovize (old_tmpls)
 */
        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_slice_resample); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1975; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_8 = NULL;
        __pyx_t_14 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
            __pyx_t_14 = 1;
          }
        }
        __pyx_t_13 = PyTuple_New(2+__pyx_t_14); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1975; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_13);
        if (__pyx_t_8) {
          PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8); __Pyx_GIVEREF(__pyx_t_8); __pyx_t_8 = NULL;
        }
        __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
        PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_14, ((PyObject *)__pyx_v_arrv));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
        __Pyx_INCREF(__pyx_int_10);
        PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_14, __pyx_int_10);
        __Pyx_GIVEREF(__pyx_int_10);
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_13, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1975; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF_SET(__pyx_v_arrvls, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "qnet.pyx":1976
 *             estimate_minilp_params (net, arrv)
 *             arrvls = net.slice_resample (arrv, 10)
 *             arrvls[-1].validate()             # <<<<<<<<<<<<<<
 *             net.demarkovize (old_tmpls)
 * 
 */
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_arrvls, -1, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L5_error;};
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_validate); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_13);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_13))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_13);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_13, function);
          }
        }
        if (__pyx_t_3) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else {
          __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_13); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1976; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        }
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1977
 *             arrvls = net.slice_resample (arrv, 10)
 *             arrvls[-1].validate()
 *             net.demarkovize (old_tmpls)             # <<<<<<<<<<<<<<
 * 
 *             return arrvls[-1]
 */
        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_demarkovize); if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
        __Pyx_GOTREF(__pyx_t_13);
        __pyx_t_3 = NULL;
        if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_13))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_13);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_13, function);
          }
        }
        if (!__pyx_t_3) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_v_old_tmpls); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
          __Pyx_INCREF(__pyx_v_old_tmpls);
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_old_tmpls);
          __Pyx_GIVEREF(__pyx_v_old_tmpls);
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1977; __pyx_clineno = __LINE__; goto __pyx_L5_error;}
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "qnet.pyx":1979
 *             net.demarkovize (old_tmpls)
 * 
 *             return arrvls[-1]             # <<<<<<<<<<<<<<
 * 
 *         except Exception, e:
 */
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_arrvls, -1, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1979; __pyx_clineno = __LINE__; goto __pyx_L5_error;};
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L9_try_return;
      }
      __pyx_L5_error:;
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "qnet.pyx":1981
 *             return arrvls[-1]
 * 
 *         except Exception, e:             # <<<<<<<<<<<<<<
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():
 */
      __pyx_t_15 = PyErr_ExceptionMatches(__pyx_builtin_Exception);
      if (__pyx_t_15) {
        __Pyx_AddTraceback("qnet.gibbs_initialize_via_minilp", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_13, &__pyx_t_8) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1981; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GOTREF(__pyx_t_13);
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_13);
        __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_13);

        /* "qnet.pyx":1982
 * 
 *         except Exception, e:
 *             if reg == 0:  # give up             # <<<<<<<<<<<<<<
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)
 */
        __pyx_t_3 = PyObject_RichCompare(__pyx_v_reg, __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1982; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __pyx_t_17 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_17 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1982; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (__pyx_t_17) {

          /* "qnet.pyx":1983
 *         except Exception, e:
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():             # <<<<<<<<<<<<<<
 *                     print "%s %s" % (k,v)
 *                 arrv.write_csv (sys.stdout)
 */
          __pyx_t_14 = 0;
          if (unlikely(__pyx_v_soln == Py_None)) {
            PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
            {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          }
          __pyx_t_11 = __Pyx_dict_iterator(__pyx_v_soln, 0, __pyx_n_s_iteritems, (&__pyx_t_9), (&__pyx_t_15)); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_XDECREF(__pyx_t_3);
          __pyx_t_3 = __pyx_t_11;
          __pyx_t_11 = 0;
          while (1) {
            __pyx_t_16 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_9, &__pyx_t_14, &__pyx_t_11, &__pyx_t_12, NULL, __pyx_t_15);
            if (unlikely(__pyx_t_16 == 0)) break;
            if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1983; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_11);
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_11);
            __pyx_t_11 = 0;
            __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_12);
            __pyx_t_12 = 0;

            /* "qnet.pyx":1984
 *             if reg == 0:  # give up
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)             # <<<<<<<<<<<<<<
 *                 arrv.write_csv (sys.stdout)
 *                 traceback.print_exc()
 */
            __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1984; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_INCREF(__pyx_v_k);
            PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_v_k);
            __Pyx_GIVEREF(__pyx_v_k);
            __Pyx_INCREF(__pyx_v_v);
            PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_v_v);
            __Pyx_GIVEREF(__pyx_v_v);
            __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_s_s, __pyx_t_12); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1984; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_11);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
            if (__Pyx_PrintOne(0, __pyx_t_11) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1984; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          }
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1985
 *                 for k,v in soln.iteritems():
 *                     print "%s %s" % (k,v)
 *                 arrv.write_csv (sys.stdout)             # <<<<<<<<<<<<<<
 *                 traceback.print_exc()
 *                 raise e
 */
          if (unlikely(!__pyx_v_arrv)) { __Pyx_RaiseUnboundLocalError("arrv"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;} }
          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_write_csv); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_12 = __Pyx_GetModuleGlobalName(__pyx_n_s_sys); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_12);
          __pyx_t_18 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_stdout); if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_18);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __pyx_t_12 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_11))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_11, function);
            }
          }
          if (!__pyx_t_12) {
            __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_18); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
            __Pyx_GOTREF(__pyx_t_3);
          } else {
            __pyx_t_19 = PyTuple_New(1+1); if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_19);
            PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_12); __Pyx_GIVEREF(__pyx_t_12); __pyx_t_12 = NULL;
            PyTuple_SET_ITEM(__pyx_t_19, 0+1, __pyx_t_18);
            __Pyx_GIVEREF(__pyx_t_18);
            __pyx_t_18 = 0;
            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_19, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1985; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
          }
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1986
 *                     print "%s %s" % (k,v)
 *                 arrv.write_csv (sys.stdout)
 *                 traceback.print_exc()             # <<<<<<<<<<<<<<
 *                 raise e
 *             else:
 */
          __pyx_t_11 = __Pyx_GetModuleGlobalName(__pyx_n_s_traceback); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1986; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_19 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_print_exc); if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1986; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_19);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_11 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_19))) {
            __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_19);
            if (likely(__pyx_t_11)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_19);
              __Pyx_INCREF(__pyx_t_11);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_19, function);
            }
          }
          if (__pyx_t_11) {
            __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_19, __pyx_t_11); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1986; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          } else {
            __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_19); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1986; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          }
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "qnet.pyx":1987
 *                 arrv.write_csv (sys.stdout)
 *                 traceback.print_exc()
 *                 raise e             # <<<<<<<<<<<<<<
 *             else:
 *                 print "Initialization at %s failed: %s" % (reg, e)
 */
          __Pyx_Raise(__pyx_v_e, 0, 0, 0);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1987; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
        }
        /*else*/ {

          /* "qnet.pyx":1989
 *                 raise e
 *             else:
 *                 print "Initialization at %s failed: %s" % (reg, e)             # <<<<<<<<<<<<<<
 *                 traceback.print_exc()
 * 
 */
          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_v_reg);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_reg);
          __Pyx_GIVEREF(__pyx_v_reg);
          __Pyx_INCREF(__pyx_v_e);
          PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_e);
          __Pyx_GIVEREF(__pyx_v_e);
          __pyx_t_19 = __Pyx_PyString_Format(__pyx_kp_s_Initialization_at_s_failed_s, __pyx_t_3); if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_19);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (__Pyx_PrintOne(0, __pyx_t_19) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1989; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;

          /* "qnet.pyx":1990
 *             else:
 *                 print "Initialization at %s failed: %s" % (reg, e)
 *                 traceback.print_exc()             # <<<<<<<<<<<<<<
 * 
 * 
 */
          __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_traceback); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_print_exc); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = NULL;
          if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_11))) {
            __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
            if (likely(__pyx_t_3)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
              __Pyx_INCREF(__pyx_t_3);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_11, function);
            }
          }
          if (__pyx_t_3) {
            __pyx_t_19 = __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_3); if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          } else {
            __pyx_t_19 = __Pyx_PyObject_CallNoArg(__pyx_t_11); if (unlikely(!__pyx_t_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1990; __pyx_clineno = __LINE__; goto __pyx_L7_except_error;}
          }
          __Pyx_GOTREF(__pyx_t_19);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L6_exception_handled;
      }
      goto __pyx_L7_except_error;
      __pyx_L7_except_error:;
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      goto __pyx_L1_error;
      __pyx_L9_try_return:;
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
      goto __pyx_L0;
      __pyx_L6_exception_handled:;
      __Pyx_XGIVEREF(__pyx_t_5);
      __Pyx_XGIVEREF(__pyx_t_6);
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
    }

    /* "qnet.pyx":1943
 *     soln = dict()
 * 
 *     for reg in [ 0.1, 0.01, 1e-4, 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1936
 *     f.close ()
 * 
 * def gibbs_initialize_via_minilp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_18);
  __Pyx_XDECREF(__pyx_t_19);
  __Pyx_AddTraceback("qnet.gibbs_initialize_via_minilp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_arrv);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_soln);
  __Pyx_XDECREF(__pyx_v_reg);
  __Pyx_XDECREF(__pyx_v_prev_dept_old);
  __Pyx_XDECREF(__pyx_v_prev_arrv_old);
  __Pyx_XDECREF(__pyx_v_lp);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XDECREF(__pyx_v_old_tmpls);
  __Pyx_XDECREF(__pyx_v_arrvls);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":1994
 * 
 * # requires Markovization
 * def estimate_minilp_params (net, arrv):             # <<<<<<<<<<<<<<
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_75estimate_minilp_params(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_75estimate_minilp_params = {"estimate_minilp_params", (PyCFunction)__pyx_pw_4qnet_75estimate_minilp_params, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_75estimate_minilp_params(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  PyObject *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("estimate_minilp_params (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("estimate_minilp_params", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "estimate_minilp_params") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("estimate_minilp_params", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.estimate_minilp_params", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_74estimate_minilp_params(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_74estimate_minilp_params(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_v_mu_s = NULL;
  PyObject *__pyx_v_N = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("estimate_minilp_params", 0);

  /* "qnet.pyx":1995
 * # requires Markovization
 * def estimate_minilp_params (net, arrv):
 *     mu_s = qstats.mean_task_service (arrv)             # <<<<<<<<<<<<<<
 *     N = qstats.mean_task_length (arrv)
 *     net.parameters = [mu_s / N] * len(net.parameters)
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_qstats); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mean_task_service); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (!__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
    __Pyx_INCREF(__pyx_v_arrv);
    PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_arrv);
    __Pyx_GIVEREF(__pyx_v_arrv);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1995; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_mu_s = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1996
 * def estimate_minilp_params (net, arrv):
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)             # <<<<<<<<<<<<<<
 *     net.parameters = [mu_s / N] * len(net.parameters)
 *     print "minilp mini params", net.parameters
 */
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_qstats); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_mean_task_length); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_arrv); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    __Pyx_INCREF(__pyx_v_arrv);
    PyTuple_SET_ITEM(__pyx_t_2, 0+1, __pyx_v_arrv);
    __Pyx_GIVEREF(__pyx_v_arrv);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1996; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_N = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":1997
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)
 *     net.parameters = [mu_s / N] * len(net.parameters)             # <<<<<<<<<<<<<<
 *     print "minilp mini params", net.parameters
 * 
 */
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_mu_s, __pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_parameters); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyList_New(1 * ((__pyx_t_5<0) ? 0:__pyx_t_5)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  { Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < __pyx_t_5; __pyx_temp++) {
      __Pyx_INCREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_4, __pyx_temp, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
    }
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__Pyx_PyObject_SetAttrStr(__pyx_v_net, __pyx_n_s_parameters, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1997; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":1998
 *     N = qstats.mean_task_length (arrv)
 *     net.parameters = [mu_s / N] * len(net.parameters)
 *     print "minilp mini params", net.parameters             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_parameters); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_s_minilp_mini_params);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_s_minilp_mini_params);
  __Pyx_GIVEREF(__pyx_kp_s_minilp_mini_params);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  if (__Pyx_Print(0, __pyx_t_1, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1998; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":1994
 * 
 * # requires Markovization
 * def estimate_minilp_params (net, arrv):             # <<<<<<<<<<<<<<
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("qnet.estimate_minilp_params", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mu_s);
  __Pyx_XDECREF(__pyx_v_N);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":2001
 * 
 * 
 * def gibbs_initialize_for_ps (net, arrv):             # <<<<<<<<<<<<<<
 *     cdef Event e, evt, dup
 *     cdef Queue q
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_77gibbs_initialize_for_ps(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_77gibbs_initialize_for_ps = {"gibbs_initialize_for_ps", (PyCFunction)__pyx_pw_4qnet_77gibbs_initialize_for_ps, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_77gibbs_initialize_for_ps(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  PyObject *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gibbs_initialize_for_ps (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("gibbs_initialize_for_ps", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gibbs_initialize_for_ps") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gibbs_initialize_for_ps", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.gibbs_initialize_for_ps", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_76gibbs_initialize_for_ps(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_76gibbs_initialize_for_ps(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_net, PyObject *__pyx_v_arrv) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_e = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_dup = 0;
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_result = 0;
  int __pyx_v_eid;
  double __pyx_v_d_last;
  PyObject *__pyx_v_ievts = NULL;
  double __pyx_v_s;
  PyObject *__pyx_v_next_obs = NULL;
  PyObject *__pyx_v_n_hidden = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_Z = NULL;
  PyObject *__pyx_v_nh = NULL;
  PyObject *__pyx_v_d_max = NULL;
  PyObject *__pyx_v_rate = NULL;
  PyObject *__pyx_v_delta = NULL;
  PyObject *__pyx_v_q0 = NULL;
  PyObject *__pyx_v_heap = NULL;
  PyObject *__pyx_v_s_next = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  double __pyx_t_13;
  int __pyx_t_14;
  Py_ssize_t __pyx_t_15;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("gibbs_initialize_for_ps", 0);

  /* "qnet.pyx":2005
 *     cdef Queue q
 * 
 *     cdef Arrivals result = Arrivals(net)             # <<<<<<<<<<<<<<
 *     cdef int eid = arrv.max_eidx() + 1
 *     cdef double d_last = 0
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_net);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_net);
  __Pyx_GIVEREF(__pyx_v_net);
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Arrivals)), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2005; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_result = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":2006
 * 
 *     cdef Arrivals result = Arrivals(net)
 *     cdef int eid = arrv.max_eidx() + 1             # <<<<<<<<<<<<<<
 *     cdef double d_last = 0
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_max_eidx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2006; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_eid = __pyx_t_4;

  /* "qnet.pyx":2007
 *     cdef Arrivals result = Arrivals(net)
 *     cdef int eid = arrv.max_eidx() + 1
 *     cdef double d_last = 0             # <<<<<<<<<<<<<<
 * 
 *     ievts = arrv.initial_events()
 */
  __pyx_v_d_last = 0.0;

  /* "qnet.pyx":2009
 *     cdef double d_last = 0
 * 
 *     ievts = arrv.initial_events()             # <<<<<<<<<<<<<<
 *     ievts.sort()
 *     for evt in arrv.initial_events():
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_initial_events); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2009; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2009; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2009; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ievts = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":2010
 * 
 *     ievts = arrv.initial_events()
 *     ievts.sort()             # <<<<<<<<<<<<<<
 *     for evt in arrv.initial_events():
 *         if evt.obs_d:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ievts, __pyx_n_s_sort); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2010; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2010; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2010; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "qnet.pyx":2011
 *     ievts = arrv.initial_events()
 *     ievts.sort()
 *     for evt in arrv.initial_events():             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             s = evt.d - d_last
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arrv, __pyx_n_s_initial_events); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2011; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "qnet.pyx":2012
 *     ievts.sort()
 *     for evt in arrv.initial_events():
 *         if evt.obs_d:             # <<<<<<<<<<<<<<
 *             s = evt.d - d_last
 *             dup = Event (evt.eid, evt.tid, evt.qid, evt.q, 0.0, s, evt.d, evt.state, obs_a=1, obs_d=1)
 */
    __pyx_t_7 = (__pyx_v_evt->obs_d != 0);
    if (__pyx_t_7) {

      /* "qnet.pyx":2013
 *     for evt in arrv.initial_events():
 *         if evt.obs_d:
 *             s = evt.d - d_last             # <<<<<<<<<<<<<<
 *             dup = Event (evt.eid, evt.tid, evt.qid, evt.q, 0.0, s, evt.d, evt.state, obs_a=1, obs_d=1)
 *             d_last = dup.d
 */
      __pyx_v_s = (__pyx_v_evt->d - __pyx_v_d_last);

      /* "qnet.pyx":2014
 *         if evt.obs_d:
 *             s = evt.d - d_last
 *             dup = Event (evt.eid, evt.tid, evt.qid, evt.q, 0.0, s, evt.d, evt.state, obs_a=1, obs_d=1)             # <<<<<<<<<<<<<<
 *             d_last = dup.d
 *             result.append (dup)
 */
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->qid); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = PyFloat_FromDouble(__pyx_v_s); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->state); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_12 = PyTuple_New(8); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
      PyTuple_SET_ITEM(__pyx_t_12, 3, ((PyObject *)__pyx_v_evt->q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
      __Pyx_INCREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_12, 4, __pyx_float_0_0);
      __Pyx_GIVEREF(__pyx_float_0_0);
      PyTuple_SET_ITEM(__pyx_t_12, 5, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_12, 6, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_12, 7, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      __pyx_t_1 = 0;
      __pyx_t_3 = 0;
      __pyx_t_8 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_11 = PyDict_New(); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_obs_a, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_obs_d, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_10 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_12, __pyx_t_11); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2014; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dup, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_10));
      __pyx_t_10 = 0;

      /* "qnet.pyx":2015
 *             s = evt.d - d_last
 *             dup = Event (evt.eid, evt.tid, evt.qid, evt.q, 0.0, s, evt.d, evt.state, obs_a=1, obs_d=1)
 *             d_last = dup.d             # <<<<<<<<<<<<<<
 *             result.append (dup)
 *         else:
 */
      __pyx_t_13 = __pyx_v_dup->d;
      __pyx_v_d_last = __pyx_t_13;

      /* "qnet.pyx":2016
 *             dup = Event (evt.eid, evt.tid, evt.qid, evt.q, 0.0, s, evt.d, evt.state, obs_a=1, obs_d=1)
 *             d_last = dup.d
 *             result.append (dup)             # <<<<<<<<<<<<<<
 *         else:
 *             dup = Event (eid, evt.tid, evt.qid, evt.q, 0, 0, d_last, evt.state, 0)
 */
      __pyx_t_14 = __Pyx_PyObject_Append(((PyObject *)__pyx_v_result), ((PyObject *)__pyx_v_dup)); if (unlikely(__pyx_t_14 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2016; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L5;
    }
    /*else*/ {

      /* "qnet.pyx":2018
 *             result.append (dup)
 *         else:
 *             dup = Event (eid, evt.tid, evt.qid, evt.q, 0, 0, d_last, evt.state, 0)             # <<<<<<<<<<<<<<
 *             result.append (dup)
 *             eid += 1
 */
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_eid); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_12 = __Pyx_PyInt_From_int(__pyx_v_evt->qid); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_9 = PyFloat_FromDouble(__pyx_v_d_last); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt->state); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = PyTuple_New(9); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_12);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
      PyTuple_SET_ITEM(__pyx_t_3, 3, ((PyObject *)__pyx_v_evt->q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
      __Pyx_INCREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_3, 4, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
      __Pyx_INCREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_3, 5, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_3, 6, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_3, 7, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_t_3, 8, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_12 = 0;
      __pyx_t_9 = 0;
      __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_8arrivals_Event)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2018; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dup, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
      __pyx_t_8 = 0;

      /* "qnet.pyx":2019
 *         else:
 *             dup = Event (eid, evt.tid, evt.qid, evt.q, 0, 0, d_last, evt.state, 0)
 *             result.append (dup)             # <<<<<<<<<<<<<<
 *             eid += 1
 *         (<Queue>dup.q).recompute_service(dup)
 */
      __pyx_t_14 = __Pyx_PyObject_Append(((PyObject *)__pyx_v_result), ((PyObject *)__pyx_v_dup)); if (unlikely(__pyx_t_14 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2019; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":2020
 *             dup = Event (eid, evt.tid, evt.qid, evt.q, 0, 0, d_last, evt.state, 0)
 *             result.append (dup)
 *             eid += 1             # <<<<<<<<<<<<<<
 *         (<Queue>dup.q).recompute_service(dup)
 * 
 */
      __pyx_v_eid = (__pyx_v_eid + 1);
    }
    __pyx_L5:;

    /* "qnet.pyx":2021
 *             result.append (dup)
 *             eid += 1
 *         (<Queue>dup.q).recompute_service(dup)             # <<<<<<<<<<<<<<
 * 
 *     result.regenerate_all_caches()
 */
    __pyx_t_8 = ((struct __pyx_vtabstruct_6queues_Queue *)((struct __pyx_obj_6queues_Queue *)__pyx_v_dup->q)->__pyx_vtab)->recompute_service(((struct __pyx_obj_6queues_Queue *)__pyx_v_dup->q), __pyx_v_dup, 0); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2021; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "qnet.pyx":2011
 *     ievts = arrv.initial_events()
 *     ievts.sort()
 *     for evt in arrv.initial_events():             # <<<<<<<<<<<<<<
 *         if evt.obs_d:
 *             s = evt.d - d_last
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":2023
 *         (<Queue>dup.q).recompute_service(dup)
 * 
 *     result.regenerate_all_caches()             # <<<<<<<<<<<<<<
 * #    print "STEP0 ", result
 * #    result.validate()
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_regenerate_all_caches); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2023; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2023; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2023; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":2028
 * 
 *     # spread out initial events
 *     ievts = result.events_of_queue (net.queues[0])             # <<<<<<<<<<<<<<
 *     next_obs = [0] * len(ievts)
 *     n_hidden = [0] * len(ievts)
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_events_of_queue); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_queues); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_2);
  } else {
    __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
    PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_9 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_12, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2028; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF_SET(__pyx_v_ievts, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":2029
 *     # spread out initial events
 *     ievts = result.events_of_queue (net.queues[0])
 *     next_obs = [0] * len(ievts)             # <<<<<<<<<<<<<<
 *     n_hidden = [0] * len(ievts)
 *     i = len(ievts)-1
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_ievts); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyList_New(1 * ((__pyx_t_5<0) ? 0:__pyx_t_5)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2029; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  { Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < __pyx_t_5; __pyx_temp++) {
      __Pyx_INCREF(__pyx_int_0);
      PyList_SET_ITEM(__pyx_t_2, __pyx_temp, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
    }
  }
  __pyx_v_next_obs = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":2030
 *     ievts = result.events_of_queue (net.queues[0])
 *     next_obs = [0] * len(ievts)
 *     n_hidden = [0] * len(ievts)             # <<<<<<<<<<<<<<
 *     i = len(ievts)-1
 *     Z = numpy.inf
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_ievts); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyList_New(1 * ((__pyx_t_5<0) ? 0:__pyx_t_5)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2030; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  { Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < __pyx_t_5; __pyx_temp++) {
      __Pyx_INCREF(__pyx_int_0);
      PyList_SET_ITEM(__pyx_t_2, __pyx_temp, __pyx_int_0);
      __Pyx_GIVEREF(__pyx_int_0);
    }
  }
  __pyx_v_n_hidden = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "qnet.pyx":2031
 *     next_obs = [0] * len(ievts)
 *     n_hidden = [0] * len(ievts)
 *     i = len(ievts)-1             # <<<<<<<<<<<<<<
 *     Z = numpy.inf
 *     nh = 0
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_ievts); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2031; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyInt_FromSsize_t((__pyx_t_5 - 1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2031; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_i = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":2032
 *     n_hidden = [0] * len(ievts)
 *     i = len(ievts)-1
 *     Z = numpy.inf             # <<<<<<<<<<<<<<
 *     nh = 0
 *     d_max = 0
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_inf); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2032; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_Z = __pyx_t_8;
  __pyx_t_8 = 0;

  /* "qnet.pyx":2033
 *     i = len(ievts)-1
 *     Z = numpy.inf
 *     nh = 0             # <<<<<<<<<<<<<<
 *     d_max = 0
 *     while i >= 0:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_nh = __pyx_int_0;

  /* "qnet.pyx":2034
 *     Z = numpy.inf
 *     nh = 0
 *     d_max = 0             # <<<<<<<<<<<<<<
 *     while i >= 0:
 *         evt = ievts[i]
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_d_max = __pyx_int_0;

  /* "qnet.pyx":2035
 *     nh = 0
 *     d_max = 0
 *     while i >= 0:             # <<<<<<<<<<<<<<
 *         evt = ievts[i]
 *         if not evt.obs_d:
 */
  while (1) {
    __pyx_t_8 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2035; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (!__pyx_t_7) break;

    /* "qnet.pyx":2036
 *     d_max = 0
 *     while i >= 0:
 *         evt = ievts[i]             # <<<<<<<<<<<<<<
 *         if not evt.obs_d:
 *             nh += 1
 */
    __pyx_t_8 = PyObject_GetItem(__pyx_v_ievts, __pyx_v_i); if (unlikely(__pyx_t_8 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_8);
    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2036; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "qnet.pyx":2037
 *     while i >= 0:
 *         evt = ievts[i]
 *         if not evt.obs_d:             # <<<<<<<<<<<<<<
 *             nh += 1
 *         else:
 */
    __pyx_t_7 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    if (__pyx_t_7) {

      /* "qnet.pyx":2038
 *         evt = ievts[i]
 *         if not evt.obs_d:
 *             nh += 1             # <<<<<<<<<<<<<<
 *         else:
 *             next_obs[i] = Z
 */
      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_nh, __pyx_int_1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2038; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF_SET(__pyx_v_nh, __pyx_t_8);
      __pyx_t_8 = 0;
      goto __pyx_L8;
    }
    /*else*/ {

      /* "qnet.pyx":2040
 *             nh += 1
 *         else:
 *             next_obs[i] = Z             # <<<<<<<<<<<<<<
 *             n_hidden[i] = nh
 *             Z = evt.d
 */
      if (unlikely(PyObject_SetItem(__pyx_v_next_obs, __pyx_v_i, __pyx_v_Z) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2040; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":2041
 *         else:
 *             next_obs[i] = Z
 *             n_hidden[i] = nh             # <<<<<<<<<<<<<<
 *             Z = evt.d
 *             d_max = max (d_max, evt.d)
 */
      if (unlikely(PyObject_SetItem(__pyx_v_n_hidden, __pyx_v_i, __pyx_v_nh) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2041; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "qnet.pyx":2042
 *             next_obs[i] = Z
 *             n_hidden[i] = nh
 *             Z = evt.d             # <<<<<<<<<<<<<<
 *             d_max = max (d_max, evt.d)
 *             nh = 0
 */
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2042; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF_SET(__pyx_v_Z, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":2043
 *             n_hidden[i] = nh
 *             Z = evt.d
 *             d_max = max (d_max, evt.d)             # <<<<<<<<<<<<<<
 *             nh = 0
 *         i -= 1
 */
      __pyx_t_13 = __pyx_v_evt->d;
      __Pyx_INCREF(__pyx_v_d_max);
      __pyx_t_8 = __pyx_v_d_max;
      __pyx_t_12 = PyFloat_FromDouble(__pyx_t_13); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_12, __pyx_t_8, Py_GT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_7) {
        __pyx_t_9 = PyFloat_FromDouble(__pyx_t_13); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2043; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_2 = __pyx_t_9;
        __pyx_t_9 = 0;
      } else {
        __Pyx_INCREF(__pyx_t_8);
        __pyx_t_2 = __pyx_t_8;
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __pyx_t_2;
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF_SET(__pyx_v_d_max, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":2044
 *             Z = evt.d
 *             d_max = max (d_max, evt.d)
 *             nh = 0             # <<<<<<<<<<<<<<
 *         i -= 1
 *     # estimate of mean service
 */
      __Pyx_INCREF(__pyx_int_0);
      __Pyx_DECREF_SET(__pyx_v_nh, __pyx_int_0);
    }
    __pyx_L8:;

    /* "qnet.pyx":2045
 *             d_max = max (d_max, evt.d)
 *             nh = 0
 *         i -= 1             # <<<<<<<<<<<<<<
 *     # estimate of mean service
 *     rate = len(ievts) / d_max
 */
    __pyx_t_8 = PyNumber_InPlaceSubtract(__pyx_v_i, __pyx_int_1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2045; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_8);
    __pyx_t_8 = 0;
  }

  /* "qnet.pyx":2047
 *         i -= 1
 *     # estimate of mean service
 *     rate = len(ievts) / d_max             # <<<<<<<<<<<<<<
 *     # now set them up
 *     d_last = ievts[0].a
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_ievts); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_8 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_8, __pyx_v_d_max); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_rate = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":2049
 *     rate = len(ievts) / d_max
 *     # now set them up
 *     d_last = ievts[0].a             # <<<<<<<<<<<<<<
 *     delta = Z / (1+nh)
 *     for i in range(len(ievts)):
 */
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_ievts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2049; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_a); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2049; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_d_last = __pyx_t_13;

  /* "qnet.pyx":2050
 *     # now set them up
 *     d_last = ievts[0].a
 *     delta = Z / (1+nh)             # <<<<<<<<<<<<<<
 *     for i in range(len(ievts)):
 *         evt = ievts[i]
 */
  __pyx_t_8 = PyNumber_Add(__pyx_int_1, __pyx_v_nh); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_v_Z, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2050; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_delta = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "qnet.pyx":2051
 *     d_last = ievts[0].a
 *     delta = Z / (1+nh)
 *     for i in range(len(ievts)):             # <<<<<<<<<<<<<<
 *         evt = ievts[i]
 *         if not evt.obs_d:
 */
  __pyx_t_5 = PyObject_Length(__pyx_v_ievts); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_8 = __pyx_t_2; __Pyx_INCREF(__pyx_t_8); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = Py_TYPE(__pyx_t_8)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_8))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_8, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_8)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_8, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_8);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2051; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_DECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "qnet.pyx":2052
 *     delta = Z / (1+nh)
 *     for i in range(len(ievts)):
 *         evt = ievts[i]             # <<<<<<<<<<<<<<
 *         if not evt.obs_d:
 *             d_last += delta
 */
    __pyx_t_2 = PyObject_GetItem(__pyx_v_ievts, __pyx_v_i); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2052; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
    __Pyx_GOTREF(__pyx_t_2);
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2052; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "qnet.pyx":2053
 *     for i in range(len(ievts)):
 *         evt = ievts[i]
 *         if not evt.obs_d:             # <<<<<<<<<<<<<<
 *             d_last += delta
 *             apply_departure (result, evt, d_last, 0)
 */
    __pyx_t_7 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    if (__pyx_t_7) {

      /* "qnet.pyx":2054
 *         evt = ievts[i]
 *         if not evt.obs_d:
 *             d_last += delta             # <<<<<<<<<<<<<<
 *             apply_departure (result, evt, d_last, 0)
 *         else:
 */
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_d_last); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2054; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_9 = PyNumber_InPlaceAdd(__pyx_t_2, __pyx_v_delta); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2054; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2054; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_v_d_last = __pyx_t_13;

      /* "qnet.pyx":2055
 *         if not evt.obs_d:
 *             d_last += delta
 *             apply_departure (result, evt, d_last, 0)             # <<<<<<<<<<<<<<
 *         else:
 *             if numpy.isinf(next_obs[i]):
 */
      __pyx_t_13 = __pyx_f_4qnet_apply_departure(__pyx_v_result, __pyx_v_evt, __pyx_v_d_last, 0.0, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2055; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      goto __pyx_L11;
    }
    /*else*/ {

      /* "qnet.pyx":2057
 *             apply_departure (result, evt, d_last, 0)
 *         else:
 *             if numpy.isinf(next_obs[i]):             # <<<<<<<<<<<<<<
 *                 delta = 1/rate
 *             else:
 */
      __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_isinf); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_GetItem(__pyx_v_next_obs, __pyx_v_i); if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
        }
      }
      if (!__pyx_t_3) {
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_GOTREF(__pyx_t_9);
      } else {
        __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_3); __Pyx_GIVEREF(__pyx_t_3); __pyx_t_3 = NULL;
        PyTuple_SET_ITEM(__pyx_t_11, 0+1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_11, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2057; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_7) {

        /* "qnet.pyx":2058
 *         else:
 *             if numpy.isinf(next_obs[i]):
 *                 delta = 1/rate             # <<<<<<<<<<<<<<
 *             else:
 *                 delta = (next_obs[i] - evt.d) / (1+n_hidden[i])
 */
        __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_int_1, __pyx_v_rate); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2058; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF_SET(__pyx_v_delta, __pyx_t_9);
        __pyx_t_9 = 0;
        goto __pyx_L12;
      }
      /*else*/ {

        /* "qnet.pyx":2060
 *                 delta = 1/rate
 *             else:
 *                 delta = (next_obs[i] - evt.d) / (1+n_hidden[i])             # <<<<<<<<<<<<<<
 *             d_last = evt.d
 *     # finally reset service
 */
        __pyx_t_9 = PyObject_GetItem(__pyx_v_next_obs, __pyx_v_i); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_12 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_11 = PyNumber_Subtract(__pyx_t_9, __pyx_t_12); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = PyObject_GetItem(__pyx_v_n_hidden, __pyx_v_i); if (unlikely(__pyx_t_12 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_9 = PyNumber_Add(__pyx_int_1, __pyx_t_12); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = __Pyx_PyNumber_Divide(__pyx_t_11, __pyx_t_9); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2060; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF_SET(__pyx_v_delta, __pyx_t_12);
        __pyx_t_12 = 0;
      }
      __pyx_L12:;

      /* "qnet.pyx":2061
 *             else:
 *                 delta = (next_obs[i] - evt.d) / (1+n_hidden[i])
 *             d_last = evt.d             # <<<<<<<<<<<<<<
 *     # finally reset service
 *     q0 = net.queues[0]
 */
      __pyx_t_13 = __pyx_v_evt->d;
      __pyx_v_d_last = __pyx_t_13;
    }
    __pyx_L11:;

    /* "qnet.pyx":2051
 *     d_last = ievts[0].a
 *     delta = Z / (1+nh)
 *     for i in range(len(ievts)):             # <<<<<<<<<<<<<<
 *         evt = ievts[i]
 *         if not evt.obs_d:
 */
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

  /* "qnet.pyx":2063
 *             d_last = evt.d
 *     # finally reset service
 *     q0 = net.queues[0]             # <<<<<<<<<<<<<<
 *     for e in ievts:
 *         q0.recompute_service (e)
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_queues); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_12 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(__pyx_t_12 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2063; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_q0 = __pyx_t_12;
  __pyx_t_12 = 0;

  /* "qnet.pyx":2064
 *     # finally reset service
 *     q0 = net.queues[0]
 *     for e in ievts:             # <<<<<<<<<<<<<<
 *         q0.recompute_service (e)
 * #    print "STEP1 ", result
 */
  if (likely(PyList_CheckExact(__pyx_v_ievts)) || PyTuple_CheckExact(__pyx_v_ievts)) {
    __pyx_t_12 = __pyx_v_ievts; __Pyx_INCREF(__pyx_t_12); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_12 = PyObject_GetIter(__pyx_v_ievts); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_6 = Py_TYPE(__pyx_t_12)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_12))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_12)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_12, __pyx_t_5); __Pyx_INCREF(__pyx_t_8); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_12, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_12)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_12, __pyx_t_5); __Pyx_INCREF(__pyx_t_8); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_12, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_6(__pyx_t_12);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2064; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_e, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "qnet.pyx":2065
 *     q0 = net.queues[0]
 *     for e in ievts:
 *         q0.recompute_service (e)             # <<<<<<<<<<<<<<
 * #    print "STEP1 ", result
 * #    result.validate()
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_q0, __pyx_n_s_recompute_service); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_11 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_11) {
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_9, ((PyObject *)__pyx_v_e)); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
    } else {
      __pyx_t_2 = PyTuple_New(1+1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_e));
      PyTuple_SET_ITEM(__pyx_t_2, 0+1, ((PyObject *)__pyx_v_e));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e));
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_2, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2065; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "qnet.pyx":2064
 *     # finally reset service
 *     q0 = net.queues[0]
 *     for e in ievts:             # <<<<<<<<<<<<<<
 *         q0.recompute_service (e)
 * #    print "STEP1 ", result
 */
  }
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

  /* "qnet.pyx":2070
 * 
 *     # sample extensions of tasks
 *     heap = []             # <<<<<<<<<<<<<<
 *     for evt in ievts:
 *         if not evt.obs_d:
 */
  __pyx_t_12 = PyList_New(0); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2070; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_12);
  __pyx_v_heap = ((PyObject*)__pyx_t_12);
  __pyx_t_12 = 0;

  /* "qnet.pyx":2071
 *     # sample extensions of tasks
 *     heap = []
 *     for evt in ievts:             # <<<<<<<<<<<<<<
 *         if not evt.obs_d:
 *             s_next = net.fsm.sample_state (evt.state)
 */
  if (likely(PyList_CheckExact(__pyx_v_ievts)) || PyTuple_CheckExact(__pyx_v_ievts)) {
    __pyx_t_12 = __pyx_v_ievts; __Pyx_INCREF(__pyx_t_12); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_12 = PyObject_GetIter(__pyx_v_ievts); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_6 = Py_TYPE(__pyx_t_12)->tp_iternext; if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_12))) {
        if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_12)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_12, __pyx_t_5); __Pyx_INCREF(__pyx_t_8); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_12, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      } else {
        if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_12)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_12, __pyx_t_5); __Pyx_INCREF(__pyx_t_8); __pyx_t_5++; if (unlikely(0 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_12, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_6(__pyx_t_12);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "qnet.pyx":2072
 *     heap = []
 *     for evt in ievts:
 *         if not evt.obs_d:             # <<<<<<<<<<<<<<
 *             s_next = net.fsm.sample_state (evt.state)
 *             if s_next: heappush (heap, (evt.d, evt.tid, s_next, SEC_ARRIVAL, None))
 */
    __pyx_t_7 = ((!(__pyx_v_evt->obs_d != 0)) != 0);
    if (__pyx_t_7) {

      /* "qnet.pyx":2073
 *     for evt in ievts:
 *         if not evt.obs_d:
 *             s_next = net.fsm.sample_state (evt.state)             # <<<<<<<<<<<<<<
 *             if s_next: heappush (heap, (evt.d, evt.tid, s_next, SEC_ARRIVAL, None))
 *     net._sample_discrete_events (heap, result, False)
 */
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_fsm); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_sample_state); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_evt->state); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_11 = NULL;
      if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_8);
      } else {
        __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_t_9);
        __Pyx_GIVEREF(__pyx_t_9);
        __pyx_t_9 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2073; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_s_next, __pyx_t_8);
      __pyx_t_8 = 0;

      /* "qnet.pyx":2074
 *         if not evt.obs_d:
 *             s_next = net.fsm.sample_state (evt.state)
 *             if s_next: heappush (heap, (evt.d, evt.tid, s_next, SEC_ARRIVAL, None))             # <<<<<<<<<<<<<<
 *     net._sample_discrete_events (heap, result, False)
 * 
 */
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_s_next); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (__pyx_t_7) {
        __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_heappush); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_e_4qnet_SEC_ARRIVAL); if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_10 = PyTuple_New(5); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_9);
        __Pyx_GIVEREF(__pyx_t_9);
        __Pyx_INCREF(__pyx_v_s_next);
        PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_s_next);
        __Pyx_GIVEREF(__pyx_v_s_next);
        PyTuple_SET_ITEM(__pyx_t_10, 3, __pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_11);
        __Pyx_INCREF(Py_None);
        PyTuple_SET_ITEM(__pyx_t_10, 4, Py_None);
        __Pyx_GIVEREF(Py_None);
        __pyx_t_3 = 0;
        __pyx_t_9 = 0;
        __pyx_t_11 = 0;
        __pyx_t_11 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_11)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_11);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
            __pyx_t_15 = 1;
          }
        }
        __pyx_t_9 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        if (__pyx_t_11) {
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_11); __Pyx_GIVEREF(__pyx_t_11); __pyx_t_11 = NULL;
        }
        __Pyx_INCREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_15, __pyx_v_heap);
        __Pyx_GIVEREF(__pyx_v_heap);
        PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_15, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2074; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L18;
      }
      __pyx_L18:;
      goto __pyx_L17;
    }
    __pyx_L17:;

    /* "qnet.pyx":2071
 *     # sample extensions of tasks
 *     heap = []
 *     for evt in ievts:             # <<<<<<<<<<<<<<
 *         if not evt.obs_d:
 *             s_next = net.fsm.sample_state (evt.state)
 */
  }
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

  /* "qnet.pyx":2075
 *             s_next = net.fsm.sample_state (evt.state)
 *             if s_next: heappush (heap, (evt.d, evt.tid, s_next, SEC_ARRIVAL, None))
 *     net._sample_discrete_events (heap, result, False)             # <<<<<<<<<<<<<<
 * 
 * #    print "STEP2 ", result
 */
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_net, __pyx_n_s_sample_discrete_events); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_5 = 1;
    }
  }
  __pyx_t_9 = PyTuple_New(3+__pyx_t_5); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (__pyx_t_2) {
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_2); __Pyx_GIVEREF(__pyx_t_2); __pyx_t_2 = NULL;
  }
  __Pyx_INCREF(__pyx_v_heap);
  PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_5, __pyx_v_heap);
  __Pyx_GIVEREF(__pyx_v_heap);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_5, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __Pyx_INCREF(Py_False);
  PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_5, Py_False);
  __Pyx_GIVEREF(Py_False);
  __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, NULL); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2075; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;

  /* "qnet.pyx":2081
 * 
 *     # add observed last so above processing doesn't screw with their departure times
 *     init_insert_observed_tasks (arrv, result, add_initial=False)             # <<<<<<<<<<<<<<
 *     result.recompute_all_service ()
 * 
 */
  __pyx_t_12 = __Pyx_GetModuleGlobalName(__pyx_n_s_init_insert_observed_tasks); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_12);
  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_INCREF(__pyx_v_arrv);
  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_arrv);
  __Pyx_GIVEREF(__pyx_v_arrv);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  PyTuple_SET_ITEM(__pyx_t_8, 1, ((PyObject *)__pyx_v_result));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_result));
  __pyx_t_9 = PyDict_New(); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_add_initial, Py_False) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2081; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":2082
 *     # add observed last so above processing doesn't screw with their departure times
 *     init_insert_observed_tasks (arrv, result, add_initial=False)
 *     result.recompute_all_service ()             # <<<<<<<<<<<<<<
 * 
 * #    print "STEP3 ", result
 */
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_result), __pyx_n_s_recompute_all_service); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_8 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
    }
  }
  if (__pyx_t_8) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2082; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "qnet.pyx":2087
 * #    result.validate()
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * ## scrap
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_result));
  __pyx_r = ((PyObject *)__pyx_v_result);
  goto __pyx_L0;

  /* "qnet.pyx":2001
 * 
 * 
 * def gibbs_initialize_for_ps (net, arrv):             # <<<<<<<<<<<<<<
 *     cdef Event e, evt, dup
 *     cdef Queue q
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("qnet.gibbs_initialize_for_ps", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_e);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_dup);
  __Pyx_XDECREF((PyObject *)__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_ievts);
  __Pyx_XDECREF(__pyx_v_next_obs);
  __Pyx_XDECREF(__pyx_v_n_hidden);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_Z);
  __Pyx_XDECREF(__pyx_v_nh);
  __Pyx_XDECREF(__pyx_v_d_max);
  __Pyx_XDECREF(__pyx_v_rate);
  __Pyx_XDECREF(__pyx_v_delta);
  __Pyx_XDECREF(__pyx_v_q0);
  __Pyx_XDECREF(__pyx_v_heap);
  __Pyx_XDECREF(__pyx_v_s_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":2156
 * #     return result
 * 
 * def null_initializer (net, arrv): return arrv             # <<<<<<<<<<<<<<
 * 
 * #cas?? initializer = gibbs_initialize_via_order
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_79null_initializer(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_79null_initializer = {"null_initializer", (PyCFunction)__pyx_pw_4qnet_79null_initializer, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4qnet_79null_initializer(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_net = 0;
  PyObject *__pyx_v_arrv = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("null_initializer (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_arrv,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("null_initializer", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "null_initializer") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_net = values[0];
    __pyx_v_arrv = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("null_initializer", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.null_initializer", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4qnet_78null_initializer(__pyx_self, __pyx_v_net, __pyx_v_arrv);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_78null_initializer(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_net, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("null_initializer", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_arrv);
  __pyx_r = __pyx_v_arrv;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":2162
 * 
 * 
 * def get_departure(evt): return evt.d             # <<<<<<<<<<<<<<
 * def get_arrival(evt): return evt.a
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_81get_departure(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_81get_departure = {"get_departure", (PyCFunction)__pyx_pw_4qnet_81get_departure, METH_O, 0};
static PyObject *__pyx_pw_4qnet_81get_departure(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_departure (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_80get_departure(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_80get_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_departure", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.get_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":2163
 * 
 * def get_departure(evt): return evt.d
 * def get_arrival(evt): return evt.a             # <<<<<<<<<<<<<<
 * 
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_83get_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_4qnet_83get_arrival = {"get_arrival", (PyCFunction)__pyx_pw_4qnet_83get_arrival, METH_O, 0};
static PyObject *__pyx_pw_4qnet_83get_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_arrival (wrapper)", 0);
  __pyx_r = __pyx_pf_4qnet_82get_arrival(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_82get_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("get_arrival", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("qnet.get_arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "qnet.pyx":2166
 * 
 * 
 * cpdef double apply_departure (Arrivals arrv, Event evt, double d, double lik) except *:             # <<<<<<<<<<<<<<
 *     cdef Event evt_next
 * 
 */

static PyObject *__pyx_pw_4qnet_85apply_departure(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static double __pyx_f_4qnet_apply_departure(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_d, double __pyx_v_lik, CYTHON_UNUSED int __pyx_skip_dispatch) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_next = 0;
  PyObject *__pyx_v_dl0 = NULL;
  double __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  double __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("apply_departure", 0);

  /* "qnet.pyx":2169
 *     cdef Event evt_next
 * 
 *     dl0 = evt.q.diffListForDeparture (evt, d)             # <<<<<<<<<<<<<<
 * 
 *     evt_next = evt.next_by_task()
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt->q->__pyx_vtab)->diffListForDeparture(__pyx_v_evt->q, __pyx_v_evt, __pyx_v_d); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_dl0 = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "qnet.pyx":2171
 *     dl0 = evt.q.diffListForDeparture (evt, d)
 * 
 *     evt_next = evt.next_by_task()             # <<<<<<<<<<<<<<
 *     if evt_next:
 *         dl0.extend (evt_next.q.diffListForArrival(evt_next, d))
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_next_by_task); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_evt_next = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "qnet.pyx":2172
 * 
 *     evt_next = evt.next_by_task()
 *     if evt_next:             # <<<<<<<<<<<<<<
 *         dl0.extend (evt_next.q.diffListForArrival(evt_next, d))
 * 
 */
  __pyx_t_4 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_next)); if (unlikely(__pyx_t_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_t_4) {

    /* "qnet.pyx":2173
 *     evt_next = evt.next_by_task()
 *     if evt_next:
 *         dl0.extend (evt_next.q.diffListForArrival(evt_next, d))             # <<<<<<<<<<<<<<
 * 
 *     if DEBUG:
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_dl0, __pyx_n_s_extend); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt_next->q->__pyx_vtab)->diffListForArrival(__pyx_v_evt_next->q, __pyx_v_evt_next, __pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = NULL;
    if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __Pyx_GIVEREF(__pyx_t_5); __pyx_t_5 = NULL;
      PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;

  /* "qnet.pyx":2175
 *         dl0.extend (evt_next.q.diffListForArrival(evt_next, d))
 * 
 *     if DEBUG:             # <<<<<<<<<<<<<<
 *         print "diff_list was\n", display_diff_list (arrv, evt, dl0)
 * 
 */
  if (__pyx_e_4qnet_DEBUG) {

    /* "qnet.pyx":2176
 * 
 *     if DEBUG:
 *         print "diff_list was\n", display_diff_list (arrv, evt, dl0)             # <<<<<<<<<<<<<<
 * 
 *     return arrv.applyDiffList (dl0, lik)
 */
    __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_display_diff_list); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    __pyx_t_3 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_6) {
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_arrv));
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, ((PyObject *)__pyx_v_arrv));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_arrv));
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, ((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_INCREF(__pyx_v_dl0);
    PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_7, __pyx_v_dl0);
    __Pyx_GIVEREF(__pyx_v_dl0);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_s_diff_list_was);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_s_diff_list_was);
    __Pyx_GIVEREF(__pyx_kp_s_diff_list_was);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    if (__Pyx_Print(0, __pyx_t_2, 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L4;
  }
  __pyx_L4:;

  /* "qnet.pyx":2178
 *         print "diff_list was\n", display_diff_list (arrv, evt, dl0)
 * 
 *     return arrv.applyDiffList (dl0, lik)             # <<<<<<<<<<<<<<
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_applyDiffList); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_lik); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_COMPILING_IN_CPYTHON && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_7 = 1;
    }
  }
  __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (__pyx_t_6) {
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __Pyx_GIVEREF(__pyx_t_6); __pyx_t_6 = NULL;
  }
  __Pyx_INCREF(__pyx_v_dl0);
  PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_v_dl0);
  __Pyx_GIVEREF(__pyx_v_dl0);
  PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_8 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_8 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_8;
  goto __pyx_L0;

  /* "qnet.pyx":2166
 * 
 * 
 * cpdef double apply_departure (Arrivals arrv, Event evt, double d, double lik) except *:             # <<<<<<<<<<<<<<
 *     cdef Event evt_next
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("qnet.apply_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_next);
  __Pyx_XDECREF(__pyx_v_dl0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_4qnet_85apply_departure(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_4qnet_85apply_departure(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_d;
  double __pyx_v_lik;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("apply_departure (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arrv,&__pyx_n_s_evt,&__pyx_n_s_d,&__pyx_n_s_lik,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_arrv)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("apply_departure", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("apply_departure", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_lik)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("apply_departure", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "apply_departure") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_arrv = ((struct __pyx_obj_8arrivals_Arrivals *)values[0]);
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[1]);
    __pyx_v_d = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_d == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_lik = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_lik == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("apply_departure", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("qnet.apply_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_pf_4qnet_84apply_departure(__pyx_self, __pyx_v_arrv, __pyx_v_evt, __pyx_v_d, __pyx_v_lik);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_4qnet_84apply_departure(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_d, double __pyx_v_lik) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("apply_departure", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_4qnet_apply_departure(__pyx_v_arrv, __pyx_v_evt, __pyx_v_d, __pyx_v_lik, 0); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("qnet.apply_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static struct __pyx_vtabstruct_4qnet_Qnet __pyx_vtable_4qnet_Qnet;

static PyObject *__pyx_tp_new_4qnet_Qnet(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_4qnet_Qnet *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_4qnet_Qnet *)o);
  p->__pyx_vtab = __pyx_vtabptr_4qnet_Qnet;
  p->queues = Py_None; Py_INCREF(Py_None);
  p->templates = Py_None; Py_INCREF(Py_None);
  p->fsm = Py_None; Py_INCREF(Py_None);
  p->universe = Py_None; Py_INCREF(Py_None);
  p->qname2id = Py_None; Py_INCREF(Py_None);
  p->sname2id = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4qnet_Qnet(PyObject *o) {
  struct __pyx_obj_4qnet_Qnet *p = (struct __pyx_obj_4qnet_Qnet *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->queues);
  Py_CLEAR(p->templates);
  Py_CLEAR(p->fsm);
  Py_CLEAR(p->universe);
  Py_CLEAR(p->qname2id);
  Py_CLEAR(p->sname2id);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4qnet_Qnet(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4qnet_Qnet *p = (struct __pyx_obj_4qnet_Qnet *)o;
  if (p->queues) {
    e = (*v)(p->queues, a); if (e) return e;
  }
  if (p->templates) {
    e = (*v)(p->templates, a); if (e) return e;
  }
  if (p->fsm) {
    e = (*v)(p->fsm, a); if (e) return e;
  }
  if (p->universe) {
    e = (*v)(p->universe, a); if (e) return e;
  }
  if (p->qname2id) {
    e = (*v)(p->qname2id, a); if (e) return e;
  }
  if (p->sname2id) {
    e = (*v)(p->sname2id, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4qnet_Qnet(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_4qnet_Qnet *p = (struct __pyx_obj_4qnet_Qnet *)o;
  tmp = ((PyObject*)p->queues);
  p->queues = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->templates);
  p->templates = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->fsm);
  p->fsm = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->universe);
  p->universe = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->qname2id);
  p->qname2id = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->sname2id);
  p->sname2id = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_4qnet_4Qnet_parameters(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_10parameters_1__get__(o);
}

static int __pyx_setprop_4qnet_4Qnet_parameters(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_4qnet_4Qnet_10parameters_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_4qnet_4Qnet_queues(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_6queues_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_templates(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_9templates_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_fsm(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_3fsm_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_universe(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_8universe_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_qname2id(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_8qname2id_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_sname2id(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_8sname2id_1__get__(o);
}

static PyObject *__pyx_getprop_4qnet_4Qnet_eidx(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_4qnet_4Qnet_4eidx_1__get__(o);
}

static PyMethodDef __pyx_methods_4qnet_Qnet[] = {
  {"as_yaml", (PyCFunction)__pyx_pw_4qnet_4Qnet_3as_yaml, METH_NOARGS, 0},
  {"as_xml", (PyCFunction)__pyx_pw_4qnet_4Qnet_5as_xml, METH_NOARGS, 0},
  {"sample", (PyCFunction)__pyx_pw_4qnet_4Qnet_7sample, METH_O, __pyx_doc_4qnet_4Qnet_6sample},
  {"sample_by_time", (PyCFunction)__pyx_pw_4qnet_4Qnet_9sample_by_time, METH_O, __pyx_doc_4qnet_4Qnet_8sample_by_time},
  {"_sample_discrete_events", (PyCFunction)__pyx_pw_4qnet_4Qnet_11_sample_discrete_events, METH_VARARGS|METH_KEYWORDS, 0},
  {"num_queues", (PyCFunction)__pyx_pw_4qnet_4Qnet_13num_queues, METH_NOARGS, 0},
  {"num_states", (PyCFunction)__pyx_pw_4qnet_4Qnet_15num_states, METH_NOARGS, 0},
  {"get_fsm", (PyCFunction)__pyx_pw_4qnet_4Qnet_17get_fsm, METH_NOARGS, 0},
  {"sid_by_name", (PyCFunction)__pyx_pw_4qnet_4Qnet_19sid_by_name, METH_O, 0},
  {"sid_to_name", (PyCFunction)__pyx_pw_4qnet_4Qnet_21sid_to_name, METH_O, 0},
  {"queues_of_state", (PyCFunction)__pyx_pw_4qnet_4Qnet_23queues_of_state, METH_O, 0},
  {"qid_of_queue", (PyCFunction)__pyx_pw_4qnet_4Qnet_25qid_of_queue, METH_O, 0},
  {"queue_by_name", (PyCFunction)__pyx_pw_4qnet_4Qnet_27queue_by_name, METH_O, 0},
  {"all_queues", (PyCFunction)__pyx_pw_4qnet_4Qnet_29all_queues, METH_NOARGS, 0},
  {"all_templates", (PyCFunction)__pyx_pw_4qnet_4Qnet_31all_templates, METH_NOARGS, 0},
  {"gibbs_resample", (PyCFunction)__pyx_pw_4qnet_4Qnet_33gibbs_resample, METH_VARARGS|METH_KEYWORDS, 0},
  {"gibbs_for_departure", (PyCFunction)__pyx_pw_4qnet_4Qnet_35gibbs_for_departure, METH_VARARGS|METH_KEYWORDS, 0},
  {"gibbs_initialize", (PyCFunction)__pyx_pw_4qnet_4Qnet_37gibbs_initialize, METH_VARARGS|METH_KEYWORDS, 0},
  {"gibbs_initialize_via_mmk", (PyCFunction)__pyx_pw_4qnet_4Qnet_39gibbs_initialize_via_mmk, METH_O, 0},
  {"markovize", (PyCFunction)__pyx_pw_4qnet_4Qnet_41markovize, METH_NOARGS, 0},
  {"markovize_from_arrivals", (PyCFunction)__pyx_pw_4qnet_4Qnet_43markovize_from_arrivals, METH_O, 0},
  {"demarkovize", (PyCFunction)__pyx_pw_4qnet_4Qnet_45demarkovize, METH_O, 0},
  {"gibbs_initialize_via_rejection", (PyCFunction)__pyx_pw_4qnet_4Qnet_47gibbs_initialize_via_rejection, METH_O, 0},
  {"slice_resample", (PyCFunction)__pyx_pw_4qnet_4Qnet_49slice_resample, METH_VARARGS|METH_KEYWORDS, 0},
  {"gibbs_kernel", (PyCFunction)__pyx_pw_4qnet_4Qnet_51gibbs_kernel, METH_VARARGS|METH_KEYWORDS, 0},
  {"parameter_kernel", (PyCFunction)__pyx_pw_4qnet_4Qnet_53parameter_kernel, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4qnet_4Qnet_52parameter_kernel},
  {"estimate", (PyCFunction)__pyx_pw_4qnet_4Qnet_55estimate, METH_O, __pyx_doc_4qnet_4Qnet_54estimate},
  {"estimate_from_obs", (PyCFunction)__pyx_pw_4qnet_4Qnet_57estimate_from_obs, METH_O, __pyx_doc_4qnet_4Qnet_56estimate_from_obs},
  {"estimate_from_events", (PyCFunction)__pyx_pw_4qnet_4Qnet_59estimate_from_events, METH_O, __pyx_doc_4qnet_4Qnet_58estimate_from_events},
  {"sample_parameters", (PyCFunction)__pyx_pw_4qnet_4Qnet_61sample_parameters, METH_O, __pyx_doc_4qnet_4Qnet_60sample_parameters},
  {"remove_task_proposal", (PyCFunction)__pyx_pw_4qnet_4Qnet_63remove_task_proposal, METH_O, 0},
  {"sample_path", (PyCFunction)__pyx_pw_4qnet_4Qnet_65sample_path, METH_NOARGS, 0},
  {"log_prob", (PyCFunction)__pyx_pw_4qnet_4Qnet_67log_prob, METH_O, 0},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_4qnet_Qnet[] = {
  {(char *)"parameters", __pyx_getprop_4qnet_4Qnet_parameters, __pyx_setprop_4qnet_4Qnet_parameters, 0, 0},
  {(char *)"queues", __pyx_getprop_4qnet_4Qnet_queues, 0, 0, 0},
  {(char *)"templates", __pyx_getprop_4qnet_4Qnet_templates, 0, 0, 0},
  {(char *)"fsm", __pyx_getprop_4qnet_4Qnet_fsm, 0, 0, 0},
  {(char *)"universe", __pyx_getprop_4qnet_4Qnet_universe, 0, 0, 0},
  {(char *)"qname2id", __pyx_getprop_4qnet_4Qnet_qname2id, 0, 0, 0},
  {(char *)"sname2id", __pyx_getprop_4qnet_4Qnet_sname2id, 0, 0, 0},
  {(char *)"eidx", __pyx_getprop_4qnet_4Qnet_eidx, 0, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyTypeObject __pyx_type_4qnet_Qnet = {
  PyVarObject_HEAD_INIT(0, 0)
  "qnet.Qnet", /*tp_name*/
  sizeof(struct __pyx_obj_4qnet_Qnet), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4qnet_Qnet, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_4qnet_Qnet, /*tp_traverse*/
  __pyx_tp_clear_4qnet_Qnet, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4qnet_Qnet, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_4qnet_Qnet, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_4qnet_4Qnet_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4qnet_Qnet, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_4qnet_GGkGibbs(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_4qnet_GGkGibbs *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_4qnet_GGkGibbs *)o);
  p->evt = ((struct __pyx_obj_8arrivals_Event *)Py_None); Py_INCREF(Py_None);
  p->evt_next = ((struct __pyx_obj_8arrivals_Event *)Py_None); Py_INCREF(Py_None);
  p->arrv = ((struct __pyx_obj_8arrivals_Arrivals *)Py_None); Py_INCREF(Py_None);
  p->net = ((struct __pyx_obj_4qnet_Qnet *)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_4qnet_GGkGibbs(PyObject *o) {
  struct __pyx_obj_4qnet_GGkGibbs *p = (struct __pyx_obj_4qnet_GGkGibbs *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->evt);
  Py_CLEAR(p->evt_next);
  Py_CLEAR(p->arrv);
  Py_CLEAR(p->net);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_4qnet_GGkGibbs(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_4qnet_GGkGibbs *p = (struct __pyx_obj_4qnet_GGkGibbs *)o;
  if (p->evt) {
    e = (*v)(((PyObject*)p->evt), a); if (e) return e;
  }
  if (p->evt_next) {
    e = (*v)(((PyObject*)p->evt_next), a); if (e) return e;
  }
  if (p->arrv) {
    e = (*v)(((PyObject*)p->arrv), a); if (e) return e;
  }
  if (p->net) {
    e = (*v)(((PyObject*)p->net), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_4qnet_GGkGibbs(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_4qnet_GGkGibbs *p = (struct __pyx_obj_4qnet_GGkGibbs *)o;
  tmp = ((PyObject*)p->evt);
  p->evt = ((struct __pyx_obj_8arrivals_Event *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->evt_next);
  p->evt_next = ((struct __pyx_obj_8arrivals_Event *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->arrv);
  p->arrv = ((struct __pyx_obj_8arrivals_Arrivals *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->net);
  p->net = ((struct __pyx_obj_4qnet_Qnet *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_4qnet_GGkGibbs[] = {
  {"inner_dfun", (PyCFunction)__pyx_pw_4qnet_8GGkGibbs_3inner_dfun, METH_O, 0},
  {"dfn", (PyCFunction)__pyx_pw_4qnet_8GGkGibbs_5dfn, METH_NOARGS, 0},
  {"integrate", (PyCFunction)__pyx_pw_4qnet_8GGkGibbs_7integrate, METH_VARARGS|METH_KEYWORDS, 0},
  {"add_points", (PyCFunction)__pyx_pw_4qnet_8GGkGibbs_9add_points, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_4qnet_GGkGibbs = {
  PyVarObject_HEAD_INIT(0, 0)
  "qnet.GGkGibbs", /*tp_name*/
  sizeof(struct __pyx_obj_4qnet_GGkGibbs), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_4qnet_GGkGibbs, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #else
  0, /*reserved*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_4qnet_GGkGibbs, /*tp_traverse*/
  __pyx_tp_clear_4qnet_GGkGibbs, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_4qnet_GGkGibbs, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_4qnet_8GGkGibbs_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_4qnet_GGkGibbs, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {"apply_departure", (PyCFunction)__pyx_pw_4qnet_85apply_departure, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
  #if PY_VERSION_HEX < 0x03020000
    { PyObject_HEAD_INIT(NULL) NULL, 0, NULL },
  #else
    PyModuleDef_HEAD_INIT,
  #endif
    "qnet",
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_s_, __pyx_k_, sizeof(__pyx_k_), 0, 0, 1, 0},
  {&__pyx_kp_s_10f, __pyx_k_10f, sizeof(__pyx_k_10f), 0, 0, 1, 0},
  {&__pyx_kp_s_75s_s_75s_s_75s_s, __pyx_k_75s_s_75s_s_75s_s, sizeof(__pyx_k_75s_s_75s_s_75s_s), 0, 0, 1, 0},
  {&__pyx_n_s_ARRV_BY_A, __pyx_k_ARRV_BY_A, sizeof(__pyx_k_ARRV_BY_A), 0, 0, 1, 1},
  {&__pyx_n_s_ARRV_BY_D, __pyx_k_ARRV_BY_D, sizeof(__pyx_k_ARRV_BY_D), 0, 0, 1, 1},
  {&__pyx_n_s_ARS_PWFUN, __pyx_k_ARS_PWFUN, sizeof(__pyx_k_ARS_PWFUN), 0, 0, 1, 1},
  {&__pyx_kp_s_Adding_initial_event, __pyx_k_Adding_initial_event, sizeof(__pyx_k_Adding_initial_event), 0, 0, 1, 0},
  {&__pyx_kp_s_Adding_observed_event, __pyx_k_Adding_observed_event, sizeof(__pyx_k_Adding_observed_event), 0, 0, 1, 0},
  {&__pyx_kp_s_Adding_observed_events, __pyx_k_Adding_observed_events, sizeof(__pyx_k_Adding_observed_events), 0, 0, 1, 0},
  {&__pyx_kp_s_Adding_unobserved_events, __pyx_k_Adding_unobserved_events, sizeof(__pyx_k_Adding_unobserved_events), 0, 0, 1, 0},
  {&__pyx_kp_s_After_update_lik_is_infinity, __pyx_k_After_update_lik_is_infinity, sizeof(__pyx_k_After_update_lik_is_infinity), 0, 0, 1, 0},
  {&__pyx_kp_s_Bad_event, __pyx_k_Bad_event, sizeof(__pyx_k_Bad_event), 0, 0, 1, 0},
  {&__pyx_kp_s_Before_update_lik_is_infinity, __pyx_k_Before_update_lik_is_infinity, sizeof(__pyx_k_Before_update_lik_is_infinity), 0, 0, 1, 0},
  {&__pyx_n_s_C, __pyx_k_C, sizeof(__pyx_k_C), 0, 0, 1, 1},
  {&__pyx_kp_s_Can_t_find_s_in_net_s, __pyx_k_Can_t_find_s_in_net_s, sizeof(__pyx_k_Can_t_find_s_in_net_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Can_t_find_valid_initialization, __pyx_k_Can_t_find_valid_initialization, sizeof(__pyx_k_Can_t_find_valid_initialization), 0, 0, 1, 0},
  {&__pyx_kp_s_Cannot_understand_type_s, __pyx_k_Cannot_understand_type_s, sizeof(__pyx_k_Cannot_understand_type_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Could_not_initialize_s, __pyx_k_Could_not_initialize_s, sizeof(__pyx_k_Could_not_initialize_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Could_not_understand_event_type, __pyx_k_Could_not_understand_event_type, sizeof(__pyx_k_Could_not_understand_event_type), 0, 0, 1, 0},
  {&__pyx_kp_s_Could_not_understand_one_d_sampl, __pyx_k_Could_not_understand_one_d_sampl, sizeof(__pyx_k_Could_not_understand_one_d_sampl), 0, 0, 1, 0},
  {&__pyx_n_s_DFN1, __pyx_k_DFN1, sizeof(__pyx_k_DFN1), 0, 0, 1, 1},
  {&__pyx_n_s_DFN2, __pyx_k_DFN2, sizeof(__pyx_k_DFN2), 0, 0, 1, 1},
  {&__pyx_kp_s_DIFF_LIST, __pyx_k_DIFF_LIST, sizeof(__pyx_k_DIFF_LIST), 0, 0, 1, 0},
  {&__pyx_kp_s_D_NEW, __pyx_k_D_NEW, sizeof(__pyx_k_D_NEW), 0, 0, 1, 0},
  {&__pyx_kp_s_Deleting_task_s_s, __pyx_k_Deleting_task_s_s, sizeof(__pyx_k_Deleting_task_s_s), 0, 0, 1, 0},
  {&__pyx_n_s_DistributionTemplate, __pyx_k_DistributionTemplate, sizeof(__pyx_k_DistributionTemplate), 0, 0, 1, 1},
  {&__pyx_kp_s_EID_d, __pyx_k_EID_d, sizeof(__pyx_k_EID_d), 0, 0, 1, 0},
  {&__pyx_kp_s_EID_d_s, __pyx_k_EID_d_s, sizeof(__pyx_k_EID_d_s), 0, 0, 1, 0},
  {&__pyx_kp_s_ERROR_sample_by_time_works_only, __pyx_k_ERROR_sample_by_time_works_only, sizeof(__pyx_k_ERROR_sample_by_time_works_only), 0, 0, 1, 0},
  {&__pyx_kp_s_Error_resampling_event_s, __pyx_k_Error_resampling_event_s, sizeof(__pyx_k_Error_resampling_event_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_d_done, __pyx_k_Event_d_done, sizeof(__pyx_k_Event_d_done), 0, 0, 1, 0},
  {&__pyx_n_s_Exception, __pyx_k_Exception, sizeof(__pyx_k_Exception), 0, 0, 1, 1},
  {&__pyx_n_s_Exponential, __pyx_k_Exponential, sizeof(__pyx_k_Exponential), 0, 0, 1, 1},
  {&__pyx_kp_s_Final_d_fn, __pyx_k_Final_d_fn, sizeof(__pyx_k_Final_d_fn), 0, 0, 1, 0},
  {&__pyx_kp_s_GG1R_initialization_done_Mean_se, __pyx_k_GG1R_initialization_done_Mean_se, sizeof(__pyx_k_GG1R_initialization_done_Mean_se), 0, 0, 1, 0},
  {&__pyx_kp_s_Gibbs_initialization_Num_backtra, __pyx_k_Gibbs_initialization_Num_backtra, sizeof(__pyx_k_Gibbs_initialization_Num_backtra), 0, 0, 1, 0},
  {&__pyx_kp_s_Huh, __pyx_k_Huh, sizeof(__pyx_k_Huh), 0, 0, 1, 0},
  {&__pyx_kp_s_Huh_Unknown_queue_order_d, __pyx_k_Huh_Unknown_queue_order_d, sizeof(__pyx_k_Huh_Unknown_queue_order_d), 0, 0, 1, 0},
  {&__pyx_kp_s_Huh_Z_0_Lik, __pyx_k_Huh_Z_0_Lik, sizeof(__pyx_k_Huh_Z_0_Lik), 0, 0, 1, 0},
  {&__pyx_kp_s_Huh_s, __pyx_k_Huh_s, sizeof(__pyx_k_Huh_s), 0, 0, 1, 0},
  {&__pyx_n_s_INITIAL_QID, __pyx_k_INITIAL_QID, sizeof(__pyx_k_INITIAL_QID), 0, 0, 1, 1},
  {&__pyx_n_s_INITIAL_STATE, __pyx_k_INITIAL_STATE, sizeof(__pyx_k_INITIAL_STATE), 0, 0, 1, 1},
  {&__pyx_kp_s_INIT_s, __pyx_k_INIT_s, sizeof(__pyx_k_INIT_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Initial_log_prob, __pyx_k_Initial_log_prob, sizeof(__pyx_k_Initial_log_prob), 0, 0, 1, 0},
  {&__pyx_kp_s_Initialization_at_s_failed_s, __pyx_k_Initialization_at_s_failed_s, sizeof(__pyx_k_Initialization_at_s_failed_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Initialization_done_Service, __pyx_k_Initialization_done_Service, sizeof(__pyx_k_Initialization_done_Service), 0, 0, 1, 0},
  {&__pyx_n_s_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 0, 0, 1, 1},
  {&__pyx_n_s_L, __pyx_k_L, sizeof(__pyx_k_L), 0, 0, 1, 1},
  {&__pyx_n_s_LP, __pyx_k_LP, sizeof(__pyx_k_LP), 0, 0, 1, 1},
  {&__pyx_kp_s_Log_prob_from_scratch, __pyx_k_Log_prob_from_scratch, sizeof(__pyx_k_Log_prob_from_scratch), 0, 0, 1, 0},
  {&__pyx_n_s_MINILP, __pyx_k_MINILP, sizeof(__pyx_k_MINILP), 0, 0, 1, 1},
  {&__pyx_n_s_N, __pyx_k_N, sizeof(__pyx_k_N), 0, 0, 1, 1},
  {&__pyx_n_s_NONE, __pyx_k_NONE, sizeof(__pyx_k_NONE), 0, 0, 1, 1},
  {&__pyx_n_s_NUM_INTEGRATION_POINTS, __pyx_k_NUM_INTEGRATION_POINTS, sizeof(__pyx_k_NUM_INTEGRATION_POINTS), 0, 0, 1, 1},
  {&__pyx_n_s_NUM_TRIES, __pyx_k_NUM_TRIES, sizeof(__pyx_k_NUM_TRIES), 0, 0, 1, 1},
  {&__pyx_kp_s_New_QNET_initializer, __pyx_k_New_QNET_initializer, sizeof(__pyx_k_New_QNET_initializer), 0, 0, 1, 0},
  {&__pyx_kp_s_New_task, __pyx_k_New_task, sizeof(__pyx_k_New_task), 0, 0, 1, 0},
  {&__pyx_kp_s_No_state_with_id_s, __pyx_k_No_state_with_id_s, sizeof(__pyx_k_No_state_with_id_s), 0, 0, 1, 0},
  {&__pyx_n_s_NotImplementedError, __pyx_k_NotImplementedError, sizeof(__pyx_k_NotImplementedError), 0, 0, 1, 1},
  {&__pyx_n_s_Ns, __pyx_k_Ns, sizeof(__pyx_k_Ns), 0, 0, 1, 1},
  {&__pyx_kp_s_OLD_s_NEW_s, __pyx_k_OLD_s_NEW_s, sizeof(__pyx_k_OLD_s_NEW_s), 0, 0, 1, 0},
  {&__pyx_n_s_PS, __pyx_k_PS, sizeof(__pyx_k_PS), 0, 0, 1, 1},
  {&__pyx_kp_s_Parameters, __pyx_k_Parameters, sizeof(__pyx_k_Parameters), 0, 0, 1, 0},
  {&__pyx_kp_s_Pre_add_prev_s_evt_s, __pyx_k_Pre_add_prev_s_evt_s, sizeof(__pyx_k_Pre_add_prev_s_evt_s), 0, 0, 1, 0},
  {&__pyx_kp_s_QNET_QUEUES, __pyx_k_QNET_QUEUES, sizeof(__pyx_k_QNET_QUEUES), 0, 0, 1, 0},
  {&__pyx_kp_s_QNET_slice_sorted, __pyx_k_QNET_slice_sorted, sizeof(__pyx_k_QNET_slice_sorted), 0, 0, 1, 0},
  {&__pyx_n_s_QP, __pyx_k_QP, sizeof(__pyx_k_QP), 0, 0, 1, 1},
  {&__pyx_kp_s_QUEUES_QNET, __pyx_k_QUEUES_QNET, sizeof(__pyx_k_QUEUES_QNET), 0, 0, 1, 0},
  {&__pyx_n_s_RTP, __pyx_k_RTP, sizeof(__pyx_k_RTP), 0, 0, 1, 1},
  {&__pyx_kp_s_RTP_Adding_event, __pyx_k_RTP_Adding_event, sizeof(__pyx_k_RTP_Adding_event), 0, 0, 1, 0},
  {&__pyx_kp_s_RTP_Resampling_departure, __pyx_k_RTP_Resampling_departure, sizeof(__pyx_k_RTP_Resampling_departure), 0, 0, 1, 0},
  {&__pyx_kp_s_RUNNING_MINI_LP, __pyx_k_RUNNING_MINI_LP, sizeof(__pyx_k_RUNNING_MINI_LP), 0, 0, 1, 0},
  {&__pyx_kp_s_Ratio, __pyx_k_Ratio, sizeof(__pyx_k_Ratio), 0, 0, 1, 0},
  {&__pyx_n_s_Ratio_2, __pyx_k_Ratio_2, sizeof(__pyx_k_Ratio_2), 0, 0, 1, 1},
  {&__pyx_kp_s_Rejected, __pyx_k_Rejected, sizeof(__pyx_k_Rejected), 0, 0, 1, 0},
  {&__pyx_kp_s_Rejecting_zero_service_on_s, __pyx_k_Rejecting_zero_service_on_s, sizeof(__pyx_k_Rejecting_zero_service_on_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Resampling, __pyx_k_Resampling, sizeof(__pyx_k_Resampling), 0, 0, 1, 0},
  {&__pyx_kp_s_Resampling_final_event_s_s_s, __pyx_k_Resampling_final_event_s_s_s, sizeof(__pyx_k_Resampling_final_event_s_s_s), 0, 0, 1, 0},
  {&__pyx_n_s_SLICE, __pyx_k_SLICE, sizeof(__pyx_k_SLICE), 0, 0, 1, 1},
  {&__pyx_n_s_SLICE_PWFUN, __pyx_k_SLICE_PWFUN, sizeof(__pyx_k_SLICE_PWFUN), 0, 0, 1, 1},
  {&__pyx_n_s_STUPID_REJECT, __pyx_k_STUPID_REJECT, sizeof(__pyx_k_STUPID_REJECT), 0, 0, 1, 1},
  {&__pyx_kp_s_Sampled, __pyx_k_Sampled, sizeof(__pyx_k_Sampled), 0, 0, 1, 0},
  {&__pyx_kp_s_TAU_d, __pyx_k_TAU_d, sizeof(__pyx_k_TAU_d), 0, 0, 1, 0},
  {&__pyx_kp_s_TIDS, __pyx_k_TIDS, sizeof(__pyx_k_TIDS), 0, 0, 1, 0},
  {&__pyx_kp_s_TID_s_SID_s_QID_s, __pyx_k_TID_s_SID_s_QID_s, sizeof(__pyx_k_TID_s_SID_s_QID_s), 0, 0, 1, 0},
  {&__pyx_n_s_U, __pyx_k_U, sizeof(__pyx_k_U), 0, 0, 1, 1},
  {&__pyx_kp_s_Users_csutton_svn_research_code, __pyx_k_Users_csutton_svn_research_code, sizeof(__pyx_k_Users_csutton_svn_research_code), 0, 0, 1, 0},
  {&__pyx_kp_s_Using_strange_initialization, __pyx_k_Using_strange_initialization, sizeof(__pyx_k_Using_strange_initialization), 0, 0, 1, 0},
  {&__pyx_n_s_Z, __pyx_k_Z, sizeof(__pyx_k_Z), 0, 0, 1, 1},
  {&__pyx_kp_s__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 0, 1, 0},
  {&__pyx_kp_s__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 1, 0},
  {&__pyx_kp_s__27, __pyx_k__27, sizeof(__pyx_k__27), 0, 0, 1, 0},
  {&__pyx_kp_s__28, __pyx_k__28, sizeof(__pyx_k__28), 0, 0, 1, 0},
  {&__pyx_kp_s__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 0, 1, 0},
  {&__pyx_kp_s__30, __pyx_k__30, sizeof(__pyx_k__30), 0, 0, 1, 0},
  {&__pyx_kp_s__33, __pyx_k__33, sizeof(__pyx_k__33), 0, 0, 1, 0},
  {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
  {&__pyx_kp_s_a_d, __pyx_k_a_d, sizeof(__pyx_k_a_d), 0, 0, 1, 0},
  {&__pyx_kp_s_a_d_a_d, __pyx_k_a_d_a_d, sizeof(__pyx_k_a_d_a_d), 0, 0, 1, 0},
  {&__pyx_kp_s_a_d_d_d_color_gray60, __pyx_k_a_d_d_d_color_gray60, sizeof(__pyx_k_a_d_d_d_color_gray60), 0, 0, 1, 0},
  {&__pyx_kp_s_a_d_style_filled_color_grey80, __pyx_k_a_d_style_filled_color_grey80, sizeof(__pyx_k_a_d_style_filled_color_grey80), 0, 0, 1, 0},
  {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
  {&__pyx_n_s_add_constraint, __pyx_k_add_constraint, sizeof(__pyx_k_add_constraint), 0, 0, 1, 1},
  {&__pyx_n_s_add_initial, __pyx_k_add_initial, sizeof(__pyx_k_add_initial), 0, 0, 1, 1},
  {&__pyx_n_s_add_initialization_constraints, __pyx_k_add_initialization_constraints, sizeof(__pyx_k_add_initialization_constraints), 0, 0, 1, 1},
  {&__pyx_n_s_add_objsq, __pyx_k_add_objsq, sizeof(__pyx_k_add_objsq), 0, 0, 1, 1},
  {&__pyx_n_s_add_points, __pyx_k_add_points, sizeof(__pyx_k_add_points), 0, 0, 1, 1},
  {&__pyx_n_s_add_var_ge, __pyx_k_add_var_ge, sizeof(__pyx_k_add_var_ge), 0, 0, 1, 1},
  {&__pyx_n_s_add_vars, __pyx_k_add_vars, sizeof(__pyx_k_add_vars), 0, 0, 1, 1},
  {&__pyx_n_s_all_events, __pyx_k_all_events, sizeof(__pyx_k_all_events), 0, 0, 1, 1},
  {&__pyx_n_s_all_tasks, __pyx_k_all_tasks, sizeof(__pyx_k_all_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_any_zero_service, __pyx_k_any_zero_service, sizeof(__pyx_k_any_zero_service), 0, 0, 1, 1},
  {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
  {&__pyx_n_s_applyDiffList, __pyx_k_applyDiffList, sizeof(__pyx_k_applyDiffList), 0, 0, 1, 1},
  {&__pyx_n_s_arms_pwfun, __pyx_k_arms_pwfun, sizeof(__pyx_k_arms_pwfun), 0, 0, 1, 1},
  {&__pyx_n_s_arrivals, __pyx_k_arrivals, sizeof(__pyx_k_arrivals), 0, 0, 1, 1},
  {&__pyx_n_s_arrv, __pyx_k_arrv, sizeof(__pyx_k_arrv), 0, 0, 1, 1},
  {&__pyx_n_s_arrv_from, __pyx_k_arrv_from, sizeof(__pyx_k_arrv_from), 0, 0, 1, 1},
  {&__pyx_n_s_arrv_in, __pyx_k_arrv_in, sizeof(__pyx_k_arrv_in), 0, 0, 1, 1},
  {&__pyx_n_s_arrv_new, __pyx_k_arrv_new, sizeof(__pyx_k_arrv_new), 0, 0, 1, 1},
  {&__pyx_n_s_arrv_to, __pyx_k_arrv_to, sizeof(__pyx_k_arrv_to), 0, 0, 1, 1},
  {&__pyx_n_s_arrvl, __pyx_k_arrvl, sizeof(__pyx_k_arrvl), 0, 0, 1, 1},
  {&__pyx_n_s_arrvls, __pyx_k_arrvls, sizeof(__pyx_k_arrvls), 0, 0, 1, 1},
  {&__pyx_n_s_as_yaml, __pyx_k_as_yaml, sizeof(__pyx_k_as_yaml), 0, 0, 1, 1},
  {&__pyx_n_s_astr, __pyx_k_astr, sizeof(__pyx_k_astr), 0, 0, 1, 1},
  {&__pyx_n_s_aux, __pyx_k_aux, sizeof(__pyx_k_aux), 0, 0, 1, 1},
  {&__pyx_n_s_bisect, __pyx_k_bisect, sizeof(__pyx_k_bisect), 0, 0, 1, 1},
  {&__pyx_n_s_burn, __pyx_k_burn, sizeof(__pyx_k_burn), 0, 0, 1, 1},
  {&__pyx_n_s_byq, __pyx_k_byq, sizeof(__pyx_k_byq), 0, 0, 1, 1},
  {&__pyx_n_s_byt, __pyx_k_byt, sizeof(__pyx_k_byt), 0, 0, 1, 1},
  {&__pyx_n_s_cleanup, __pyx_k_cleanup, sizeof(__pyx_k_cleanup), 0, 0, 1, 1},
  {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
  {&__pyx_n_s_compactify_soln, __pyx_k_compactify_soln, sizeof(__pyx_k_compactify_soln), 0, 0, 1, 1},
  {&__pyx_n_s_compute_mean_ia, __pyx_k_compute_mean_ia, sizeof(__pyx_k_compute_mean_ia), 0, 0, 1, 1},
  {&__pyx_n_s_compute_obs_mean_ia, __pyx_k_compute_obs_mean_ia, sizeof(__pyx_k_compute_obs_mean_ia), 0, 0, 1, 1},
  {&__pyx_n_s_compute_obs_means, __pyx_k_compute_obs_means, sizeof(__pyx_k_compute_obs_means), 0, 0, 1, 1},
  {&__pyx_n_s_compute_task_order, __pyx_k_compute_task_order, sizeof(__pyx_k_compute_task_order), 0, 0, 1, 1},
  {&__pyx_n_s_create_qp, __pyx_k_create_qp, sizeof(__pyx_k_create_qp), 0, 0, 1, 1},
  {&__pyx_n_s_d, __pyx_k_d, sizeof(__pyx_k_d), 0, 0, 1, 1},
  {&__pyx_n_s_d0, __pyx_k_d0, sizeof(__pyx_k_d0), 0, 0, 1, 1},
  {&__pyx_kp_s_d_d, __pyx_k_d_d, sizeof(__pyx_k_d_d), 0, 0, 1, 0},
  {&__pyx_kp_s_d_d_a_d_color_lawngreen, __pyx_k_d_d_a_d_color_lawngreen, sizeof(__pyx_k_d_d_a_d_color_lawngreen), 0, 0, 1, 0},
  {&__pyx_kp_s_d_d_d_d, __pyx_k_d_d_d_d, sizeof(__pyx_k_d_d_d_d), 0, 0, 1, 0},
  {&__pyx_kp_s_d_d_style_filled_color_grey80, __pyx_k_d_d_style_filled_color_grey80, sizeof(__pyx_k_d_d_style_filled_color_grey80), 0, 0, 1, 0},
  {&__pyx_n_s_d_initial, __pyx_k_d_initial, sizeof(__pyx_k_d_initial), 0, 0, 1, 1},
  {&__pyx_n_s_d_last, __pyx_k_d_last, sizeof(__pyx_k_d_last), 0, 0, 1, 1},
  {&__pyx_n_s_d_max, __pyx_k_d_max, sizeof(__pyx_k_d_max), 0, 0, 1, 1},
  {&__pyx_n_s_d_new, __pyx_k_d_new, sizeof(__pyx_k_d_new), 0, 0, 1, 1},
  {&__pyx_n_s_d_old, __pyx_k_d_old, sizeof(__pyx_k_d_old), 0, 0, 1, 1},
  {&__pyx_n_s_d_prev, __pyx_k_d_prev, sizeof(__pyx_k_d_prev), 0, 0, 1, 1},
  {&__pyx_n_s_delete_task, __pyx_k_delete_task, sizeof(__pyx_k_delete_task), 0, 0, 1, 1},
  {&__pyx_n_s_delta, __pyx_k_delta, sizeof(__pyx_k_delta), 0, 0, 1, 1},
  {&__pyx_n_s_demarkovize, __pyx_k_demarkovize, sizeof(__pyx_k_demarkovize), 0, 0, 1, 1},
  {&__pyx_n_s_dfn, __pyx_k_dfn, sizeof(__pyx_k_dfn), 0, 0, 1, 1},
  {&__pyx_n_s_diff_len, __pyx_k_diff_len, sizeof(__pyx_k_diff_len), 0, 0, 1, 1},
  {&__pyx_n_s_diff_list, __pyx_k_diff_list, sizeof(__pyx_k_diff_list), 0, 0, 1, 1},
  {&__pyx_kp_s_diff_list_2, __pyx_k_diff_list_2, sizeof(__pyx_k_diff_list_2), 0, 0, 1, 0},
  {&__pyx_kp_s_diff_list_3, __pyx_k_diff_list_3, sizeof(__pyx_k_diff_list_3), 0, 0, 1, 0},
  {&__pyx_n_s_diff_list_definitely_bad, __pyx_k_diff_list_definitely_bad, sizeof(__pyx_k_diff_list_definitely_bad), 0, 0, 1, 1},
  {&__pyx_kp_s_diff_list_was, __pyx_k_diff_list_was, sizeof(__pyx_k_diff_list_was), 0, 0, 1, 0},
  {&__pyx_kp_s_digraph_G, __pyx_k_digraph_G, sizeof(__pyx_k_digraph_G), 0, 0, 1, 0},
  {&__pyx_n_s_display_diff_list, __pyx_k_display_diff_list, sizeof(__pyx_k_display_diff_list), 0, 0, 1, 1},
  {&__pyx_n_s_distributions, __pyx_k_distributions, sizeof(__pyx_k_distributions), 0, 0, 1, 1},
  {&__pyx_n_s_dists, __pyx_k_dists, sizeof(__pyx_k_dists), 0, 0, 1, 1},
  {&__pyx_n_s_doitp, __pyx_k_doitp, sizeof(__pyx_k_doitp), 0, 0, 1, 1},
  {&__pyx_n_s_dstr, __pyx_k_dstr, sizeof(__pyx_k_dstr), 0, 0, 1, 1},
  {&__pyx_n_s_dump, __pyx_k_dump, sizeof(__pyx_k_dump), 0, 0, 1, 1},
  {&__pyx_n_s_dup, __pyx_k_dup, sizeof(__pyx_k_dup), 0, 0, 1, 1},
  {&__pyx_n_s_duplicate, __pyx_k_duplicate, sizeof(__pyx_k_duplicate), 0, 0, 1, 1},
  {&__pyx_n_s_e, __pyx_k_e, sizeof(__pyx_k_e), 0, 0, 1, 1},
  {&__pyx_n_s_e0, __pyx_k_e0, sizeof(__pyx_k_e0), 0, 0, 1, 1},
  {&__pyx_n_s_eid, __pyx_k_eid, sizeof(__pyx_k_eid), 0, 0, 1, 1},
  {&__pyx_n_s_eid_prev, __pyx_k_eid_prev, sizeof(__pyx_k_eid_prev), 0, 0, 1, 1},
  {&__pyx_n_s_elem, __pyx_k_elem, sizeof(__pyx_k_elem), 0, 0, 1, 1},
  {&__pyx_n_s_end, __pyx_k_end, sizeof(__pyx_k_end), 0, 0, 1, 1},
  {&__pyx_n_s_eps, __pyx_k_eps, sizeof(__pyx_k_eps), 0, 0, 1, 1},
  {&__pyx_n_s_estimate, __pyx_k_estimate, sizeof(__pyx_k_estimate), 0, 0, 1, 1},
  {&__pyx_n_s_estimate_minilp_params, __pyx_k_estimate_minilp_params, sizeof(__pyx_k_estimate_minilp_params), 0, 0, 1, 1},
  {&__pyx_n_s_event, __pyx_k_event, sizeof(__pyx_k_event), 0, 0, 1, 1},
  {&__pyx_n_s_events_of_queue, __pyx_k_events_of_queue, sizeof(__pyx_k_events_of_queue), 0, 0, 1, 1},
  {&__pyx_n_s_events_of_task, __pyx_k_events_of_task, sizeof(__pyx_k_events_of_task), 0, 0, 1, 1},
  {&__pyx_n_s_evt, __pyx_k_evt, sizeof(__pyx_k_evt), 0, 0, 1, 1},
  {&__pyx_n_s_evt0, __pyx_k_evt0, sizeof(__pyx_k_evt0), 0, 0, 1, 1},
  {&__pyx_n_s_evt1, __pyx_k_evt1, sizeof(__pyx_k_evt1), 0, 0, 1, 1},
  {&__pyx_n_s_evt2, __pyx_k_evt2, sizeof(__pyx_k_evt2), 0, 0, 1, 1},
  {&__pyx_n_s_evt_new, __pyx_k_evt_new, sizeof(__pyx_k_evt_new), 0, 0, 1, 1},
  {&__pyx_n_s_evt_old, __pyx_k_evt_old, sizeof(__pyx_k_evt_old), 0, 0, 1, 1},
  {&__pyx_n_s_evt_prev, __pyx_k_evt_prev, sizeof(__pyx_k_evt_prev), 0, 0, 1, 1},
  {&__pyx_n_s_evt_to_test, __pyx_k_evt_to_test, sizeof(__pyx_k_evt_to_test), 0, 0, 1, 1},
  {&__pyx_n_s_evts, __pyx_k_evts, sizeof(__pyx_k_evts), 0, 0, 1, 1},
  {&__pyx_n_s_exp, __pyx_k_exp, sizeof(__pyx_k_exp), 0, 0, 1, 1},
  {&__pyx_n_s_expify, __pyx_k_expify, sizeof(__pyx_k_expify), 0, 0, 1, 1},
  {&__pyx_n_s_extend, __pyx_k_extend, sizeof(__pyx_k_extend), 0, 0, 1, 1},
  {&__pyx_n_s_f, __pyx_k_f, sizeof(__pyx_k_f), 0, 0, 1, 1},
  {&__pyx_n_s_file, __pyx_k_file, sizeof(__pyx_k_file), 0, 0, 1, 1},
  {&__pyx_n_s_final_arrival_by_qid, __pyx_k_final_arrival_by_qid, sizeof(__pyx_k_final_arrival_by_qid), 0, 0, 1, 1},
  {&__pyx_n_s_first_arrival_by_qid, __pyx_k_first_arrival_by_qid, sizeof(__pyx_k_first_arrival_by_qid), 0, 0, 1, 1},
  {&__pyx_n_s_fn, __pyx_k_fn, sizeof(__pyx_k_fn), 0, 0, 1, 1},
  {&__pyx_n_s_found_a_good_one, __pyx_k_found_a_good_one, sizeof(__pyx_k_found_a_good_one), 0, 0, 1, 1},
  {&__pyx_n_s_fsm, __pyx_k_fsm, sizeof(__pyx_k_fsm), 0, 0, 1, 1},
  {&__pyx_n_s_get, __pyx_k_get, sizeof(__pyx_k_get), 0, 0, 1, 1},
  {&__pyx_n_s_get_arrival, __pyx_k_get_arrival, sizeof(__pyx_k_get_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_get_departure, __pyx_k_get_departure, sizeof(__pyx_k_get_departure), 0, 0, 1, 1},
  {&__pyx_n_s_get_initializer, __pyx_k_get_initializer, sizeof(__pyx_k_get_initializer), 0, 0, 1, 1},
  {&__pyx_kp_s_gg1r_initialize, __pyx_k_gg1r_initialize, sizeof(__pyx_k_gg1r_initialize), 0, 0, 1, 0},
  {&__pyx_n_s_gibbs_initialize_for_gg1r, __pyx_k_gibbs_initialize_for_gg1r, sizeof(__pyx_k_gibbs_initialize_for_gg1r), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_for_ps, __pyx_k_gibbs_initialize_for_ps, sizeof(__pyx_k_gibbs_initialize_for_ps), 0, 0, 1, 1},
  {&__pyx_kp_s_gibbs_initialize_mini_params_s, __pyx_k_gibbs_initialize_mini_params_s, sizeof(__pyx_k_gibbs_initialize_mini_params_s), 0, 0, 1, 0},
  {&__pyx_n_s_gibbs_initialize_via_dfn, __pyx_k_gibbs_initialize_via_dfn, sizeof(__pyx_k_gibbs_initialize_via_dfn), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_dfn1, __pyx_k_gibbs_initialize_via_dfn1, sizeof(__pyx_k_gibbs_initialize_via_dfn1), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_dfn2, __pyx_k_gibbs_initialize_via_dfn2, sizeof(__pyx_k_gibbs_initialize_via_dfn2), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_dfn3, __pyx_k_gibbs_initialize_via_dfn3, sizeof(__pyx_k_gibbs_initialize_via_dfn3), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_lp, __pyx_k_gibbs_initialize_via_lp, sizeof(__pyx_k_gibbs_initialize_via_lp), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_minilp, __pyx_k_gibbs_initialize_via_minilp, sizeof(__pyx_k_gibbs_initialize_via_minilp), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_order, __pyx_k_gibbs_initialize_via_order, sizeof(__pyx_k_gibbs_initialize_via_order), 0, 0, 1, 1},
  {&__pyx_n_s_gibbs_initialize_via_rejection, __pyx_k_gibbs_initialize_via_rejection, sizeof(__pyx_k_gibbs_initialize_via_rejection), 0, 0, 1, 1},
  {&__pyx_kp_s_gibbs_kernel_0_Could_not_process, __pyx_k_gibbs_kernel_0_Could_not_process, sizeof(__pyx_k_gibbs_kernel_0_Could_not_process), 0, 0, 1, 0},
  {&__pyx_kp_s_gibbs_kernel_Kernel_0_5f_not_in, __pyx_k_gibbs_kernel_Kernel_0_5f_not_in, sizeof(__pyx_k_gibbs_kernel_Kernel_0_5f_not_in), 0, 0, 1, 0},
  {&__pyx_kp_s_gibbs_kernel_inf_Kernel_0_FROM_s, __pyx_k_gibbs_kernel_inf_Kernel_0_FROM_s, sizeof(__pyx_k_gibbs_kernel_inf_Kernel_0_FROM_s), 0, 0, 1, 0},
  {&__pyx_n_s_gibbs_resample, __pyx_k_gibbs_resample, sizeof(__pyx_k_gibbs_resample), 0, 0, 1, 1},
  {&__pyx_n_s_has_tau, __pyx_k_has_tau, sizeof(__pyx_k_has_tau), 0, 0, 1, 1},
  {&__pyx_n_s_heap, __pyx_k_heap, sizeof(__pyx_k_heap), 0, 0, 1, 1},
  {&__pyx_n_s_heap_from_arrivals, __pyx_k_heap_from_arrivals, sizeof(__pyx_k_heap_from_arrivals), 0, 0, 1, 1},
  {&__pyx_n_s_heappop, __pyx_k_heappop, sizeof(__pyx_k_heappop), 0, 0, 1, 1},
  {&__pyx_n_s_heappush, __pyx_k_heappush, sizeof(__pyx_k_heappush), 0, 0, 1, 1},
  {&__pyx_n_s_heapq, __pyx_k_heapq, sizeof(__pyx_k_heapq), 0, 0, 1, 1},
  {&__pyx_n_s_hmm, __pyx_k_hmm, sizeof(__pyx_k_hmm), 0, 0, 1, 1},
  {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
  {&__pyx_n_s_ievts, __pyx_k_ievts, sizeof(__pyx_k_ievts), 0, 0, 1, 1},
  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
  {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
  {&__pyx_n_s_inf, __pyx_k_inf, sizeof(__pyx_k_inf), 0, 0, 1, 1},
  {&__pyx_n_s_init_add_initial_events, __pyx_k_init_add_initial_events, sizeof(__pyx_k_init_add_initial_events), 0, 0, 1, 1},
  {&__pyx_n_s_init_insert_observed_tasks, __pyx_k_init_insert_observed_tasks, sizeof(__pyx_k_init_insert_observed_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_initial_events, __pyx_k_initial_events, sizeof(__pyx_k_initial_events), 0, 0, 1, 1},
  {&__pyx_n_s_initial_q, __pyx_k_initial_q, sizeof(__pyx_k_initial_q), 0, 0, 1, 1},
  {&__pyx_n_s_initial_state, __pyx_k_initial_state, sizeof(__pyx_k_initial_state), 0, 0, 1, 1},
  {&__pyx_n_s_initialize_auxiliaries, __pyx_k_initialize_auxiliaries, sizeof(__pyx_k_initialize_auxiliaries), 0, 0, 1, 1},
  {&__pyx_kp_s_initialize_by_order_aborting_tas, __pyx_k_initialize_by_order_aborting_tas, sizeof(__pyx_k_initialize_by_order_aborting_tas), 0, 0, 1, 0},
  {&__pyx_n_s_initialize_inserting_implied_tas, __pyx_k_initialize_inserting_implied_tas, sizeof(__pyx_k_initialize_inserting_implied_tas), 0, 0, 1, 1},
  {&__pyx_n_s_inner, __pyx_k_inner, sizeof(__pyx_k_inner), 0, 0, 1, 1},
  {&__pyx_n_s_inner_dfun, __pyx_k_inner_dfun, sizeof(__pyx_k_inner_dfun), 0, 0, 1, 1},
  {&__pyx_n_s_insert, __pyx_k_insert, sizeof(__pyx_k_insert), 0, 0, 1, 1},
  {&__pyx_n_s_insert_implied_tasks, __pyx_k_insert_implied_tasks, sizeof(__pyx_k_insert_implied_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_insort, __pyx_k_insort, sizeof(__pyx_k_insort), 0, 0, 1, 1},
  {&__pyx_n_s_integrate, __pyx_k_integrate, sizeof(__pyx_k_integrate), 0, 0, 1, 1},
  {&__pyx_n_s_integrate_by_points, __pyx_k_integrate_by_points, sizeof(__pyx_k_integrate_by_points), 0, 0, 1, 1},
  {&__pyx_n_s_is_final, __pyx_k_is_final, sizeof(__pyx_k_is_final), 0, 0, 1, 1},
  {&__pyx_n_s_is_markov, __pyx_k_is_markov, sizeof(__pyx_k_is_markov), 0, 0, 1, 1},
  {&__pyx_n_s_is_sampled_by_task, __pyx_k_is_sampled_by_task, sizeof(__pyx_k_is_sampled_by_task), 0, 0, 1, 1},
  {&__pyx_n_s_isinf, __pyx_k_isinf, sizeof(__pyx_k_isinf), 0, 0, 1, 1},
  {&__pyx_n_s_iteritems, __pyx_k_iteritems, sizeof(__pyx_k_iteritems), 0, 0, 1, 1},
  {&__pyx_n_s_j, __pyx_k_j, sizeof(__pyx_k_j), 0, 0, 1, 1},
  {&__pyx_n_s_join, __pyx_k_join, sizeof(__pyx_k_join), 0, 0, 1, 1},
  {&__pyx_n_s_k, __pyx_k_k, sizeof(__pyx_k_k), 0, 0, 1, 1},
  {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
  {&__pyx_n_s_l, __pyx_k_l, sizeof(__pyx_k_l), 0, 0, 1, 1},
  {&__pyx_n_s_last_a, __pyx_k_last_a, sizeof(__pyx_k_last_a), 0, 0, 1, 1},
  {&__pyx_n_s_lik, __pyx_k_lik, sizeof(__pyx_k_lik), 0, 0, 1, 1},
  {&__pyx_n_s_lik0, __pyx_k_lik0, sizeof(__pyx_k_lik0), 0, 0, 1, 1},
  {&__pyx_n_s_likelihoodDelta, __pyx_k_likelihoodDelta, sizeof(__pyx_k_likelihoodDelta), 0, 0, 1, 1},
  {&__pyx_n_s_log_prob, __pyx_k_log_prob, sizeof(__pyx_k_log_prob), 0, 0, 1, 1},
  {&__pyx_n_s_lower, __pyx_k_lower, sizeof(__pyx_k_lower), 0, 0, 1, 1},
  {&__pyx_n_s_lp, __pyx_k_lp, sizeof(__pyx_k_lp), 0, 0, 1, 1},
  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
  {&__pyx_n_s_map, __pyx_k_map, sizeof(__pyx_k_map), 0, 0, 1, 1},
  {&__pyx_n_s_markovize, __pyx_k_markovize, sizeof(__pyx_k_markovize), 0, 0, 1, 1},
  {&__pyx_n_s_markovize_from_arrivals, __pyx_k_markovize_from_arrivals, sizeof(__pyx_k_markovize_from_arrivals), 0, 0, 1, 1},
  {&__pyx_n_s_math, __pyx_k_math, sizeof(__pyx_k_math), 0, 0, 1, 1},
  {&__pyx_n_s_max, __pyx_k_max, sizeof(__pyx_k_max), 0, 0, 1, 1},
  {&__pyx_n_s_max_eidx, __pyx_k_max_eidx, sizeof(__pyx_k_max_eidx), 0, 0, 1, 1},
  {&__pyx_n_s_mean, __pyx_k_mean, sizeof(__pyx_k_mean), 0, 0, 1, 1},
  {&__pyx_n_s_mean_service, __pyx_k_mean_service, sizeof(__pyx_k_mean_service), 0, 0, 1, 1},
  {&__pyx_n_s_mean_task_length, __pyx_k_mean_task_length, sizeof(__pyx_k_mean_task_length), 0, 0, 1, 1},
  {&__pyx_n_s_mean_task_service, __pyx_k_mean_task_service, sizeof(__pyx_k_mean_task_service), 0, 0, 1, 1},
  {&__pyx_kp_s_minilp_mini_params, __pyx_k_minilp_mini_params, sizeof(__pyx_k_minilp_mini_params), 0, 0, 1, 0},
  {&__pyx_kp_s_minimize_cost_0, __pyx_k_minimize_cost_0, sizeof(__pyx_k_minimize_cost_0), 0, 0, 1, 0},
  {&__pyx_kp_s_minimize_cost_sum_i_in_E_slack1, __pyx_k_minimize_cost_sum_i_in_E_slack1, sizeof(__pyx_k_minimize_cost_sum_i_in_E_slack1), 0, 0, 1, 0},
  {&__pyx_n_s_misc, __pyx_k_misc, sizeof(__pyx_k_misc), 0, 0, 1, 1},
  {&__pyx_kp_s_model_dot, __pyx_k_model_dot, sizeof(__pyx_k_model_dot), 0, 0, 1, 0},
  {&__pyx_n_s_mu_s, __pyx_k_mu_s, sizeof(__pyx_k_mu_s), 0, 0, 1, 1},
  {&__pyx_n_s_n, __pyx_k_n, sizeof(__pyx_k_n), 0, 0, 1, 1},
  {&__pyx_n_s_n_hidden, __pyx_k_n_hidden, sizeof(__pyx_k_n_hidden), 0, 0, 1, 1},
  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
  {&__pyx_kp_s_name_s, __pyx_k_name_s, sizeof(__pyx_k_name_s), 0, 0, 1, 0},
  {&__pyx_n_s_ne, __pyx_k_ne, sizeof(__pyx_k_ne), 0, 0, 1, 1},
  {&__pyx_n_s_net, __pyx_k_net, sizeof(__pyx_k_net), 0, 0, 1, 1},
  {&__pyx_n_s_netutils, __pyx_k_netutils, sizeof(__pyx_k_netutils), 0, 0, 1, 1},
  {&__pyx_n_s_nevents, __pyx_k_nevents, sizeof(__pyx_k_nevents), 0, 0, 1, 1},
  {&__pyx_n_s_next_by_task, __pyx_k_next_by_task, sizeof(__pyx_k_next_by_task), 0, 0, 1, 1},
  {&__pyx_n_s_next_obs, __pyx_k_next_obs, sizeof(__pyx_k_next_obs), 0, 0, 1, 1},
  {&__pyx_n_s_nh, __pyx_k_nh, sizeof(__pyx_k_nh), 0, 0, 1, 1},
  {&__pyx_n_s_nreject, __pyx_k_nreject, sizeof(__pyx_k_nreject), 0, 0, 1, 1},
  {&__pyx_n_s_nrtp_calls, __pyx_k_nrtp_calls, sizeof(__pyx_k_nrtp_calls), 0, 0, 1, 1},
  {&__pyx_n_s_nrtp_reject, __pyx_k_nrtp_reject, sizeof(__pyx_k_nrtp_reject), 0, 0, 1, 1},
  {&__pyx_n_s_nt, __pyx_k_nt, sizeof(__pyx_k_nt), 0, 0, 1, 1},
  {&__pyx_n_s_null_initializer, __pyx_k_null_initializer, sizeof(__pyx_k_null_initializer), 0, 0, 1, 1},
  {&__pyx_n_s_numParameters, __pyx_k_numParameters, sizeof(__pyx_k_numParameters), 0, 0, 1, 1},
  {&__pyx_n_s_num_diff, __pyx_k_num_diff, sizeof(__pyx_k_num_diff), 0, 0, 1, 1},
  {&__pyx_n_s_num_iter, __pyx_k_num_iter, sizeof(__pyx_k_num_iter), 0, 0, 1, 1},
  {&__pyx_n_s_num_queues, __pyx_k_num_queues, sizeof(__pyx_k_num_queues), 0, 0, 1, 1},
  {&__pyx_n_s_num_states, __pyx_k_num_states, sizeof(__pyx_k_num_states), 0, 0, 1, 1},
  {&__pyx_n_s_num_tasks, __pyx_k_num_tasks, sizeof(__pyx_k_num_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
  {&__pyx_n_s_obs, __pyx_k_obs, sizeof(__pyx_k_obs), 0, 0, 1, 1},
  {&__pyx_n_s_obs_a, __pyx_k_obs_a, sizeof(__pyx_k_obs_a), 0, 0, 1, 1},
  {&__pyx_n_s_obs_d, __pyx_k_obs_d, sizeof(__pyx_k_obs_d), 0, 0, 1, 1},
  {&__pyx_n_s_old_tmpls, __pyx_k_old_tmpls, sizeof(__pyx_k_old_tmpls), 0, 0, 1, 1},
  {&__pyx_n_s_open, __pyx_k_open, sizeof(__pyx_k_open), 0, 0, 1, 1},
  {&__pyx_n_s_order, __pyx_k_order, sizeof(__pyx_k_order), 0, 0, 1, 1},
  {&__pyx_n_s_parameter_kernel, __pyx_k_parameter_kernel, sizeof(__pyx_k_parameter_kernel), 0, 0, 1, 1},
  {&__pyx_n_s_parameters, __pyx_k_parameters, sizeof(__pyx_k_parameters), 0, 0, 1, 1},
  {&__pyx_n_s_path, __pyx_k_path, sizeof(__pyx_k_path), 0, 0, 1, 1},
  {&__pyx_kp_s_pi0_10f_pi1_10f, __pyx_k_pi0_10f_pi1_10f, sizeof(__pyx_k_pi0_10f_pi1_10f), 0, 0, 1, 0},
  {&__pyx_n_s_points, __pyx_k_points, sizeof(__pyx_k_points), 0, 0, 1, 1},
  {&__pyx_n_s_poisson, __pyx_k_poisson, sizeof(__pyx_k_poisson), 0, 0, 1, 1},
  {&__pyx_n_s_pop, __pyx_k_pop, sizeof(__pyx_k_pop), 0, 0, 1, 1},
  {&__pyx_n_s_possible_observations, __pyx_k_possible_observations, sizeof(__pyx_k_possible_observations), 0, 0, 1, 1},
  {&__pyx_n_s_prev_arrv_old, __pyx_k_prev_arrv_old, sizeof(__pyx_k_prev_arrv_old), 0, 0, 1, 1},
  {&__pyx_n_s_prev_dept_old, __pyx_k_prev_dept_old, sizeof(__pyx_k_prev_dept_old), 0, 0, 1, 1},
  {&__pyx_n_s_previous_arriving, __pyx_k_previous_arriving, sizeof(__pyx_k_previous_arriving), 0, 0, 1, 1},
  {&__pyx_n_s_previous_departing, __pyx_k_previous_departing, sizeof(__pyx_k_previous_departing), 0, 0, 1, 1},
  {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
  {&__pyx_n_s_print_exc, __pyx_k_print_exc, sizeof(__pyx_k_print_exc), 0, 0, 1, 1},
  {&__pyx_n_s_proc, __pyx_k_proc, sizeof(__pyx_k_proc), 0, 0, 1, 1},
  {&__pyx_kp_s_product, __pyx_k_product, sizeof(__pyx_k_product), 0, 0, 1, 0},
  {&__pyx_n_s_pwfun, __pyx_k_pwfun, sizeof(__pyx_k_pwfun), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
  {&__pyx_n_s_q, __pyx_k_q, sizeof(__pyx_k_q), 0, 0, 1, 1},
  {&__pyx_n_s_q0, __pyx_k_q0, sizeof(__pyx_k_q0), 0, 0, 1, 1},
  {&__pyx_n_s_qid, __pyx_k_qid, sizeof(__pyx_k_qid), 0, 0, 1, 1},
  {&__pyx_n_s_qname2id, __pyx_k_qname2id, sizeof(__pyx_k_qname2id), 0, 0, 1, 1},
  {&__pyx_n_s_qnet, __pyx_k_qnet, sizeof(__pyx_k_qnet), 0, 0, 1, 1},
  {&__pyx_n_s_qp, __pyx_k_qp, sizeof(__pyx_k_qp), 0, 0, 1, 1},
  {&__pyx_n_s_qstats, __pyx_k_qstats, sizeof(__pyx_k_qstats), 0, 0, 1, 1},
  {&__pyx_n_s_queue, __pyx_k_queue, sizeof(__pyx_k_queue), 0, 0, 1, 1},
  {&__pyx_n_s_queue_order, __pyx_k_queue_order, sizeof(__pyx_k_queue_order), 0, 0, 1, 1},
  {&__pyx_n_s_queues, __pyx_k_queues, sizeof(__pyx_k_queues), 0, 0, 1, 1},
  {&__pyx_kp_s_queues_2, __pyx_k_queues_2, sizeof(__pyx_k_queues_2), 0, 0, 1, 0},
  {&__pyx_n_s_queues_of_state, __pyx_k_queues_of_state, sizeof(__pyx_k_queues_of_state), 0, 0, 1, 1},
  {&__pyx_kp_s_queues_s, __pyx_k_queues_s, sizeof(__pyx_k_queues_s), 0, 0, 1, 0},
  {&__pyx_n_s_random, __pyx_k_random, sizeof(__pyx_k_random), 0, 0, 1, 1},
  {&__pyx_n_s_random_elt, __pyx_k_random_elt, sizeof(__pyx_k_random_elt), 0, 0, 1, 1},
  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
  {&__pyx_n_s_rate, __pyx_k_rate, sizeof(__pyx_k_rate), 0, 0, 1, 1},
  {&__pyx_n_s_recompute_all_service, __pyx_k_recompute_all_service, sizeof(__pyx_k_recompute_all_service), 0, 0, 1, 1},
  {&__pyx_n_s_recompute_service, __pyx_k_recompute_service, sizeof(__pyx_k_recompute_service), 0, 0, 1, 1},
  {&__pyx_n_s_reg, __pyx_k_reg, sizeof(__pyx_k_reg), 0, 0, 1, 1},
  {&__pyx_n_s_regenerate_all_caches, __pyx_k_regenerate_all_caches, sizeof(__pyx_k_regenerate_all_caches), 0, 0, 1, 1},
  {&__pyx_n_s_rejection, __pyx_k_rejection, sizeof(__pyx_k_rejection), 0, 0, 1, 1},
  {&__pyx_n_s_remove, __pyx_k_remove, sizeof(__pyx_k_remove), 0, 0, 1, 1},
  {&__pyx_n_s_remove_task_proposal, __pyx_k_remove_task_proposal, sizeof(__pyx_k_remove_task_proposal), 0, 0, 1, 1},
  {&__pyx_n_s_report, __pyx_k_report, sizeof(__pyx_k_report), 0, 0, 1, 1},
  {&__pyx_n_s_report_fn, __pyx_k_report_fn, sizeof(__pyx_k_report_fn), 0, 0, 1, 1},
  {&__pyx_n_s_resample_auxiliaries, __pyx_k_resample_auxiliaries, sizeof(__pyx_k_resample_auxiliaries), 0, 0, 1, 1},
  {&__pyx_n_s_reset_stats, __pyx_k_reset_stats, sizeof(__pyx_k_reset_stats), 0, 0, 1, 1},
  {&__pyx_n_s_resort_byq, __pyx_k_resort_byq, sizeof(__pyx_k_resort_byq), 0, 0, 1, 1},
  {&__pyx_n_s_result, __pyx_k_result, sizeof(__pyx_k_result), 0, 0, 1, 1},
  {&__pyx_n_s_return_arrv, __pyx_k_return_arrv, sizeof(__pyx_k_return_arrv), 0, 0, 1, 1},
  {&__pyx_n_s_return_lp, __pyx_k_return_lp, sizeof(__pyx_k_return_lp), 0, 0, 1, 1},
  {&__pyx_n_s_reverse, __pyx_k_reverse, sizeof(__pyx_k_reverse), 0, 0, 1, 1},
  {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
  {&__pyx_kp_s_s_17g, __pyx_k_s_17g, sizeof(__pyx_k_s_17g), 0, 0, 1, 0},
  {&__pyx_kp_s_s_d_u_a_Error_Could_not_find_goo, __pyx_k_s_d_u_a_Error_Could_not_find_goo, sizeof(__pyx_k_s_d_u_a_Error_Could_not_find_goo), 0, 0, 1, 0},
  {&__pyx_n_s_s_initial, __pyx_k_s_initial, sizeof(__pyx_k_s_initial), 0, 0, 1, 1},
  {&__pyx_n_s_s_new, __pyx_k_s_new, sizeof(__pyx_k_s_new), 0, 0, 1, 1},
  {&__pyx_n_s_s_next, __pyx_k_s_next, sizeof(__pyx_k_s_next), 0, 0, 1, 1},
  {&__pyx_kp_s_s_s, __pyx_k_s_s, sizeof(__pyx_k_s_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_a_ini_d_a_d_0, __pyx_k_s_t_a_ini_d_a_d_0, sizeof(__pyx_k_s_t_a_ini_d_a_d_0), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_a_pi_d_a_d_0, __pyx_k_s_t_a_pi_d_a_d_0, sizeof(__pyx_k_s_t_a_pi_d_a_d_0), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_a_pi_d_a_d_d_d, __pyx_k_s_t_a_pi_d_a_d_d_d, sizeof(__pyx_k_s_t_a_pi_d_a_d_d_d), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_a_pi_d_s_s, __pyx_k_s_t_a_pi_d_s_s, sizeof(__pyx_k_s_t_a_pi_d_s_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_a_rho_d_a_d_a_d_s, __pyx_k_s_t_a_rho_d_a_d_a_d_s, sizeof(__pyx_k_s_t_a_rho_d_a_d_a_d_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_allr_i_in_E_d_i_a_i_r_i, __pyx_k_s_t_allr_i_in_E_d_i_a_i_r_i, sizeof(__pyx_k_s_t_allr_i_in_E_d_i_a_i_r_i), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_aobs__d_a_d_17g, __pyx_k_s_t_aobs__d_a_d_17g, sizeof(__pyx_k_s_t_aobs__d_a_d_17g), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_d_ge_a_d_d_d_a_d_s, __pyx_k_s_t_d_ge_a_d_d_d_a_d_s, sizeof(__pyx_k_s_t_d_ge_a_d_d_d_a_d_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_d_ge_a_d_s_s_s, __pyx_k_s_t_d_ge_a_d_s_s_s, sizeof(__pyx_k_s_t_d_ge_a_d_s_s_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_d_ge_a_d_s_s_s_2, __pyx_k_s_t_d_ge_a_d_s_s_s_2, sizeof(__pyx_k_s_t_d_ge_a_d_s_s_s_2), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_d_rho_d_d_d_d_d_s, __pyx_k_s_t_d_rho_d_d_d_d_d_s, sizeof(__pyx_k_s_t_d_rho_d_d_d_d_d_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_dobs__d_d_d_17g, __pyx_k_s_t_dobs__d_d_d_17g, sizeof(__pyx_k_s_t_dobs__d_d_d_17g), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_order_d_s_s, __pyx_k_s_t_order_d_s_s, sizeof(__pyx_k_s_t_order_d_s_s), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_slack1_d_r_d_slack1_d_slack2, __pyx_k_s_t_slack1_d_r_d_slack1_d_slack2, sizeof(__pyx_k_s_t_slack1_d_r_d_slack1_d_slack2), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_slack_b_d_tau_d_slack3_d_sla, __pyx_k_s_t_slack_b_d_tau_d_slack3_d_sla, sizeof(__pyx_k_s_t_slack_b_d_tau_d_slack3_d_sla), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_tau_d_d_d_tau_d, __pyx_k_s_t_tau_d_d_d_tau_d, sizeof(__pyx_k_s_t_tau_d_d_d_tau_d), 0, 0, 1, 0},
  {&__pyx_kp_s_s_t_tau_d_d_d_tau_d_d_d, __pyx_k_s_t_tau_d_d_d_tau_d_d_d, sizeof(__pyx_k_s_t_tau_d_d_d_tau_d_d_d), 0, 0, 1, 0},
  {&__pyx_n_s_s_true, __pyx_k_s_true, sizeof(__pyx_k_s_true), 0, 0, 1, 1},
  {&__pyx_n_s_samplePaths, __pyx_k_samplePaths, sizeof(__pyx_k_samplePaths), 0, 0, 1, 1},
  {&__pyx_n_s_sample_d_until_acceptance, __pyx_k_sample_d_until_acceptance, sizeof(__pyx_k_sample_d_until_acceptance), 0, 0, 1, 1},
  {&__pyx_n_s_sample_discrete_events, __pyx_k_sample_discrete_events, sizeof(__pyx_k_sample_discrete_events), 0, 0, 1, 1},
  {&__pyx_n_s_sample_final, __pyx_k_sample_final, sizeof(__pyx_k_sample_final), 0, 0, 1, 1},
  {&__pyx_n_s_sample_one_obs, __pyx_k_sample_one_obs, sizeof(__pyx_k_sample_one_obs), 0, 0, 1, 1},
  {&__pyx_n_s_sample_parameters, __pyx_k_sample_parameters, sizeof(__pyx_k_sample_parameters), 0, 0, 1, 1},
  {&__pyx_n_s_sample_path, __pyx_k_sample_path, sizeof(__pyx_k_sample_path), 0, 0, 1, 1},
  {&__pyx_n_s_sample_service, __pyx_k_sample_service, sizeof(__pyx_k_sample_service), 0, 0, 1, 1},
  {&__pyx_n_s_sample_state, __pyx_k_sample_state, sizeof(__pyx_k_sample_state), 0, 0, 1, 1},
  {&__pyx_n_s_sampled, __pyx_k_sampled, sizeof(__pyx_k_sampled), 0, 0, 1, 1},
  {&__pyx_n_s_sampling, __pyx_k_sampling, sizeof(__pyx_k_sampling), 0, 0, 1, 1},
  {&__pyx_n_s_scale, __pyx_k_scale, sizeof(__pyx_k_scale), 0, 0, 1, 1},
  {&__pyx_n_s_scipy, __pyx_k_scipy, sizeof(__pyx_k_scipy), 0, 0, 1, 1},
  {&__pyx_n_s_select_job_for_service, __pyx_k_select_job_for_service, sizeof(__pyx_k_select_job_for_service), 0, 0, 1, 1},
  {&__pyx_n_s_service, __pyx_k_service, sizeof(__pyx_k_service), 0, 0, 1, 1},
  {&__pyx_n_s_service_only, __pyx_k_service_only, sizeof(__pyx_k_service_only), 0, 0, 1, 1},
  {&__pyx_n_s_setParameters, __pyx_k_setParameters, sizeof(__pyx_k_setParameters), 0, 0, 1, 1},
  {&__pyx_kp_s_set_E_0_d, __pyx_k_set_E_0_d, sizeof(__pyx_k_set_E_0_d), 0, 0, 1, 0},
  {&__pyx_n_s_set_initialization_type, __pyx_k_set_initialization_type, sizeof(__pyx_k_set_initialization_type), 0, 0, 1, 1},
  {&__pyx_n_s_set_objective, __pyx_k_set_objective, sizeof(__pyx_k_set_objective), 0, 0, 1, 1},
  {&__pyx_n_s_set_sampler, __pyx_k_set_sampler, sizeof(__pyx_k_set_sampler), 0, 0, 1, 1},
  {&__pyx_n_s_set_slice_sorted, __pyx_k_set_slice_sorted, sizeof(__pyx_k_set_slice_sorted), 0, 0, 1, 1},
  {&__pyx_n_s_set_use_rtp, __pyx_k_set_use_rtp, sizeof(__pyx_k_set_use_rtp), 0, 0, 1, 1},
  {&__pyx_n_s_setup_minilp, __pyx_k_setup_minilp, sizeof(__pyx_k_setup_minilp), 0, 0, 1, 1},
  {&__pyx_n_s_sid, __pyx_k_sid, sizeof(__pyx_k_sid), 0, 0, 1, 1},
  {&__pyx_n_s_sid_to_name, __pyx_k_sid_to_name, sizeof(__pyx_k_sid_to_name), 0, 0, 1, 1},
  {&__pyx_n_s_slice, __pyx_k_slice, sizeof(__pyx_k_slice), 0, 0, 1, 1},
  {&__pyx_n_s_slice_resample, __pyx_k_slice_resample, sizeof(__pyx_k_slice_resample), 0, 0, 1, 1},
  {&__pyx_kp_s_slice_resample_Tmax, __pyx_k_slice_resample_Tmax, sizeof(__pyx_k_slice_resample_Tmax), 0, 0, 1, 0},
  {&__pyx_kp_s_slice_resample_initial_log_prob, __pyx_k_slice_resample_initial_log_prob, sizeof(__pyx_k_slice_resample_initial_log_prob), 0, 0, 1, 0},
  {&__pyx_kp_s_slice_resampling_EID_d_s, __pyx_k_slice_resampling_EID_d_s, sizeof(__pyx_k_slice_resampling_EID_d_s), 0, 0, 1, 0},
  {&__pyx_n_s_sname2id, __pyx_k_sname2id, sizeof(__pyx_k_sname2id), 0, 0, 1, 1},
  {&__pyx_n_s_soln, __pyx_k_soln, sizeof(__pyx_k_soln), 0, 0, 1, 1},
  {&__pyx_n_s_solve, __pyx_k_solve, sizeof(__pyx_k_solve), 0, 0, 1, 1},
  {&__pyx_n_s_sort, __pyx_k_sort, sizeof(__pyx_k_sort), 0, 0, 1, 1},
  {&__pyx_n_s_sorted_uniforms, __pyx_k_sorted_uniforms, sizeof(__pyx_k_sorted_uniforms), 0, 0, 1, 1},
  {&__pyx_kp_s_states, __pyx_k_states, sizeof(__pyx_k_states), 0, 0, 1, 0},
  {&__pyx_n_s_stats, __pyx_k_stats, sizeof(__pyx_k_stats), 0, 0, 1, 1},
  {&__pyx_n_s_stdout, __pyx_k_stdout, sizeof(__pyx_k_stdout), 0, 0, 1, 1},
  {&__pyx_n_s_str, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
  {&__pyx_n_s_stupidlp, __pyx_k_stupidlp, sizeof(__pyx_k_stupidlp), 0, 0, 1, 1},
  {&__pyx_kp_s_subgraph_cluster__s_A_label_s_co, __pyx_k_subgraph_cluster__s_A_label_s_co, sizeof(__pyx_k_subgraph_cluster__s_A_label_s_co), 0, 0, 1, 0},
  {&__pyx_kp_s_subgraph_cluster__s_D_label_s_co, __pyx_k_subgraph_cluster__s_D_label_s_co, sizeof(__pyx_k_subgraph_cluster__s_D_label_s_co), 0, 0, 1, 0},
  {&__pyx_n_s_successors, __pyx_k_successors, sizeof(__pyx_k_successors), 0, 0, 1, 1},
  {&__pyx_kp_s_successors_s, __pyx_k_successors_s, sizeof(__pyx_k_successors_s), 0, 0, 1, 0},
  {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
  {&__pyx_n_s_tasks, __pyx_k_tasks, sizeof(__pyx_k_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_tasks_in, __pyx_k_tasks_in, sizeof(__pyx_k_tasks_in), 0, 0, 1, 1},
  {&__pyx_n_s_tasks_out, __pyx_k_tasks_out, sizeof(__pyx_k_tasks_out), 0, 0, 1, 1},
  {&__pyx_n_s_templates, __pyx_k_templates, sizeof(__pyx_k_templates), 0, 0, 1, 1},
  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
  {&__pyx_n_s_theta_from, __pyx_k_theta_from, sizeof(__pyx_k_theta_from), 0, 0, 1, 1},
  {&__pyx_n_s_theta_to, __pyx_k_theta_to, sizeof(__pyx_k_theta_to), 0, 0, 1, 1},
  {&__pyx_n_s_thin, __pyx_k_thin, sizeof(__pyx_k_thin), 0, 0, 1, 1},
  {&__pyx_n_s_tid, __pyx_k_tid, sizeof(__pyx_k_tid), 0, 0, 1, 1},
  {&__pyx_n_s_tid0, __pyx_k_tid0, sizeof(__pyx_k_tid0), 0, 0, 1, 1},
  {&__pyx_n_s_tid1, __pyx_k_tid1, sizeof(__pyx_k_tid1), 0, 0, 1, 1},
  {&__pyx_n_s_tid2, __pyx_k_tid2, sizeof(__pyx_k_tid2), 0, 0, 1, 1},
  {&__pyx_n_s_time_next, __pyx_k_time_next, sizeof(__pyx_k_time_next), 0, 0, 1, 1},
  {&__pyx_n_s_times, __pyx_k_times, sizeof(__pyx_k_times), 0, 0, 1, 1},
  {&__pyx_n_s_to_fix, __pyx_k_to_fix, sizeof(__pyx_k_to_fix), 0, 0, 1, 1},
  {&__pyx_n_s_tots, __pyx_k_tots, sizeof(__pyx_k_tots), 0, 0, 1, 1},
  {&__pyx_n_s_traceback, __pyx_k_traceback, sizeof(__pyx_k_traceback), 0, 0, 1, 1},
  {&__pyx_n_s_type, __pyx_k_type, sizeof(__pyx_k_type), 0, 0, 1, 1},
  {&__pyx_n_s_uniform, __pyx_k_uniform, sizeof(__pyx_k_uniform), 0, 0, 1, 1},
  {&__pyx_n_s_universe, __pyx_k_universe, sizeof(__pyx_k_universe), 0, 0, 1, 1},
  {&__pyx_n_s_unobs, __pyx_k_unobs, sizeof(__pyx_k_unobs), 0, 0, 1, 1},
  {&__pyx_n_s_update_caches_for, __pyx_k_update_caches_for, sizeof(__pyx_k_update_caches_for), 0, 0, 1, 1},
  {&__pyx_n_s_upper, __pyx_k_upper, sizeof(__pyx_k_upper), 0, 0, 1, 1},
  {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
  {&__pyx_n_s_val, __pyx_k_val, sizeof(__pyx_k_val), 0, 0, 1, 1},
  {&__pyx_n_s_validate, __pyx_k_validate, sizeof(__pyx_k_validate), 0, 0, 1, 1},
  {&__pyx_kp_s_var_a_i_in_E_0, __pyx_k_var_a_i_in_E_0, sizeof(__pyx_k_var_a_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_d_i_in_E_0, __pyx_k_var_d_i_in_E_0, sizeof(__pyx_k_var_d_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_r_i_in_E_0, __pyx_k_var_r_i_in_E_0, sizeof(__pyx_k_var_r_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_slack1_i_in_E_0, __pyx_k_var_slack1_i_in_E_0, sizeof(__pyx_k_var_slack1_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_slack2_i_in_E_0, __pyx_k_var_slack2_i_in_E_0, sizeof(__pyx_k_var_slack2_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_slack3_i_in_E_0, __pyx_k_var_slack3_i_in_E_0, sizeof(__pyx_k_var_slack3_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_slack4_i_in_E_0, __pyx_k_var_slack4_i_in_E_0, sizeof(__pyx_k_var_slack4_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_kp_s_var_tau_i_in_E_0, __pyx_k_var_tau_i_in_E_0, sizeof(__pyx_k_var_tau_i_in_E_0), 0, 0, 1, 0},
  {&__pyx_n_s_visualize_initialization_lp, __pyx_k_visualize_initialization_lp, sizeof(__pyx_k_visualize_initialization_lp), 0, 0, 1, 1},
  {&__pyx_n_s_w, __pyx_k_w, sizeof(__pyx_k_w), 0, 0, 1, 1},
  {&__pyx_n_s_wait, __pyx_k_wait, sizeof(__pyx_k_wait), 0, 0, 1, 1},
  {&__pyx_n_s_warnings, __pyx_k_warnings, sizeof(__pyx_k_warnings), 0, 0, 1, 1},
  {&__pyx_n_s_was, __pyx_k_was, sizeof(__pyx_k_was), 0, 0, 1, 1},
  {&__pyx_n_s_when_clear, __pyx_k_when_clear, sizeof(__pyx_k_when_clear), 0, 0, 1, 1},
  {&__pyx_n_s_write, __pyx_k_write, sizeof(__pyx_k_write), 0, 0, 1, 1},
  {&__pyx_n_s_write_csv, __pyx_k_write_csv, sizeof(__pyx_k_write_csv), 0, 0, 1, 1},
  {&__pyx_n_s_xrange, __pyx_k_xrange, sizeof(__pyx_k_xrange), 0, 0, 1, 1},
  {&__pyx_n_s_yaml, __pyx_k_yaml, sizeof(__pyx_k_yaml), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_Exception = __Pyx_GetBuiltinName(__pyx_n_s_Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION >= 3
  __pyx_builtin_xrange = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_xrange) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #else
  __pyx_builtin_xrange = __Pyx_GetBuiltinName(__pyx_n_s_xrange); if (!__pyx_builtin_xrange) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_NotImplementedError = __Pyx_GetBuiltinName(__pyx_n_s_NotImplementedError); if (!__pyx_builtin_NotImplementedError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_max = __Pyx_GetBuiltinName(__pyx_n_s_max); if (!__pyx_builtin_max) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 672; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_map = __Pyx_GetBuiltinName(__pyx_n_s_map); if (!__pyx_builtin_map) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1661; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1892; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "qnet.pyx":200
 *         delta_bar = q0.service.parameters[0]
 *         if not q0.is_markov():
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")             # <<<<<<<<<<<<<<
 *         if not len(q0.service.parameters) == 1:
 *             raise Exception ("Huh?")
 */
  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_ERROR_sample_by_time_works_only); if (unlikely(!__pyx_tuple__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__4);
  __Pyx_GIVEREF(__pyx_tuple__4);

  /* "qnet.pyx":202
 *             raise Exception ("ERROR: sample_by_time works only for M/G/xxx queues")
 *         if not len(q0.service.parameters) == 1:
 *             raise Exception ("Huh?")             # <<<<<<<<<<<<<<
 * 
 *         arrv = Arrivals (self)
 */
  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_Huh); if (unlikely(!__pyx_tuple__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__5);
  __Pyx_GIVEREF(__pyx_tuple__5);

  /* "qnet.pyx":331
 *             return None
 * 
 *     def all_queues (self): return self.queues[:]             # <<<<<<<<<<<<<<
 * 
 *     def all_templates (self): return self.templates[:]
 */
  __pyx_slice__6 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_slice__6);
  __Pyx_GIVEREF(__pyx_slice__6);

  /* "qnet.pyx":333
 *     def all_queues (self): return self.queues[:]
 * 
 *     def all_templates (self): return self.templates[:]             # <<<<<<<<<<<<<<
 * 
 *     # Gibbs sampling
 */
  __pyx_slice__7 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_slice__7);
  __Pyx_GIVEREF(__pyx_slice__7);

  /* "qnet.pyx":598
 *         for rep in xrange (max_backtracks):
 *             eid = eid_snapshot
 *             heap = heap_snapshot[:]             # <<<<<<<<<<<<<<
 *             result = result_snapshot.duplicate()
 * 
 */
  __pyx_slice__8 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_slice__8);
  __Pyx_GIVEREF(__pyx_slice__8);

  /* "qnet.pyx":622
 *                         # create new snapshot
 *                         eid_snapshot = eid+1
 *                         heap_snapshot = heap[:]             # <<<<<<<<<<<<<<
 *                         result_snapshot = result.duplicate()
 * #                        print "SNAPSHOT: %s" % result_snapshot
 */
  __pyx_slice__9 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 622; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_slice__9);
  __Pyx_GIVEREF(__pyx_slice__9);

  /* "qnet.pyx":910
 * 
 *         def __set__ (self, v):
 *             r = v[:]             # <<<<<<<<<<<<<<
 *             cdef Queue q
 *             for q in self.queues:
 */
  __pyx_slice__11 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 910; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_slice__11);
  __Pyx_GIVEREF(__pyx_slice__11);

  /* "qnet.pyx":924
 *     def remove_task_proposal (self, Arrivals arrv_old):
 *         cdef Arrivals arrv = arrv_old.duplicate()
 *         cdef Event last_evt = arrv.final_arrival_by_qid (0)             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         cdef Queue q
 */
  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_int_0); if (unlikely(!__pyx_tuple__12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 924; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__12);
  __Pyx_GIVEREF(__pyx_tuple__12);

  /* "qnet.pyx":1106
 *         lp.add_vars ("set E := 0 .. %d;\n" % ne)
 * 
 *         lp.add_vars ("var d{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")
 */
  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_s_var_d_i_in_E_0); if (unlikely(!__pyx_tuple__14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__14);
  __Pyx_GIVEREF(__pyx_tuple__14);

  /* "qnet.pyx":1107
 * 
 *         lp.add_vars ("var d{i in E} >= 0;")
 *         lp.add_vars ("var r{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")
 */
  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_s_var_r_i_in_E_0); if (unlikely(!__pyx_tuple__15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__15);
  __Pyx_GIVEREF(__pyx_tuple__15);

  /* "qnet.pyx":1108
 *         lp.add_vars ("var d{i in E} >= 0;")
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 */
  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_s_var_tau_i_in_E_0); if (unlikely(!__pyx_tuple__16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__16);
  __Pyx_GIVEREF(__pyx_tuple__16);

  /* "qnet.pyx":1109
 *         lp.add_vars ("var r{i in E} >= 0;")
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 */
  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_s_var_a_i_in_E_0); if (unlikely(!__pyx_tuple__17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__17);
  __Pyx_GIVEREF(__pyx_tuple__17);

  /* "qnet.pyx":1110
 *         lp.add_vars ("var tau{i in E} >= 0;")
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 */
  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_s_var_slack1_i_in_E_0); if (unlikely(!__pyx_tuple__18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__18);
  __Pyx_GIVEREF(__pyx_tuple__18);

  /* "qnet.pyx":1111
 *         lp.add_vars ("var a{i in E} >= 0;")
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 */
  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_s_var_slack2_i_in_E_0); if (unlikely(!__pyx_tuple__19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__19);
  __Pyx_GIVEREF(__pyx_tuple__19);

  /* "qnet.pyx":1112
 *         lp.add_vars ("var slack1{i in E} >= 0;")
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 * 
 */
  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_s_var_slack3_i_in_E_0); if (unlikely(!__pyx_tuple__20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__20);
  __Pyx_GIVEREF(__pyx_tuple__20);

  /* "qnet.pyx":1113
 *         lp.add_vars ("var slack2{i in E} >= 0;")
 *         lp.add_vars ("var slack3{i in E} >= 0;")
 *         lp.add_vars ("var slack4{i in E} >= 0;")             # <<<<<<<<<<<<<<
 * 
 *         lp.set_objective ("minimize cost: sum{i in E} slack1[i] + sum{i in E} slack2[i] + sum{i in E} slack3[i] + sum{i in E} slack4[i];\n")
 */
  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_s_var_slack4_i_in_E_0); if (unlikely(!__pyx_tuple__21)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__21);
  __Pyx_GIVEREF(__pyx_tuple__21);

  /* "qnet.pyx":1115
 *         lp.add_vars ("var slack4{i in E} >= 0;")
 * 
 *         lp.set_objective ("minimize cost: sum{i in E} slack1[i] + sum{i in E} slack2[i] + sum{i in E} slack3[i] + sum{i in E} slack4[i];\n")             # <<<<<<<<<<<<<<
 * 
 *         # Constraint 1. d_e = a_e + r_e
 */
  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_s_minimize_cost_sum_i_in_E_slack1); if (unlikely(!__pyx_tuple__22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__22);
  __Pyx_GIVEREF(__pyx_tuple__22);

  /* "qnet.pyx":1118
 * 
 *         # Constraint 1. d_e = a_e + r_e
 *         lp.add_constraint ("s.t. allr{i in E}: d[i] = a[i] + r[i];")             # <<<<<<<<<<<<<<
 * 
 *         cdef Event evt, byq, byt
 */
  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_s_s_t_allr_i_in_E_d_i_a_i_r_i); if (unlikely(!__pyx_tuple__23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__23);
  __Pyx_GIVEREF(__pyx_tuple__23);

  /* "qnet.pyx":1228
 *     lp.add_vars ("set E := 0 .. %d;\n" % ne)
 * 
 *     lp.add_vars ("var d{i in E} >= 0;")             # <<<<<<<<<<<<<<
 *     lp.add_vars ("var a{i in E} >= 0;")
 * 
 */
  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_var_d_i_in_E_0); if (unlikely(!__pyx_tuple__24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__24);
  __Pyx_GIVEREF(__pyx_tuple__24);

  /* "qnet.pyx":1229
 * 
 *     lp.add_vars ("var d{i in E} >= 0;")
 *     lp.add_vars ("var a{i in E} >= 0;")             # <<<<<<<<<<<<<<
 * 
 *     lp.set_objective ("minimize cost: 0;\n")
 */
  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_var_a_i_in_E_0); if (unlikely(!__pyx_tuple__25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__25);
  __Pyx_GIVEREF(__pyx_tuple__25);

  /* "qnet.pyx":1231
 *     lp.add_vars ("var a{i in E} >= 0;")
 * 
 *     lp.set_objective ("minimize cost: 0;\n")             # <<<<<<<<<<<<<<
 * 
 *     # Constraint 1. d_e > a_e
 */
  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_s_minimize_cost_0); if (unlikely(!__pyx_tuple__26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__26);
  __Pyx_GIVEREF(__pyx_tuple__26);

  /* "qnet.pyx":1856
 *     soln = dict()
 * 
 *     for reg in [ 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  __pyx_tuple__29 = PyTuple_Pack(3, __pyx_float_1eneg_6, __pyx_float_1eneg_10, __pyx_int_0); if (unlikely(!__pyx_tuple__29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1856; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__29);
  __Pyx_GIVEREF(__pyx_tuple__29);

  /* "qnet.pyx":1892
 *     cdef Event evt, byq, byt
 * 
 *     f = open ("model.dot", "w")             # <<<<<<<<<<<<<<
 * 
 *     f.write ("digraph G {\n")
 */
  __pyx_tuple__31 = PyTuple_Pack(2, __pyx_kp_s_model_dot, __pyx_n_s_w); if (unlikely(!__pyx_tuple__31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1892; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__31);
  __Pyx_GIVEREF(__pyx_tuple__31);

  /* "qnet.pyx":1894
 *     f = open ("model.dot", "w")
 * 
 *     f.write ("digraph G {\n")             # <<<<<<<<<<<<<<
 * 
 *     for q in net.queues:
 */
  __pyx_tuple__32 = PyTuple_Pack(1, __pyx_kp_s_digraph_G); if (unlikely(!__pyx_tuple__32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1894; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__32);
  __Pyx_GIVEREF(__pyx_tuple__32);

  /* "qnet.pyx":1909
 *                     f.write ("d%d -> d%d;\n" % (byq.eid, eid))
 * 
 *         f.write("}\n")             # <<<<<<<<<<<<<<
 *         f.write ("subgraph cluster_%s_A {\nlabel = \"%s\";\ncolor=blue;\n" % (q.name, q.name))
 * 
 */
  __pyx_tuple__34 = PyTuple_Pack(1, __pyx_kp_s__33); if (unlikely(!__pyx_tuple__34)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1909; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__34);
  __Pyx_GIVEREF(__pyx_tuple__34);

  /* "qnet.pyx":1921
 *                     f.write ("a%d -> a%d;\n" % (byq.eid, eid))
 * 
 *         f.write("}\n")             # <<<<<<<<<<<<<<
 * 
 *     for evt in arrv:
 */
  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_s__33); if (unlikely(!__pyx_tuple__35)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1921; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__35);
  __Pyx_GIVEREF(__pyx_tuple__35);

  /* "qnet.pyx":1933
 *             f.write ("d%d [style=filled, color=grey80];\n" % evt.eid)
 * 
 *     f.write ("}\n")             # <<<<<<<<<<<<<<
 *     f.close ()
 * 
 */
  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_s__33); if (unlikely(!__pyx_tuple__36)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1933; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__36);
  __Pyx_GIVEREF(__pyx_tuple__36);

  /* "qnet.pyx":1943
 *     soln = dict()
 * 
 *     for reg in [ 0.1, 0.01, 1e-4, 1e-6, 1e-10, 0 ]:             # <<<<<<<<<<<<<<
 *         try:
 * 
 */
  __pyx_tuple__37 = PyTuple_Pack(6, __pyx_float_0_1, __pyx_float_0_01, __pyx_float_1eneg_4, __pyx_float_1eneg_6, __pyx_float_1eneg_10, __pyx_int_0); if (unlikely(!__pyx_tuple__37)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1943; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__37);
  __Pyx_GIVEREF(__pyx_tuple__37);

  /* "qnet.pyx":71
 * cdef int is_slice_sorted = 0
 * 
 * def set_sampler (str):             # <<<<<<<<<<<<<<
 *     global sampler
 *     if str == "SLICE": sampler = SLICE
 */
  __pyx_tuple__38 = PyTuple_Pack(1, __pyx_n_s_str); if (unlikely(!__pyx_tuple__38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__38);
  __Pyx_GIVEREF(__pyx_tuple__38);
  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_set_sampler, 71, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":79
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 * 
 * def set_use_rtp (doitp):             # <<<<<<<<<<<<<<
 *     global doUseRtp
 *     doUseRtp = doitp
 */
  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_n_s_doitp); if (unlikely(!__pyx_tuple__40)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__40);
  __Pyx_GIVEREF(__pyx_tuple__40);
  __pyx_codeobj__41 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_set_use_rtp, 79, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__41)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":83
 *     doUseRtp = doitp
 * 
 * def set_initialization_type (type):             # <<<<<<<<<<<<<<
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type
 */
  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_n_s_type); if (unlikely(!__pyx_tuple__42)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__42);
  __Pyx_GIVEREF(__pyx_tuple__42);
  __pyx_codeobj__43 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_set_initialization_type, 83, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__43)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":104
 *     print "New QNET initializer = ", initializer
 * 
 * def get_initializer (): return initializer             # <<<<<<<<<<<<<<
 * 
 * def set_slice_sorted (val):
 */
  __pyx_codeobj__44 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_get_initializer, 104, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__44)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":106
 * def get_initializer (): return initializer
 * 
 * def set_slice_sorted (val):             # <<<<<<<<<<<<<<
 *     global is_slice_sorted
 *     is_slice_sorted = val
 */
  __pyx_tuple__45 = PyTuple_Pack(1, __pyx_n_s_val); if (unlikely(!__pyx_tuple__45)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__45);
  __Pyx_GIVEREF(__pyx_tuple__45);
  __pyx_codeobj__46 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__45, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_set_slice_sorted, 106, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__46)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":122
 * cdef int num_diff = 0
 * 
 * def reset_stats():             # <<<<<<<<<<<<<<
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0
 */
  __pyx_tuple__47 = PyTuple_Pack(1, __pyx_n_s_num_diff); if (unlikely(!__pyx_tuple__47)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__47);
  __Pyx_GIVEREF(__pyx_tuple__47);
  __pyx_codeobj__48 = (PyObject*)__Pyx_PyCode_New(0, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__47, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_reset_stats, 122, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__48)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":131
 *     num_diff = 0
 * 
 * def stats():             # <<<<<<<<<<<<<<
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}
 * 
 */
  __pyx_codeobj__49 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_stats, 131, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__49)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1047
 * # Utilities
 * 
 * def is_sampled_by_task (arrv):             # <<<<<<<<<<<<<<
 *     tasks_in = {}
 *     tasks_out = {}
 */
  __pyx_tuple__50 = PyTuple_Pack(4, __pyx_n_s_arrv, __pyx_n_s_tasks_in, __pyx_n_s_tasks_out, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__50)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__50);
  __Pyx_GIVEREF(__pyx_tuple__50);
  __pyx_codeobj__51 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__50, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_is_sampled_by_task, 1047, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__51)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1063
 *     return True
 * 
 * def has_tau (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byq = evt.prev_byq
 * #    if evt.prev_byt != None: return False
 */
  __pyx_tuple__52 = PyTuple_Pack(2, __pyx_n_s_evt, __pyx_n_s_byq); if (unlikely(!__pyx_tuple__52)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__52);
  __Pyx_GIVEREF(__pyx_tuple__52);
  __pyx_codeobj__53 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__52, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_has_tau, 1063, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__53)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1071
 *         return not evt.obs_a
 * 
 * def create_qp (a, reg):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()
 */
  __pyx_tuple__54 = PyTuple_Pack(9, __pyx_n_s_a, __pyx_n_s_reg, __pyx_n_s_arrv, __pyx_n_s_ne, __pyx_n_s_nt, __pyx_n_s_qp, __pyx_n_s_evt, __pyx_n_s_eid, __pyx_n_s_byq); if (unlikely(!__pyx_tuple__54)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__54);
  __Pyx_GIVEREF(__pyx_tuple__54);
  __pyx_codeobj__55 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__54, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_create_qp, 1071, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__55)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1178
 * 
 * 
 * def compute_obs_means (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()
 */
  __pyx_tuple__56 = PyTuple_Pack(5, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_tots, __pyx_n_s_Ns, __pyx_n_s_i); if (unlikely(!__pyx_tuple__56)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__56);
  __Pyx_GIVEREF(__pyx_tuple__56);
  __pyx_codeobj__57 = (PyObject*)__Pyx_PyCode_New(1, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_compute_obs_means, 1178, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__57)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1190
 *     return tots
 * 
 * def compute_obs_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     last_a = 0.
 */
  __pyx_tuple__58 = PyTuple_Pack(4, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_last_a, __pyx_n_s_N); if (unlikely(!__pyx_tuple__58)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__58);
  __Pyx_GIVEREF(__pyx_tuple__58);
  __pyx_codeobj__59 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__58, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_compute_obs_mean_ia, 1190, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__59)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1203
 *     else: return 0
 * 
 * def compute_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     times = []
 */
  __pyx_tuple__60 = PyTuple_Pack(4, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_times, __pyx_n_s_time_next); if (unlikely(!__pyx_tuple__60)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__60);
  __Pyx_GIVEREF(__pyx_tuple__60);
  __pyx_codeobj__61 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__60, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_compute_mean_ia, 1203, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__61)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1213
 *     return numpy.mean (times)
 * 
 * def sorted_uniforms (n, L, U):             # <<<<<<<<<<<<<<
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()
 */
  __pyx_tuple__62 = PyTuple_Pack(5, __pyx_n_s_n, __pyx_n_s_L, __pyx_n_s_U, __pyx_n_s_l, __pyx_n_s_i); if (unlikely(!__pyx_tuple__62)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__62);
  __Pyx_GIVEREF(__pyx_tuple__62);
  __pyx_codeobj__63 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__62, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_sorted_uniforms, 1213, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__63)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1218
 *     return l
 * 
 * def setup_minilp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 * 
 */
  __pyx_tuple__64 = PyTuple_Pack(9, __pyx_n_s_arrv, __pyx_n_s_reg, __pyx_n_s_evt, __pyx_n_s_lp, __pyx_n_s_ne, __pyx_n_s_nt, __pyx_n_s_byt, __pyx_n_s_byq, __pyx_n_s_order); if (unlikely(!__pyx_tuple__64)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__64);
  __Pyx_GIVEREF(__pyx_tuple__64);
  __pyx_codeobj__65 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__64, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_setup_minilp, 1218, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__65)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1268
 *     return lp
 * 
 * def astr (evt):             # <<<<<<<<<<<<<<
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):
 */
  __pyx_tuple__66 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__66)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__66);
  __Pyx_GIVEREF(__pyx_tuple__66);
  __pyx_codeobj__67 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__66, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_astr, 1268, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__67)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1270
 * def astr (evt):
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):             # <<<<<<<<<<<<<<
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 */
  __pyx_tuple__68 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__68)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__68);
  __Pyx_GIVEREF(__pyx_tuple__68);
  __pyx_codeobj__69 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__68, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_dstr, 1270, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__69)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1272
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 */
  __pyx_tuple__70 = PyTuple_Pack(3, __pyx_n_s_arrv, __pyx_n_s_soln, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__70)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__70);
  __Pyx_GIVEREF(__pyx_tuple__70);
  __pyx_codeobj__71 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__70, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_compactify_soln, 1272, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__71)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1286
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 * 
 * def _compute_task_order (Event evt):             # <<<<<<<<<<<<<<
 *     i = 0
 *     while evt.prev_byt:
 */
  __pyx_tuple__72 = PyTuple_Pack(2, __pyx_n_s_evt, __pyx_n_s_i); if (unlikely(!__pyx_tuple__72)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__72);
  __Pyx_GIVEREF(__pyx_tuple__72);
  __pyx_codeobj__73 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__72, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_compute_task_order, 1286, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__73)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1305
 * 
 * 
 * def display_diff_list (arrv, Event e, diff_list):             # <<<<<<<<<<<<<<
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 */
  __pyx_tuple__74 = PyTuple_Pack(6, __pyx_n_s_arrv, __pyx_n_s_e, __pyx_n_s_diff_list, __pyx_n_s_result, __pyx_n_s_evt, __pyx_n_s_evt_old); if (unlikely(!__pyx_tuple__74)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__74);
  __Pyx_GIVEREF(__pyx_tuple__74);
  __pyx_codeobj__75 = (PyObject*)__Pyx_PyCode_New(3, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__74, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_display_diff_list, 1305, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__75)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1314
 *     return result
 * 
 * def any_zero_service (diff_list):             # <<<<<<<<<<<<<<
 *     for evt in diff_list:
 *         if evt.s < 0:
 */
  __pyx_tuple__76 = PyTuple_Pack(2, __pyx_n_s_diff_list, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__76)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__76);
  __Pyx_GIVEREF(__pyx_tuple__76);
  __pyx_codeobj__77 = (PyObject*)__Pyx_PyCode_New(1, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__76, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_any_zero_service, 1314, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__77)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1393
 * # Initializers
 * 
 * def gibbs_initialize_via_dfn1 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 */
  __pyx_tuple__78 = PyTuple_Pack(4, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_result, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__78)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__78);
  __Pyx_GIVEREF(__pyx_tuple__78);
  __pyx_codeobj__79 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__78, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_dfn1, 1393, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__79)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1401
 *     return result
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 */
  __pyx_tuple__80 = PyTuple_Pack(5, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_inner, __pyx_n_s_result, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__80)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__80);
  __Pyx_GIVEREF(__pyx_tuple__80);
  __pyx_codeobj__81 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__80, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_dfn2, 1401, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__81)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1410
 *     return result
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 */
  __pyx_tuple__82 = PyTuple_Pack(4, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_result, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__82)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__82);
  __Pyx_GIVEREF(__pyx_tuple__82);
  __pyx_codeobj__83 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__82, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_dfn3, 1410, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__83)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1418
 *     return result
 * 
 * def insert_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, evt0, evt1
 * 
 */
  __pyx_tuple__84 = PyTuple_Pack(13, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_evt0, __pyx_n_s_evt1, __pyx_n_s_eid, __pyx_n_s_d0, __pyx_n_s_tid0, __pyx_n_s_evt2, __pyx_n_s_initial_q, __pyx_n_s_eps, __pyx_n_s_tid2, __pyx_n_s_tid1); if (unlikely(!__pyx_tuple__84)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__84);
  __Pyx_GIVEREF(__pyx_tuple__84);
  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(2, 0, 13, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__84, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_insert_implied_tasks, 1418, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1450
 *     return arrv
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     insert_implied_tasks (net, arrv)
 *     return initializer (net, arrv)
 */
  __pyx_tuple__86 = PyTuple_Pack(2, __pyx_n_s_net, __pyx_n_s_arrv); if (unlikely(!__pyx_tuple__86)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__86);
  __Pyx_GIVEREF(__pyx_tuple__86);
  __pyx_codeobj__87 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__86, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_initialize_inserting_implied_tas, 1450, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__87)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1454
 *     return initializer (net, arrv)
 * 
 * def gibbs_initialize_via_dfn (Qnet net, Arrivals arrv, scale):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_tuple__88 = PyTuple_Pack(22, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_scale, __pyx_n_s_q, __pyx_n_s_evt, __pyx_n_s_evt_new, __pyx_n_s_evt_prev, __pyx_n_s_evt1, __pyx_n_s_result, __pyx_n_s_s_initial, __pyx_n_s_eid, __pyx_n_s_dists, __pyx_n_s_tid, __pyx_n_s_evts, __pyx_n_s_diff_list, __pyx_n_s_tasks, __pyx_n_s_i, __pyx_n_s_path, __pyx_n_s_eid_prev, __pyx_n_s_d_new, __pyx_n_s_sid, __pyx_n_s_qid); if (unlikely(!__pyx_tuple__88)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__88);
  __Pyx_GIVEREF(__pyx_tuple__88);
  __pyx_codeobj__89 = (PyObject*)__Pyx_PyCode_New(3, 0, 22, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__88, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_dfn, 1454, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__89)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1557
 * 
 * 
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):             # <<<<<<<<<<<<<<
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():
 */
  __pyx_tuple__90 = PyTuple_Pack(8, __pyx_n_s_arrv, __pyx_n_s_result, __pyx_n_s_add_initial, __pyx_n_s_evt_new, __pyx_n_s_evt, __pyx_n_s_tid, __pyx_n_s_evts, __pyx_n_s_diff_list); if (unlikely(!__pyx_tuple__90)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__90);
  __Pyx_GIVEREF(__pyx_tuple__90);
  __pyx_codeobj__91 = (PyObject*)__Pyx_PyCode_New(3, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__90, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_init_insert_observed_tasks, 1557, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__91)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1574
 * 
 *     # now add unobserved initial events
 * def init_add_initial_events (Qnet net, Arrivals arrv, Arrivals result):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     cdef Queue q
 */
  __pyx_tuple__92 = PyTuple_Pack(16, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_result, __pyx_n_s_evt, __pyx_n_s_q, __pyx_n_s_d_prev, __pyx_n_s_heap, __pyx_n_s_tasks, __pyx_n_s_i, __pyx_n_s_tid, __pyx_n_s_evts, __pyx_n_s_path, __pyx_n_s_eid_prev, __pyx_n_s_evt_prev, __pyx_n_s_d_new, __pyx_n_s_diff_list); if (unlikely(!__pyx_tuple__92)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__92);
  __Pyx_GIVEREF(__pyx_tuple__92);
  __pyx_codeobj__93 = (PyObject*)__Pyx_PyCode_New(3, 0, 16, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__92, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_init_add_initial_events, 1574, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__93)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1610
 *     return heap
 * 
 * def gibbs_initialize_via_order (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_tuple__94 = PyTuple_Pack(19, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_q, __pyx_n_s_evt, __pyx_n_s_evt_new, __pyx_n_s_evt_prev, __pyx_n_s_evt1, __pyx_n_s_result, __pyx_n_s_s_initial, __pyx_n_s_eid, __pyx_n_s_dists, __pyx_n_s_heap, __pyx_n_s_a, __pyx_n_s_tid, __pyx_n_s_path, __pyx_n_s_sid, __pyx_n_s_qid, __pyx_n_s_d_new, __pyx_n_s_diff_list); if (unlikely(!__pyx_tuple__94)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__94);
  __Pyx_GIVEREF(__pyx_tuple__94);
  __pyx_codeobj__95 = (PyObject*)__Pyx_PyCode_New(2, 0, 19, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__94, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_order, 1610, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__95)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1688
 *     return result
 * 
 * def gibbs_initialize_for_gg1r (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_tuple__96 = PyTuple_Pack(27, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_q, __pyx_n_s_evt, __pyx_n_s_evt_new, __pyx_n_s_evt_prev, __pyx_n_s_evt1, __pyx_n_s_result, __pyx_n_s_s_initial, __pyx_n_s_eid, __pyx_n_s_dists, __pyx_n_s_heap, __pyx_n_s_unobs, __pyx_n_s_elem, __pyx_n_s_a, __pyx_n_s_tid, __pyx_n_s_path, __pyx_n_s_sid, __pyx_n_s_qid, __pyx_n_s_s, __pyx_n_s_d, __pyx_n_s_s_new, __pyx_n_s_aux, __pyx_n_s_N, __pyx_n_s_to_fix, __pyx_n_s_d_old, __pyx_n_s_e); if (unlikely(!__pyx_tuple__96)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__96);
  __Pyx_GIVEREF(__pyx_tuple__96);
  __pyx_codeobj__97 = (PyObject*)__Pyx_PyCode_New(2, 0, 27, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__96, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_for_gg1r, 1688, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__97)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1770
 *     return result
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True
 */
  __pyx_tuple__98 = PyTuple_Pack(5, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_q, __pyx_n_s_diff_list, __pyx_n_s_evt1); if (unlikely(!__pyx_tuple__98)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__98);
  __Pyx_GIVEREF(__pyx_tuple__98);
  __pyx_codeobj__99 = (PyObject*)__Pyx_PyCode_New(4, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__98, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_diff_list_definitely_bad, 1770, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__99)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1777
 *     return False
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):             # <<<<<<<<<<<<<<
 *     cdef Queue q = evt.q
 * 
 */
  __pyx_tuple__100 = PyTuple_Pack(19, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_service_only, __pyx_n_s_scale, __pyx_n_s_q, __pyx_n_s_dfn, __pyx_n_s_d_initial, __pyx_n_s_delta, __pyx_n_s_diff_list, __pyx_n_s_found_a_good_one, __pyx_n_s_s_true, __pyx_n_s_wait, __pyx_n_s_j, __pyx_n_s_s_new, __pyx_n_s_aux, __pyx_n_s_d_new, __pyx_n_s_e0, __pyx_n_s_evt_to_test); if (unlikely(!__pyx_tuple__100)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__100);
  __Pyx_GIVEREF(__pyx_tuple__100);
  __pyx_codeobj__101 = (PyObject*)__Pyx_PyCode_New(5, 0, 19, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__100, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_sample_d_until_acceptance, 1777, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__101)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1838
 *     return d_new, diff_list
 * 
 * def heap_from_arrivals (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     heap = []
 *     cdef Event evt
 */
  __pyx_tuple__102 = PyTuple_Pack(5, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_heap, __pyx_n_s_evt, __pyx_n_s_s_initial); if (unlikely(!__pyx_tuple__102)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__102);
  __Pyx_GIVEREF(__pyx_tuple__102);
  __pyx_codeobj__103 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__102, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_heap_from_arrivals, 1838, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__103)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1850
 *     return heap
 * 
 * def gibbs_initialize_via_lp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */
  __pyx_tuple__104 = PyTuple_Pack(10, __pyx_n_s_net, __pyx_n_s_arrv_in, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_soln, __pyx_n_s_reg, __pyx_n_s_lp, __pyx_n_s_k, __pyx_n_s_v, __pyx_n_s_e); if (unlikely(!__pyx_tuple__104)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__104);
  __Pyx_GIVEREF(__pyx_tuple__104);
  __pyx_codeobj__105 = (PyObject*)__Pyx_PyCode_New(2, 0, 10, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__104, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_lp, 1850, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__105)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1889
 *                 print "Initialization at %s failed: %s" % (reg, e)
 * 
 * def visualize_initialization_lp (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, byq, byt
 * 
 */
  __pyx_tuple__106 = PyTuple_Pack(8, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_byq, __pyx_n_s_byt, __pyx_n_s_f, __pyx_n_s_q, __pyx_n_s_eid); if (unlikely(!__pyx_tuple__106)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__106);
  __Pyx_GIVEREF(__pyx_tuple__106);
  __pyx_codeobj__107 = (PyObject*)__Pyx_PyCode_New(2, 0, 8, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__106, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_visualize_initialization_lp, 1889, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__107)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1936
 *     f.close ()
 * 
 * def gibbs_initialize_via_minilp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */
  __pyx_tuple__108 = PyTuple_Pack(14, __pyx_n_s_net, __pyx_n_s_arrv_in, __pyx_n_s_arrv, __pyx_n_s_evt, __pyx_n_s_soln, __pyx_n_s_reg, __pyx_n_s_prev_dept_old, __pyx_n_s_prev_arrv_old, __pyx_n_s_lp, __pyx_n_s_k, __pyx_n_s_v, __pyx_n_s_old_tmpls, __pyx_n_s_arrvls, __pyx_n_s_e); if (unlikely(!__pyx_tuple__108)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__108);
  __Pyx_GIVEREF(__pyx_tuple__108);
  __pyx_codeobj__109 = (PyObject*)__Pyx_PyCode_New(2, 0, 14, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__108, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_via_minilp, 1936, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__109)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1994
 * 
 * # requires Markovization
 * def estimate_minilp_params (net, arrv):             # <<<<<<<<<<<<<<
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)
 */
  __pyx_tuple__110 = PyTuple_Pack(4, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_mu_s, __pyx_n_s_N); if (unlikely(!__pyx_tuple__110)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__110);
  __Pyx_GIVEREF(__pyx_tuple__110);
  __pyx_codeobj__111 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__110, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_estimate_minilp_params, 1994, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__111)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":2001
 * 
 * 
 * def gibbs_initialize_for_ps (net, arrv):             # <<<<<<<<<<<<<<
 *     cdef Event e, evt, dup
 *     cdef Queue q
 */
  __pyx_tuple__112 = PyTuple_Pack(22, __pyx_n_s_net, __pyx_n_s_arrv, __pyx_n_s_e, __pyx_n_s_evt, __pyx_n_s_dup, __pyx_n_s_q, __pyx_n_s_result, __pyx_n_s_eid, __pyx_n_s_d_last, __pyx_n_s_ievts, __pyx_n_s_s, __pyx_n_s_next_obs, __pyx_n_s_n_hidden, __pyx_n_s_i, __pyx_n_s_Z, __pyx_n_s_nh, __pyx_n_s_d_max, __pyx_n_s_rate, __pyx_n_s_delta, __pyx_n_s_q0, __pyx_n_s_heap, __pyx_n_s_s_next); if (unlikely(!__pyx_tuple__112)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__112);
  __Pyx_GIVEREF(__pyx_tuple__112);
  __pyx_codeobj__113 = (PyObject*)__Pyx_PyCode_New(2, 0, 22, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__112, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_gibbs_initialize_for_ps, 2001, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__113)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":2156
 * #     return result
 * 
 * def null_initializer (net, arrv): return arrv             # <<<<<<<<<<<<<<
 * 
 * #cas?? initializer = gibbs_initialize_via_order
 */
  __pyx_tuple__114 = PyTuple_Pack(2, __pyx_n_s_net, __pyx_n_s_arrv); if (unlikely(!__pyx_tuple__114)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__114);
  __Pyx_GIVEREF(__pyx_tuple__114);
  __pyx_codeobj__115 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__114, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_null_initializer, 2156, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__115)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":2162
 * 
 * 
 * def get_departure(evt): return evt.d             # <<<<<<<<<<<<<<
 * def get_arrival(evt): return evt.a
 * 
 */
  __pyx_tuple__116 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__116)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__116);
  __Pyx_GIVEREF(__pyx_tuple__116);
  __pyx_codeobj__117 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__116, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_get_departure, 2162, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__117)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":2163
 * 
 * def get_departure(evt): return evt.d
 * def get_arrival(evt): return evt.a             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_tuple__118 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__118)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_tuple__118);
  __Pyx_GIVEREF(__pyx_tuple__118);
  __pyx_codeobj__119 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__118, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_svn_research_code, __pyx_n_s_get_arrival, 2163, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__119)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_0_1 = PyFloat_FromDouble(0.1); if (unlikely(!__pyx_float_0_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1_1 = PyFloat_FromDouble(1.1); if (unlikely(!__pyx_float_1_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_0_01 = PyFloat_FromDouble(0.01); if (unlikely(!__pyx_float_0_01)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1eneg_4 = PyFloat_FromDouble(1e-4); if (unlikely(!__pyx_float_1eneg_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1eneg_5 = PyFloat_FromDouble(1e-5); if (unlikely(!__pyx_float_1eneg_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1eneg_6 = PyFloat_FromDouble(1e-6); if (unlikely(!__pyx_float_1eneg_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1eneg_9 = PyFloat_FromDouble(1e-9); if (unlikely(!__pyx_float_1eneg_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_float_1eneg_10 = PyFloat_FromDouble(1e-10); if (unlikely(!__pyx_float_1eneg_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_9 = PyInt_FromLong(9); if (unlikely(!__pyx_int_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_1000 = PyInt_FromLong(1000); if (unlikely(!__pyx_int_1000)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initqnet(void); /*proto*/
PyMODINIT_FUNC initqnet(void)
#else
PyMODINIT_FUNC PyInit_qnet(void); /*proto*/
PyMODINIT_FUNC PyInit_qnet(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  #if CYTHON_REFNANNY
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  #endif
  __Pyx_RefNannySetupContext("PyMODINIT_FUNC PyInit_qnet(void)", 0);
  if ( __Pyx_check_binary_version() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #ifdef __Pyx_CyFunction_USED
  if (__Pyx_CyFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("qnet", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_d);
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if CYTHON_COMPILING_IN_PYPY
  Py_INCREF(__pyx_b);
  #endif
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  #endif
  if (__pyx_module_is_main_qnet) {
    if (PyObject_SetAttrString(__pyx_m, "__name__", __pyx_n_s_main) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (!PyDict_GetItemString(modules, "qnet")) {
      if (unlikely(PyDict_SetItemString(modules, "qnet", __pyx_m) < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Constants init code ---*/
  if (unlikely(__Pyx_InitCachedConstants() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Global init code ---*/
  __pyx_v_4qnet_initializer = Py_None; Py_INCREF(Py_None);
  /*--- Variable export code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  __pyx_vtabptr_4qnet_Qnet = &__pyx_vtable_4qnet_Qnet;
  __pyx_vtable_4qnet_Qnet.gibbs_resample_final = (int (*)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *))__pyx_f_4qnet_4Qnet_gibbs_resample_final;
  __pyx_vtable_4qnet_Qnet.gibbs_resample_pair = (int (*)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *))__pyx_f_4qnet_4Qnet_gibbs_resample_pair;
  __pyx_vtable_4qnet_Qnet.determine_upper = (double (*)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Event *))__pyx_f_4qnet_4Qnet_determine_upper;
  __pyx_vtable_4qnet_Qnet.dfn_range = (PyObject *(*)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *))__pyx_f_4qnet_4Qnet_dfn_range;
  __pyx_vtable_4qnet_Qnet.log_prob = (double (*)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch))__pyx_f_4qnet_4Qnet_log_prob;
  if (PyType_Ready(&__pyx_type_4qnet_Qnet) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_4qnet_Qnet.tp_print = 0;
  if (__Pyx_SetVtable(__pyx_type_4qnet_Qnet.tp_dict, __pyx_vtabptr_4qnet_Qnet) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttrString(__pyx_m, "Qnet", (PyObject *)&__pyx_type_4qnet_Qnet) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4qnet_Qnet = &__pyx_type_4qnet_Qnet;
  if (PyType_Ready(&__pyx_type_4qnet_GGkGibbs) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_type_4qnet_GGkGibbs.tp_print = 0;
  if (PyObject_SetAttrString(__pyx_m, "GGkGibbs", (PyObject *)&__pyx_type_4qnet_GGkGibbs) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_4qnet_GGkGibbs = &__pyx_type_4qnet_GGkGibbs;
  /*--- Type import code ---*/
  __pyx_ptype_13distributions_Distribution = __Pyx_ImportType("distributions", "Distribution", sizeof(struct __pyx_obj_13distributions_Distribution), 1); if (unlikely(!__pyx_ptype_13distributions_Distribution)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_13distributions_Distribution = (struct __pyx_vtabstruct_13distributions_Distribution*)__Pyx_GetVtable(__pyx_ptype_13distributions_Distribution->tp_dict); if (unlikely(!__pyx_vtabptr_13distributions_Distribution)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_5pwfun_Pwfun = __Pyx_ImportType("pwfun", "Pwfun", sizeof(struct __pyx_obj_5pwfun_Pwfun), 1); if (unlikely(!__pyx_ptype_5pwfun_Pwfun)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_5pwfun_Pwfun = (struct __pyx_vtabstruct_5pwfun_Pwfun*)__Pyx_GetVtable(__pyx_ptype_5pwfun_Pwfun->tp_dict); if (unlikely(!__pyx_vtabptr_5pwfun_Pwfun)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_5pwfun_Pwlin = __Pyx_ImportType("pwfun", "Pwlin", sizeof(struct __pyx_obj_5pwfun_Pwlin), 1); if (unlikely(!__pyx_ptype_5pwfun_Pwlin)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_5pwfun_Pwlin = (struct __pyx_vtabstruct_5pwfun_Pwlin*)__Pyx_GetVtable(__pyx_ptype_5pwfun_Pwlin->tp_dict); if (unlikely(!__pyx_vtabptr_5pwfun_Pwlin)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6queues_Queue = __Pyx_ImportType("queues", "Queue", sizeof(struct __pyx_obj_6queues_Queue), 1); if (unlikely(!__pyx_ptype_6queues_Queue)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_6queues_Queue = (struct __pyx_vtabstruct_6queues_Queue*)__Pyx_GetVtable(__pyx_ptype_6queues_Queue->tp_dict); if (unlikely(!__pyx_vtabptr_6queues_Queue)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6queues_FactorTemplate = __Pyx_ImportType("queues", "FactorTemplate", sizeof(struct __pyx_obj_6queues_FactorTemplate), 1); if (unlikely(!__pyx_ptype_6queues_FactorTemplate)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_6queues_FactorTemplate = (struct __pyx_vtabstruct_6queues_FactorTemplate*)__Pyx_GetVtable(__pyx_ptype_6queues_FactorTemplate->tp_dict); if (unlikely(!__pyx_vtabptr_6queues_FactorTemplate)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8arrivals_Event = __Pyx_ImportType("arrivals", "Event", sizeof(struct __pyx_obj_8arrivals_Event), 1); if (unlikely(!__pyx_ptype_8arrivals_Event)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_8arrivals_Event = (struct __pyx_vtabstruct_8arrivals_Event*)__Pyx_GetVtable(__pyx_ptype_8arrivals_Event->tp_dict); if (unlikely(!__pyx_vtabptr_8arrivals_Event)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8arrivals_Arrivals = __Pyx_ImportType("arrivals", "Arrivals", sizeof(struct __pyx_obj_8arrivals_Arrivals), 1); if (unlikely(!__pyx_ptype_8arrivals_Arrivals)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_vtabptr_8arrivals_Arrivals = (struct __pyx_vtabstruct_8arrivals_Arrivals*)__Pyx_GetVtable(__pyx_ptype_8arrivals_Arrivals->tp_dict); if (unlikely(!__pyx_vtabptr_8arrivals_Arrivals)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_8arrivals_Vars = __Pyx_ImportType("arrivals", "Vars", sizeof(struct __pyx_obj_8arrivals_Vars), 1); if (unlikely(!__pyx_ptype_8arrivals_Vars)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Variable import code ---*/
  /*--- Function import code ---*/
  __pyx_t_1 = __Pyx_ImportModule("queues"); if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_1, "_pair_proposal", (void (**)(void))&__pyx_f_6queues__pair_proposal, "struct __pyx_obj_5pwfun_Pwfun *(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_1, "_departure_proposal", (void (**)(void))&__pyx_f_6queues__departure_proposal, "struct __pyx_obj_5pwfun_Pwfun *(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_ImportModule("sampling"); if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "_slice", (void (**)(void))&__pyx_f_8sampling__slice, "double (double, PyObject *, double, double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "_slice_pwfun", (void (**)(void))&__pyx_f_8sampling__slice_pwfun, "double (struct __pyx_obj_5pwfun_Pwfun *, double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "rand", (void (**)(void))&__pyx_f_8sampling_rand, "double (void)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "uniform", (void (**)(void))&__pyx_f_8sampling_uniform, "double (double, double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_2, "exponential", (void (**)(void))&__pyx_f_8sampling_exponential, "double (double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_ImportModule("misc"); if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_ImportFunction(__pyx_t_3, "_integrate", (void (**)(void))&__pyx_f_4misc__integrate, "double (PyObject *, double, double)") < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  /*--- Execution code ---*/

  /* "qnet.pyx":22
 *     double log(double x)
 * 
 * from heapq import heappush, heappop             # <<<<<<<<<<<<<<
 * import bisect
 * 
 */
  __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_n_s_heappush);
  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_n_s_heappush);
  __Pyx_GIVEREF(__pyx_n_s_heappush);
  __Pyx_INCREF(__pyx_n_s_heappop);
  PyList_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_heappop);
  __Pyx_GIVEREF(__pyx_n_s_heappop);
  __pyx_t_5 = __Pyx_Import(__pyx_n_s_heapq, __pyx_t_4, -1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_ImportFrom(__pyx_t_5, __pyx_n_s_heappush); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_heappush, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_ImportFrom(__pyx_t_5, __pyx_n_s_heappop); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_heappop, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":23
 * 
 * from heapq import heappush, heappop
 * import bisect             # <<<<<<<<<<<<<<
 * 
 * import numpy
 */
  __pyx_t_5 = __Pyx_Import(__pyx_n_s_bisect, 0, -1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_bisect, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":25
 * import bisect
 * 
 * import numpy             # <<<<<<<<<<<<<<
 * from numpy import random
 * 
 */
  __pyx_t_5 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numpy, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":26
 * 
 * import numpy
 * from numpy import random             # <<<<<<<<<<<<<<
 * 
 * import yaml
 */
  __pyx_t_5 = PyList_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_n_s_random);
  PyList_SET_ITEM(__pyx_t_5, 0, __pyx_n_s_random);
  __Pyx_GIVEREF(__pyx_n_s_random);
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_numpy, __pyx_t_5, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_random); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_random, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":28
 * from numpy import random
 * 
 * import yaml             # <<<<<<<<<<<<<<
 * 
 * from distributions cimport Distribution
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_yaml, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_yaml, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":37
 * from arrivals cimport Event
 * 
 * import queues, distributions, arrivals, qstats             # <<<<<<<<<<<<<<
 * 
 * from sampling cimport _slice_pwfun, _slice, rand, uniform, exponential
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_queues, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_queues, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_distributions, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_distributions, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_arrivals, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_arrivals, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_qstats, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_qstats, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":42
 * from misc cimport _integrate
 * 
 * import netutils             # <<<<<<<<<<<<<<
 * import sampling
 * import pwfun
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_netutils, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_netutils, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":43
 * 
 * import netutils
 * import sampling             # <<<<<<<<<<<<<<
 * import pwfun
 * import stupidlp
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_sampling, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sampling, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":44
 * import netutils
 * import sampling
 * import pwfun             # <<<<<<<<<<<<<<
 * import stupidlp
 * import hmm
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_pwfun, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pwfun, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":45
 * import sampling
 * import pwfun
 * import stupidlp             # <<<<<<<<<<<<<<
 * import hmm
 * import warnings
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_stupidlp, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_stupidlp, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":46
 * import pwfun
 * import stupidlp
 * import hmm             # <<<<<<<<<<<<<<
 * import warnings
 * import misc
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_hmm, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hmm, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":47
 * import stupidlp
 * import hmm
 * import warnings             # <<<<<<<<<<<<<<
 * import misc
 * 
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_warnings, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_warnings, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":48
 * import hmm
 * import warnings
 * import misc             # <<<<<<<<<<<<<<
 * 
 * import sys, traceback
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_misc, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_misc, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":50
 * import misc
 * 
 * import sys, traceback             # <<<<<<<<<<<<<<
 * import math # temporary
 * 
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_sys, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_traceback, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_traceback, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":51
 * 
 * import sys, traceback
 * import math # temporary             # <<<<<<<<<<<<<<
 * 
 * from scipy import integrate
 */
  __pyx_t_4 = __Pyx_Import(__pyx_n_s_math, 0, -1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_math, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "qnet.pyx":53
 * import math # temporary
 * 
 * from scipy import integrate             # <<<<<<<<<<<<<<
 * 
 * # configuration: need to expose in a better way
 */
  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_n_s_integrate);
  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_n_s_integrate);
  __Pyx_GIVEREF(__pyx_n_s_integrate);
  __pyx_t_5 = __Pyx_Import(__pyx_n_s_scipy, __pyx_t_4, -1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_ImportFrom(__pyx_t_5, __pyx_n_s_integrate); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_integrate, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":62
 *     STUPID_REJECT = 3
 * 
 * cdef int doUseRtp = 0             # <<<<<<<<<<<<<<
 * cdef SamplingType sampler = SLICE
 * 
 */
  __pyx_v_4qnet_doUseRtp = 0;

  /* "qnet.pyx":63
 * 
 * cdef int doUseRtp = 0
 * cdef SamplingType sampler = SLICE             # <<<<<<<<<<<<<<
 * 
 * cdef int BRUTE_FORCE_RATIO = 0
 */
  __pyx_v_4qnet_sampler = __pyx_e_4qnet_SLICE;

  /* "qnet.pyx":65
 * cdef SamplingType sampler = SLICE
 * 
 * cdef int BRUTE_FORCE_RATIO = 0             # <<<<<<<<<<<<<<
 * 
 * cdef object initializer
 */
  __pyx_v_4qnet_BRUTE_FORCE_RATIO = 0;

  /* "qnet.pyx":69
 * cdef object initializer
 * 
 * cdef int is_slice_sorted = 0             # <<<<<<<<<<<<<<
 * 
 * def set_sampler (str):
 */
  __pyx_v_4qnet_is_slice_sorted = 0;

  /* "qnet.pyx":71
 * cdef int is_slice_sorted = 0
 * 
 * def set_sampler (str):             # <<<<<<<<<<<<<<
 *     global sampler
 *     if str == "SLICE": sampler = SLICE
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_1set_sampler, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_set_sampler, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":79
 *     else: raise Exception("Could not understand one_d_sampler: %s" % str)
 * 
 * def set_use_rtp (doitp):             # <<<<<<<<<<<<<<
 *     global doUseRtp
 *     doUseRtp = doitp
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_3set_use_rtp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_set_use_rtp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":83
 *     doUseRtp = doitp
 * 
 * def set_initialization_type (type):             # <<<<<<<<<<<<<<
 *     global initializer
 *     type = type.upper() if isinstance(type, str) else type
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_5set_initialization_type, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_set_initialization_type, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":104
 *     print "New QNET initializer = ", initializer
 * 
 * def get_initializer (): return initializer             # <<<<<<<<<<<<<<
 * 
 * def set_slice_sorted (val):
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_7get_initializer, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_initializer, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":106
 * def get_initializer (): return initializer
 * 
 * def set_slice_sorted (val):             # <<<<<<<<<<<<<<
 *     global is_slice_sorted
 *     is_slice_sorted = val
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_9set_slice_sorted, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_set_slice_sorted, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":115
 * # stastics
 * 
 * cdef int nreject = 0             # <<<<<<<<<<<<<<
 * cdef int nevents = 0
 * cdef int nrtp_reject = 0
 */
  __pyx_v_4qnet_nreject = 0;

  /* "qnet.pyx":116
 * 
 * cdef int nreject = 0
 * cdef int nevents = 0             # <<<<<<<<<<<<<<
 * cdef int nrtp_reject = 0
 * cdef int nrtp_calls = 0
 */
  __pyx_v_4qnet_nevents = 0;

  /* "qnet.pyx":117
 * cdef int nreject = 0
 * cdef int nevents = 0
 * cdef int nrtp_reject = 0             # <<<<<<<<<<<<<<
 * cdef int nrtp_calls = 0
 * cdef int diff_len = 0
 */
  __pyx_v_4qnet_nrtp_reject = 0;

  /* "qnet.pyx":118
 * cdef int nevents = 0
 * cdef int nrtp_reject = 0
 * cdef int nrtp_calls = 0             # <<<<<<<<<<<<<<
 * cdef int diff_len = 0
 * cdef int num_diff = 0
 */
  __pyx_v_4qnet_nrtp_calls = 0;

  /* "qnet.pyx":119
 * cdef int nrtp_reject = 0
 * cdef int nrtp_calls = 0
 * cdef int diff_len = 0             # <<<<<<<<<<<<<<
 * cdef int num_diff = 0
 * 
 */
  __pyx_v_4qnet_diff_len = 0;

  /* "qnet.pyx":120
 * cdef int nrtp_calls = 0
 * cdef int diff_len = 0
 * cdef int num_diff = 0             # <<<<<<<<<<<<<<
 * 
 * def reset_stats():
 */
  __pyx_v_4qnet_num_diff = 0;

  /* "qnet.pyx":122
 * cdef int num_diff = 0
 * 
 * def reset_stats():             # <<<<<<<<<<<<<<
 *     global nreject, nevents, nrtp_calls, nrtp_reject, diff_len
 *     nreject = 0
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_11reset_stats, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_reset_stats, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":131
 *     num_diff = 0
 * 
 * def stats():             # <<<<<<<<<<<<<<
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_13stats, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_stats, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":134
 *     return {'nreject':nreject, 'nevents':nevents, 'nrtp_calls':nrtp_calls, 'nrtp_reject':nrtp_reject, 'diff_len':diff_len, 'num_diff':num_diff}
 * 
 * reset_stats()             # <<<<<<<<<<<<<<
 * 
 * # end stats
 */
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_reset_stats); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_COMPILING_IN_CPYTHON && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  if (__pyx_t_6) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else {
    __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":138
 * # end stats
 * 
 * INITIAL_QID = 0             # <<<<<<<<<<<<<<
 * INITIAL_STATE = 0
 * 
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INITIAL_QID, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":139
 * 
 * INITIAL_QID = 0
 * INITIAL_STATE = 0             # <<<<<<<<<<<<<<
 * 
 * cdef class GGkGibbs
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INITIAL_STATE, __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":529
 *             raise NotImplementedError()
 * 
 *     NUM_TRIES = 1  # Number of tries for random GGk initializations             # <<<<<<<<<<<<<<
 * 
 *     def gibbs_initialize (self, a, samplePaths=False):
 */
  if (PyDict_SetItem((PyObject *)__pyx_ptype_4qnet_Qnet->tp_dict, __pyx_n_s_NUM_TRIES, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyType_Modified(__pyx_ptype_4qnet_Qnet);

  /* "qnet.pyx":741
 * 
 *     ## Computing the exact Gibbs kernel
 *     def gibbs_kernel (self, Arrivals arrv_from, Arrivals arrv_to, double lik=-INFINITY):             # <<<<<<<<<<<<<<
 * 
 *       cdef Event evt, evt_next
 */
  __pyx_k__10 = (-INFINITY);

  /* "qnet.pyx":1047
 * # Utilities
 * 
 * def is_sampled_by_task (arrv):             # <<<<<<<<<<<<<<
 *     tasks_in = {}
 *     tasks_out = {}
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_15is_sampled_by_task, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_sampled_by_task, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1047; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1063
 *     return True
 * 
 * def has_tau (Event evt):             # <<<<<<<<<<<<<<
 *     cdef Event byq = evt.prev_byq
 * #    if evt.prev_byt != None: return False
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_17has_tau, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_has_tau, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1063; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1071
 *         return not evt.obs_a
 * 
 * def create_qp (a, reg):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv = a
 *     ne = arrv.max_eidx()
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_19create_qp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_create_qp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1071; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1178
 * 
 * 
 * def compute_obs_means (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     tots = [1e-5] * arrv.num_queues()
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_21compute_obs_means, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_obs_means, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1190
 *     return tots
 * 
 * def compute_obs_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     last_a = 0.
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_23compute_obs_mean_ia, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_obs_mean_ia, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1203
 *     else: return 0
 * 
 * def compute_mean_ia (arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     times = []
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_25compute_mean_ia, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_mean_ia, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1213
 *     return numpy.mean (times)
 * 
 * def sorted_uniforms (n, L, U):             # <<<<<<<<<<<<<<
 *     l = [ uniform(L,U) for i in xrange (n) ]
 *     l.sort()
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_27sorted_uniforms, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sorted_uniforms, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1218
 *     return l
 * 
 * def setup_minilp (Arrivals arrv, reg):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_29setup_minilp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_setup_minilp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1268
 *     return lp
 * 
 * def astr (evt):             # <<<<<<<<<<<<<<
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_31astr, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_astr, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1270
 * def astr (evt):
 *     return "a[%d]" % evt.eid if not evt.obs_a else "%.10f" % evt.a
 * def dstr (evt):             # <<<<<<<<<<<<<<
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_33dstr, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dstr, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1272
 * def dstr (evt):
 *     return "d[%d]" % evt.eid if not evt.obs_d else "%.10f" % evt.d
 * def compactify_soln (arrv, soln):             # <<<<<<<<<<<<<<
 *     for evt in arrv:
 *         if evt.obs_a: soln["a[%d]" % evt.eid] = evt.a
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_35compactify_soln, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compactify_soln, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1286
 *     return "%-75s%s\n%-75s%s\n%-75s%s" % (byq, byt_minus1, evt, byt, next_byq, byt_plus1)
 * 
 * def _compute_task_order (Event evt):             # <<<<<<<<<<<<<<
 *     i = 0
 *     while evt.prev_byt:
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_37_compute_task_order, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_task_order, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1305
 * 
 * 
 * def display_diff_list (arrv, Event e, diff_list):             # <<<<<<<<<<<<<<
 *     result = "EID: %d\n" % e.eid
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_39display_diff_list, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_display_diff_list, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1314
 *     return result
 * 
 * def any_zero_service (diff_list):             # <<<<<<<<<<<<<<
 *     for evt in diff_list:
 *         if evt.s < 0:
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_41any_zero_service, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_any_zero_service, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1324
 * # closure emulation
 * 
 * NUM_INTEGRATION_POINTS = 3             # <<<<<<<<<<<<<<
 * 
 * # true gibbs distribution
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NUM_INTEGRATION_POINTS, __pyx_int_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "qnet.pyx":1393
 * # Initializers
 * 
 * def gibbs_initialize_via_dfn1 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_43gibbs_initialize_via_dfn1, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_dfn1, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1401
 *     return result
 * 
 * def gibbs_initialize_via_dfn2 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     inner = gibbs_initialize_via_dfn (net, arrv, 1.0)
 *     result = gibbs_initialize_via_dfn (net, inner, 1.0)
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_45gibbs_initialize_via_dfn2, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_dfn2, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1410
 *     return result
 * 
 * def gibbs_initialize_via_dfn3 (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     result = gibbs_initialize_via_dfn (net, arrv, 1.1)
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_47gibbs_initialize_via_dfn3, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_dfn3, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1418
 *     return result
 * 
 * def insert_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, evt0, evt1
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_49insert_implied_tasks, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_insert_implied_tasks, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1418; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1450
 *     return arrv
 * 
 * def initialize_inserting_implied_tasks (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     insert_implied_tasks (net, arrv)
 *     return initializer (net, arrv)
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_51initialize_inserting_implied_tasks, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_initialize_inserting_implied_tas, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1454
 *     return initializer (net, arrv)
 * 
 * def gibbs_initialize_via_dfn (Qnet net, Arrivals arrv, scale):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_53gibbs_initialize_via_dfn, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_dfn, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1557
 * 
 * 
 * def init_insert_observed_tasks (Arrivals arrv, Arrivals result, add_initial=True):             # <<<<<<<<<<<<<<
 *     cdef Event evt_new, evt
 *     for tid in arrv.all_tasks():
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_55init_insert_observed_tasks, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_init_insert_observed_tasks, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1574
 * 
 *     # now add unobserved initial events
 * def init_add_initial_events (Qnet net, Arrivals arrv, Arrivals result):             # <<<<<<<<<<<<<<
 *     cdef Event evt
 *     cdef Queue q
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_57init_add_initial_events, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_init_add_initial_events, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1574; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1610
 *     return heap
 * 
 * def gibbs_initialize_via_order (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_59gibbs_initialize_via_order, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_order, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1688
 *     return result
 * 
 * def gibbs_initialize_for_gg1r (Qnet net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     # Initialize by sampling response times from initial distribution
 *     #  Assumes that data is sampled by task
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_61gibbs_initialize_for_gg1r, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_for_gg1r, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1688; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1770
 *     return result
 * 
 * def diff_list_definitely_bad (net, arrv, q, diff_list):             # <<<<<<<<<<<<<<
 *     for evt1 in diff_list:
 *         if evt1.s < 0: return True
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_63diff_list_definitely_bad, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_diff_list_definitely_bad, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1777
 *     return False
 * 
 * def sample_d_until_acceptance (net, Arrivals arrv, Event evt, service_only=False, scale=1.0):             # <<<<<<<<<<<<<<
 *     cdef Queue q = evt.q
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_65sample_d_until_acceptance, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sample_d_until_acceptance, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1777; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1838
 *     return d_new, diff_list
 * 
 * def heap_from_arrivals (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     heap = []
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_67heap_from_arrivals, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_heap_from_arrivals, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1838; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1850
 *     return heap
 * 
 * def gibbs_initialize_via_lp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_69gibbs_initialize_via_lp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_lp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1850; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1889
 *                 print "Initialization at %s failed: %s" % (reg, e)
 * 
 * def visualize_initialization_lp (net, Arrivals arrv):             # <<<<<<<<<<<<<<
 *     cdef Event evt, byq, byt
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_71visualize_initialization_lp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_visualize_initialization_lp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1889; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1936
 *     f.close ()
 * 
 * def gibbs_initialize_via_minilp (net, Arrivals arrv_in):             # <<<<<<<<<<<<<<
 *     cdef Arrivals arrv
 *     cdef Event evt
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_73gibbs_initialize_via_minilp, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_via_minilp, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1936; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1994
 * 
 * # requires Markovization
 * def estimate_minilp_params (net, arrv):             # <<<<<<<<<<<<<<
 *     mu_s = qstats.mean_task_service (arrv)
 *     N = qstats.mean_task_length (arrv)
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_75estimate_minilp_params, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_estimate_minilp_params, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1994; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":2001
 * 
 * 
 * def gibbs_initialize_for_ps (net, arrv):             # <<<<<<<<<<<<<<
 *     cdef Event e, evt, dup
 *     cdef Queue q
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_77gibbs_initialize_for_ps, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gibbs_initialize_for_ps, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2001; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":2156
 * #     return result
 * 
 * def null_initializer (net, arrv): return arrv             # <<<<<<<<<<<<<<
 * 
 * #cas?? initializer = gibbs_initialize_via_order
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_79null_initializer, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_null_initializer, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":2159
 * 
 * #cas?? initializer = gibbs_initialize_via_order
 * initializer = gibbs_initialize_via_lp             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_gibbs_initialize_via_lp); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_XGOTREF(__pyx_v_4qnet_initializer);
  __Pyx_DECREF_SET(__pyx_v_4qnet_initializer, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_5);
  __pyx_t_5 = 0;

  /* "qnet.pyx":2162
 * 
 * 
 * def get_departure(evt): return evt.d             # <<<<<<<<<<<<<<
 * def get_arrival(evt): return evt.a
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_81get_departure, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_departure, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":2163
 * 
 * def get_departure(evt): return evt.d
 * def get_arrival(evt): return evt.a             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_4qnet_83get_arrival, NULL, __pyx_n_s_qnet); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_arrival, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 2163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "qnet.pyx":1
 * ##  Data structure for managing Arrivals.             # <<<<<<<<<<<<<<
 * ##   This needs to be really fast
 * 
 */
  __pyx_t_5 = PyDict_New(); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /*--- Wrapped vars code ---*/

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  if (__pyx_m) {
    if (__pyx_d) {
      __Pyx_AddTraceback("init qnet", __pyx_clineno, __pyx_lineno, __pyx_filename);
    }
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init qnet");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

/* Runtime support code */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif

static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
    if (s1 == s2) {
        return (equals == Py_EQ);
    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
        const char *ps1, *ps2;
        Py_ssize_t length = PyBytes_GET_SIZE(s1);
        if (length != PyBytes_GET_SIZE(s2))
            return (equals == Py_NE);
        ps1 = PyBytes_AS_STRING(s1);
        ps2 = PyBytes_AS_STRING(s2);
        if (ps1[0] != ps2[0]) {
            return (equals == Py_NE);
        } else if (length == 1) {
            return (equals == Py_EQ);
        } else {
            int result = memcmp(ps1, ps2, (size_t)length);
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
        return (equals == Py_NE);
    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
        return (equals == Py_NE);
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
#endif
}

static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
#if PY_MAJOR_VERSION < 3
    PyObject* owned_ref = NULL;
#endif
    int s1_is_unicode, s2_is_unicode;
    if (s1 == s2) {
        goto return_eq;
    }
    s1_is_unicode = PyUnicode_CheckExact(s1);
    s2_is_unicode = PyUnicode_CheckExact(s2);
#if PY_MAJOR_VERSION < 3
    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
        owned_ref = PyUnicode_FromObject(s2);
        if (unlikely(!owned_ref))
            return -1;
        s2 = owned_ref;
        s2_is_unicode = 1;
    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
        owned_ref = PyUnicode_FromObject(s1);
        if (unlikely(!owned_ref))
            return -1;
        s1 = owned_ref;
        s1_is_unicode = 1;
    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
        return __Pyx_PyBytes_Equals(s1, s2, equals);
    }
#endif
    if (s1_is_unicode & s2_is_unicode) {
        Py_ssize_t length;
        int kind;
        void *data1, *data2;
        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
            return -1;
        length = __Pyx_PyUnicode_GET_LENGTH(s1);
        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
            goto return_ne;
        }
        kind = __Pyx_PyUnicode_KIND(s1);
        if (kind != __Pyx_PyUnicode_KIND(s2)) {
            goto return_ne;
        }
        data1 = __Pyx_PyUnicode_DATA(s1);
        data2 = __Pyx_PyUnicode_DATA(s2);
        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
            goto return_ne;
        } else if (length == 1) {
            goto return_eq;
        } else {
            int result = memcmp(data1, data2, (size_t)(length * kind));
            #if PY_MAJOR_VERSION < 3
            Py_XDECREF(owned_ref);
            #endif
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & s2_is_unicode) {
        goto return_ne;
    } else if ((s2 == Py_None) & s1_is_unicode) {
        goto return_ne;
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
return_eq:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_EQ);
return_ne:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_NE);
#endif
}

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *result;
    ternaryfunc call = func->ob_type->tp_call;
    if (unlikely(!call))
        return PyObject_Call(func, arg, kw);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = (*call)(func, arg, kw);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_Restore(type, value, tb);
#endif
}
static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(type, value, tb);
#endif
}

#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    if (PyType_Check(type)) {
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
    }
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                if (PyObject_IsSubclass(instance_class, type)) {
                    type = instance_class;
                } else {
                    instance_class = NULL;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
#if PY_VERSION_HEX >= 0x03030000
    if (cause) {
#else
    if (cause && cause != Py_None) {
#endif
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
#if CYTHON_COMPILING_IN_PYPY
        PyObject *tmp_type, *tmp_value, *tmp_tb;
        PyErr_Fetch(tmp_type, tmp_value, tmp_tb);
        Py_INCREF(tb);
        PyErr_Restore(tmp_type, tmp_value, tb);
        Py_XDECREF(tmp_tb);
#else
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
#endif
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
    PyObject *self, *result;
    PyCFunction cfunc;
    cfunc = PyCFunction_GET_FUNCTION(func);
    self = PyCFunction_GET_SELF(func);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = cfunc(self, arg);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

#if CYTHON_COMPILING_IN_CPYTHON
static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_New(1);
    if (unlikely(!args)) return NULL;
    Py_INCREF(arg);
    PyTuple_SET_ITEM(args, 0, arg);
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || PyObject_TypeCheck(func, __pyx_CyFunctionType))) {
#else
    if (likely(PyCFunction_Check(func))) {
#endif
        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
            return __Pyx_PyObject_CallMethO(func, arg);
        }
    }
    return __Pyx__PyObject_CallOneArg(func, arg);
}
#else
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject* args = PyTuple_Pack(1, arg);
    return (likely(args)) ? __Pyx_PyObject_Call(func, args, NULL) : NULL;
}
#endif

#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || PyObject_TypeCheck(func, __pyx_CyFunctionType))) {
#else
    if (likely(PyCFunction_Check(func))) {
#endif
        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
            return __Pyx_PyObject_CallMethO(func, NULL);
        }
    }
    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
}
#endif

static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name) {
    PyObject *result;
#if CYTHON_COMPILING_IN_CPYTHON
    result = PyDict_GetItem(__pyx_d, name);
    if (likely(result)) {
        Py_INCREF(result);
    } else {
#else
    result = PyObject_GetItem(__pyx_d, name);
    if (!result) {
        PyErr_Clear();
#endif
        result = __Pyx_GetBuiltinName(name);
    }
    return result;
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_CheckExact(key)) || likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (PyUnicode_GET_SIZE(**name) != PyUnicode_GET_SIZE(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (PyUnicode_GET_SIZE(**argname) != PyUnicode_GET_SIZE(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

#if !CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values) {
    return PyObject_CallMethodObjArgs(sep, __pyx_n_s_join, values, NULL);
}
#endif

static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (wraparound & unlikely(i < 0)) i += PyList_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (wraparound & unlikely(i < 0)) i += PyTuple_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely((n >= 0) & (n < PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely((n >= 0) & (n < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (PyErr_ExceptionMatches(PyExc_OverflowError))
                        PyErr_Clear();
                    else
                        return NULL;
                }
            }
            return m->sq_item(o, i);
        }
    }
#else
    if (is_list || PySequence_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
    PyObject *method, *result = NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto bad;
#if CYTHON_COMPILING_IN_CPYTHON
    if (likely(PyMethod_Check(method))) {
        PyObject *self = PyMethod_GET_SELF(method);
        if (likely(self)) {
            PyObject *args;
            PyObject *function = PyMethod_GET_FUNCTION(method);
            args = PyTuple_New(2);
            if (unlikely(!args)) goto bad;
            Py_INCREF(self);
            PyTuple_SET_ITEM(args, 0, self);
            Py_INCREF(arg);
            PyTuple_SET_ITEM(args, 1, arg);
            Py_INCREF(function);
            Py_DECREF(method); method = NULL;
            result = __Pyx_PyObject_Call(function, args, NULL);
            Py_DECREF(args);
            Py_DECREF(function);
            return result;
        }
    }
#endif
    result = __Pyx_PyObject_CallOneArg(method, arg);
bad:
    Py_XDECREF(method);
    return result;
}

static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
    } else {
        PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
        if (unlikely(!retval))
            return -1;
        Py_DECREF(retval);
    }
    return 0;
}

static void __Pyx_RaiseArgumentTypeInvalid(const char* name, PyObject *obj, PyTypeObject *type) {
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
}
static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (likely(Py_TYPE(obj) == type)) return 1;
        #if PY_MAJOR_VERSION == 2
        else if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(PyObject_TypeCheck(obj, type))) return 1;
    }
    __Pyx_RaiseArgumentTypeInvalid(name, obj, type);
    return 0;
}

static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
    PyErr_Format(PyExc_ValueError,
                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
}

static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                 index, (index == 1) ? "" : "s");
}

static CYTHON_INLINE int __Pyx_IterFinish(void) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    PyObject* exc_type = tstate->curexc_type;
    if (unlikely(exc_type)) {
        if (likely(exc_type == PyExc_StopIteration) || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)) {
            PyObject *exc_value, *exc_tb;
            exc_value = tstate->curexc_value;
            exc_tb = tstate->curexc_traceback;
            tstate->curexc_type = 0;
            tstate->curexc_value = 0;
            tstate->curexc_traceback = 0;
            Py_DECREF(exc_type);
            Py_XDECREF(exc_value);
            Py_XDECREF(exc_tb);
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#else
    if (unlikely(PyErr_Occurred())) {
        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
            PyErr_Clear();
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#endif
}

static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
    if (unlikely(retval)) {
        Py_DECREF(retval);
        __Pyx_RaiseTooManyValuesError(expected);
        return -1;
    } else {
        return __Pyx_IterFinish();
    }
    return 0;
}

static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(PyObject_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
    PyObject *method, *result = NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto bad;
#if CYTHON_COMPILING_IN_CPYTHON
    if (likely(PyMethod_Check(method))) {
        PyObject *self = PyMethod_GET_SELF(method);
        if (likely(self)) {
            PyObject *function = PyMethod_GET_FUNCTION(method);
            result = __Pyx_PyObject_CallOneArg(function, self);
            Py_DECREF(method);
            return result;
        }
    }
#endif
    result = __Pyx_PyObject_CallNoArg(method);
    Py_DECREF(method);
bad:
    return result;
}

static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
}

static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
    if (t == Py_None) {
      __Pyx_RaiseNoneNotIterableError();
    } else if (PyTuple_GET_SIZE(t) < index) {
      __Pyx_RaiseNeedMoreValuesError(PyTuple_GET_SIZE(t));
    } else {
      __Pyx_RaiseTooManyValuesError(index);
    }
}

static CYTHON_INLINE int __Pyx_unpack_tuple2(PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2,
                                             int is_tuple, int has_known_size, int decref_tuple) {
    Py_ssize_t index;
    PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
    if (!is_tuple && unlikely(!PyTuple_Check(tuple))) {
        iternextfunc iternext;
        iter = PyObject_GetIter(tuple);
        if (unlikely(!iter)) goto bad;
        if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
        iternext = Py_TYPE(iter)->tp_iternext;
        value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
        value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
        if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
        Py_DECREF(iter);
    } else {
        if (!has_known_size && unlikely(PyTuple_GET_SIZE(tuple) != 2)) {
            __Pyx_UnpackTupleError(tuple, 2);
            goto bad;
        }
#if CYTHON_COMPILING_IN_PYPY
        value1 = PySequence_ITEM(tuple, 0);
        if (unlikely(!value1)) goto bad;
        value2 = PySequence_ITEM(tuple, 1);
        if (unlikely(!value2)) goto bad;
#else
        value1 = PyTuple_GET_ITEM(tuple, 0);
        value2 = PyTuple_GET_ITEM(tuple, 1);
        Py_INCREF(value1);
        Py_INCREF(value2);
#endif
        if (decref_tuple) { Py_DECREF(tuple); }
    }
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
unpacking_failed:
    if (!has_known_size && __Pyx_IterFinish() == 0)
        __Pyx_RaiseNeedMoreValuesError(index);
bad:
    Py_XDECREF(iter);
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
}

static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* iterable, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_source_is_dict) {
    is_dict = is_dict || likely(PyDict_CheckExact(iterable));
    *p_source_is_dict = is_dict;
#if !CYTHON_COMPILING_IN_PYPY
    if (is_dict) {
        *p_orig_length = PyDict_Size(iterable);
        Py_INCREF(iterable);
        return iterable;
    }
#endif
    *p_orig_length = 0;
    if (method_name) {
        PyObject* iter;
        iterable = __Pyx_PyObject_CallMethod0(iterable, method_name);
        if (!iterable)
            return NULL;
#if !CYTHON_COMPILING_IN_PYPY
        if (PyTuple_CheckExact(iterable) || PyList_CheckExact(iterable))
            return iterable;
#endif
        iter = PyObject_GetIter(iterable);
        Py_DECREF(iterable);
        return iter;
    }
    return PyObject_GetIter(iterable);
}
static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* iter_obj, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int source_is_dict) {
    PyObject* next_item;
#if !CYTHON_COMPILING_IN_PYPY
    if (source_is_dict) {
        PyObject *key, *value;
        if (unlikely(orig_length != PyDict_Size(iter_obj))) {
            PyErr_SetString(PyExc_RuntimeError, "dictionary changed size during iteration");
            return -1;
        }
        if (unlikely(!PyDict_Next(iter_obj, ppos, &key, &value))) {
            return 0;
        }
        if (pitem) {
            PyObject* tuple = PyTuple_New(2);
            if (unlikely(!tuple)) {
                return -1;
            }
            Py_INCREF(key);
            Py_INCREF(value);
            PyTuple_SET_ITEM(tuple, 0, key);
            PyTuple_SET_ITEM(tuple, 1, value);
            *pitem = tuple;
        } else {
            if (pkey) {
                Py_INCREF(key);
                *pkey = key;
            }
            if (pvalue) {
                Py_INCREF(value);
                *pvalue = value;
            }
        }
        return 1;
    } else if (PyTuple_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyTuple_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyTuple_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else if (PyList_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyList_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyList_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else
#endif
    {
        next_item = PyIter_Next(iter_obj);
        if (unlikely(!next_item)) {
            return __Pyx_IterFinish();
        }
    }
    if (pitem) {
        *pitem = next_item;
    } else if (pkey && pvalue) {
        if (__Pyx_unpack_tuple2(next_item, pkey, pvalue, source_is_dict, source_is_dict, 1))
            return -1;
    } else if (pkey) {
        *pkey = next_item;
    } else {
        *pvalue = next_item;
    }
    return 1;
}

static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (PyErr_ExceptionMatches(PyExc_OverflowError))
                    PyErr_Clear();
                else
                    goto bad;
            }
        }
        return ms->sq_slice(obj, cstart, cstop);
    }
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_subscript))
#endif
    {
        PyObject* result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_COMPILING_IN_CPYTHON
        result = mp->mp_subscript(obj, py_slice);
#else
        result = PyObject_GetItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    PyErr_Format(PyExc_TypeError,
        "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
bad:
    return NULL;
}

static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t a, Py_ssize_t b) {
    Py_ssize_t q = a / b;
    Py_ssize_t r = a - q*b;
    q -= ((r != 0) & ((r ^ b) < 0));
    return q;
}

static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
#else
    PyErr_GetExcInfo(type, value, tb);
#endif
}
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(type, value, tb);
#endif
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_COMPILING_IN_CPYTHON
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_COMPILING_IN_CPYTHON
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
}

static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
                                  int full_traceback) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    if (full_traceback) {
        Py_XINCREF(old_exc);
        Py_XINCREF(old_val);
        Py_XINCREF(old_tb);
        __Pyx_ErrRestore(old_exc, old_val, old_tb);
        PyErr_PrintEx(1);
    }
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
}

static PyObject* __Pyx__PyObject_PopIndex(PyObject* L, PyObject* py_ix) {
    PyObject *r;
    if (unlikely(!py_ix)) return NULL;
    r = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_pop, py_ix);
    Py_DECREF(py_ix);
    return r;
}
static PyObject* __Pyx__PyList_PopIndex(PyObject* L, Py_ssize_t ix) {
#if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = PyList_GET_SIZE(L);
    if (likely(size > (((PyListObject*)L)->allocated >> 1))) {
        Py_ssize_t cix = ix;
        if (cix < 0) {
            cix += size;
        }
        if (likely(0 <= cix && cix < size)) {
            PyObject* v = PyList_GET_ITEM(L, cix);
            Py_SIZE(L) -= 1;
            size -= 1;
            memmove(&PyList_GET_ITEM(L, cix), &PyList_GET_ITEM(L, cix+1), (size_t)(size-cix)*sizeof(PyObject*));
            return v;
        }
    }
#endif
    return __Pyx__PyObject_PopIndex(L, PyInt_FromSsize_t(ix));
}

static CYTHON_INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck) {
#if CYTHON_COMPILING_IN_CPYTHON
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
        if ((!boundscheck) || likely((n >= 0) & (n < PyList_GET_SIZE(o)))) {
            PyObject* old = PyList_GET_ITEM(o, n);
            Py_INCREF(v);
            PyList_SET_ITEM(o, n, v);
            Py_DECREF(old);
            return 1;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_ass_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (PyErr_ExceptionMatches(PyExc_OverflowError))
                        PyErr_Clear();
                    else
                        return -1;
                }
            }
            return m->sq_ass_item(o, i, v);
        }
    }
#else
#if CYTHON_COMPILING_IN_PYPY
    if (is_list || (PySequence_Check(o) && !PyDict_Check(o))) {
#else
    if (is_list || PySequence_Check(o)) {
#endif
        return PySequence_SetItem(o, i, v);
    }
#endif
    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
}

static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX >= 0x02070000
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#else
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItem(dict, __pyx_n_s_pyx_vtable, ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

static void* __Pyx_GetVtable(PyObject *dict) {
    void* ptr;
    PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
    if (!ob)
        goto bad;
#if PY_VERSION_HEX >= 0x02070000
    ptr = PyCapsule_GetPointer(ob, 0);
#else
    ptr = PyCObject_AsVoidPtr(ob);
#endif
    if (!ptr && !PyErr_Occurred())
        PyErr_SetString(PyExc_RuntimeError, "invalid vtable found for imported type");
    Py_DECREF(ob);
    return ptr;
bad:
    Py_XDECREF(ob);
    return NULL;
}

static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = (start + end) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, (size_t)new_max*sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,
        0,
        0,
        0,
        0,
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    py_code = __pyx_find_code_object(c_line ? c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? c_line : py_line, py_code);
    }
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        __pyx_d,      /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = py_line;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
    const int neg_one = (int) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(int) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(int),
                                     little, !is_unsigned);
    }
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_VERSION_HEX < 0x03030000
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.')) {
                #if PY_VERSION_HEX < 0x03030000
                PyObject *py_level = PyInt_FromLong(1);
                if (!py_level)
                    goto bad;
                module = PyObject_CallFunctionObjArgs(py_import,
                    name, global_dict, empty_dict, list, py_level, NULL);
                Py_DECREF(py_level);
                #else
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                #endif
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0;
        }
        #endif
        if (!module) {
            #if PY_VERSION_HEX < 0x03030000
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
bad:
    #if PY_VERSION_HEX < 0x03030000
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)       \
    {                                                                     \
        func_type value = func_value;                                     \
        if (sizeof(target_type) < sizeof(func_type)) {                    \
            if (unlikely(value != (func_type) (target_type) value)) {     \
                func_type zero = 0;                                       \
                if (is_unsigned && unlikely(value < zero))                \
                    goto raise_neg_overflow;                              \
                else                                                      \
                    goto raise_overflow;                                  \
            }                                                             \
        }                                                                 \
        return (target_type) value;                                       \
    }

#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
 #endif
#endif

static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
    const int neg_one = (int) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(int) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            switch (Py_SIZE(x)) {
                case  0: return 0;
                case  1: __PYX_VERIFY_RETURN_INT(int, digit, ((PyLongObject*)x)->ob_digit[0]);
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
            if (sizeof(int) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(int, unsigned long, PyLong_AsUnsignedLong(x))
            } else if (sizeof(int) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(int, unsigned long long, PyLong_AsUnsignedLongLong(x))
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            switch (Py_SIZE(x)) {
                case  0: return 0;
                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +(((PyLongObject*)x)->ob_digit[0]));
                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, -(sdigit) ((PyLongObject*)x)->ob_digit[0]);
            }
 #endif
#endif
            if (sizeof(int) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(int, long, PyLong_AsLong(x))
            } else if (sizeof(int) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(int, long long, PyLong_AsLongLong(x))
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            int val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to int");
    return (int) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to int");
    return (int) -1;
}

#if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject((char *)"stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}
static int __Pyx_Print(PyObject* f, PyObject *arg_tuple, int newline) {
    int i;
    if (!f) {
        if (!(f = __Pyx_GetStdout()))
            return -1;
    }
    Py_INCREF(f);
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        PyObject* v;
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                goto error;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            goto error;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0) {
                switch (s[len-1]) {
                    case ' ': break;
                    case '\f': case '\r': case '\n': case '\t': case '\v':
                        PyFile_SoftSpace(f, 0);
                        break;
                    default:  break;
                }
            }
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            goto error;
        PyFile_SoftSpace(f, 0);
    }
    Py_DECREF(f);
    return 0;
error:
    Py_DECREF(f);
    return -1;
}
#else
static int __Pyx_Print(PyObject* stream, PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (unlikely(!__pyx_print)) {
        __pyx_print = PyObject_GetAttr(__pyx_b, __pyx_n_s_print);
        if (!__pyx_print)
            return -1;
    }
    if (stream) {
        kwargs = PyDict_New();
        if (unlikely(!kwargs))
            return -1;
        if (unlikely(PyDict_SetItem(kwargs, __pyx_n_s_file, stream) < 0))
            goto bad;
        if (!newline) {
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (unlikely(!end_string))
                goto bad;
            if (PyDict_SetItem(kwargs, __pyx_n_s_end, end_string) < 0) {
                Py_DECREF(end_string);
                goto bad;
            }
            Py_DECREF(end_string);
        }
    } else if (!newline) {
        if (unlikely(!__pyx_print_kwargs)) {
            __pyx_print_kwargs = PyDict_New();
            if (unlikely(!__pyx_print_kwargs))
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (unlikely(!end_string))
                return -1;
            if (PyDict_SetItem(__pyx_print_kwargs, __pyx_n_s_end, end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (unlikely(kwargs) && (kwargs != __pyx_print_kwargs))
        Py_DECREF(kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
bad:
    if (kwargs != __pyx_print_kwargs)
        Py_XDECREF(kwargs);
    return -1;
}
#endif

static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
    const long neg_one = (long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
        } else if (sizeof(long) <= sizeof(unsigned long long)) {
            return PyLong_FromUnsignedLongLong((unsigned long long) value);
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(long long)) {
            return PyLong_FromLongLong((long long) value);
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
    }
}

#if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION < 3
static int __Pyx_PrintOne(PyObject* f, PyObject *o) {
    if (!f) {
        if (!(f = __Pyx_GetStdout()))
            return -1;
    }
    Py_INCREF(f);
    if (PyFile_SoftSpace(f, 0)) {
        if (PyFile_WriteString(" ", f) < 0)
            goto error;
    }
    if (PyFile_WriteObject(o, f, Py_PRINT_RAW) < 0)
        goto error;
    if (PyFile_WriteString("\n", f) < 0)
        goto error;
    Py_DECREF(f);
    return 0;
error:
    Py_DECREF(f);
    return -1;
    /* the line below is just to avoid C compiler
     * warnings about unused functions */
    return __Pyx_Print(f, NULL, 0);
}
#else
static int __Pyx_PrintOne(PyObject* stream, PyObject *o) {
    int res;
    PyObject* arg_tuple = PyTuple_Pack(1, o);
    if (unlikely(!arg_tuple))
        return -1;
    res = __Pyx_Print(stream, arg_tuple, 1);
    Py_DECREF(arg_tuple);
    return res;
}
#endif

static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
    const long neg_one = (long) -1, const_zero = 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            switch (Py_SIZE(x)) {
                case  0: return 0;
                case  1: __PYX_VERIFY_RETURN_INT(long, digit, ((PyLongObject*)x)->ob_digit[0]);
            }
 #endif
#endif
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
            if (sizeof(long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT(long, unsigned long, PyLong_AsUnsignedLong(x))
            } else if (sizeof(long) <= sizeof(unsigned long long)) {
                __PYX_VERIFY_RETURN_INT(long, unsigned long long, PyLong_AsUnsignedLongLong(x))
            }
        } else {
#if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
 #if CYTHON_USE_PYLONG_INTERNALS
            switch (Py_SIZE(x)) {
                case  0: return 0;
                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +(((PyLongObject*)x)->ob_digit[0]));
                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, -(sdigit) ((PyLongObject*)x)->ob_digit[0]);
            }
 #endif
#endif
            if (sizeof(long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT(long, long, PyLong_AsLong(x))
            } else if (sizeof(long) <= sizeof(long long)) {
                __PYX_VERIFY_RETURN_INT(long, long long, PyLong_AsLongLong(x))
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            long val;
            PyObject *v = __Pyx_PyNumber_Int(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to long");
    return (long) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to long");
    return (long) -1;
}

static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        return PyErr_WarnEx(NULL, message, 1);
    }
    return 0;
}

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;
    py_name = __Pyx_PyIdentifier_FromString(name);
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    size_t size, int strict)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;
    char warning[200];
    Py_ssize_t basicsize;
#ifdef Py_LIMITED_API
    PyObject *py_basicsize;
#endif
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    py_name = __Pyx_PyIdentifier_FromString(class_name);
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s.%.200s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifndef Py_LIMITED_API
    basicsize = ((PyTypeObject *)result)->tp_basicsize;
#else
    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
    if (!py_basicsize)
        goto bad;
    basicsize = PyLong_AsSsize_t(py_basicsize);
    Py_DECREF(py_basicsize);
    py_basicsize = 0;
    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
        goto bad;
#endif
    if (!strict && (size_t)basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning),
            "%s.%s size changed, may indicate binary incompatibility",
            module_name, class_name);
        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
    }
    else if ((size_t)basicsize != size) {
        PyErr_Format(PyExc_ValueError,
            "%.200s.%.200s has the wrong size, try recompiling",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return NULL;
}
#endif

#ifndef __PYX_HAVE_RT_ImportFunction
#define __PYX_HAVE_RT_ImportFunction
static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
    PyObject *d = 0;
    PyObject *cobj = 0;
    union {
        void (*fp)(void);
        void *p;
    } tmp;
    d = PyObject_GetAttrString(module, (char *)"__pyx_capi__");
    if (!d)
        goto bad;
    cobj = PyDict_GetItemString(d, funcname);
    if (!cobj) {
        PyErr_Format(PyExc_ImportError,
            "%.200s does not export expected C function %.200s",
                PyModule_GetName(module), funcname);
        goto bad;
    }
#if PY_VERSION_HEX >= 0x02070000
    if (!PyCapsule_IsValid(cobj, sig)) {
        PyErr_Format(PyExc_TypeError,
            "C function %.200s.%.200s has wrong signature (expected %.500s, got %.500s)",
             PyModule_GetName(module), funcname, sig, PyCapsule_GetName(cobj));
        goto bad;
    }
    tmp.p = PyCapsule_GetPointer(cobj, sig);
#else
    {const char *desc, *s1, *s2;
    desc = (const char *)PyCObject_GetDesc(cobj);
    if (!desc)
        goto bad;
    s1 = desc; s2 = sig;
    while (*s1 != '\0' && *s1 == *s2) { s1++; s2++; }
    if (*s1 != *s2) {
        PyErr_Format(PyExc_TypeError,
            "C function %.200s.%.200s has wrong signature (expected %.500s, got %.500s)",
             PyModule_GetName(module), funcname, sig, desc);
        goto bad;
    }
    tmp.p = PyCObject_AsVoidPtr(cobj);}
#endif
    *f = tmp.fp;
    if (!(*f))
        goto bad;
    Py_DECREF(d);
    return 0;
bad:
    Py_XDECREF(d);
    return -1;
}
#endif

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
}
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
#if PY_VERSION_HEX < 0x03030000
        char* defenc_c;
        PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
        if (!defenc) return NULL;
        defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        {
            char* end = defenc_c + PyBytes_GET_SIZE(defenc);
            char* c;
            for (c = defenc_c; c < end; c++) {
                if ((unsigned char) (*c) >= 128) {
                    PyUnicode_AsASCIIString(o);
                    return NULL;
                }
            }
        }
#endif
        *length = PyBytes_GET_SIZE(defenc);
        return defenc_c;
#else
        if (__Pyx_PyUnicode_READY(o) == -1) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        if (PyUnicode_IS_ASCII(o)) {
            *length = PyUnicode_GET_LENGTH(o);
            return PyUnicode_AsUTF8(o);
        } else {
            PyUnicode_AsASCIIString(o);
            return NULL;
        }
#else
        return PyUnicode_AsUTF8AndSize(o, length);
#endif
#endif
    } else
#endif
#if !CYTHON_COMPILING_IN_PYPY
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_MAJOR_VERSION < 3
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%.4s__ returned non-%.4s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b)))
      return PyInt_AS_LONG(b);
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
     #if CYTHON_USE_PYLONG_INTERNALS
       switch (Py_SIZE(b)) {
       case -1: return -(sdigit)((PyLongObject*)b)->ob_digit[0];
       case  0: return 0;
       case  1: return ((PyLongObject*)b)->ob_digit[0];
       }
     #endif
    #endif
    return PyLong_AsSsize_t(b);
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
    return PyInt_FromSize_t(ival);
}


#endif /* Py_PYTHON_H */
