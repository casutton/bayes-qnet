/* Generated by Cython 0.25.2 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03020000)
    #error Cython requires Python 2.6+ or Python 3.2+.
#else
#define CYTHON_ABI "0_25_2"
#include <stddef.h>
#ifndef offsetof
  #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#ifndef HAVE_LONG_LONG
  #if PY_VERSION_HEX >= 0x03030000 || (PY_MAJOR_VERSION == 2 && PY_VERSION_HEX >= 0x02070000)
    #define HAVE_LONG_LONG
  #endif
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
  #define CYTHON_COMPILING_IN_PYPY 1
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #undef CYTHON_USE_ASYNC_SLOTS
  #define CYTHON_USE_ASYNC_SLOTS 0
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #undef CYTHON_AVOID_BORROWED_REFS
  #define CYTHON_AVOID_BORROWED_REFS 1
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
#elif defined(PYSTON_VERSION)
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 1
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #undef CYTHON_USE_ASYNC_SLOTS
  #define CYTHON_USE_ASYNC_SLOTS 0
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
#else
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 1
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #if PY_MAJOR_VERSION < 3
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #if PY_VERSION_HEX < 0x02070000
    #undef CYTHON_USE_PYLONG_INTERNALS
    #define CYTHON_USE_PYLONG_INTERNALS 0
  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
    #define CYTHON_USE_PYLONG_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_PYLIST_INTERNALS
    #define CYTHON_USE_PYLIST_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #if PY_VERSION_HEX < 0x030300F0
    #undef CYTHON_USE_UNICODE_WRITER
    #define CYTHON_USE_UNICODE_WRITER 0
  #elif !defined(CYTHON_USE_UNICODE_WRITER)
    #define CYTHON_USE_UNICODE_WRITER 1
  #endif
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #ifndef CYTHON_FAST_THREAD_STATE
    #define CYTHON_FAST_THREAD_STATE 1
  #endif
  #ifndef CYTHON_FAST_PYCALL
    #define CYTHON_FAST_PYCALL 1
  #endif
#endif
#if !defined(CYTHON_FAST_PYCCALL)
#define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
#endif
#if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
  #undef SHIFT
  #undef BASE
  #undef MASK
#endif
#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
  #define Py_OptimizeFlag 0
#endif
#define __PYX_BUILD_PY_SSIZE_T "n"
#define CYTHON_FORMAT_SSIZE_T "z"
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyClass_Type
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyType_Type
#endif
#ifndef Py_TPFLAGS_CHECKTYPES
  #define Py_TPFLAGS_CHECKTYPES 0
#endif
#ifndef Py_TPFLAGS_HAVE_INDEX
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#ifndef Py_TPFLAGS_HAVE_NEWBUFFER
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#ifndef Py_TPFLAGS_HAVE_FINALIZE
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#ifndef METH_FASTCALL
  #define METH_FASTCALL 0x80
  typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject **args,
                                              Py_ssize_t nargs, PyObject *kwnames);
#else
  #define __Pyx_PyCFunctionFast _PyCFunctionFast
#endif
#if CYTHON_FAST_PYCCALL
#define __Pyx_PyFastCFunction_Check(func)\
    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST)))))
#else
#define __Pyx_PyFastCFunction_Check(func) 0
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
#else
  #define CYTHON_PEP393_ENABLED 0
  #define PyUnicode_1BYTE_KIND  1
  #define PyUnicode_2BYTE_KIND  2
  #define PyUnicode_4BYTE_KIND  4
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
#else
  #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
      PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
  #define PyObject_Malloc(s)   PyMem_Malloc(s)
  #define PyObject_Free(p)     PyMem_Free(p)
  #define PyObject_Realloc(p)  PyMem_Realloc(p)
#endif
#if CYTHON_COMPILING_IN_PYSTON
  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
#else
  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
#endif
#define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None)) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION < 3 && !defined(PyObject_ASCII)
  #define PyObject_ASCII(o)            PyObject_Repr(o)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
  #ifndef PyUnicode_InternFromString
    #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
  #endif
#endif
#if PY_VERSION_HEX < 0x030200A4
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : PyInstanceMethod_New(func))
#else
  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
#endif
#if CYTHON_USE_ASYNC_SLOTS
  #if PY_VERSION_HEX >= 0x030500B1
    #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
    #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
  #else
    typedef struct {
        unaryfunc am_await;
        unaryfunc am_aiter;
        unaryfunc am_anext;
    } __Pyx_PyAsyncMethodsStruct;
    #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
  #endif
#else
  #define __Pyx_PyType_AsAsync(obj) NULL
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
#ifndef CYTHON_MAYBE_UNUSED_VAR
#  if defined(__cplusplus)
     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
#  else
#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
#  endif
#endif
#ifndef CYTHON_NCP_UNUSED
# if CYTHON_COMPILING_IN_CPYTHON
#  define CYTHON_NCP_UNUSED
# else
#  define CYTHON_NCP_UNUSED CYTHON_UNUSED
# endif
#endif
#define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)

#ifndef CYTHON_INLINE
  #if defined(__clang__)
    #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
  #elif defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
  #define _USE_MATH_DEFINES
#endif
#include <math.h>
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif
#if defined(__CYGWIN__) && defined(_LDBL_EQ_DBL)
#define __Pyx_truncl trunc
#else
#define __Pyx_truncl truncl
#endif


#define __PYX_ERR(f_index, lineno, Ln_error) \
{ \
  __pyx_filename = __pyx_f[f_index]; __pyx_lineno = lineno; __pyx_clineno = __LINE__; goto Ln_error; \
}

#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#define __PYX_HAVE__arrivals
#define __PYX_HAVE_API__arrivals
#include "string.h"
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#ifdef PYREX_WITHOUT_ASSERTIONS
#define CYTHON_WITHOUT_ASSERTIONS
#endif

typedef struct {PyObject **p; const char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry;

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT 0
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_uchar_cast(c) ((unsigned char)c)
#define __Pyx_long_cast(x) ((long)x)
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (\
    (sizeof(type) < sizeof(Py_ssize_t))  ||\
    (sizeof(type) > sizeof(Py_ssize_t) &&\
          likely(v < (type)PY_SSIZE_T_MAX ||\
                 v == (type)PY_SSIZE_T_MAX)  &&\
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||\
                                v == (type)PY_SSIZE_T_MIN)))  ||\
    (sizeof(type) == sizeof(Py_ssize_t) &&\
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||\
                               v == (type)PY_SSIZE_T_MAX)))  )
#if defined (__cplusplus) && __cplusplus >= 201103L
    #include <cstdlib>
    #define __Pyx_sst_abs(value) std::abs(value)
#elif SIZEOF_INT >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) abs(value)
#elif SIZEOF_LONG >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) labs(value)
#elif defined (_MSC_VER) && defined (_M_X64)
    #define __Pyx_sst_abs(value) _abs64(value)
#elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define __Pyx_sst_abs(value) llabs(value)
#elif defined (__GNUC__)
    #define __Pyx_sst_abs(value) __builtin_llabs(value)
#else
    #define __Pyx_sst_abs(value) ((value<0) ? -value : value)
#endif
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyByteArray_FromString(s) PyByteArray_FromStringAndSize((const char*)s, strlen((const char*)s))
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyObject_AsSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
#define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
#define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
#define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
#define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
#if PY_MAJOR_VERSION < 3
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
{
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return (size_t)(u_end - u - 1);
}
#else
#define __Pyx_Py_UNICODE_strlen Py_UNICODE_strlen
#endif
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
#define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
#define __Pyx_PyBool_FromLong(b) ((b) ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False))
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
#if CYTHON_ASSUME_SAFE_MACROS
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
#else
#define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
#endif
#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    const char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    if (strcmp(default_encoding_c, "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (!ascii_chars_u) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
        Py_DECREF(ascii_chars_u);
        Py_DECREF(ascii_chars_b);
    }
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c));
    if (!__PYX_DEFAULT_STRING_ENCODING) goto bad;
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


/* Test for GCC > 2.95 */
#if defined(__GNUC__)     && (__GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)))
  #define likely(x)   __builtin_expect(!!(x), 1)
  #define unlikely(x) __builtin_expect(!!(x), 0)
#else /* !__GNUC__ or GCC < 2.95 */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */

static PyObject *__pyx_m;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static PyObject *__pyx_empty_unicode;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;


static const char *__pyx_f[] = {
  "arrivals.pyx",
  "arrivals.pxd",
  "distributions.pxd",
  "pwfun.pxd",
  "queues.pxd",
  "qnet.pxd",
};

/*--- Type declarations ---*/
struct __pyx_obj_13distributions_Distribution;
struct __pyx_obj_5pwfun_Pwfun;
struct __pyx_obj_5pwfun_Pwlin;
struct __pyx_obj_6queues_FactorTemplate;
struct __pyx_obj_6queues_Queue;
struct __pyx_obj_4qnet_Qnet;
struct __pyx_obj_8arrivals_Vars;
struct __pyx_obj_8arrivals_Event;
struct __pyx_obj_8arrivals_Arrivals;

/* "distributions.pxd":1
 * cdef class Distribution:             # <<<<<<<<<<<<<<
 *     cdef double _lpdf (self, double x)
 *     cdef double _mean (self)
 */
struct __pyx_obj_13distributions_Distribution {
  PyObject_HEAD
  struct __pyx_vtabstruct_13distributions_Distribution *__pyx_vtab;
};


/* "pwfun.pxd":1
 * cdef class Pwfun:             # <<<<<<<<<<<<<<
 *     cdef readonly object xs
 *     cdef readonly object derivs
 */
struct __pyx_obj_5pwfun_Pwfun {
  PyObject_HEAD
  struct __pyx_vtabstruct_5pwfun_Pwfun *__pyx_vtab;
  PyObject *xs;
  PyObject *derivs;
  PyObject *fns;
  int N;
  PyObject *OOR;
};


/* "pwfun.pxd":16
 * 
 * 
 * cdef class Pwlin:             # <<<<<<<<<<<<<<
 *     cdef object xs      # Points at which slope changes xs[0] is lower bound xs[-1] upper
 *     cdef object x_tan   # Points at which the tangent is taken.
 */
struct __pyx_obj_5pwfun_Pwlin {
  PyObject_HEAD
  struct __pyx_vtabstruct_5pwfun_Pwlin *__pyx_vtab;
  PyObject *xs;
  PyObject *x_tan;
  PyObject *heights;
  PyObject *derivs;
  PyObject *f;
  PyObject *fprime;
};


/* "queues.pxd":12
 * cdef Pwfun _departure_proposal (Arrivals arrv, Event e0)
 * 
 * cdef class FactorTemplate:             # <<<<<<<<<<<<<<
 *     cdef object estimate (self, evtl)
 *     cdef object serviceLikelihood (self, Event evt)
 */
struct __pyx_obj_6queues_FactorTemplate {
  PyObject_HEAD
  struct __pyx_vtabstruct_6queues_FactorTemplate *__pyx_vtab;
};


/* "queues.pxd":1
 * cdef class Queue             # <<<<<<<<<<<<<<
 * 
 * from distributions cimport Distribution
 */
struct __pyx_obj_6queues_Queue {
  PyObject_HEAD
  struct __pyx_vtabstruct_6queues_Queue *__pyx_vtab;
  PyObject *name;
  struct __pyx_obj_6queues_FactorTemplate *service;
};


/* "qnet.pxd":1
 * cdef class Qnet             # <<<<<<<<<<<<<<
 * 
 * from arrivals cimport Arrivals
 */
struct __pyx_obj_4qnet_Qnet {
  PyObject_HEAD
  struct __pyx_vtabstruct_4qnet_Qnet *__pyx_vtab;
  PyObject *queues;
  PyObject *templates;
  PyObject *fsm;
  PyObject *universe;
  PyObject *qname2id;
  PyObject *sname2id;
  int eidx;
};


/* "arrivals.pxd":8
 * cimport cython
 * 
 * cdef class Vars:             # <<<<<<<<<<<<<<
 *     cdef object map
 * 
 */
struct __pyx_obj_8arrivals_Vars {
  PyObject_HEAD
  PyObject *map;
};


/* "arrivals.pxd":1
 * cdef class Event             # <<<<<<<<<<<<<<
 * cdef class Arrivals
 * 
 */
struct __pyx_obj_8arrivals_Event {
  PyObject_HEAD
  struct __pyx_vtabstruct_8arrivals_Event *__pyx_vtab;
  int eid;
  int tid;
  struct __pyx_obj_6queues_Queue *q;
  int qid;
  int state;
  double a;
  double s;
  double c;
  double d;
  int obs_a;
  int obs_d;
  PyObject *prev_byt;
  PyObject *next_byt;
  PyObject *prev_byq;
  PyObject *next_byq;
  PyObject *arrv;
  int proc;
  int num_proc;
  double d_prev;
  double *d_proc_prev;
  struct __pyx_obj_8arrivals_Vars *auxiliaries;
};


/* "arrivals.pxd":2
 * cdef class Event
 * cdef class Arrivals             # <<<<<<<<<<<<<<
 * 
 * from queues cimport Queue
 */
struct __pyx_obj_8arrivals_Arrivals {
  PyObject_HEAD
  struct __pyx_vtabstruct_8arrivals_Arrivals *__pyx_vtab;
  struct __pyx_obj_4qnet_Qnet *net;
  PyObject *byq;
  PyObject *final_byq;
  PyObject *byt;
  PyObject *events;
  PyObject *_initial_events;
  PyObject *queue_orders;
  PyObject *ninq;
  PyObject *inq;
  PyObject *a2e_cache;
  PyObject *c2e_cache;
  int cap;
};



/* "distributions.pxd":1
 * cdef class Distribution:             # <<<<<<<<<<<<<<
 *     cdef double _lpdf (self, double x)
 *     cdef double _mean (self)
 */

struct __pyx_vtabstruct_13distributions_Distribution {
  double (*_lpdf)(struct __pyx_obj_13distributions_Distribution *, double);
  double (*_mean)(struct __pyx_obj_13distributions_Distribution *);
  PyObject *(*_sample)(struct __pyx_obj_13distributions_Distribution *, int);
  PyObject *(*_estimate)(struct __pyx_obj_13distributions_Distribution *, PyObject *);
  double (*_dx_lpdf)(struct __pyx_obj_13distributions_Distribution *, double);
  double (*_quantile)(struct __pyx_obj_13distributions_Distribution *, double);
};
static struct __pyx_vtabstruct_13distributions_Distribution *__pyx_vtabptr_13distributions_Distribution;


/* "pwfun.pxd":1
 * cdef class Pwfun:             # <<<<<<<<<<<<<<
 *     cdef readonly object xs
 *     cdef readonly object derivs
 */

struct __pyx_vtabstruct_5pwfun_Pwfun {
  double (*value)(struct __pyx_obj_5pwfun_Pwfun *, double);
  int (*_find_knot)(struct __pyx_obj_5pwfun_Pwfun *, double);
  double (*L)(struct __pyx_obj_5pwfun_Pwfun *);
  double (*U)(struct __pyx_obj_5pwfun_Pwfun *);
};
static struct __pyx_vtabstruct_5pwfun_Pwfun *__pyx_vtabptr_5pwfun_Pwfun;


/* "pwfun.pxd":16
 * 
 * 
 * cdef class Pwlin:             # <<<<<<<<<<<<<<
 *     cdef object xs      # Points at which slope changes xs[0] is lower bound xs[-1] upper
 *     cdef object x_tan   # Points at which the tangent is taken.
 */

struct __pyx_vtabstruct_5pwfun_Pwlin {
  double (*value)(struct __pyx_obj_5pwfun_Pwlin *, double);
  PyObject *(*c_argmin)(struct __pyx_obj_5pwfun_Pwlin *, double);
};
static struct __pyx_vtabstruct_5pwfun_Pwlin *__pyx_vtabptr_5pwfun_Pwlin;


/* "queues.pxd":1
 * cdef class Queue             # <<<<<<<<<<<<<<
 * 
 * from distributions cimport Distribution
 */

struct __pyx_vtabstruct_6queues_Queue {
  struct __pyx_obj_5pwfun_Pwfun *(*arrivalLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  struct __pyx_obj_5pwfun_Pwfun *(*departureLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  double (*allEventLik)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *);
  PyObject *(*diffListForArrival)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  PyObject *(*diffListForDeparture)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  double (*likelihoodDelta)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, PyObject *, int __pyx_skip_dispatch);
  PyObject *(*recompute_service)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  PyObject *(*recompute_departure)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  double (*departure_of_service)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, double);
  double (*service_lpdf)(struct __pyx_obj_6queues_Queue *, struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_6queues_Queue *__pyx_vtabptr_6queues_Queue;


/* "queues.pxd":12
 * cdef Pwfun _departure_proposal (Arrivals arrv, Event e0)
 * 
 * cdef class FactorTemplate:             # <<<<<<<<<<<<<<
 *     cdef object estimate (self, evtl)
 *     cdef object serviceLikelihood (self, Event evt)
 */

struct __pyx_vtabstruct_6queues_FactorTemplate {
  PyObject *(*estimate)(struct __pyx_obj_6queues_FactorTemplate *, PyObject *);
  PyObject *(*serviceLikelihood)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*serviceDerivative)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  void (*resample_auxiliaries)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
  void (*initialize_auxiliaries)(struct __pyx_obj_6queues_FactorTemplate *, struct __pyx_obj_8arrivals_Event *);
};
static struct __pyx_vtabstruct_6queues_FactorTemplate *__pyx_vtabptr_6queues_FactorTemplate;


/* "qnet.pxd":1
 * cdef class Qnet             # <<<<<<<<<<<<<<
 * 
 * from arrivals cimport Arrivals
 */

struct __pyx_vtabstruct_4qnet_Qnet {
  int (*gibbs_resample_final)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  int (*gibbs_resample_pair)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *);
  double (*determine_upper)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*dfn_range)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  double (*log_prob)(struct __pyx_obj_4qnet_Qnet *, struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_4qnet_Qnet *__pyx_vtabptr_4qnet_Qnet;


/* "arrivals.pyx":53
 * 
 * # This is basically a typed tuple for speed
 * cdef class Event:             # <<<<<<<<<<<<<<
 * 
 *     def __init__ (self, eid, tid, qid, q, a, s, d, state, obs_a=0, obs_d=0, proc=0, aux=None):
 */

struct __pyx_vtabstruct_8arrivals_Event {
  PyObject *(*set_service)(struct __pyx_obj_8arrivals_Event *, double);
  PyObject *(*set_departure)(struct __pyx_obj_8arrivals_Event *, double);
  struct __pyx_obj_8arrivals_Event *(*duplicate)(struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch);
  struct __pyx_obj_8arrivals_Event *(*dup_with_structure)(struct __pyx_obj_8arrivals_Event *);
  int (*update_from_solution)(struct __pyx_obj_8arrivals_Event *, PyObject *);
  PyObject *(*copy_dtimes)(struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*init_dtimes)(struct __pyx_obj_8arrivals_Event *);
  struct __pyx_obj_8arrivals_Event *(*_dup_inner)(struct __pyx_obj_8arrivals_Event *, int);
};
static struct __pyx_vtabstruct_8arrivals_Event *__pyx_vtabptr_8arrivals_Event;


/* "arrivals.pyx":240
 * 
 * @cython.final
 * cdef class Arrivals:             # <<<<<<<<<<<<<<
 * 
 *     ## TODO: Are the python lists going to be fast enough?
 */

struct __pyx_vtabstruct_8arrivals_Arrivals {
  struct __pyx_obj_8arrivals_Event *(*event)(struct __pyx_obj_8arrivals_Arrivals *, int, int __pyx_skip_dispatch);
  int (*num_events)(struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch);
  PyObject *(*_is_initial)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
  PyObject *(*_is_final)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
};
static struct __pyx_vtabstruct_8arrivals_Arrivals *__pyx_vtabptr_8arrivals_Arrivals;
static CYTHON_INLINE struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_8Arrivals_event(struct __pyx_obj_8arrivals_Arrivals *, int, int __pyx_skip_dispatch);
static CYTHON_INLINE int __pyx_f_8arrivals_8Arrivals_num_events(struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch);
static PyObject *__pyx_f_8arrivals_8Arrivals__is_initial(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);
static PyObject *__pyx_f_8arrivals_8Arrivals__is_final(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *);

/* --- Runtime support code (head) --- */
/* Refnanny.proto */
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          if (acquire_gil) {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
              PyGILState_Release(__pyx_gilstate_save);\
          } else {\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext()\
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif
#define __Pyx_XDECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_XDECREF(tmp);\
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_DECREF(tmp);\
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

/* PyObjectGetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

/* GetBuiltinName.proto */
static PyObject *__Pyx_GetBuiltinName(PyObject *name);

/* RaiseDoubleKeywords.proto */
static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);

/* ParseKeywords.proto */
static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
    const char* function_name);

/* RaiseArgTupleInvalid.proto */
static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);

/* PyCFunctionFastCall.proto */
#if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
#else
#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
#endif

/* PyFunctionFastCall.proto */
#if CYTHON_FAST_PYCALL
#define __Pyx_PyFunction_FastCall(func, args, nargs)\
    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, int nargs, PyObject *kwargs);
#else
#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
#endif
#endif

/* PyObjectCall.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
#else
#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
#endif

/* PyObjectCallMethO.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
#endif

/* PyObjectCallOneArg.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);

/* PyObjectCallNoArg.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
#else
#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
#endif

/* ExtTypeTest.proto */
static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);

/* PyObjectSetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o,n,NULL)
static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_setattro))
        return tp->tp_setattro(obj, attr_name, value);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_setattr))
        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
#endif
    return PyObject_SetAttr(obj, attr_name, value);
}
#else
#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
#endif

/* ArgTypeTest.proto */
static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, int inplace);
#else
#define __Pyx_PyInt_EqObjC(op1, op2, intval, inplace)\
    PyObject_RichCompare(op1, op2, Py_EQ)
    #endif

/* GetModuleGlobalName.proto */
static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name);

/* ListAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

/* PyObjectCallMethod1.proto */
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);

/* append.proto */
static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x);

/* ListCompAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        Py_SIZE(list) = len+1;
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

/* SetItemInt.proto */
#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) :\
               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
static CYTHON_INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck);

/* GetItemInt.proto */
#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

/* PyDictContains.proto */
static CYTHON_INLINE int __Pyx_PyDict_ContainsTF(PyObject* item, PyObject* dict, int eq) {
    int result = PyDict_Contains(dict, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* py_dict_keys.proto */
static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d);

/* UnpackUnboundCMethod.proto */
typedef struct {
    PyObject *type;
    PyObject **method_name;
    PyCFunction func;
    PyObject *method;
    int flag;
} __Pyx_CachedCFunction;

/* CallUnboundCMethod0.proto */
static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self);
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_CallUnboundCMethod0(cfunc, self)\
    ((likely((cfunc)->func)) ?\
        (likely((cfunc)->flag == METH_NOARGS) ?  (*((cfunc)->func))(self, NULL) :\
         (likely((cfunc)->flag == (METH_VARARGS | METH_KEYWORDS)) ?  ((*(PyCFunctionWithKeywords)(cfunc)->func)(self, __pyx_empty_tuple, NULL)) :\
             ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
              (PY_VERSION_HEX >= 0x030600B1 && (cfunc)->flag == METH_FASTCALL ?  (*(__Pyx_PyCFunctionFast)(cfunc)->func)(self, &PyTuple_GET_ITEM(__pyx_empty_tuple, 0), 0, NULL) :\
                __Pyx__CallUnboundCMethod0(cfunc, self))))) :\
        __Pyx__CallUnboundCMethod0(cfunc, self))
#else
#define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
#endif

/* PyThreadStateGet.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
#define __Pyx_PyThreadState_assign  __pyx_tstate = PyThreadState_GET();
#else
#define __Pyx_PyThreadState_declare
#define __Pyx_PyThreadState_assign
#endif

/* PyErrFetchRestore.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
#endif

/* RaiseException.proto */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);

/* WriteUnraisableException.proto */
static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                  int lineno, const char *filename,
                                  int full_traceback, int nogil);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace);
#else
#define __Pyx_PyInt_AddObjC(op1, op2, intval, inplace)\
    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
#endif

/* PySequenceContains.proto */
static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* SliceObject.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

/* pop_index.proto */
static PyObject* __Pyx__PyObject_PopNewIndex(PyObject* L, PyObject* py_ix);
static PyObject* __Pyx__PyObject_PopIndex(PyObject* L, PyObject* py_ix);
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static PyObject* __Pyx__PyList_PopIndex(PyObject* L, PyObject* py_ix, Py_ssize_t ix);
#define __Pyx_PyObject_PopIndex(L, py_ix, ix, is_signed, type, to_py_func) (\
    (likely(PyList_CheckExact(L) && __Pyx_fits_Py_ssize_t(ix, type, is_signed))) ?\
        __Pyx__PyList_PopIndex(L, py_ix, ix) : (\
        (unlikely(py_ix == Py_None)) ? __Pyx__PyObject_PopNewIndex(L, to_py_func(ix)) :\
            __Pyx__PyObject_PopIndex(L, py_ix)))
#define __Pyx_PyList_PopIndex(L, py_ix, ix, is_signed, type, to_py_func) (\
    __Pyx_fits_Py_ssize_t(ix, type, is_signed) ?\
        __Pyx__PyList_PopIndex(L, py_ix, ix) : (\
        (unlikely(py_ix == Py_None)) ? __Pyx__PyObject_PopNewIndex(L, to_py_func(ix)) :\
            __Pyx__PyObject_PopIndex(L, py_ix)))
#else
#define __Pyx_PyList_PopIndex(L, py_ix, ix, is_signed, type, to_py_func)\
    __Pyx_PyObject_PopIndex(L, py_ix, ix, is_signed, type, to_py_func)
#define __Pyx_PyObject_PopIndex(L, py_ix, ix, is_signed, type, to_py_func) (\
    (unlikely(py_ix == Py_None)) ? __Pyx__PyObject_PopNewIndex(L, to_py_func(ix)) :\
        __Pyx__PyObject_PopIndex(L, py_ix))
#endif

/* IterFinish.proto */
static CYTHON_INLINE int __Pyx_IterFinish(void);

/* PyObjectCallMethod0.proto */
static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);

/* RaiseNeedMoreValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

/* RaiseTooManyValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);

/* UnpackItemEndCheck.proto */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);

/* RaiseNoneIterError.proto */
static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);

/* UnpackTupleError.proto */
static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index);

/* UnpackTuple2.proto */
static CYTHON_INLINE int __Pyx_unpack_tuple2(PyObject* tuple, PyObject** value1, PyObject** value2,
                                             int is_tuple, int has_known_size, int decref_tuple);

/* dict_iter.proto */
static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_is_dict);
static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);

/* SaveResetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
#else
#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
#endif

/* PyErrExceptionMatches.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
#else
#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
#endif

/* GetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* StringJoin.proto */
#if PY_MAJOR_VERSION < 3
#define __Pyx_PyString_Join __Pyx_PyBytes_Join
#define __Pyx_PyBaseString_Join(s, v) (PyUnicode_CheckExact(s) ? PyUnicode_Join(s, v) : __Pyx_PyBytes_Join(s, v))
#else
#define __Pyx_PyString_Join PyUnicode_Join
#define __Pyx_PyBaseString_Join PyUnicode_Join
#endif
#if CYTHON_COMPILING_IN_CPYTHON
    #if PY_MAJOR_VERSION < 3
    #define __Pyx_PyBytes_Join _PyString_Join
    #else
    #define __Pyx_PyBytes_Join _PyBytes_Join
    #endif
#else
static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values);
#endif

/* SetVTable.proto */
static int __Pyx_SetVtable(PyObject *dict, void *vtable);

/* GetVTable.proto */
static void* __Pyx_GetVtable(PyObject *dict);

/* Import.proto */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);

/* CodeObjectCache.proto */
typedef struct {
    PyCodeObject* code_object;
    int code_line;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

/* AddTraceback.proto */
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

/* Print.proto */
static int __Pyx_Print(PyObject*, PyObject *, int);
#if CYTHON_COMPILING_IN_PYPY || PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

/* CIntFromPy.proto */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

/* PrintOne.proto */
static int __Pyx_PrintOne(PyObject* stream, PyObject *o);

/* CIntFromPy.proto */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

/* CheckBinaryVersion.proto */
static int __Pyx_check_binary_version(void);

/* PyIdentifierFromString.proto */
#if !defined(__Pyx_PyIdentifier_FromString)
#if PY_MAJOR_VERSION < 3
  #define __Pyx_PyIdentifier_FromString(s) PyString_FromString(s)
#else
  #define __Pyx_PyIdentifier_FromString(s) PyUnicode_FromString(s)
#endif
#endif

/* ModuleImport.proto */
static PyObject *__Pyx_ImportModule(const char *name);

/* TypeImport.proto */
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name, size_t size, int strict);

/* InitStrings.proto */
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);

static PyObject *__pyx_f_8arrivals_5Event_set_service(struct __pyx_obj_8arrivals_Event *__pyx_v_self, double __pyx_v_v); /* proto*/
static PyObject *__pyx_f_8arrivals_5Event_set_departure(struct __pyx_obj_8arrivals_Event *__pyx_v_self, double __pyx_v_d); /* proto*/
static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event_duplicate(struct __pyx_obj_8arrivals_Event *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event__dup_inner(struct __pyx_obj_8arrivals_Event *__pyx_v_self, CYTHON_UNUSED int __pyx_v_dup_aux); /* proto*/
static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event_dup_with_structure(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto*/
static PyObject *__pyx_f_8arrivals_5Event_init_dtimes(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto*/
static PyObject *__pyx_f_8arrivals_5Event_copy_dtimes(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_other); /* proto*/
static int __pyx_f_8arrivals_5Event_update_from_solution(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_lp_soln); /* proto*/
static CYTHON_INLINE int __pyx_f_8arrivals_8Arrivals_num_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, CYTHON_UNUSED int __pyx_skip_dispatch); /* proto*/
static CYTHON_INLINE struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_8Arrivals_event(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, int __pyx_v_eid, CYTHON_UNUSED int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8arrivals_8Arrivals__is_initial(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto*/
static PyObject *__pyx_f_8arrivals_8Arrivals__is_final(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto*/

/* Module declarations from 'distributions' */
static PyTypeObject *__pyx_ptype_13distributions_Distribution = 0;

/* Module declarations from 'pwfun' */
static PyTypeObject *__pyx_ptype_5pwfun_Pwfun = 0;
static PyTypeObject *__pyx_ptype_5pwfun_Pwlin = 0;

/* Module declarations from 'queues' */
static PyTypeObject *__pyx_ptype_6queues_Queue = 0;
static PyTypeObject *__pyx_ptype_6queues_FactorTemplate = 0;

/* Module declarations from 'qnet' */
static PyTypeObject *__pyx_ptype_4qnet_Qnet = 0;

/* Module declarations from 'cython' */

/* Module declarations from 'arrivals' */
static PyTypeObject *__pyx_ptype_8arrivals_Event = 0;
static PyTypeObject *__pyx_ptype_8arrivals_Arrivals = 0;
static PyTypeObject *__pyx_ptype_8arrivals_Vars = 0;
#define __Pyx_MODULE_NAME "arrivals"
int __pyx_module_is_main_arrivals = 0;

/* Implementation of 'arrivals' */
static PyObject *__pyx_builtin_round;
static PyObject *__pyx_builtin_cmp;
static PyObject *__pyx_builtin_xrange;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_zip;
static PyObject *__pyx_builtin_AssertionError;
static PyObject *__pyx_builtin_map;
static const char __pyx_k_[] = "]";
static const char __pyx_k_N[] = "N";
static const char __pyx_k_a[] = "a";
static const char __pyx_k_c[] = "c";
static const char __pyx_k_d[] = "d";
static const char __pyx_k_e[] = "e";
static const char __pyx_k_l[] = "l";
static const char __pyx_k_q[] = "q";
static const char __pyx_k_r[] = "r";
static const char __pyx_k_s[] = "s";
static const char __pyx_k_5f[] = "%.5f ";
static const char __pyx_k_NA[] = " NA";
static const char __pyx_k__3[] = "";
static const char __pyx_k__4[] = "\n";
static const char __pyx_k_a0[] = "a0";
static const char __pyx_k_a1[] = "a1";
static const char __pyx_k_c0[] = "c0";
static const char __pyx_k_c1[] = "c1";
static const char __pyx_k_d0[] = "d0";
static const char __pyx_k_d1[] = "d1";
static const char __pyx_k_fn[] = "fn";
static const char __pyx_k_qi[] = "qi";
static const char __pyx_k_EPS[] = "EPS";
static const char __pyx_k_a_d[] = "a[%d]";
static const char __pyx_k_add[] = "add";
static const char __pyx_k_aux[] = "aux";
static const char __pyx_k_c2e[] = "c2e";
static const char __pyx_k_cap[] = "cap";
static const char __pyx_k_cmp[] = "cmp";
static const char __pyx_k_d_d[] = "d[%d]";
static const char __pyx_k_eid[] = "eid";
static const char __pyx_k_end[] = "end";
static const char __pyx_k_evt[] = "evt";
static const char __pyx_k_get[] = "get";
static const char __pyx_k_hmm[] = "hmm";
static const char __pyx_k_lik[] = "lik";
static const char __pyx_k_map[] = "map";
static const char __pyx_k_net[] = "net";
static const char __pyx_k_pct[] = "pct";
static const char __pyx_k_pop[] = "pop";
static const char __pyx_k_qid[] = "qid";
static const char __pyx_k_s_2[] = "_s";
static const char __pyx_k_s_3[] = " %s";
static const char __pyx_k_s_s[] = "%s: %s ";
static const char __pyx_k_set[] = "set";
static const char __pyx_k_sys[] = "sys";
static const char __pyx_k_tid[] = "tid";
static const char __pyx_k_val[] = "val";
static const char __pyx_k_var[] = "var";
static const char __pyx_k_zip[] = "zip";
static const char __pyx_k_Ninq[] = "Ninq";
static const char __pyx_k_None[] = "None";
static const char __pyx_k_arrv[] = "arrv";
static const char __pyx_k_copy[] = "copy";
static const char __pyx_k_dump[] = "dump";
static const char __pyx_k_evtl[] = "evtl";
static const char __pyx_k_file[] = "file";
static const char __pyx_k_iter[] = "__iter__";
static const char __pyx_k_join[] = "join";
static const char __pyx_k_keys[] = "keys";
static const char __pyx_k_main[] = "__main__";
static const char __pyx_k_name[] = "name";
static const char __pyx_k_proc[] = "proc";
static const char __pyx_k_rand[] = "rand";
static const char __pyx_k_self[] = "self";
static const char __pyx_k_sort[] = "sort";
static const char __pyx_k_test[] = "__test__";
static const char __pyx_k_wait[] = "wait";
static const char __pyx_k_warn[] = "warn";
static const char __pyx_k_BIG_N[] = "BIG_N";
static const char __pyx_k_Cycle[] = "Cycle!!!";
static const char __pyx_k_TIMES[] = "[TIMES ";
static const char __pyx_k_cninq[] = "cninq";
static const char __pyx_k_index[] = "index";
static const char __pyx_k_numpy[] = "numpy";
static const char __pyx_k_obs_a[] = "obs_a";
static const char __pyx_k_obs_d[] = "obs_d";
static const char __pyx_k_other[] = "other";
static const char __pyx_k_print[] = "print";
static const char __pyx_k_pwfun[] = "pwfun";
static const char __pyx_k_range[] = "range";
static const char __pyx_k_round[] = "round";
static const char __pyx_k_state[] = "state";
static const char __pyx_k_value[] = "value";
static const char __pyx_k_write[] = "write";
static const char __pyx_k_append[] = "append";
static const char __pyx_k_as_csv[] = "as_csv";
static const char __pyx_k_import[] = "__import__";
static const char __pyx_k_insert[] = "insert";
static const char __pyx_k_mytime[] = "mytime";
static const char __pyx_k_queues[] = "queues";
static const char __pyx_k_random[] = "random";
static const char __pyx_k_remove[] = "remove";
static const char __pyx_k_report[] = "report";
static const char __pyx_k_stdout[] = "stdout";
static const char __pyx_k_subset[] = "subset";
static const char __pyx_k_values[] = "values";
static const char __pyx_k_xrange[] = "xrange";
static const char __pyx_k_QueuePS[] = "QueuePS";
static const char __pyx_k_allvars[] = "allvars";
static const char __pyx_k_evt_new[] = "evt_new";
static const char __pyx_k_evt_old[] = "evt_old";
static const char __pyx_k_NO_TIMES[] = " [NO  TIMES]";
static const char __pyx_k_adapt_fn[] = "adapt_fn";
static const char __pyx_k_all_true[] = "all_true";
static const char __pyx_k_arrivals[] = "arrivals";
static const char __pyx_k_in_range[] = "in_range";
static const char __pyx_k_iterkeys[] = "iterkeys";
static const char __pyx_k_ivltreap[] = "ivltreap";
static const char __pyx_k_netutils[] = "netutils";
static const char __pyx_k_ninqueue[] = "ninqueue";
static const char __pyx_k_num_vars[] = "num_vars";
static const char __pyx_k_validate[] = "validate";
static const char __pyx_k_warnings[] = "warnings";
static const char __pyx_k_ARRV_BY_A[] = "ARRV_BY_A";
static const char __pyx_k_ARRV_BY_D[] = "ARRV_BY_D";
static const char __pyx_k_QUEUE_s_d[] = "QUEUE %s (%d)\n";
static const char __pyx_k_diff_list[] = "diff_list";
static const char __pyx_k_duplicate[] = "duplicate";
static const char __pyx_k_iteritems[] = "iteritems";
static const char __pyx_k_num_tasks[] = "num_tasks";
static const char __pyx_k_print_exc[] = "print_exc";
static const char __pyx_k_traceback[] = "traceback";
static const char __pyx_k_write_csv[] = "write_csv";
static const char __pyx_k_SortedList[] = "SortedList";
static const char __pyx_k_all_queues[] = "all_queues";
static const char __pyx_k_format_evt[] = "format_evt";
static const char __pyx_k_num_queues[] = "num_queues";
static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
static const char __pyx_k_when_clear[] = "when_clear";
static const char __pyx_k_QUEUE_s_d_2[] = "QUEUE %s (%d)";
static const char __pyx_k_contains_kv[] = "contains_kv";
static const char __pyx_k_get_arrival[] = "_get_arrival";
static const char __pyx_k_not_in_set2[] = "not_in_set2";
static const char __pyx_k_queue_order[] = "queue_order";
static const char __pyx_k_update_ninq[] = "_update_ninq";
static const char __pyx_k_commencement[] = "commencement";
static const char __pyx_k_contains_key[] = "contains_key";
static const char __pyx_k_move_arrival[] = "move_arrival";
static const char __pyx_k_qid_of_queue[] = "qid_of_queue";
static const char __pyx_k_IntervalTreap[] = "IntervalTreap";
static const char __pyx_k_all_intersect[] = "all_intersect";
static const char __pyx_k_events_of_qid[] = "events_of_qid";
static const char __pyx_k_find_next_byq[] = "find_next_byq";
static const char __pyx_k_initial_state[] = "initial_state";
static const char __pyx_k_AssertionError[] = "AssertionError";
static const char __pyx_k_cmp_by_arrival[] = "cmp_by_arrival";
static const char __pyx_k_events_of_task[] = "events_of_task";
static const char __pyx_k_move_departure[] = "move_departure";
static const char __pyx_k_add_birth_death[] = "add_birth_death";
static const char __pyx_k_setup_inq_cache[] = "setup_inq_cache";
static const char __pyx_k_sort_by_arrival[] = "sort_by_arrival";
static const char __pyx_k_validate_caches[] = "validate_caches";
static const char __pyx_k_Huh_EVTL_s_C2E_s[] = "Huh? EVTL %s  C2E %s";
static const char __pyx_k_cmp_by_departure[] = "cmp_by_departure";
static const char __pyx_k_contains_arrival[] = "contains_arrival";
static const char __pyx_k_update_final_byq[] = "_update_final_byq";
static const char __pyx_k_update_inq_cache[] = "update_inq_cache";
static const char __pyx_k_validate_service[] = "validate_service";
static const char __pyx_k_sort_by_departure[] = "sort_by_departure";
static const char __pyx_k_update_caches_for[] = "update_caches_for";
static const char __pyx_k_ARRIVALS_NE_d_NT_d[] = "ARRIVALS NE %d  NT %d";
static const char __pyx_k_contains_departure[] = "contains_departure";
static const char __pyx_k_reset_commencement[] = "reset_commencement";
static const char __pyx_k_final_arrival_by_qid[] = "final_arrival_by_qid";
static const char __pyx_k_first_arrival_by_qid[] = "first_arrival_by_qid";
static const char __pyx_k_update_arrival_cache[] = "update_arrival_cache";
static const char __pyx_k_recompute_all_service[] = "recompute_all_service";
static const char __pyx_k_final_arrival_by_queue[] = "final_arrival_by_queue";
static const char __pyx_k_Bad_order_d_for_queue_s[] = "Bad order %d for queue %s";
static const char __pyx_k_update_departure_caches[] = "update_departure_caches";
static const char __pyx_k_check_commencement_cache[] = "check_commencement_cache";
static const char __pyx_k_Event_not_in_event_list_s[] = "Event not in event list:\n  %s";
static const char __pyx_k_d_d_d_5f_5f_5f_5f_d_d_d_d[] = "%d %d %d  %.5f %.5f %.5f %.5f %d %d %d %d";
static const char __pyx_k_update_commencement_cache[] = "update_commencement_cache";
static const char __pyx_k_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d[] = "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]";
static const char __pyx_k_EVT_5d_23_17g_23_17g_S_23_17g_T[] = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d ";
static const char __pyx_k_Invalid_negative_service_time_s[] = "Invalid (negative) service time %s for:\n  %s\n  %s";
static const char __pyx_k_Next_byq_pointers_don_t_match_s[] = "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s";
static const char __pyx_k_Prev_byq_pointers_don_t_match_s[] = "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s";
static const char __pyx_k_Prev_byt_pointers_don_t_match_s[] = "Prev_byt pointers don't match\n  %s\n  %s";
static const char __pyx_k_Users_csutton_research_projects[] = "/Users/csutton/research/projects/2009/bayes-qnet/src/arrivals.pyx";
static const char __pyx_k_Arrivals_Disregarding_event_s_br[] = "Arrivals: Disregarding event %s (breaks FIFO assumptions)";
static const char __pyx_k_Can_t_find_event_in_ninq_EVT_s_E[] = "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s";
static const char __pyx_k_EID_TID_QID_A_D_S_W_STATE_PROC_O[] = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n";
static const char __pyx_k_Error_in_initializing_observed_e[] = "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s";
static const char __pyx_k_Event_in_by_q_cache_but_not_even[] = "Event in by_q cache but not events %s";
static const char __pyx_k_Event_in_by_t_cache_but_not_even[] = "Event in by_t cache but not events %s";
static const char __pyx_k_Event_in_event_list_but_not_in_b[] = "Event in event list but not in by_q cache:\n  %s";
static const char __pyx_k_Event_list_mismatch_Expected_s_W[] = "Event list mismatch\n  Expected: %s\n  Was: %s";
static const char __pyx_k_Initial_event_with_bad_arrival_s[] = "Initial event with bad arrival\n%s";
static const char __pyx_k_Mismatched_arrivals_D_prev_s_A_s[] = "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s";
static const char __pyx_k_NINQ_wrong_does_not_contain_arri[] = "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s";
static const char __pyx_k_NINQ_wrong_does_not_contain_depa[] = "NINQ wrong, does not contain departure\n%s\n%.15f\n%s";
static const char __pyx_k_Next_byt_pointers_don_t_match_FR[] = "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s";
static const char __pyx_k_TID_pointers_don_t_match_but_are[] = "TID pointers don't match, but are linked\n  %s\n  %s";
static const char __pyx_k_TID_pointers_don_t_match_qnet_ha[] = "TID pointers don't match (qnet has %s)\n  %s";
static const char __pyx_k_Error_in_initializing_observed_e_2[] = "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s]";
static const char __pyx_k_Event_in_event_list_but_not_in_b_2[] = "Event in event list but not in by_t cache:\n  %s";
static PyObject *__pyx_kp_s_;
static PyObject *__pyx_kp_s_5f;
static PyObject *__pyx_kp_s_ARRIVALS_NE_d_NT_d;
static PyObject *__pyx_n_s_ARRV_BY_A;
static PyObject *__pyx_n_s_ARRV_BY_D;
static PyObject *__pyx_kp_s_Arrivals_Disregarding_event_s_br;
static PyObject *__pyx_n_s_AssertionError;
static PyObject *__pyx_n_s_BIG_N;
static PyObject *__pyx_kp_s_Bad_order_d_for_queue_s;
static PyObject *__pyx_kp_s_Can_t_find_event_in_ninq_EVT_s_E;
static PyObject *__pyx_kp_s_Cycle;
static PyObject *__pyx_kp_s_EID_TID_QID_A_D_S_W_STATE_PROC_O;
static PyObject *__pyx_n_s_EPS;
static PyObject *__pyx_kp_s_EVT_5d_23_17g_23_17g_S_23_17g_T;
static PyObject *__pyx_kp_s_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d;
static PyObject *__pyx_kp_s_Error_in_initializing_observed_e;
static PyObject *__pyx_kp_s_Error_in_initializing_observed_e_2;
static PyObject *__pyx_kp_s_Event_in_by_q_cache_but_not_even;
static PyObject *__pyx_kp_s_Event_in_by_t_cache_but_not_even;
static PyObject *__pyx_kp_s_Event_in_event_list_but_not_in_b;
static PyObject *__pyx_kp_s_Event_in_event_list_but_not_in_b_2;
static PyObject *__pyx_kp_s_Event_list_mismatch_Expected_s_W;
static PyObject *__pyx_kp_s_Event_not_in_event_list_s;
static PyObject *__pyx_kp_s_Huh_EVTL_s_C2E_s;
static PyObject *__pyx_kp_s_Initial_event_with_bad_arrival_s;
static PyObject *__pyx_n_s_IntervalTreap;
static PyObject *__pyx_kp_s_Invalid_negative_service_time_s;
static PyObject *__pyx_kp_s_Mismatched_arrivals_D_prev_s_A_s;
static PyObject *__pyx_n_s_N;
static PyObject *__pyx_kp_s_NA;
static PyObject *__pyx_kp_s_NINQ_wrong_does_not_contain_arri;
static PyObject *__pyx_kp_s_NINQ_wrong_does_not_contain_depa;
static PyObject *__pyx_kp_s_NO_TIMES;
static PyObject *__pyx_kp_s_Next_byq_pointers_don_t_match_s;
static PyObject *__pyx_kp_s_Next_byt_pointers_don_t_match_FR;
static PyObject *__pyx_n_s_Ninq;
static PyObject *__pyx_n_s_None;
static PyObject *__pyx_kp_s_Prev_byq_pointers_don_t_match_s;
static PyObject *__pyx_kp_s_Prev_byt_pointers_don_t_match_s;
static PyObject *__pyx_kp_s_QUEUE_s_d;
static PyObject *__pyx_kp_s_QUEUE_s_d_2;
static PyObject *__pyx_n_s_QueuePS;
static PyObject *__pyx_n_s_SortedList;
static PyObject *__pyx_kp_s_TID_pointers_don_t_match_but_are;
static PyObject *__pyx_kp_s_TID_pointers_don_t_match_qnet_ha;
static PyObject *__pyx_kp_s_TIMES;
static PyObject *__pyx_kp_s_Users_csutton_research_projects;
static PyObject *__pyx_kp_s__3;
static PyObject *__pyx_kp_s__4;
static PyObject *__pyx_n_s_a;
static PyObject *__pyx_n_s_a0;
static PyObject *__pyx_n_s_a1;
static PyObject *__pyx_kp_s_a_d;
static PyObject *__pyx_n_s_adapt_fn;
static PyObject *__pyx_n_s_add;
static PyObject *__pyx_n_s_add_birth_death;
static PyObject *__pyx_n_s_all_intersect;
static PyObject *__pyx_n_s_all_queues;
static PyObject *__pyx_n_s_all_true;
static PyObject *__pyx_n_s_allvars;
static PyObject *__pyx_n_s_append;
static PyObject *__pyx_n_s_arrivals;
static PyObject *__pyx_n_s_arrv;
static PyObject *__pyx_n_s_as_csv;
static PyObject *__pyx_n_s_aux;
static PyObject *__pyx_n_s_c;
static PyObject *__pyx_n_s_c0;
static PyObject *__pyx_n_s_c1;
static PyObject *__pyx_n_s_c2e;
static PyObject *__pyx_n_s_cap;
static PyObject *__pyx_n_s_check_commencement_cache;
static PyObject *__pyx_n_s_cmp;
static PyObject *__pyx_n_s_cmp_by_arrival;
static PyObject *__pyx_n_s_cmp_by_departure;
static PyObject *__pyx_n_s_cninq;
static PyObject *__pyx_n_s_commencement;
static PyObject *__pyx_n_s_contains_arrival;
static PyObject *__pyx_n_s_contains_departure;
static PyObject *__pyx_n_s_contains_key;
static PyObject *__pyx_n_s_contains_kv;
static PyObject *__pyx_n_s_copy;
static PyObject *__pyx_n_s_d;
static PyObject *__pyx_n_s_d0;
static PyObject *__pyx_n_s_d1;
static PyObject *__pyx_kp_s_d_d;
static PyObject *__pyx_kp_s_d_d_d_5f_5f_5f_5f_d_d_d_d;
static PyObject *__pyx_n_s_diff_list;
static PyObject *__pyx_n_s_dump;
static PyObject *__pyx_n_s_duplicate;
static PyObject *__pyx_n_s_e;
static PyObject *__pyx_n_s_eid;
static PyObject *__pyx_n_s_end;
static PyObject *__pyx_n_s_events_of_qid;
static PyObject *__pyx_n_s_events_of_task;
static PyObject *__pyx_n_s_evt;
static PyObject *__pyx_n_s_evt_new;
static PyObject *__pyx_n_s_evt_old;
static PyObject *__pyx_n_s_evtl;
static PyObject *__pyx_n_s_file;
static PyObject *__pyx_n_s_final_arrival_by_qid;
static PyObject *__pyx_n_s_final_arrival_by_queue;
static PyObject *__pyx_n_s_find_next_byq;
static PyObject *__pyx_n_s_first_arrival_by_qid;
static PyObject *__pyx_n_s_fn;
static PyObject *__pyx_n_s_format_evt;
static PyObject *__pyx_n_s_get;
static PyObject *__pyx_n_s_get_arrival;
static PyObject *__pyx_n_s_hmm;
static PyObject *__pyx_n_s_import;
static PyObject *__pyx_n_s_in_range;
static PyObject *__pyx_n_s_index;
static PyObject *__pyx_n_s_initial_state;
static PyObject *__pyx_n_s_insert;
static PyObject *__pyx_n_s_iter;
static PyObject *__pyx_n_s_iteritems;
static PyObject *__pyx_n_s_iterkeys;
static PyObject *__pyx_n_s_ivltreap;
static PyObject *__pyx_n_s_join;
static PyObject *__pyx_n_s_keys;
static PyObject *__pyx_n_s_l;
static PyObject *__pyx_n_s_lik;
static PyObject *__pyx_n_s_main;
static PyObject *__pyx_n_s_map;
static PyObject *__pyx_n_s_move_arrival;
static PyObject *__pyx_n_s_move_departure;
static PyObject *__pyx_n_s_mytime;
static PyObject *__pyx_n_s_name;
static PyObject *__pyx_n_s_net;
static PyObject *__pyx_n_s_netutils;
static PyObject *__pyx_n_s_ninqueue;
static PyObject *__pyx_n_s_not_in_set2;
static PyObject *__pyx_n_s_num_queues;
static PyObject *__pyx_n_s_num_tasks;
static PyObject *__pyx_n_s_num_vars;
static PyObject *__pyx_n_s_numpy;
static PyObject *__pyx_n_s_obs_a;
static PyObject *__pyx_n_s_obs_d;
static PyObject *__pyx_n_s_other;
static PyObject *__pyx_n_s_pct;
static PyObject *__pyx_n_s_pop;
static PyObject *__pyx_n_s_print;
static PyObject *__pyx_n_s_print_exc;
static PyObject *__pyx_n_s_proc;
static PyObject *__pyx_n_s_pwfun;
static PyObject *__pyx_n_s_pyx_vtable;
static PyObject *__pyx_n_s_q;
static PyObject *__pyx_n_s_qi;
static PyObject *__pyx_n_s_qid;
static PyObject *__pyx_n_s_qid_of_queue;
static PyObject *__pyx_n_s_queue_order;
static PyObject *__pyx_n_s_queues;
static PyObject *__pyx_n_s_r;
static PyObject *__pyx_n_s_rand;
static PyObject *__pyx_n_s_random;
static PyObject *__pyx_n_s_range;
static PyObject *__pyx_n_s_recompute_all_service;
static PyObject *__pyx_n_s_remove;
static PyObject *__pyx_n_s_report;
static PyObject *__pyx_n_s_reset_commencement;
static PyObject *__pyx_n_s_round;
static PyObject *__pyx_n_s_s;
static PyObject *__pyx_n_s_s_2;
static PyObject *__pyx_kp_s_s_3;
static PyObject *__pyx_kp_s_s_s;
static PyObject *__pyx_n_s_self;
static PyObject *__pyx_n_s_set;
static PyObject *__pyx_n_s_setup_inq_cache;
static PyObject *__pyx_n_s_sort;
static PyObject *__pyx_n_s_sort_by_arrival;
static PyObject *__pyx_n_s_sort_by_departure;
static PyObject *__pyx_n_s_state;
static PyObject *__pyx_n_s_stdout;
static PyObject *__pyx_n_s_subset;
static PyObject *__pyx_n_s_sys;
static PyObject *__pyx_n_s_test;
static PyObject *__pyx_n_s_tid;
static PyObject *__pyx_n_s_traceback;
static PyObject *__pyx_n_s_update_arrival_cache;
static PyObject *__pyx_n_s_update_caches_for;
static PyObject *__pyx_n_s_update_commencement_cache;
static PyObject *__pyx_n_s_update_departure_caches;
static PyObject *__pyx_n_s_update_final_byq;
static PyObject *__pyx_n_s_update_inq_cache;
static PyObject *__pyx_n_s_update_ninq;
static PyObject *__pyx_n_s_val;
static PyObject *__pyx_n_s_validate;
static PyObject *__pyx_n_s_validate_caches;
static PyObject *__pyx_n_s_validate_service;
static PyObject *__pyx_n_s_value;
static PyObject *__pyx_n_s_values;
static PyObject *__pyx_n_s_var;
static PyObject *__pyx_n_s_wait;
static PyObject *__pyx_n_s_warn;
static PyObject *__pyx_n_s_warnings;
static PyObject *__pyx_n_s_when_clear;
static PyObject *__pyx_n_s_write;
static PyObject *__pyx_n_s_write_csv;
static PyObject *__pyx_n_s_xrange;
static PyObject *__pyx_n_s_zip;
static int __pyx_pf_8arrivals_4Vars___init__(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_map); /* proto */
static PyObject *__pyx_pf_8arrivals_4Vars_2duplicate(struct __pyx_obj_8arrivals_Vars *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_4Vars_4get(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_var); /* proto */
static PyObject *__pyx_pf_8arrivals_4Vars_6set(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_var, PyObject *__pyx_v_val); /* proto */
static PyObject *__pyx_pf_8arrivals_4Vars_8num_vars(struct __pyx_obj_8arrivals_Vars *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_4Vars_10allvars(struct __pyx_obj_8arrivals_Vars *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event___init__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_eid, PyObject *__pyx_v_tid, PyObject *__pyx_v_qid, PyObject *__pyx_v_q, PyObject *__pyx_v_a, PyObject *__pyx_v_s, PyObject *__pyx_v_d, PyObject *__pyx_v_state, PyObject *__pyx_v_obs_a, PyObject *__pyx_v_obs_d, PyObject *__pyx_v_proc, PyObject *__pyx_v_aux); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_2__repr__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static void __pyx_pf_8arrivals_5Event_4__dealloc__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_6dump(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_8as_csv(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_10arrival(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_12service(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_14departure(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_16queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_18set_state(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_sid); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_20duplicate(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_22previous_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_24next_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_26previous_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_28next_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_30set_next_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_32set_previous_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_34set_previous_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_36set_next_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_38variable(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_var); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_40set_variable(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_var, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_42set_all_vars(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_44copy_caches(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_46wait(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_48commencement(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_50reset_commencement(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
#if PY_MAJOR_VERSION < 3
static int __pyx_pf_8arrivals_5Event_52__cmp__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
#endif
static PyObject *__pyx_pf_8arrivals_5Event_3eid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_3tid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_3qid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_5state___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_1a___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_1a_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_1s___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_1s_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_1c___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_1c_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_1d___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_1d_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_5obs_a___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_5obs_a_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_5obs_d___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_5obs_d_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_4proc___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static int __pyx_pf_8arrivals_5Event_4proc_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value); /* proto */
static PyObject *__pyx_pf_8arrivals_5Event_11auxiliaries___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_sort_by_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evtl); /* proto */
static PyObject *__pyx_pf_8arrivals_2sort_by_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evtl); /* proto */
static PyObject *__pyx_pf_8arrivals_4cmp_by_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_8arrivals_6cmp_by_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other); /* proto */
static PyObject *__pyx_pf_8arrivals_8_get_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static int __pyx_pf_8arrivals_8Arrivals___init__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_net, PyObject *__pyx_v_cap); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_2__iter__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_4__repr__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_6display(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_8dump(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_10as_csv(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_12write_csv(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_f); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_14all_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_16events_of_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_18events_of_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_20final_arrival_by_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_22final_arrival_by_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_24first_arrival_by_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_26first_arrival_by_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_28events_of_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_tid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_30c2e_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_32arrivals_in_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_34evts_in_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_36num_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_38num_hidden_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_40num_tasks(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_42all_tasks(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_44max_eidx(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_46max_tid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_48initial_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_50append(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_52insert(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_54resort_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_56find_next_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_58applyDiffList(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_diff_list, PyObject *__pyx_v_lik); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_60_update_final_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_62_update_ninq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt_old, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_64update_commencement_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_c0, double __pyx_v_c1); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_66update_arrival_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_a0, double __pyx_v_a1); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_68setup_inq_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_70update_inq_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt_old, struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_72update_departure_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_d0, double __pyx_v_d1); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_74regenerate_all_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_76ninq_of_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_78delete_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_tid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_80append_and_check(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_82qnet(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_84num_queues(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_86event(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, int __pyx_v_eid); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_88is_initial(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_90is_final(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_92is_last_in_queue(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_94recompute_all_service(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_96subset(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_fn, CYTHON_UNUSED PyObject *__pyx_v_adapt_fn); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_98subset_by_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_pct, PyObject *__pyx_v_adapt_fn); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_100subset_by_task_fn(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_fn, CYTHON_UNUSED PyObject *__pyx_v_adapt_fn); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_102recompute_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_104duplicate(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_106validate(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_8Arrivals_108report(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8arrivals_10format_evt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt); /* proto */
static PyObject *__pyx_pf_8arrivals_12check_commencement_cache(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv); /* proto */
static PyObject *__pyx_tp_new_8arrivals_Event(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_8arrivals_Arrivals(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_8arrivals_Vars(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_keys = {0, &__pyx_n_s_keys, 0, 0, 0};
static PyObject *__pyx_float_1_0;
static PyObject *__pyx_float_1eneg_5;
static PyObject *__pyx_float_1eneg_8;
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_9;
static PyObject *__pyx_int_10000;
static PyObject *__pyx_int_neg_1;
static PyObject *__pyx_k__2;
static PyObject *__pyx_slice__9;
static PyObject *__pyx_tuple__5;
static PyObject *__pyx_tuple__6;
static PyObject *__pyx_tuple__7;
static PyObject *__pyx_tuple__8;
static PyObject *__pyx_slice__10;
static PyObject *__pyx_slice__11;
static PyObject *__pyx_tuple__12;
static PyObject *__pyx_tuple__14;
static PyObject *__pyx_tuple__16;
static PyObject *__pyx_tuple__18;
static PyObject *__pyx_tuple__20;
static PyObject *__pyx_tuple__22;
static PyObject *__pyx_tuple__24;
static PyObject *__pyx_codeobj__13;
static PyObject *__pyx_codeobj__15;
static PyObject *__pyx_codeobj__17;
static PyObject *__pyx_codeobj__19;
static PyObject *__pyx_codeobj__21;
static PyObject *__pyx_codeobj__23;
static PyObject *__pyx_codeobj__25;

/* "arrivals.pyx":35
 * 
 * cdef class Vars:
 *     def __init__ (self, map):             # <<<<<<<<<<<<<<
 *         self.map = map.copy()
 * 
 */

/* Python wrapper */
static int __pyx_pw_8arrivals_4Vars_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_8arrivals_4Vars_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_map = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_map,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_map)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 35, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
    }
    __pyx_v_map = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 35, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Vars.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_4Vars___init__(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self), __pyx_v_map);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_4Vars___init__(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_map) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "arrivals.pyx":36
 * cdef class Vars:
 *     def __init__ (self, map):
 *         self.map = map.copy()             # <<<<<<<<<<<<<<
 * 
 *     def duplicate(self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_map, __pyx_n_s_copy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 36, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->map);
  __Pyx_DECREF(__pyx_v_self->map);
  __pyx_v_self->map = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":35
 * 
 * cdef class Vars:
 *     def __init__ (self, map):             # <<<<<<<<<<<<<<
 *         self.map = map.copy()
 * 
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Vars.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":38
 *         self.map = map.copy()
 * 
 *     def duplicate(self):             # <<<<<<<<<<<<<<
 *         return Vars (self.map)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_4Vars_3duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_4Vars_3duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("duplicate (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_4Vars_2duplicate(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4Vars_2duplicate(struct __pyx_obj_8arrivals_Vars *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("duplicate", 0);

  /* "arrivals.pyx":39
 * 
 *     def duplicate(self):
 *         return Vars (self.map)             # <<<<<<<<<<<<<<
 * 
 *     def get (self, var):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 39, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_self->map);
  __Pyx_GIVEREF(__pyx_v_self->map);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_self->map);
  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_8arrivals_Vars), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 39, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":38
 *         self.map = map.copy()
 * 
 *     def duplicate(self):             # <<<<<<<<<<<<<<
 *         return Vars (self.map)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("arrivals.Vars.duplicate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":41
 *         return Vars (self.map)
 * 
 *     def get (self, var):             # <<<<<<<<<<<<<<
 *         return self.map[var]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_4Vars_5get(PyObject *__pyx_v_self, PyObject *__pyx_v_var); /*proto*/
static PyObject *__pyx_pw_8arrivals_4Vars_5get(PyObject *__pyx_v_self, PyObject *__pyx_v_var) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_4Vars_4get(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self), ((PyObject *)__pyx_v_var));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4Vars_4get(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_var) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("get", 0);

  /* "arrivals.pyx":42
 * 
 *     def get (self, var):
 *         return self.map[var]             # <<<<<<<<<<<<<<
 * 
 *     def set (self, var, val):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->map, __pyx_v_var); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":41
 *         return Vars (self.map)
 * 
 *     def get (self, var):             # <<<<<<<<<<<<<<
 *         return self.map[var]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Vars.get", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":44
 *         return self.map[var]
 * 
 *     def set (self, var, val):             # <<<<<<<<<<<<<<
 *         self.map[var] = val
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_4Vars_7set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_4Vars_7set(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_var = 0;
  PyObject *__pyx_v_val = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_var,&__pyx_n_s_val,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_var)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_val)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("set", 1, 2, 2, 1); __PYX_ERR(0, 44, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set") < 0)) __PYX_ERR(0, 44, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_var = values[0];
    __pyx_v_val = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("set", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 44, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Vars.set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_4Vars_6set(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self), __pyx_v_var, __pyx_v_val);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4Vars_6set(struct __pyx_obj_8arrivals_Vars *__pyx_v_self, PyObject *__pyx_v_var, PyObject *__pyx_v_val) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set", 0);

  /* "arrivals.pyx":45
 * 
 *     def set (self, var, val):
 *         self.map[var] = val             # <<<<<<<<<<<<<<
 * 
 *     def num_vars (self): return len(self.map)
 */
  if (unlikely(PyObject_SetItem(__pyx_v_self->map, __pyx_v_var, __pyx_v_val) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)

  /* "arrivals.pyx":44
 *         return self.map[var]
 * 
 *     def set (self, var, val):             # <<<<<<<<<<<<<<
 *         self.map[var] = val
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Vars.set", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":47
 *         self.map[var] = val
 * 
 *     def num_vars (self): return len(self.map)             # <<<<<<<<<<<<<<
 * 
 *     def allvars (self):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_4Vars_9num_vars(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_4Vars_9num_vars(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_vars (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_4Vars_8num_vars(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4Vars_8num_vars(struct __pyx_obj_8arrivals_Vars *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("num_vars", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_v_self->map;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Vars.num_vars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":49
 *     def num_vars (self): return len(self.map)
 * 
 *     def allvars (self):             # <<<<<<<<<<<<<<
 *         return self.map.keys()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_4Vars_11allvars(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_4Vars_11allvars(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("allvars (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_4Vars_10allvars(((struct __pyx_obj_8arrivals_Vars *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4Vars_10allvars(struct __pyx_obj_8arrivals_Vars *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("allvars", 0);

  /* "arrivals.pyx":50
 * 
 *     def allvars (self):
 *         return self.map.keys()             # <<<<<<<<<<<<<<
 * 
 * # This is basically a typed tuple for speed
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->map, __pyx_n_s_keys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":49
 *     def num_vars (self): return len(self.map)
 * 
 *     def allvars (self):             # <<<<<<<<<<<<<<
 *         return self.map.keys()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Vars.allvars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":55
 * cdef class Event:
 * 
 *     def __init__ (self, eid, tid, qid, q, a, s, d, state, obs_a=0, obs_d=0, proc=0, aux=None):             # <<<<<<<<<<<<<<
 *         self.eid = eid
 *         self.tid = tid
 */

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_8arrivals_5Event_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_eid = 0;
  PyObject *__pyx_v_tid = 0;
  PyObject *__pyx_v_qid = 0;
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_s = 0;
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v_obs_a = 0;
  PyObject *__pyx_v_obs_d = 0;
  PyObject *__pyx_v_proc = 0;
  PyObject *__pyx_v_aux = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_eid,&__pyx_n_s_tid,&__pyx_n_s_qid,&__pyx_n_s_q,&__pyx_n_s_a,&__pyx_n_s_s,&__pyx_n_s_d,&__pyx_n_s_state,&__pyx_n_s_obs_a,&__pyx_n_s_obs_d,&__pyx_n_s_proc,&__pyx_n_s_aux,0};
    PyObject* values[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
    values[8] = ((PyObject *)__pyx_int_0);
    values[9] = ((PyObject *)__pyx_int_0);
    values[10] = ((PyObject *)__pyx_int_0);
    values[11] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_eid)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_tid)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 1); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_qid)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 2); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  3:
        if (likely((values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 3); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  4:
        if (likely((values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 4); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  5:
        if (likely((values[5] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_s)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 5); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  6:
        if (likely((values[6] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 6); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  7:
        if (likely((values[7] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, 7); __PYX_ERR(0, 55, __pyx_L3_error)
        }
        case  8:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_obs_a);
          if (value) { values[8] = value; kw_args--; }
        }
        case  9:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_obs_d);
          if (value) { values[9] = value; kw_args--; }
        }
        case 10:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_proc);
          if (value) { values[10] = value; kw_args--; }
        }
        case 11:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_aux);
          if (value) { values[11] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 55, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_eid = values[0];
    __pyx_v_tid = values[1];
    __pyx_v_qid = values[2];
    __pyx_v_q = values[3];
    __pyx_v_a = values[4];
    __pyx_v_s = values[5];
    __pyx_v_d = values[6];
    __pyx_v_state = values[7];
    __pyx_v_obs_a = values[8];
    __pyx_v_obs_d = values[9];
    __pyx_v_proc = values[10];
    __pyx_v_aux = values[11];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 8, 12, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 55, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Event.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_5Event___init__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), __pyx_v_eid, __pyx_v_tid, __pyx_v_qid, __pyx_v_q, __pyx_v_a, __pyx_v_s, __pyx_v_d, __pyx_v_state, __pyx_v_obs_a, __pyx_v_obs_d, __pyx_v_proc, __pyx_v_aux);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event___init__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_eid, PyObject *__pyx_v_tid, PyObject *__pyx_v_qid, PyObject *__pyx_v_q, PyObject *__pyx_v_a, PyObject *__pyx_v_s, PyObject *__pyx_v_d, PyObject *__pyx_v_state, PyObject *__pyx_v_obs_a, PyObject *__pyx_v_obs_d, PyObject *__pyx_v_proc, PyObject *__pyx_v_aux) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  double __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "arrivals.pyx":56
 * 
 *     def __init__ (self, eid, tid, qid, q, a, s, d, state, obs_a=0, obs_d=0, proc=0, aux=None):
 *         self.eid = eid             # <<<<<<<<<<<<<<
 *         self.tid = tid
 *         self.qid = qid
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_eid); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 56, __pyx_L1_error)
  __pyx_v_self->eid = __pyx_t_1;

  /* "arrivals.pyx":57
 *     def __init__ (self, eid, tid, qid, q, a, s, d, state, obs_a=0, obs_d=0, proc=0, aux=None):
 *         self.eid = eid
 *         self.tid = tid             # <<<<<<<<<<<<<<
 *         self.qid = qid
 *         self.q = q
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_tid); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 57, __pyx_L1_error)
  __pyx_v_self->tid = __pyx_t_1;

  /* "arrivals.pyx":58
 *         self.eid = eid
 *         self.tid = tid
 *         self.qid = qid             # <<<<<<<<<<<<<<
 *         self.q = q
 *         self.a = a
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_qid); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 58, __pyx_L1_error)
  __pyx_v_self->qid = __pyx_t_1;

  /* "arrivals.pyx":59
 *         self.tid = tid
 *         self.qid = qid
 *         self.q = q             # <<<<<<<<<<<<<<
 *         self.a = a
 *         self.s = s
 */
  if (!(likely(((__pyx_v_q) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_q, __pyx_ptype_6queues_Queue))))) __PYX_ERR(0, 59, __pyx_L1_error)
  __pyx_t_2 = __pyx_v_q;
  __Pyx_INCREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __Pyx_GOTREF(__pyx_v_self->q);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->q));
  __pyx_v_self->q = ((struct __pyx_obj_6queues_Queue *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "arrivals.pyx":60
 *         self.qid = qid
 *         self.q = q
 *         self.a = a             # <<<<<<<<<<<<<<
 *         self.s = s
 *         self.c = max(a,d-s)
 */
  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_a); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 60, __pyx_L1_error)
  __pyx_v_self->a = __pyx_t_3;

  /* "arrivals.pyx":61
 *         self.q = q
 *         self.a = a
 *         self.s = s             # <<<<<<<<<<<<<<
 *         self.c = max(a,d-s)
 *         self.d = d
 */
  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_s); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L1_error)
  __pyx_v_self->s = __pyx_t_3;

  /* "arrivals.pyx":62
 *         self.a = a
 *         self.s = s
 *         self.c = max(a,d-s)             # <<<<<<<<<<<<<<
 *         self.d = d
 *         self.obs_a = obs_a
 */
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_d, __pyx_v_s); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 62, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_a);
  __pyx_t_4 = __pyx_v_a;
  __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 62, __pyx_L1_error)
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 62, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_7) {
    __Pyx_INCREF(__pyx_t_2);
    __pyx_t_5 = __pyx_t_2;
  } else {
    __Pyx_INCREF(__pyx_t_4);
    __pyx_t_5 = __pyx_t_4;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 62, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_self->c = __pyx_t_3;

  /* "arrivals.pyx":63
 *         self.s = s
 *         self.c = max(a,d-s)
 *         self.d = d             # <<<<<<<<<<<<<<
 *         self.obs_a = obs_a
 *         self.obs_d = obs_d
 */
  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_d); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 63, __pyx_L1_error)
  __pyx_v_self->d = __pyx_t_3;

  /* "arrivals.pyx":64
 *         self.c = max(a,d-s)
 *         self.d = d
 *         self.obs_a = obs_a             # <<<<<<<<<<<<<<
 *         self.obs_d = obs_d
 *         self.state = state
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_obs_a); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 64, __pyx_L1_error)
  __pyx_v_self->obs_a = __pyx_t_1;

  /* "arrivals.pyx":65
 *         self.d = d
 *         self.obs_a = obs_a
 *         self.obs_d = obs_d             # <<<<<<<<<<<<<<
 *         self.state = state
 *         self.proc = proc if proc else 0
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_obs_d); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
  __pyx_v_self->obs_d = __pyx_t_1;

  /* "arrivals.pyx":66
 *         self.obs_a = obs_a
 *         self.obs_d = obs_d
 *         self.state = state             # <<<<<<<<<<<<<<
 *         self.proc = proc if proc else 0
 *         self.arrv = None
 */
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_state); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
  __pyx_v_self->state = __pyx_t_1;

  /* "arrivals.pyx":67
 *         self.obs_d = obs_d
 *         self.state = state
 *         self.proc = proc if proc else 0             # <<<<<<<<<<<<<<
 *         self.arrv = None
 *         if aux:
 */
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_proc); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 67, __pyx_L1_error)
  if (__pyx_t_7) {
    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_proc); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 67, __pyx_L1_error)
    __pyx_t_1 = __pyx_t_8;
  } else {
    __pyx_t_1 = 0;
  }
  __pyx_v_self->proc = __pyx_t_1;

  /* "arrivals.pyx":68
 *         self.state = state
 *         self.proc = proc if proc else 0
 *         self.arrv = None             # <<<<<<<<<<<<<<
 *         if aux:
 *             self.auxiliaries = aux
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->arrv);
  __Pyx_DECREF(__pyx_v_self->arrv);
  __pyx_v_self->arrv = Py_None;

  /* "arrivals.pyx":69
 *         self.proc = proc if proc else 0
 *         self.arrv = None
 *         if aux:             # <<<<<<<<<<<<<<
 *             self.auxiliaries = aux
 *         else:
 */
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_aux); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 69, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "arrivals.pyx":70
 *         self.arrv = None
 *         if aux:
 *             self.auxiliaries = aux             # <<<<<<<<<<<<<<
 *         else:
 *             self.auxiliaries = Vars({})
 */
    if (!(likely(((__pyx_v_aux) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_aux, __pyx_ptype_8arrivals_Vars))))) __PYX_ERR(0, 70, __pyx_L1_error)
    __pyx_t_5 = __pyx_v_aux;
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_5);
    __Pyx_GOTREF(__pyx_v_self->auxiliaries);
    __Pyx_DECREF(((PyObject *)__pyx_v_self->auxiliaries));
    __pyx_v_self->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)__pyx_t_5);
    __pyx_t_5 = 0;

    /* "arrivals.pyx":69
 *         self.proc = proc if proc else 0
 *         self.arrv = None
 *         if aux:             # <<<<<<<<<<<<<<
 *             self.auxiliaries = aux
 *         else:
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":72
 *             self.auxiliaries = aux
 *         else:
 *             self.auxiliaries = Vars({})             # <<<<<<<<<<<<<<
 * 
 *     def __repr__ (self):
 */
  /*else*/ {
    __pyx_t_5 = PyDict_New(); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 72, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 72, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_8arrivals_Vars), __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 72, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GIVEREF(__pyx_t_5);
    __Pyx_GOTREF(__pyx_v_self->auxiliaries);
    __Pyx_DECREF(((PyObject *)__pyx_v_self->auxiliaries));
    __pyx_v_self->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)__pyx_t_5);
    __pyx_t_5 = 0;
  }
  __pyx_L3:;

  /* "arrivals.pyx":55
 * cdef class Event:
 * 
 *     def __init__ (self, eid, tid, qid, q, a, s, d, state, obs_a=0, obs_d=0, proc=0, aux=None):             # <<<<<<<<<<<<<<
 *         self.eid = eid
 *         self.tid = tid
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("arrivals.Event.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":74
 *             self.auxiliaries = Vars({})
 * 
 *     def __repr__ (self):             # <<<<<<<<<<<<<<
 *         return "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]" % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_3__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_3__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_2__repr__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_2__repr__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "arrivals.pyx":75
 * 
 *     def __repr__ (self):
 *         return "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]" % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__ (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->state); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->proc); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->obs_a); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_self->obs_d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyTuple_New(10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_10, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_10, 4, __pyx_t_5);
  __Pyx_INCREF(__pyx_v_self->q->name);
  __Pyx_GIVEREF(__pyx_v_self->q->name);
  PyTuple_SET_ITEM(__pyx_t_10, 5, __pyx_v_self->q->name);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_10, 6, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_10, 7, __pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_10, 8, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_10, 9, __pyx_t_9);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_9 = __Pyx_PyString_Format(__pyx_kp_s_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 75, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_r = __pyx_t_9;
  __pyx_t_9 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":74
 *             self.auxiliaries = Vars({})
 * 
 *     def __repr__ (self):             # <<<<<<<<<<<<<<
 *         return "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]" % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("arrivals.Event.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":77
 *         return "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]" % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 * 
 *     def __dealloc__ (self):             # <<<<<<<<<<<<<<
 *         if self.d_proc_prev != NULL:
 *             PyMem_Free (self.d_proc_prev)
 */

/* Python wrapper */
static void __pyx_pw_8arrivals_5Event_5__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_8arrivals_5Event_5__dealloc__(PyObject *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__dealloc__ (wrapper)", 0);
  __pyx_pf_8arrivals_5Event_4__dealloc__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

static void __pyx_pf_8arrivals_5Event_4__dealloc__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__dealloc__", 0);

  /* "arrivals.pyx":78
 * 
 *     def __dealloc__ (self):
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             PyMem_Free (self.d_proc_prev)
 * 
 */
  __pyx_t_1 = ((__pyx_v_self->d_proc_prev != NULL) != 0);
  if (__pyx_t_1) {

    /* "arrivals.pyx":79
 *     def __dealloc__ (self):
 *         if self.d_proc_prev != NULL:
 *             PyMem_Free (self.d_proc_prev)             # <<<<<<<<<<<<<<
 * 
 *     def dump (self):
 */
    PyMem_Free(__pyx_v_self->d_proc_prev);

    /* "arrivals.pyx":78
 * 
 *     def __dealloc__ (self):
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             PyMem_Free (self.d_proc_prev)
 * 
 */
  }

  /* "arrivals.pyx":77
 *         return "[EVT %5d: %5.5f .. %5.5f S: %5.5f TID: %5d Q: %s ST: %d PID: %d OBS: %d%d]" % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 * 
 *     def __dealloc__ (self):             # <<<<<<<<<<<<<<
 *         if self.d_proc_prev != NULL:
 *             PyMem_Free (self.d_proc_prev)
 */

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

/* "arrivals.pyx":81
 *             PyMem_Free (self.d_proc_prev)
 * 
 *     def dump (self):             # <<<<<<<<<<<<<<
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_7dump(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_7dump(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("dump (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_6dump(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_6dump(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_v_foo = NULL;
  PyObject *__pyx_v_k = NULL;
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  PyObject *(*__pyx_t_13)(PyObject *);
  int __pyx_t_14;
  __Pyx_RefNannySetupContext("dump", 0);

  /* "arrivals.pyx":82
 * 
 *     def dump (self):
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)             # <<<<<<<<<<<<<<
 *         if self.auxiliaries:
 *             for k in self.auxiliaries.allvars():
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->state); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->proc); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->obs_a); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_self->obs_d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyTuple_New(10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_10, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_10, 4, __pyx_t_5);
  __Pyx_INCREF(__pyx_v_self->q->name);
  __Pyx_GIVEREF(__pyx_v_self->q->name);
  PyTuple_SET_ITEM(__pyx_t_10, 5, __pyx_v_self->q->name);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_10, 6, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_10, 7, __pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_10, 8, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_10, 9, __pyx_t_9);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_9 = __Pyx_PyString_Format(__pyx_kp_s_EVT_5d_23_17g_23_17g_S_23_17g_T, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_v_foo = ((PyObject*)__pyx_t_9);
  __pyx_t_9 = 0;

  /* "arrivals.pyx":83
 *     def dump (self):
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:             # <<<<<<<<<<<<<<
 *             for k in self.auxiliaries.allvars():
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 */
  __pyx_t_11 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_self->auxiliaries)); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 83, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "arrivals.pyx":84
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:
 *             for k in self.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 *         cdef int i
 */
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->auxiliaries), __pyx_n_s_allvars); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 84, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_9 = __Pyx_PyObject_CallNoArg(__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (likely(PyList_CheckExact(__pyx_t_9)) || PyTuple_CheckExact(__pyx_t_9)) {
      __pyx_t_10 = __pyx_t_9; __Pyx_INCREF(__pyx_t_10); __pyx_t_12 = 0;
      __pyx_t_13 = NULL;
    } else {
      __pyx_t_12 = -1; __pyx_t_10 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 84, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_13 = Py_TYPE(__pyx_t_10)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 84, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    for (;;) {
      if (likely(!__pyx_t_13)) {
        if (likely(PyList_CheckExact(__pyx_t_10))) {
          if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_10)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_9 = PyList_GET_ITEM(__pyx_t_10, __pyx_t_12); __Pyx_INCREF(__pyx_t_9); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 84, __pyx_L1_error)
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_10, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_9);
          #endif
        } else {
          if (__pyx_t_12 >= PyTuple_GET_SIZE(__pyx_t_10)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_10, __pyx_t_12); __Pyx_INCREF(__pyx_t_9); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 84, __pyx_L1_error)
          #else
          __pyx_t_9 = PySequence_ITEM(__pyx_t_10, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_9);
          #endif
        }
      } else {
        __pyx_t_9 = __pyx_t_13(__pyx_t_10);
        if (unlikely(!__pyx_t_9)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 84, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_9);
      }
      __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "arrivals.pyx":85
 *         if self.auxiliaries:
 *             for k in self.auxiliaries.allvars():
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))             # <<<<<<<<<<<<<<
 *         cdef int i
 *         if self.d_proc_prev != NULL:
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->auxiliaries), __pyx_n_s_get); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 85, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_7) {
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_k); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_k};
          __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_9);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_k};
          __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_9);
        } else
        #endif
        {
          __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 85, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __pyx_t_7 = NULL;
          __Pyx_INCREF(__pyx_v_k);
          __Pyx_GIVEREF(__pyx_v_k);
          PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_v_k);
          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 85, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_v_k);
      __Pyx_GIVEREF(__pyx_v_k);
      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_k);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = __Pyx_PyString_Format(__pyx_kp_s_s_s, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 85, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 85, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_8));
      __pyx_t_8 = 0;

      /* "arrivals.pyx":84
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:
 *             for k in self.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 *         cdef int i
 */
    }
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "arrivals.pyx":83
 *     def dump (self):
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:             # <<<<<<<<<<<<<<
 *             for k in self.auxiliaries.allvars():
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 */
  }

  /* "arrivals.pyx":87
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 *         cdef int i
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             foo += "[TIMES "
 *             for i from 0 <= i < self.num_proc:
 */
  __pyx_t_11 = ((__pyx_v_self->d_proc_prev != NULL) != 0);
  if (__pyx_t_11) {

    /* "arrivals.pyx":88
 *         cdef int i
 *         if self.d_proc_prev != NULL:
 *             foo += "[TIMES "             # <<<<<<<<<<<<<<
 *             for i from 0 <= i < self.num_proc:
 *                 foo += "%.5f " % self.d_proc_prev[i]
 */
    __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_kp_s_TIMES); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 88, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_10));
    __pyx_t_10 = 0;

    /* "arrivals.pyx":89
 *         if self.d_proc_prev != NULL:
 *             foo += "[TIMES "
 *             for i from 0 <= i < self.num_proc:             # <<<<<<<<<<<<<<
 *                 foo += "%.5f " % self.d_proc_prev[i]
 *             foo += "]"
 */
    __pyx_t_14 = __pyx_v_self->num_proc;
    for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_14; __pyx_v_i++) {

      /* "arrivals.pyx":90
 *             foo += "[TIMES "
 *             for i from 0 <= i < self.num_proc:
 *                 foo += "%.5f " % self.d_proc_prev[i]             # <<<<<<<<<<<<<<
 *             foo += "]"
 *         else: foo += " [NO  TIMES]"
 */
      __pyx_t_10 = PyFloat_FromDouble((__pyx_v_self->d_proc_prev[__pyx_v_i])); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 90, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_5f, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 90, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 90, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_10));
      __pyx_t_10 = 0;
    }

    /* "arrivals.pyx":91
 *             for i from 0 <= i < self.num_proc:
 *                 foo += "%.5f " % self.d_proc_prev[i]
 *             foo += "]"             # <<<<<<<<<<<<<<
 *         else: foo += " [NO  TIMES]"
 *         foo += "]"
 */
    __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_kp_s_); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 91, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_10));
    __pyx_t_10 = 0;

    /* "arrivals.pyx":87
 *                 foo += "%s: %s " % (k, self.auxiliaries.get(k))
 *         cdef int i
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             foo += "[TIMES "
 *             for i from 0 <= i < self.num_proc:
 */
    goto __pyx_L6;
  }

  /* "arrivals.pyx":92
 *                 foo += "%.5f " % self.d_proc_prev[i]
 *             foo += "]"
 *         else: foo += " [NO  TIMES]"             # <<<<<<<<<<<<<<
 *         foo += "]"
 *         return foo
 */
  /*else*/ {
    __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_kp_s_NO_TIMES); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 92, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_10));
    __pyx_t_10 = 0;
  }
  __pyx_L6:;

  /* "arrivals.pyx":93
 *             foo += "]"
 *         else: foo += " [NO  TIMES]"
 *         foo += "]"             # <<<<<<<<<<<<<<
 *         return foo
 * 
 */
  __pyx_t_10 = PyNumber_InPlaceAdd(__pyx_v_foo, __pyx_kp_s_); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 93, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF_SET(__pyx_v_foo, ((PyObject*)__pyx_t_10));
  __pyx_t_10 = 0;

  /* "arrivals.pyx":94
 *         else: foo += " [NO  TIMES]"
 *         foo += "]"
 *         return foo             # <<<<<<<<<<<<<<
 * 
 *     def as_csv (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_foo);
  __pyx_r = __pyx_v_foo;
  goto __pyx_L0;

  /* "arrivals.pyx":81
 *             PyMem_Free (self.d_proc_prev)
 * 
 *     def dump (self):             # <<<<<<<<<<<<<<
 *         foo = "[EVT %5d: %23.17g .. %23.17g S: %23.17g TID: %5d Q: %s ST: %d PID: %d  OBS: %d%d " % (self.eid, self.a, self.d, self.s, self.tid, self.q.name, self.state, self.proc, self.obs_a, self.obs_d)
 *         if self.auxiliaries:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("arrivals.Event.dump", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_foo);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":96
 *         return foo
 * 
 *     def as_csv (self):             # <<<<<<<<<<<<<<
 *          return "%d %d %d  %.5f %.5f %.5f %.5f %d %d %d %d" % (self.eid, self.tid, self.qid, self.a, self.d, self.s, self.wait(), self.state, self.proc, self.obs_a, self.obs_d)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_9as_csv(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_9as_csv(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("as_csv (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_8as_csv(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_8as_csv(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  __Pyx_RefNannySetupContext("as_csv", 0);

  /* "arrivals.pyx":97
 * 
 *     def as_csv (self):
 *          return "%d %d %d  %.5f %.5f %.5f %.5f %d %d %d %d" % (self.eid, self.tid, self.qid, self.a, self.d, self.s, self.wait(), self.state, self.proc, self.obs_a, self.obs_d)             # <<<<<<<<<<<<<<
 * 
 *     def arrival (self): return self.a
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_wait); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  if (__pyx_t_9) {
    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  } else {
    __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->state); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyInt_From_int(__pyx_v_self->proc); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_self->obs_a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = __Pyx_PyInt_From_int(__pyx_v_self->obs_d); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = PyTuple_New(11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_12, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_12, 4, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_12, 5, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_12, 6, __pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_12, 7, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_12, 8, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_12, 9, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_12, 10, __pyx_t_11);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_11 = __Pyx_PyString_Format(__pyx_kp_s_d_d_d_5f_5f_5f_5f_d_d_d_d, __pyx_t_12); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":96
 *         return foo
 * 
 *     def as_csv (self):             # <<<<<<<<<<<<<<
 *          return "%d %d %d  %.5f %.5f %.5f %.5f %d %d %d %d" % (self.eid, self.tid, self.qid, self.a, self.d, self.s, self.wait(), self.state, self.proc, self.obs_a, self.obs_d)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("arrivals.Event.as_csv", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":99
 *          return "%d %d %d  %.5f %.5f %.5f %.5f %d %d %d %d" % (self.eid, self.tid, self.qid, self.a, self.d, self.s, self.wait(), self.state, self.proc, self.obs_a, self.obs_d)
 * 
 *     def arrival (self): return self.a             # <<<<<<<<<<<<<<
 *     def service (self): return self.s
 *     def departure (self): return self.d
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_11arrival(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_11arrival(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("arrival (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_10arrival(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_10arrival(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("arrival", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":100
 * 
 *     def arrival (self): return self.a
 *     def service (self): return self.s             # <<<<<<<<<<<<<<
 *     def departure (self): return self.d
 *     def queue (self): return self.q
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_13service(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_13service(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("service (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_12service(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_12service(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("service", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.service", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":101
 *     def arrival (self): return self.a
 *     def service (self): return self.s
 *     def departure (self): return self.d             # <<<<<<<<<<<<<<
 *     def queue (self): return self.q
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_15departure(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_15departure(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("departure (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_14departure(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_14departure(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("departure", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":102
 *     def service (self): return self.s
 *     def departure (self): return self.d
 *     def queue (self): return self.q             # <<<<<<<<<<<<<<
 * 
 *     # a faster alternative to evt.s = v
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_17queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_17queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_16queue(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_16queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("queue", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->q));
  __pyx_r = ((PyObject *)__pyx_v_self->q);
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":105
 * 
 *     # a faster alternative to evt.s = v
 *     cdef set_service (self, double v):             # <<<<<<<<<<<<<<
 *         self._s = v
 *         c_old = self.c
 */

static PyObject *__pyx_f_8arrivals_5Event_set_service(struct __pyx_obj_8arrivals_Event *__pyx_v_self, double __pyx_v_v) {
  double __pyx_v_c_old;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  double __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("set_service", 0);

  /* "arrivals.pyx":106
 *     # a faster alternative to evt.s = v
 *     cdef set_service (self, double v):
 *         self._s = v             # <<<<<<<<<<<<<<
 *         c_old = self.c
 *         self.reset_commencement()
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_s_2, __pyx_t_1) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":107
 *     cdef set_service (self, double v):
 *         self._s = v
 *         c_old = self.c             # <<<<<<<<<<<<<<
 *         self.reset_commencement()
 *         if self.arrv:
 */
  __pyx_t_2 = __pyx_v_self->c;
  __pyx_v_c_old = __pyx_t_2;

  /* "arrivals.pyx":108
 *         self._s = v
 *         c_old = self.c
 *         self.reset_commencement()             # <<<<<<<<<<<<<<
 *         if self.arrv:
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset_commencement); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":109
 *         c_old = self.c
 *         self.reset_commencement()
 *         if self.arrv:             # <<<<<<<<<<<<<<
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 * 
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_self->arrv); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 109, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "arrivals.pyx":110
 *         self.reset_commencement()
 *         if self.arrv:
 *             self.arrv.update_commencement_cache (self, c_old, self.c)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->arrv, __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_c_old); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->c); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_self), __pyx_t_4, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_self), __pyx_t_4, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, ((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_t_6);
      __pyx_t_4 = 0;
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":109
 *         c_old = self.c
 *         self.reset_commencement()
 *         if self.arrv:             # <<<<<<<<<<<<<<
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 * 
 */
  }

  /* "arrivals.pyx":105
 * 
 *     # a faster alternative to evt.s = v
 *     cdef set_service (self, double v):             # <<<<<<<<<<<<<<
 *         self._s = v
 *         c_old = self.c
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("arrivals.Event.set_service", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":114
 * 
 *     # a faster alternative to evt.s = v
 *     cdef set_departure (self, double d):             # <<<<<<<<<<<<<<
 *         c_old = self.c
 *         d_old = self.d
 */

static PyObject *__pyx_f_8arrivals_5Event_set_departure(struct __pyx_obj_8arrivals_Event *__pyx_v_self, double __pyx_v_d) {
  double __pyx_v_c_old;
  double __pyx_v_d_old;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("set_departure", 0);

  /* "arrivals.pyx":115
 *     # a faster alternative to evt.s = v
 *     cdef set_departure (self, double d):
 *         c_old = self.c             # <<<<<<<<<<<<<<
 *         d_old = self.d
 *         self.d = d
 */
  __pyx_t_1 = __pyx_v_self->c;
  __pyx_v_c_old = __pyx_t_1;

  /* "arrivals.pyx":116
 *     cdef set_departure (self, double d):
 *         c_old = self.c
 *         d_old = self.d             # <<<<<<<<<<<<<<
 *         self.d = d
 *         self.reset_commencement()
 */
  __pyx_t_1 = __pyx_v_self->d;
  __pyx_v_d_old = __pyx_t_1;

  /* "arrivals.pyx":117
 *         c_old = self.c
 *         d_old = self.d
 *         self.d = d             # <<<<<<<<<<<<<<
 *         self.reset_commencement()
 *         if self.arrv:
 */
  __pyx_v_self->d = __pyx_v_d;

  /* "arrivals.pyx":118
 *         d_old = self.d
 *         self.d = d
 *         self.reset_commencement()             # <<<<<<<<<<<<<<
 *         if self.arrv:
 *             self.arrv.update_departure_caches (self, d_old, d)
 */
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_reset_commencement); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 118, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 118, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 118, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":119
 *         self.d = d
 *         self.reset_commencement()
 *         if self.arrv:             # <<<<<<<<<<<<<<
 *             self.arrv.update_departure_caches (self, d_old, d)
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_self->arrv); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 119, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "arrivals.pyx":120
 *         self.reset_commencement()
 *         if self.arrv:
 *             self.arrv.update_departure_caches (self, d_old, d)             # <<<<<<<<<<<<<<
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->arrv, __pyx_n_s_update_departure_caches); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d_old); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_d); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_self), __pyx_t_4, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_self), __pyx_t_4, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 120, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, ((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_t_6);
      __pyx_t_4 = 0;
      __pyx_t_6 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":121
 *         if self.arrv:
 *             self.arrv.update_departure_caches (self, d_old, d)
 *             self.arrv.update_commencement_cache (self, c_old, self.c)             # <<<<<<<<<<<<<<
 * 
 *     def set_state (self, sid): self.state = sid
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->arrv, __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 121, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_c_old); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 121, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->c); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_4, ((PyObject *)__pyx_v_self), __pyx_t_9, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_4, ((PyObject *)__pyx_v_self), __pyx_t_9, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 121, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, ((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_8, __pyx_t_6);
      __pyx_t_9 = 0;
      __pyx_t_6 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":119
 *         self.d = d
 *         self.reset_commencement()
 *         if self.arrv:             # <<<<<<<<<<<<<<
 *             self.arrv.update_departure_caches (self, d_old, d)
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 */
  }

  /* "arrivals.pyx":114
 * 
 *     # a faster alternative to evt.s = v
 *     cdef set_departure (self, double d):             # <<<<<<<<<<<<<<
 *         c_old = self.c
 *         d_old = self.d
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("arrivals.Event.set_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":123
 *             self.arrv.update_commencement_cache (self, c_old, self.c)
 * 
 *     def set_state (self, sid): self.state = sid             # <<<<<<<<<<<<<<
 * 
 *     cpdef Event duplicate (self):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_19set_state(PyObject *__pyx_v_self, PyObject *__pyx_v_sid); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_19set_state(PyObject *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_state (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_18set_state(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_sid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_18set_state(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_sid) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("set_state", 0);
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_sid); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 123, __pyx_L1_error)
  __pyx_v_self->state = __pyx_t_1;

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":125
 *     def set_state (self, sid): self.state = sid
 * 
 *     cpdef Event duplicate (self):             # <<<<<<<<<<<<<<
 *         return self._dup_inner (1)
 * 
 */

static PyObject *__pyx_pw_8arrivals_5Event_21duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event_duplicate(struct __pyx_obj_8arrivals_Event *__pyx_v_self, int __pyx_skip_dispatch) {
  struct __pyx_obj_8arrivals_Event *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("duplicate", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 125, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)__pyx_pw_8arrivals_5Event_21duplicate)) {
      __Pyx_XDECREF(((PyObject *)__pyx_r));
      __Pyx_INCREF(__pyx_t_1);
      __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (__pyx_t_4) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 125, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 125, __pyx_L1_error)
      }
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 125, __pyx_L1_error)
      __pyx_r = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":126
 * 
 *     cpdef Event duplicate (self):
 *         return self._dup_inner (1)             # <<<<<<<<<<<<<<
 * 
 *     cdef Event _dup_inner (self, int dup_aux):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_self->__pyx_vtab)->_dup_inner(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":125
 *     def set_state (self, sid): self.state = sid
 * 
 *     cpdef Event duplicate (self):             # <<<<<<<<<<<<<<
 *         return self._dup_inner (1)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Event.duplicate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_21duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_21duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("duplicate (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_20duplicate(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_20duplicate(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("duplicate", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_8arrivals_5Event_duplicate(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 125, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.duplicate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":128
 *         return self._dup_inner (1)
 * 
 *     cdef Event _dup_inner (self, int dup_aux):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 * 
 */

static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event__dup_inner(struct __pyx_obj_8arrivals_Event *__pyx_v_self, CYTHON_UNUSED int __pyx_v_dup_aux) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_aux = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  double __pyx_t_11;
  __Pyx_RefNannySetupContext("_dup_inner", 0);

  /* "arrivals.pyx":131
 *         cdef Event evt
 * 
 *         aux = self.auxiliaries.duplicate()             # <<<<<<<<<<<<<<
 * 
 *         evt = Event(self.eid, self.tid, self.qid, self.q, self.a, self.s, self.d, self.state, obs_a=self.obs_a, obs_d=self.obs_d, proc=self.proc, aux=aux)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->auxiliaries), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_aux = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":133
 *         aux = self.auxiliaries.duplicate()
 * 
 *         evt = Event(self.eid, self.tid, self.qid, self.q, self.a, self.s, self.d, self.state, obs_a=self.obs_a, obs_d=self.obs_d, proc=self.proc, aux=aux)             # <<<<<<<<<<<<<<
 * 
 *         cdef int i
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->state); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = PyTuple_New(8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_3);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->q));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->q));
  PyTuple_SET_ITEM(__pyx_t_8, 3, ((PyObject *)__pyx_v_self->q));
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_8, 5, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_8, 6, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_8, 7, __pyx_t_7);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = PyDict_New(); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->obs_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_obs_a, __pyx_t_6) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->obs_d); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_obs_d, __pyx_t_6) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->proc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_proc, __pyx_t_6) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_aux, __pyx_v_aux) < 0) __PYX_ERR(0, 133, __pyx_L1_error)
  __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_8arrivals_Event), __pyx_t_8, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_6);
  __pyx_t_6 = 0;

  /* "arrivals.pyx":136
 * 
 *         cdef int i
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             evt.num_proc = self.num_proc
 *             evt.d_prev = self.d_prev
 */
  __pyx_t_9 = ((__pyx_v_self->d_proc_prev != NULL) != 0);
  if (__pyx_t_9) {

    /* "arrivals.pyx":137
 *         cdef int i
 *         if self.d_proc_prev != NULL:
 *             evt.num_proc = self.num_proc             # <<<<<<<<<<<<<<
 *             evt.d_prev = self.d_prev
 *             evt.init_dtimes()
 */
    __pyx_t_10 = __pyx_v_self->num_proc;
    __pyx_v_evt->num_proc = __pyx_t_10;

    /* "arrivals.pyx":138
 *         if self.d_proc_prev != NULL:
 *             evt.num_proc = self.num_proc
 *             evt.d_prev = self.d_prev             # <<<<<<<<<<<<<<
 *             evt.init_dtimes()
 *             memcpy (evt.d_proc_prev, self.d_proc_prev, self.num_proc * sizeof(double))
 */
    __pyx_t_11 = __pyx_v_self->d_prev;
    __pyx_v_evt->d_prev = __pyx_t_11;

    /* "arrivals.pyx":139
 *             evt.num_proc = self.num_proc
 *             evt.d_prev = self.d_prev
 *             evt.init_dtimes()             # <<<<<<<<<<<<<<
 *             memcpy (evt.d_proc_prev, self.d_proc_prev, self.num_proc * sizeof(double))
 * 
 */
    __pyx_t_6 = ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->init_dtimes(__pyx_v_evt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "arrivals.pyx":140
 *             evt.d_prev = self.d_prev
 *             evt.init_dtimes()
 *             memcpy (evt.d_proc_prev, self.d_proc_prev, self.num_proc * sizeof(double))             # <<<<<<<<<<<<<<
 * 
 *         return evt
 */
    memcpy(__pyx_v_evt->d_proc_prev, __pyx_v_self->d_proc_prev, (__pyx_v_self->num_proc * (sizeof(double))));

    /* "arrivals.pyx":136
 * 
 *         cdef int i
 *         if self.d_proc_prev != NULL:             # <<<<<<<<<<<<<<
 *             evt.num_proc = self.num_proc
 *             evt.d_prev = self.d_prev
 */
  }

  /* "arrivals.pyx":142
 *             memcpy (evt.d_proc_prev, self.d_proc_prev, self.num_proc * sizeof(double))
 * 
 *         return evt             # <<<<<<<<<<<<<<
 * 
 *     cdef Event dup_with_structure (self):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_evt));
  __pyx_r = __pyx_v_evt;
  goto __pyx_L0;

  /* "arrivals.pyx":128
 *         return self._dup_inner (1)
 * 
 *     cdef Event _dup_inner (self, int dup_aux):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Event._dup_inner", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_aux);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":144
 *         return evt
 * 
 *     cdef Event dup_with_structure (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt = self._dup_inner (0)
 *         evt.prev_byq = self.prev_byq
 */

static struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_5Event_dup_with_structure(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("dup_with_structure", 0);

  /* "arrivals.pyx":145
 * 
 *     cdef Event dup_with_structure (self):
 *         cdef Event evt = self._dup_inner (0)             # <<<<<<<<<<<<<<
 *         evt.prev_byq = self.prev_byq
 *         evt.next_byq = self.next_byq
 */
  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_self->__pyx_vtab)->_dup_inner(__pyx_v_self, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":146
 *     cdef Event dup_with_structure (self):
 *         cdef Event evt = self._dup_inner (0)
 *         evt.prev_byq = self.prev_byq             # <<<<<<<<<<<<<<
 *         evt.next_byq = self.next_byq
 *         evt.prev_byt = self.prev_byt
 */
  __pyx_t_1 = __pyx_v_self->prev_byq;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_evt->prev_byq);
  __Pyx_DECREF(__pyx_v_evt->prev_byq);
  __pyx_v_evt->prev_byq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":147
 *         cdef Event evt = self._dup_inner (0)
 *         evt.prev_byq = self.prev_byq
 *         evt.next_byq = self.next_byq             # <<<<<<<<<<<<<<
 *         evt.prev_byt = self.prev_byt
 *         evt.next_byt = self.next_byt
 */
  __pyx_t_1 = __pyx_v_self->next_byq;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_evt->next_byq);
  __Pyx_DECREF(__pyx_v_evt->next_byq);
  __pyx_v_evt->next_byq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":148
 *         evt.prev_byq = self.prev_byq
 *         evt.next_byq = self.next_byq
 *         evt.prev_byt = self.prev_byt             # <<<<<<<<<<<<<<
 *         evt.next_byt = self.next_byt
 *         return evt
 */
  __pyx_t_1 = __pyx_v_self->prev_byt;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_evt->prev_byt);
  __Pyx_DECREF(__pyx_v_evt->prev_byt);
  __pyx_v_evt->prev_byt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":149
 *         evt.next_byq = self.next_byq
 *         evt.prev_byt = self.prev_byt
 *         evt.next_byt = self.next_byt             # <<<<<<<<<<<<<<
 *         return evt
 * 
 */
  __pyx_t_1 = __pyx_v_self->next_byt;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_evt->next_byt);
  __Pyx_DECREF(__pyx_v_evt->next_byt);
  __pyx_v_evt->next_byt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":150
 *         evt.prev_byt = self.prev_byt
 *         evt.next_byt = self.next_byt
 *         return evt             # <<<<<<<<<<<<<<
 * 
 *     cdef init_dtimes (self):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __Pyx_INCREF(((PyObject *)__pyx_v_evt));
  __pyx_r = __pyx_v_evt;
  goto __pyx_L0;

  /* "arrivals.pyx":144
 *         return evt
 * 
 *     cdef Event dup_with_structure (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt = self._dup_inner (0)
 *         evt.prev_byq = self.prev_byq
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.dup_with_structure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":152
 *         return evt
 * 
 *     cdef init_dtimes (self):             # <<<<<<<<<<<<<<
 *         self.d_proc_prev = <double*> PyMem_Malloc (self.num_proc * sizeof(double))
 * 
 */

static PyObject *__pyx_f_8arrivals_5Event_init_dtimes(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("init_dtimes", 0);

  /* "arrivals.pyx":153
 * 
 *     cdef init_dtimes (self):
 *         self.d_proc_prev = <double*> PyMem_Malloc (self.num_proc * sizeof(double))             # <<<<<<<<<<<<<<
 * 
 *     def previous_by_queue (self): return self.prev_byq
 */
  __pyx_v_self->d_proc_prev = ((double *)PyMem_Malloc((__pyx_v_self->num_proc * (sizeof(double)))));

  /* "arrivals.pyx":152
 *         return evt
 * 
 *     cdef init_dtimes (self):             # <<<<<<<<<<<<<<
 *         self.d_proc_prev = <double*> PyMem_Malloc (self.num_proc * sizeof(double))
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":155
 *         self.d_proc_prev = <double*> PyMem_Malloc (self.num_proc * sizeof(double))
 * 
 *     def previous_by_queue (self): return self.prev_byq             # <<<<<<<<<<<<<<
 *     def next_by_queue (self): return self.next_byq
 *     def previous_by_task (self): return self.prev_byt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_23previous_by_queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_23previous_by_queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("previous_by_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_22previous_by_queue(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_22previous_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("previous_by_queue", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->prev_byq);
  __pyx_r = __pyx_v_self->prev_byq;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":156
 * 
 *     def previous_by_queue (self): return self.prev_byq
 *     def next_by_queue (self): return self.next_byq             # <<<<<<<<<<<<<<
 *     def previous_by_task (self): return self.prev_byt
 *     def next_by_task (self): return self.next_byt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_25next_by_queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_25next_by_queue(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("next_by_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_24next_by_queue(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_24next_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("next_by_queue", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->next_byq);
  __pyx_r = __pyx_v_self->next_byq;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":157
 *     def previous_by_queue (self): return self.prev_byq
 *     def next_by_queue (self): return self.next_byq
 *     def previous_by_task (self): return self.prev_byt             # <<<<<<<<<<<<<<
 *     def next_by_task (self): return self.next_byt
 *     def set_next_by_task (self, Event e):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_27previous_by_task(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_27previous_by_task(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("previous_by_task (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_26previous_by_task(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_26previous_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("previous_by_task", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->prev_byt);
  __pyx_r = __pyx_v_self->prev_byt;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":158
 *     def next_by_queue (self): return self.next_byq
 *     def previous_by_task (self): return self.prev_byt
 *     def next_by_task (self): return self.next_byt             # <<<<<<<<<<<<<<
 *     def set_next_by_task (self, Event e):
 *         self.next_byt = e
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_29next_by_task(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_29next_by_task(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("next_by_task (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_28next_by_task(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_28next_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("next_by_task", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->next_byt);
  __pyx_r = __pyx_v_self->next_byt;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":159
 *     def previous_by_task (self): return self.prev_byt
 *     def next_by_task (self): return self.next_byt
 *     def set_next_by_task (self, Event e):             # <<<<<<<<<<<<<<
 *         self.next_byt = e
 *         if e is not None: e.prev_byt = self
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_31set_next_by_task(PyObject *__pyx_v_self, PyObject *__pyx_v_e); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_31set_next_by_task(PyObject *__pyx_v_self, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_next_by_task (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) __PYX_ERR(0, 159, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_30set_next_by_task(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_e));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_30set_next_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("set_next_by_task", 0);

  /* "arrivals.pyx":160
 *     def next_by_task (self): return self.next_byt
 *     def set_next_by_task (self, Event e):
 *         self.next_byt = e             # <<<<<<<<<<<<<<
 *         if e is not None: e.prev_byt = self
 *     def set_previous_by_task (self, Event e):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_e));
  __Pyx_GOTREF(__pyx_v_self->next_byt);
  __Pyx_DECREF(__pyx_v_self->next_byt);
  __pyx_v_self->next_byt = ((PyObject *)__pyx_v_e);

  /* "arrivals.pyx":161
 *     def set_next_by_task (self, Event e):
 *         self.next_byt = e
 *         if e is not None: e.prev_byt = self             # <<<<<<<<<<<<<<
 *     def set_previous_by_task (self, Event e):
 *         self.prev_byt = e
 */
  __pyx_t_1 = (((PyObject *)__pyx_v_e) != Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __Pyx_GOTREF(__pyx_v_e->prev_byt);
    __Pyx_DECREF(__pyx_v_e->prev_byt);
    __pyx_v_e->prev_byt = ((PyObject *)__pyx_v_self);
  }

  /* "arrivals.pyx":159
 *     def previous_by_task (self): return self.prev_byt
 *     def next_by_task (self): return self.next_byt
 *     def set_next_by_task (self, Event e):             # <<<<<<<<<<<<<<
 *         self.next_byt = e
 *         if e is not None: e.prev_byt = self
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":162
 *         self.next_byt = e
 *         if e is not None: e.prev_byt = self
 *     def set_previous_by_task (self, Event e):             # <<<<<<<<<<<<<<
 *         self.prev_byt = e
 *         if e is not None: e.next_byt = self
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_33set_previous_by_task(PyObject *__pyx_v_self, PyObject *__pyx_v_e); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_33set_previous_by_task(PyObject *__pyx_v_self, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_previous_by_task (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) __PYX_ERR(0, 162, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_32set_previous_by_task(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_e));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_32set_previous_by_task(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("set_previous_by_task", 0);

  /* "arrivals.pyx":163
 *         if e is not None: e.prev_byt = self
 *     def set_previous_by_task (self, Event e):
 *         self.prev_byt = e             # <<<<<<<<<<<<<<
 *         if e is not None: e.next_byt = self
 *     def set_previous_by_queue (self, Event e):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_e));
  __Pyx_GOTREF(__pyx_v_self->prev_byt);
  __Pyx_DECREF(__pyx_v_self->prev_byt);
  __pyx_v_self->prev_byt = ((PyObject *)__pyx_v_e);

  /* "arrivals.pyx":164
 *     def set_previous_by_task (self, Event e):
 *         self.prev_byt = e
 *         if e is not None: e.next_byt = self             # <<<<<<<<<<<<<<
 *     def set_previous_by_queue (self, Event e):
 *         self.prev_byq = e
 */
  __pyx_t_1 = (((PyObject *)__pyx_v_e) != Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __Pyx_GOTREF(__pyx_v_e->next_byt);
    __Pyx_DECREF(__pyx_v_e->next_byt);
    __pyx_v_e->next_byt = ((PyObject *)__pyx_v_self);
  }

  /* "arrivals.pyx":162
 *         self.next_byt = e
 *         if e is not None: e.prev_byt = self
 *     def set_previous_by_task (self, Event e):             # <<<<<<<<<<<<<<
 *         self.prev_byt = e
 *         if e is not None: e.next_byt = self
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":165
 *         self.prev_byt = e
 *         if e is not None: e.next_byt = self
 *     def set_previous_by_queue (self, Event e):             # <<<<<<<<<<<<<<
 *         self.prev_byq = e
 *         if e is not None: e.next_byq = self
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_35set_previous_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_e); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_35set_previous_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_previous_by_queue (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) __PYX_ERR(0, 165, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_34set_previous_by_queue(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_e));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_34set_previous_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("set_previous_by_queue", 0);

  /* "arrivals.pyx":166
 *         if e is not None: e.next_byt = self
 *     def set_previous_by_queue (self, Event e):
 *         self.prev_byq = e             # <<<<<<<<<<<<<<
 *         if e is not None: e.next_byq = self
 *     def set_next_by_queue (self, Event e):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_e));
  __Pyx_GOTREF(__pyx_v_self->prev_byq);
  __Pyx_DECREF(__pyx_v_self->prev_byq);
  __pyx_v_self->prev_byq = ((PyObject *)__pyx_v_e);

  /* "arrivals.pyx":167
 *     def set_previous_by_queue (self, Event e):
 *         self.prev_byq = e
 *         if e is not None: e.next_byq = self             # <<<<<<<<<<<<<<
 *     def set_next_by_queue (self, Event e):
 *         self.next_byq = e
 */
  __pyx_t_1 = (((PyObject *)__pyx_v_e) != Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __Pyx_GOTREF(__pyx_v_e->next_byq);
    __Pyx_DECREF(__pyx_v_e->next_byq);
    __pyx_v_e->next_byq = ((PyObject *)__pyx_v_self);
  }

  /* "arrivals.pyx":165
 *         self.prev_byt = e
 *         if e is not None: e.next_byt = self
 *     def set_previous_by_queue (self, Event e):             # <<<<<<<<<<<<<<
 *         self.prev_byq = e
 *         if e is not None: e.next_byq = self
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":168
 *         self.prev_byq = e
 *         if e is not None: e.next_byq = self
 *     def set_next_by_queue (self, Event e):             # <<<<<<<<<<<<<<
 *         self.next_byq = e
 *         if e is not None: e.prev_byq = self
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_37set_next_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_e); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_37set_next_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_next_by_queue (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) __PYX_ERR(0, 168, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_36set_next_by_queue(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_e));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_36set_next_by_queue(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("set_next_by_queue", 0);

  /* "arrivals.pyx":169
 *         if e is not None: e.next_byq = self
 *     def set_next_by_queue (self, Event e):
 *         self.next_byq = e             # <<<<<<<<<<<<<<
 *         if e is not None: e.prev_byq = self
 * 
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_e));
  __Pyx_GOTREF(__pyx_v_self->next_byq);
  __Pyx_DECREF(__pyx_v_self->next_byq);
  __pyx_v_self->next_byq = ((PyObject *)__pyx_v_e);

  /* "arrivals.pyx":170
 *     def set_next_by_queue (self, Event e):
 *         self.next_byq = e
 *         if e is not None: e.prev_byq = self             # <<<<<<<<<<<<<<
 * 
 *     def variable (self, var): return self.auxiliaries.get (var)
 */
  __pyx_t_1 = (((PyObject *)__pyx_v_e) != Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_self));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
    __Pyx_GOTREF(__pyx_v_e->prev_byq);
    __Pyx_DECREF(__pyx_v_e->prev_byq);
    __pyx_v_e->prev_byq = ((PyObject *)__pyx_v_self);
  }

  /* "arrivals.pyx":168
 *         self.prev_byq = e
 *         if e is not None: e.next_byq = self
 *     def set_next_by_queue (self, Event e):             # <<<<<<<<<<<<<<
 *         self.next_byq = e
 *         if e is not None: e.prev_byq = self
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":172
 *         if e is not None: e.prev_byq = self
 * 
 *     def variable (self, var): return self.auxiliaries.get (var)             # <<<<<<<<<<<<<<
 *     def set_variable (self, var, value): self.auxiliaries.set (var, value)
 *     def set_all_vars (self, Event e): self.auxiliaries = e.auxiliaries.duplicate()
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_39variable(PyObject *__pyx_v_self, PyObject *__pyx_v_var); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_39variable(PyObject *__pyx_v_self, PyObject *__pyx_v_var) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("variable (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_38variable(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_var));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_38variable(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_var) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("variable", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->auxiliaries), __pyx_n_s_get); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_var); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_var};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_var};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_var);
      __Pyx_GIVEREF(__pyx_v_var);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_var);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Event.variable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":173
 * 
 *     def variable (self, var): return self.auxiliaries.get (var)
 *     def set_variable (self, var, value): self.auxiliaries.set (var, value)             # <<<<<<<<<<<<<<
 *     def set_all_vars (self, Event e): self.auxiliaries = e.auxiliaries.duplicate()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_41set_variable(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_41set_variable(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_var = 0;
  PyObject *__pyx_v_value = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_variable (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_var,&__pyx_n_s_value,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_var)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_value)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("set_variable", 1, 2, 2, 1); __PYX_ERR(0, 173, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "set_variable") < 0)) __PYX_ERR(0, 173, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_var = values[0];
    __pyx_v_value = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("set_variable", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 173, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Event.set_variable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_5Event_40set_variable(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), __pyx_v_var, __pyx_v_value);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_40set_variable(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_var, PyObject *__pyx_v_value) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("set_variable", 0);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->auxiliaries), __pyx_n_s_set); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 173, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_var, __pyx_v_value};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_var, __pyx_v_value};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_INCREF(__pyx_v_var);
    __Pyx_GIVEREF(__pyx_v_var);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_var);
    __Pyx_INCREF(__pyx_v_value);
    __Pyx_GIVEREF(__pyx_v_value);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_value);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.Event.set_variable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":174
 *     def variable (self, var): return self.auxiliaries.get (var)
 *     def set_variable (self, var, value): self.auxiliaries.set (var, value)
 *     def set_all_vars (self, Event e): self.auxiliaries = e.auxiliaries.duplicate()             # <<<<<<<<<<<<<<
 * 
 *     def copy_caches (self, Event other):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_43set_all_vars(PyObject *__pyx_v_self, PyObject *__pyx_v_e); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_43set_all_vars(PyObject *__pyx_v_self, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_all_vars (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_e), __pyx_ptype_8arrivals_Event, 1, "e", 0))) __PYX_ERR(0, 174, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_42set_all_vars(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_e));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_42set_all_vars(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("set_all_vars", 0);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_e->auxiliaries), __pyx_n_s_duplicate); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 174, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 174, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 174, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Vars))))) __PYX_ERR(0, 174, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->auxiliaries);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->auxiliaries));
  __pyx_v_self->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Event.set_all_vars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":176
 *     def set_all_vars (self, Event e): self.auxiliaries = e.auxiliaries.duplicate()
 * 
 *     def copy_caches (self, Event other):             # <<<<<<<<<<<<<<
 *         self.copy_dtimes (other)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_45copy_caches(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_45copy_caches(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("copy_caches (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_other), __pyx_ptype_8arrivals_Event, 1, "other", 0))) __PYX_ERR(0, 176, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_5Event_44copy_caches(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_other));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_44copy_caches(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_other) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("copy_caches", 0);

  /* "arrivals.pyx":177
 * 
 *     def copy_caches (self, Event other):
 *         self.copy_dtimes (other)             # <<<<<<<<<<<<<<
 * 
 *     cdef copy_dtimes (self, Event other):
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_self->__pyx_vtab)->copy_dtimes(__pyx_v_self, __pyx_v_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":176
 *     def set_all_vars (self, Event e): self.auxiliaries = e.auxiliaries.duplicate()
 * 
 *     def copy_caches (self, Event other):             # <<<<<<<<<<<<<<
 *         self.copy_dtimes (other)
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.copy_caches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":179
 *         self.copy_dtimes (other)
 * 
 *     cdef copy_dtimes (self, Event other):             # <<<<<<<<<<<<<<
 *        cdef int i
 *        if self.d_proc_prev == NULL:
 */

static PyObject *__pyx_f_8arrivals_5Event_copy_dtimes(struct __pyx_obj_8arrivals_Event *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_other) {
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("copy_dtimes", 0);

  /* "arrivals.pyx":181
 *     cdef copy_dtimes (self, Event other):
 *        cdef int i
 *        if self.d_proc_prev == NULL:             # <<<<<<<<<<<<<<
 *            self.num_proc = other.num_proc
 *            self.init_dtimes()
 */
  __pyx_t_1 = ((__pyx_v_self->d_proc_prev == NULL) != 0);
  if (__pyx_t_1) {

    /* "arrivals.pyx":182
 *        cdef int i
 *        if self.d_proc_prev == NULL:
 *            self.num_proc = other.num_proc             # <<<<<<<<<<<<<<
 *            self.init_dtimes()
 *        for i from 0 <= i < other.num_proc:
 */
    __pyx_t_2 = __pyx_v_other->num_proc;
    __pyx_v_self->num_proc = __pyx_t_2;

    /* "arrivals.pyx":183
 *        if self.d_proc_prev == NULL:
 *            self.num_proc = other.num_proc
 *            self.init_dtimes()             # <<<<<<<<<<<<<<
 *        for i from 0 <= i < other.num_proc:
 *            self.d_proc_prev[i] = other.d_proc_prev[i]
 */
    __pyx_t_3 = ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_self->__pyx_vtab)->init_dtimes(__pyx_v_self); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 183, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "arrivals.pyx":181
 *     cdef copy_dtimes (self, Event other):
 *        cdef int i
 *        if self.d_proc_prev == NULL:             # <<<<<<<<<<<<<<
 *            self.num_proc = other.num_proc
 *            self.init_dtimes()
 */
  }

  /* "arrivals.pyx":184
 *            self.num_proc = other.num_proc
 *            self.init_dtimes()
 *        for i from 0 <= i < other.num_proc:             # <<<<<<<<<<<<<<
 *            self.d_proc_prev[i] = other.d_proc_prev[i]
 * 
 */
  __pyx_t_2 = __pyx_v_other->num_proc;
  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {

    /* "arrivals.pyx":185
 *            self.init_dtimes()
 *        for i from 0 <= i < other.num_proc:
 *            self.d_proc_prev[i] = other.d_proc_prev[i]             # <<<<<<<<<<<<<<
 * 
 *     def wait (self): return max(0, self.d - self.a - self.s)
 */
    (__pyx_v_self->d_proc_prev[__pyx_v_i]) = (__pyx_v_other->d_proc_prev[__pyx_v_i]);
  }

  /* "arrivals.pyx":179
 *         self.copy_dtimes (other)
 * 
 *     cdef copy_dtimes (self, Event other):             # <<<<<<<<<<<<<<
 *        cdef int i
 *        if self.d_proc_prev == NULL:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Event.copy_dtimes", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":187
 *            self.d_proc_prev[i] = other.d_proc_prev[i]
 * 
 *     def wait (self): return max(0, self.d - self.a - self.s)             # <<<<<<<<<<<<<<
 * 
 *     def commencement (self): return self.c
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_47wait(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_47wait(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("wait (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_46wait(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_46wait(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  long __pyx_t_2;
  double __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("wait", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((__pyx_v_self->d - __pyx_v_self->a) - __pyx_v_self->s);
  __pyx_t_2 = 0;
  if (((__pyx_t_1 > __pyx_t_2) != 0)) {
    __pyx_t_3 = __pyx_t_1;
  } else {
    __pyx_t_3 = __pyx_t_2;
  }
  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Event.wait", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":189
 *     def wait (self): return max(0, self.d - self.a - self.s)
 * 
 *     def commencement (self): return self.c             # <<<<<<<<<<<<<<
 *     def reset_commencement (self):
 *         # max b/c of numerical issues
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_49commencement(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_49commencement(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("commencement (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_48commencement(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_48commencement(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("commencement", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->c); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.commencement", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":190
 * 
 *     def commencement (self): return self.c
 *     def reset_commencement (self):             # <<<<<<<<<<<<<<
 *         # max b/c of numerical issues
 *         self.c = max(self.a, self.d - self.s)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_51reset_commencement(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_51reset_commencement(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reset_commencement (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_50reset_commencement(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_50reset_commencement(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  double __pyx_t_2;
  double __pyx_t_3;
  __Pyx_RefNannySetupContext("reset_commencement", 0);

  /* "arrivals.pyx":192
 *     def reset_commencement (self):
 *         # max b/c of numerical issues
 *         self.c = max(self.a, self.d - self.s)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_1 = (__pyx_v_self->d - __pyx_v_self->s);
  __pyx_t_2 = __pyx_v_self->a;
  if (((__pyx_t_1 > __pyx_t_2) != 0)) {
    __pyx_t_3 = __pyx_t_1;
  } else {
    __pyx_t_3 = __pyx_t_2;
  }
  __pyx_v_self->c = __pyx_t_3;

  /* "arrivals.pyx":190
 * 
 *     def commencement (self): return self.c
 *     def reset_commencement (self):             # <<<<<<<<<<<<<<
 *         # max b/c of numerical issues
 *         self.c = max(self.a, self.d - self.s)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":195
 * 
 * 
 *     cdef int update_from_solution (self, lp_soln) except -1:             # <<<<<<<<<<<<<<
 *         d_new = round (lp_soln['d[%d]' % self.eid], 9)
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)
 */

static int __pyx_f_8arrivals_5Event_update_from_solution(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_lp_soln) {
  PyObject *__pyx_v_d_new = NULL;
  PyObject *__pyx_v_a_new = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  double __pyx_t_6;
  __Pyx_RefNannySetupContext("update_from_solution", 0);

  /* "arrivals.pyx":196
 * 
 *     cdef int update_from_solution (self, lp_soln) except -1:
 *         d_new = round (lp_soln['d[%d]' % self.eid], 9)             # <<<<<<<<<<<<<<
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_d_d, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_GetItem(__pyx_v_lp_soln, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_INCREF(__pyx_int_9);
  __Pyx_GIVEREF(__pyx_int_9);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_int_9);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_round, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_d_new = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":197
 *     cdef int update_from_solution (self, lp_soln) except -1:
 *         d_new = round (lp_soln['d[%d]' % self.eid], 9)
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)             # <<<<<<<<<<<<<<
 * 
 *         if self.obs_d:
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_a_d, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_GetItem(__pyx_v_lp_soln, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_INCREF(__pyx_int_9);
  __Pyx_GIVEREF(__pyx_int_9);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_int_9);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_round, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_a_new = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":199
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)
 * 
 *         if self.obs_d:             # <<<<<<<<<<<<<<
 *             assert abs(self.d - d_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s" % (self, self.a, self.d, a_new, d_new, (d_new - self.d))
 * 
 */
  __pyx_t_3 = (__pyx_v_self->obs_d != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":200
 * 
 *         if self.obs_d:
 *             assert abs(self.d - d_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s" % (self, self.a, self.d, a_new, d_new, (d_new - self.d))             # <<<<<<<<<<<<<<
 * 
 *         if self.obs_a:
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyNumber_Subtract(__pyx_t_1, __pyx_v_d_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Absolute(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_float_1eneg_8, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 200, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) {
        __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyNumber_Subtract(__pyx_v_d_new, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyTuple_New(6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_1);
        __Pyx_INCREF(__pyx_v_a_new);
        __Pyx_GIVEREF(__pyx_v_a_new);
        PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_a_new);
        __Pyx_INCREF(__pyx_v_d_new);
        __Pyx_GIVEREF(__pyx_v_d_new);
        PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_v_d_new);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_4, 5, __pyx_t_5);
        __pyx_t_2 = 0;
        __pyx_t_1 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Error_in_initializing_observed_e, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 200, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        PyErr_SetObject(PyExc_AssertionError, __pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __PYX_ERR(0, 200, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":199
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)
 * 
 *         if self.obs_d:             # <<<<<<<<<<<<<<
 *             assert abs(self.d - d_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s" % (self, self.a, self.d, a_new, d_new, (d_new - self.d))
 * 
 */
  }

  /* "arrivals.pyx":202
 *             assert abs(self.d - d_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s" % (self, self.a, self.d, a_new, d_new, (d_new - self.d))
 * 
 *         if self.obs_a:             # <<<<<<<<<<<<<<
 *             assert abs(self.a - a_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s]" % (self, self.a, self.d, a_new, d_new)
 * 
 */
  __pyx_t_3 = (__pyx_v_self->obs_a != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":203
 * 
 *         if self.obs_a:
 *             assert abs(self.a - a_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s]" % (self, self.a, self.d, a_new, d_new)             # <<<<<<<<<<<<<<
 * 
 *         self.d = d_new
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyNumber_Subtract(__pyx_t_5, __pyx_v_a_new); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyNumber_Absolute(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_float_1eneg_8, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) {
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 203, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 203, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 203, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_5);
        __Pyx_INCREF(__pyx_v_a_new);
        __Pyx_GIVEREF(__pyx_v_a_new);
        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_v_a_new);
        __Pyx_INCREF(__pyx_v_d_new);
        __Pyx_GIVEREF(__pyx_v_d_new);
        PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_v_d_new);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Error_in_initializing_observed_e_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 203, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        PyErr_SetObject(PyExc_AssertionError, __pyx_t_5);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __PYX_ERR(0, 203, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":202
 *             assert abs(self.d - d_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s], diff %s" % (self, self.a, self.d, a_new, d_new, (d_new - self.d))
 * 
 *         if self.obs_a:             # <<<<<<<<<<<<<<
 *             assert abs(self.a - a_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s]" % (self, self.a, self.d, a_new, d_new)
 * 
 */
  }

  /* "arrivals.pyx":205
 *             assert abs(self.a - a_new) < 1e-8, "Error in initializing observed event %s...\n was [%s %s] got from LP [%s %s]" % (self, self.a, self.d, a_new, d_new)
 * 
 *         self.d = d_new             # <<<<<<<<<<<<<<
 *         self.a = a_new
 * 
 */
  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_v_d_new); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 205, __pyx_L1_error)
  __pyx_v_self->d = __pyx_t_6;

  /* "arrivals.pyx":206
 * 
 *         self.d = d_new
 *         self.a = a_new             # <<<<<<<<<<<<<<
 * 
 *         return 0
 */
  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_v_a_new); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 206, __pyx_L1_error)
  __pyx_v_self->a = __pyx_t_6;

  /* "arrivals.pyx":208
 *         self.a = a_new
 * 
 *         return 0             # <<<<<<<<<<<<<<
 * 
 *     def __cmp__ (self, other):
 */
  __pyx_r = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":195
 * 
 * 
 *     cdef int update_from_solution (self, lp_soln) except -1:             # <<<<<<<<<<<<<<
 *         d_new = round (lp_soln['d[%d]' % self.eid], 9)
 *         a_new = round (lp_soln['a[%d]' % self.eid], 9)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.Event.update_from_solution", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d_new);
  __Pyx_XDECREF(__pyx_v_a_new);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":210
 *         return 0
 * 
 *     def __cmp__ (self, other):             # <<<<<<<<<<<<<<
 *         c = cmp(self.a, other.a)
 *         if c == 0: c = cmp(self.d, other.d)
 */

/* Python wrapper */
#if PY_MAJOR_VERSION < 3
static int __pyx_pw_8arrivals_5Event_53__cmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other); /*proto*/
static int __pyx_pw_8arrivals_5Event_53__cmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__cmp__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_52__cmp__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_other));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
#endif /*!(#if PY_MAJOR_VERSION < 3)*/

#if PY_MAJOR_VERSION < 3
static int __pyx_pf_8arrivals_5Event_52__cmp__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_c = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("__cmp__", 0);

  /* "arrivals.pyx":211
 * 
 *     def __cmp__ (self, other):
 *         c = cmp(self.a, other.a)             # <<<<<<<<<<<<<<
 *         if c == 0: c = cmp(self.d, other.d)
 *         if c == 0: c = cmp(self.tid, other.tid)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_c = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "arrivals.pyx":212
 *     def __cmp__ (self, other):
 *         c = cmp(self.a, other.a)
 *         if c == 0: c = cmp(self.d, other.d)             # <<<<<<<<<<<<<<
 *         if c == 0: c = cmp(self.tid, other.tid)
 *         return c
 */
  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_c, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 212, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_c, __pyx_t_3);
    __pyx_t_3 = 0;
  }

  /* "arrivals.pyx":213
 *         c = cmp(self.a, other.a)
 *         if c == 0: c = cmp(self.d, other.d)
 *         if c == 0: c = cmp(self.tid, other.tid)             # <<<<<<<<<<<<<<
 *         return c
 * 
 */
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_c, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 213, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_4) {
    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __pyx_t_3 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_c, __pyx_t_1);
    __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":214
 *         if c == 0: c = cmp(self.d, other.d)
 *         if c == 0: c = cmp(self.tid, other.tid)
 *         return c             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_v_c); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
  __pyx_r = __pyx_t_5;
  goto __pyx_L0;

  /* "arrivals.pyx":210
 *         return 0
 * 
 *     def __cmp__ (self, other):             # <<<<<<<<<<<<<<
 *         c = cmp(self.a, other.a)
 *         if c == 0: c = cmp(self.d, other.d)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Event.__cmp__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
#endif /*!(#if PY_MAJOR_VERSION < 3)*/

/* "arrivals.pxd":12
 * 
 * cdef class Event:
 *     cdef readonly int eid             # <<<<<<<<<<<<<<
 *     cdef readonly int tid
 *     cdef Queue q
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_3eid_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_3eid_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_3eid___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_3eid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.eid.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":13
 * cdef class Event:
 *     cdef readonly int eid
 *     cdef readonly int tid             # <<<<<<<<<<<<<<
 *     cdef Queue q
 *     cdef readonly int qid
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_3tid_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_3tid_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_3tid___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_3tid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.tid.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":15
 *     cdef readonly int tid
 *     cdef Queue q
 *     cdef readonly int qid             # <<<<<<<<<<<<<<
 *     cdef readonly int state
 *     cdef public double a
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_3qid_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_3qid_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_3qid___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_3qid___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.qid.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":16
 *     cdef Queue q
 *     cdef readonly int qid
 *     cdef readonly int state             # <<<<<<<<<<<<<<
 *     cdef public double a
 *     cdef public double s
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_5state_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_5state_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_5state___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_5state___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->state); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 16, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.state.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":17
 *     cdef readonly int qid
 *     cdef readonly int state
 *     cdef public double a             # <<<<<<<<<<<<<<
 *     cdef public double s
 *     cdef public double c
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_1a_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_1a_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1a___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_1a___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->a); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.a.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_1a_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_1a_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1a_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_1a_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_v_self->a = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.a.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":18
 *     cdef readonly int state
 *     cdef public double a
 *     cdef public double s             # <<<<<<<<<<<<<<
 *     cdef public double c
 *     cdef public double d
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_1s_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_1s_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1s___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_1s___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->s); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 18, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.s.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_1s_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_1s_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1s_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_1s_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 18, __pyx_L1_error)
  __pyx_v_self->s = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.s.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":19
 *     cdef public double a
 *     cdef public double s
 *     cdef public double c             # <<<<<<<<<<<<<<
 *     cdef public double d
 *     cdef public int obs_a
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_1c_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_1c_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1c___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_1c___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->c); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 19, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.c.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_1c_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_1c_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1c_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_1c_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 19, __pyx_L1_error)
  __pyx_v_self->c = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.c.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":20
 *     cdef public double s
 *     cdef public double c
 *     cdef public double d             # <<<<<<<<<<<<<<
 *     cdef public int obs_a
 *     cdef public int obs_d
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_1d_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_1d_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1d___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_1d___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->d); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 20, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.d.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_1d_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_1d_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_1d_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_1d_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  double __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 20, __pyx_L1_error)
  __pyx_v_self->d = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.d.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":21
 *     cdef public double c
 *     cdef public double d
 *     cdef public int obs_a             # <<<<<<<<<<<<<<
 *     cdef public int obs_d
 *     cdef object prev_byt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_5obs_a_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_5obs_a_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_5obs_a___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_5obs_a___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->obs_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 21, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.obs_a.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_5obs_a_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_5obs_a_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_5obs_a_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_5obs_a_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_value); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 21, __pyx_L1_error)
  __pyx_v_self->obs_a = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.obs_a.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":22
 *     cdef public double d
 *     cdef public int obs_a
 *     cdef public int obs_d             # <<<<<<<<<<<<<<
 *     cdef object prev_byt
 *     cdef object next_byt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_5obs_d_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_5obs_d_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_5obs_d___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_5obs_d___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->obs_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 22, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.obs_d.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_5obs_d_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_5obs_d_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_5obs_d_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_5obs_d_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_value); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 22, __pyx_L1_error)
  __pyx_v_self->obs_d = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.obs_d.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":30
 * 
 *     # For G/G/k queues
 *     cdef public int proc             # <<<<<<<<<<<<<<
 *     cdef int num_proc
 *     cdef double d_prev
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_4proc_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_4proc_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_4proc___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_4proc___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->proc); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 30, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Event.proc.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static int __pyx_pw_8arrivals_5Event_4proc_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pw_8arrivals_5Event_4proc_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_4proc_2__set__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self), ((PyObject *)__pyx_v_value));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_5Event_4proc_2__set__(struct __pyx_obj_8arrivals_Event *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("__set__", 0);
  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_value); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 30, __pyx_L1_error)
  __pyx_v_self->proc = __pyx_t_1;

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("arrivals.Event.proc.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pxd":36
 * 
 *     # used by mixture distributions, etc.
 *     cdef readonly Vars auxiliaries             # <<<<<<<<<<<<<<
 * 
 *     cdef set_service (self, double v)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5Event_11auxiliaries_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_5Event_11auxiliaries_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_5Event_11auxiliaries___get__(((struct __pyx_obj_8arrivals_Event *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_5Event_11auxiliaries___get__(struct __pyx_obj_8arrivals_Event *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__get__", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->auxiliaries));
  __pyx_r = ((PyObject *)__pyx_v_self->auxiliaries);
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":217
 * 
 * 
 * def sort_by_arrival (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_arrival)
 *     return evtl
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_1sort_by_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evtl); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_1sort_by_arrival = {"sort_by_arrival", (PyCFunction)__pyx_pw_8arrivals_1sort_by_arrival, METH_O, 0};
static PyObject *__pyx_pw_8arrivals_1sort_by_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evtl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sort_by_arrival (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_sort_by_arrival(__pyx_self, ((PyObject *)__pyx_v_evtl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_sort_by_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evtl) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("sort_by_arrival", 0);

  /* "arrivals.pyx":218
 * 
 * def sort_by_arrival (evtl):
 *     evtl.sort(cmp=cmp_by_arrival)             # <<<<<<<<<<<<<<
 *     return evtl
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evtl, __pyx_n_s_sort); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_cmp_by_arrival); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_cmp, __pyx_t_3) < 0) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "arrivals.pyx":219
 * def sort_by_arrival (evtl):
 *     evtl.sort(cmp=cmp_by_arrival)
 *     return evtl             # <<<<<<<<<<<<<<
 * 
 * def sort_by_departure (evtl):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_evtl);
  __pyx_r = __pyx_v_evtl;
  goto __pyx_L0;

  /* "arrivals.pyx":217
 * 
 * 
 * def sort_by_arrival (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_arrival)
 *     return evtl
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.sort_by_arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":221
 *     return evtl
 * 
 * def sort_by_departure (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_departure)
 *     return evtl
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_3sort_by_departure(PyObject *__pyx_self, PyObject *__pyx_v_evtl); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_3sort_by_departure = {"sort_by_departure", (PyCFunction)__pyx_pw_8arrivals_3sort_by_departure, METH_O, 0};
static PyObject *__pyx_pw_8arrivals_3sort_by_departure(PyObject *__pyx_self, PyObject *__pyx_v_evtl) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sort_by_departure (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_2sort_by_departure(__pyx_self, ((PyObject *)__pyx_v_evtl));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_2sort_by_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evtl) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("sort_by_departure", 0);

  /* "arrivals.pyx":222
 * 
 * def sort_by_departure (evtl):
 *     evtl.sort(cmp=cmp_by_departure)             # <<<<<<<<<<<<<<
 *     return evtl
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evtl, __pyx_n_s_sort); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_cmp_by_departure); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_cmp, __pyx_t_3) < 0) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "arrivals.pyx":223
 * def sort_by_departure (evtl):
 *     evtl.sort(cmp=cmp_by_departure)
 *     return evtl             # <<<<<<<<<<<<<<
 * 
 * def cmp_by_arrival (self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_evtl);
  __pyx_r = __pyx_v_evtl;
  goto __pyx_L0;

  /* "arrivals.pyx":221
 *     return evtl
 * 
 * def sort_by_departure (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_departure)
 *     return evtl
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.sort_by_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":225
 *     return evtl
 * 
 * def cmp_by_arrival (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.a, other.a)
 *     return cmp(self.d, other.d) if c == 0 else c
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_5cmp_by_arrival(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_5cmp_by_arrival = {"cmp_by_arrival", (PyCFunction)__pyx_pw_8arrivals_5cmp_by_arrival, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_8arrivals_5cmp_by_arrival(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("cmp_by_arrival (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("cmp_by_arrival", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cmp_by_arrival") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("cmp_by_arrival", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 225, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.cmp_by_arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_4cmp_by_arrival(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_4cmp_by_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("cmp_by_arrival", 0);

  /* "arrivals.pyx":226
 * 
 * def cmp_by_arrival (self, other):
 *     c = cmp(self.a, other.a)             # <<<<<<<<<<<<<<
 *     return cmp(self.d, other.d) if c == 0 else c
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 226, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 226, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 226, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 226, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_c = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "arrivals.pyx":227
 * def cmp_by_arrival (self, other):
 *     c = cmp(self.a, other.a)
 *     return cmp(self.d, other.d) if c == 0 else c             # <<<<<<<<<<<<<<
 * 
 * def cmp_by_departure (self, other):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_c, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_4) {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
    __pyx_t_3 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_2 = __pyx_t_1;
    __pyx_t_1 = 0;
  } else {
    __Pyx_INCREF(__pyx_v_c);
    __pyx_t_2 = __pyx_v_c;
  }
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":225
 *     return evtl
 * 
 * def cmp_by_arrival (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.a, other.a)
 *     return cmp(self.d, other.d) if c == 0 else c
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.cmp_by_arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":229
 *     return cmp(self.d, other.d) if c == 0 else c
 * 
 * def cmp_by_departure (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.d, other.d)
 *     return cmp(self.a, other.a) if c == 0 else c
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_7cmp_by_departure(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_7cmp_by_departure = {"cmp_by_departure", (PyCFunction)__pyx_pw_8arrivals_7cmp_by_departure, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_8arrivals_7cmp_by_departure(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_self = 0;
  PyObject *__pyx_v_other = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("cmp_by_departure (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_other,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("cmp_by_departure", 1, 2, 2, 1); __PYX_ERR(0, 229, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cmp_by_departure") < 0)) __PYX_ERR(0, 229, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_self = values[0];
    __pyx_v_other = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("cmp_by_departure", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 229, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.cmp_by_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_6cmp_by_departure(__pyx_self, __pyx_v_self, __pyx_v_other);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_6cmp_by_departure(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_other) {
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("cmp_by_departure", 0);

  /* "arrivals.pyx":230
 * 
 * def cmp_by_departure (self, other):
 *     c = cmp(self.d, other.d)             # <<<<<<<<<<<<<<
 *     return cmp(self.a, other.a) if c == 0 else c
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 230, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_c = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "arrivals.pyx":231
 * def cmp_by_departure (self, other):
 *     c = cmp(self.d, other.d)
 *     return cmp(self.a, other.a) if c == 0 else c             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_c, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 231, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_4) {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 231, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_other, __pyx_n_s_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 231, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
    __pyx_t_3 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_cmp, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_2 = __pyx_t_1;
    __pyx_t_1 = 0;
  } else {
    __Pyx_INCREF(__pyx_v_c);
    __pyx_t_2 = __pyx_v_c;
  }
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":229
 *     return cmp(self.d, other.d) if c == 0 else c
 * 
 * def cmp_by_departure (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.d, other.d)
 *     return cmp(self.a, other.a) if c == 0 else c
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.cmp_by_departure", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":235
 * 
 * 
 * def _get_arrival (evt): return (evt.a, evt.d)             # <<<<<<<<<<<<<<
 * 
 * BIG_N = 10000
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_9_get_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_9_get_arrival = {"_get_arrival", (PyCFunction)__pyx_pw_8arrivals_9_get_arrival, METH_O, 0};
static PyObject *__pyx_pw_8arrivals_9_get_arrival(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_get_arrival (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8_get_arrival(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8_get_arrival(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("_get_arrival", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals._get_arrival", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":243
 * 
 *     ## TODO: Are the python lists going to be fast enough?
 *     def __init__ (self, net, cap=BIG_N):             # <<<<<<<<<<<<<<
 *         """nq the number of queues in the net."""
 *         self.net = net
 */

/* Python wrapper */
static int __pyx_pw_8arrivals_8Arrivals_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8arrivals_8Arrivals___init__[] = "nq the number of queues in the net.";
#if CYTHON_COMPILING_IN_CPYTHON
struct wrapperbase __pyx_wrapperbase_8arrivals_8Arrivals___init__;
#endif
static int __pyx_pw_8arrivals_8Arrivals_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_net = 0;
  PyObject *__pyx_v_cap = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_net,&__pyx_n_s_cap,0};
    PyObject* values[2] = {0,0};
    values[1] = __pyx_k__2;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_net)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_cap);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 243, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_net = values[0];
    __pyx_v_cap = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 243, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals___init__(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_net, __pyx_v_cap);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8arrivals_8Arrivals___init__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_net, PyObject *__pyx_v_cap) {
  Py_ssize_t __pyx_v_nq;
  CYTHON_UNUSED Py_ssize_t __pyx_v_i;
  PyObject *__pyx_v_q = NULL;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "arrivals.pyx":245
 *     def __init__ (self, net, cap=BIG_N):
 *         """nq the number of queues in the net."""
 *         self.net = net             # <<<<<<<<<<<<<<
 *         nq = len (self.net.queues)
 *         self.byq = []
 */
  if (!(likely(((__pyx_v_net) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_net, __pyx_ptype_4qnet_Qnet))))) __PYX_ERR(0, 245, __pyx_L1_error)
  __pyx_t_1 = __pyx_v_net;
  __Pyx_INCREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->net);
  __Pyx_DECREF(((PyObject *)__pyx_v_self->net));
  __pyx_v_self->net = ((struct __pyx_obj_4qnet_Qnet *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":246
 *         """nq the number of queues in the net."""
 *         self.net = net
 *         nq = len (self.net.queues)             # <<<<<<<<<<<<<<
 *         self.byq = []
 *         self.final_byq = []
 */
  __pyx_t_1 = __pyx_v_self->net->queues;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 246, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_nq = __pyx_t_2;

  /* "arrivals.pyx":247
 *         self.net = net
 *         nq = len (self.net.queues)
 *         self.byq = []             # <<<<<<<<<<<<<<
 *         self.final_byq = []
 *         for i in xrange(nq):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 247, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->byq);
  __Pyx_DECREF(__pyx_v_self->byq);
  __pyx_v_self->byq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":248
 *         nq = len (self.net.queues)
 *         self.byq = []
 *         self.final_byq = []             # <<<<<<<<<<<<<<
 *         for i in xrange(nq):
 *             self.byq.append(None)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 248, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->final_byq);
  __Pyx_DECREF(__pyx_v_self->final_byq);
  __pyx_v_self->final_byq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":249
 *         self.byq = []
 *         self.final_byq = []
 *         for i in xrange(nq):             # <<<<<<<<<<<<<<
 *             self.byq.append(None)
 *             self.final_byq.append(None)
 */
  __pyx_t_2 = __pyx_v_nq;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "arrivals.pyx":250
 *         self.final_byq = []
 *         for i in xrange(nq):
 *             self.byq.append(None)             # <<<<<<<<<<<<<<
 *             self.final_byq.append(None)
 *         self.byt = dict()
 */
    __pyx_t_4 = __Pyx_PyObject_Append(__pyx_v_self->byq, Py_None); if (unlikely(__pyx_t_4 == -1)) __PYX_ERR(0, 250, __pyx_L1_error)

    /* "arrivals.pyx":251
 *         for i in xrange(nq):
 *             self.byq.append(None)
 *             self.final_byq.append(None)             # <<<<<<<<<<<<<<
 *         self.byt = dict()
 *         self.events = {}
 */
    __pyx_t_4 = __Pyx_PyObject_Append(__pyx_v_self->final_byq, Py_None); if (unlikely(__pyx_t_4 == -1)) __PYX_ERR(0, 251, __pyx_L1_error)
  }

  /* "arrivals.pyx":252
 *             self.byq.append(None)
 *             self.final_byq.append(None)
 *         self.byt = dict()             # <<<<<<<<<<<<<<
 *         self.events = {}
 *         self._initial_events = None
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 252, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->byt);
  __Pyx_DECREF(__pyx_v_self->byt);
  __pyx_v_self->byt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":253
 *             self.final_byq.append(None)
 *         self.byt = dict()
 *         self.events = {}             # <<<<<<<<<<<<<<
 *         self._initial_events = None
 *         self.queue_orders = [ q.queue_order() for q in self.net.queues ]
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 253, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->events);
  __Pyx_DECREF(__pyx_v_self->events);
  __pyx_v_self->events = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":254
 *         self.byt = dict()
 *         self.events = {}
 *         self._initial_events = None             # <<<<<<<<<<<<<<
 *         self.queue_orders = [ q.queue_order() for q in self.net.queues ]
 *         self.queue_orders[0] = ARRV_BY_D # special case for initial queue
 */
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  __Pyx_GOTREF(__pyx_v_self->_initial_events);
  __Pyx_DECREF(__pyx_v_self->_initial_events);
  __pyx_v_self->_initial_events = Py_None;

  /* "arrivals.pyx":255
 *         self.events = {}
 *         self._initial_events = None
 *         self.queue_orders = [ q.queue_order() for q in self.net.queues ]             # <<<<<<<<<<<<<<
 *         self.queue_orders[0] = ARRV_BY_D # special case for initial queue
 *         self.ninq = [ cninq.Ninq(cap) for q in range(nq) ]
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 255, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_v_self->net->queues)) || PyTuple_CheckExact(__pyx_v_self->net->queues)) {
    __pyx_t_5 = __pyx_v_self->net->queues; __Pyx_INCREF(__pyx_t_5); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_self->net->queues); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 255, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 255, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_5))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_7); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 255, __pyx_L1_error)
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 255, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_7); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 255, __pyx_L1_error)
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 255, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        #endif
      }
    } else {
      __pyx_t_7 = __pyx_t_6(__pyx_t_5);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 255, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_7);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_queue_order); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 255, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
      }
    }
    if (__pyx_t_9) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 255, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else {
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 255, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_7))) __PYX_ERR(0, 255, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->queue_orders);
  __Pyx_DECREF(__pyx_v_self->queue_orders);
  __pyx_v_self->queue_orders = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":256
 *         self._initial_events = None
 *         self.queue_orders = [ q.queue_order() for q in self.net.queues ]
 *         self.queue_orders[0] = ARRV_BY_D # special case for initial queue             # <<<<<<<<<<<<<<
 *         self.ninq = [ cninq.Ninq(cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_ARRV_BY_D); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely(__Pyx_SetItemInt(__pyx_v_self->queue_orders, 0, __pyx_t_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 256, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":257
 *         self.queue_orders = [ q.queue_order() for q in self.net.queues ]
 *         self.queue_orders[0] = ARRV_BY_D # special case for initial queue
 *         self.ninq = [ cninq.Ninq(cap) for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 257, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_nq); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
    __pyx_t_7 = __pyx_t_5; __Pyx_INCREF(__pyx_t_7); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 257, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_7))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_7, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_7, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      }
    } else {
      __pyx_t_5 = __pyx_t_6(__pyx_t_7);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 257, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_5);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_8 = __Pyx_GetModuleGlobalName(__pyx_n_s_cninq); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 257, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_Ninq); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 257, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_cap); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_cap};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_5);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_cap};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_5);
      } else
      #endif
      {
        __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
        __Pyx_INCREF(__pyx_v_cap);
        __Pyx_GIVEREF(__pyx_v_cap);
        PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_v_cap);
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_10, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_5))) __PYX_ERR(0, 257, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->ninq);
  __Pyx_DECREF(__pyx_v_self->ninq);
  __pyx_v_self->ninq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":258
 *         self.queue_orders[0] = ARRV_BY_D # special case for initial queue
 *         self.ninq = [ cninq.Ninq(cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = PyInt_FromSsize_t(__pyx_v_nq); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (likely(PyList_CheckExact(__pyx_t_7)) || PyTuple_CheckExact(__pyx_t_7)) {
    __pyx_t_5 = __pyx_t_7; __Pyx_INCREF(__pyx_t_5); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 258, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_5))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_7); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_7); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
        #else
        __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        #endif
      }
    } else {
      __pyx_t_7 = __pyx_t_6(__pyx_t_5);
      if (unlikely(!__pyx_t_7)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 258, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_7);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_9 = __Pyx_GetModuleGlobalName(__pyx_n_s_ninqueue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_SortedList); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
      }
    }
    if (__pyx_t_9) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else {
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_7))) __PYX_ERR(0, 258, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->c2e_cache);
  __Pyx_DECREF(__pyx_v_self->c2e_cache);
  __pyx_v_self->c2e_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":259
 *         self.ninq = [ cninq.Ninq(cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.inq = self.setup_inq_cache()
 *         self.cap = cap
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_nq); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
    __pyx_t_7 = __pyx_t_5; __Pyx_INCREF(__pyx_t_7); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_7))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_7, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_7, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      }
    } else {
      __pyx_t_5 = __pyx_t_6(__pyx_t_7);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 259, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_5);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_10 = __Pyx_GetModuleGlobalName(__pyx_n_s_ninqueue); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_SortedList); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 259, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (__pyx_t_10) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    } else {
      __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_5))) __PYX_ERR(0, 259, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->a2e_cache);
  __Pyx_DECREF(__pyx_v_self->a2e_cache);
  __pyx_v_self->a2e_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":260
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()             # <<<<<<<<<<<<<<
 *         self.cap = cap
 * 
 */
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_setup_inq_cache); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  if (__pyx_t_5) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->inq);
  __Pyx_DECREF(__pyx_v_self->inq);
  __pyx_v_self->inq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":261
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()
 *         self.cap = cap             # <<<<<<<<<<<<<<
 * 
 *     def __iter__ (self): return self.events.values().__iter__()
 */
  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_cap); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 261, __pyx_L1_error)
  __pyx_v_self->cap = __pyx_t_11;

  /* "arrivals.pyx":243
 * 
 *     ## TODO: Are the python lists going to be fast enough?
 *     def __init__ (self, net, cap=BIG_N):             # <<<<<<<<<<<<<<
 *         """nq the number of queues in the net."""
 *         self.net = net
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("arrivals.Arrivals.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":263
 *         self.cap = cap
 * 
 *     def __iter__ (self): return self.events.values().__iter__()             # <<<<<<<<<<<<<<
 * 
 *     def __repr__ (self):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_3__iter__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_3__iter__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_2__iter__(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_2__iter__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("__iter__", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->events, __pyx_n_s_values); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 263, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 263, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_iter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 263, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 263, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":265
 *     def __iter__ (self): return self.events.values().__iter__()
 * 
 *     def __repr__ (self):             # <<<<<<<<<<<<<<
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_5__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_5__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_4__repr__(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_4__repr__(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_ret = NULL;
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  __Pyx_RefNannySetupContext("__repr__", 0);

  /* "arrivals.pyx":266
 * 
 *     def __repr__ (self):
 *         ret = ""             # <<<<<<<<<<<<<<
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 */
  __Pyx_INCREF(__pyx_kp_s__3);
  __pyx_v_ret = __pyx_kp_s__3;

  /* "arrivals.pyx":267
 *     def __repr__ (self):
 *         ret = ""
 *         for qi in xrange(len(self.byq)):             # <<<<<<<<<<<<<<
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 */
  __pyx_t_1 = __pyx_v_self->byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 267, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_qi = __pyx_t_3;

    /* "arrivals.pyx":268
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]             # <<<<<<<<<<<<<<
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->net->queues, __pyx_v_qi, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 268, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":269
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)             # <<<<<<<<<<<<<<
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + str(evt)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 269, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 269, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 269, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
    __pyx_t_1 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_QUEUE_s_d, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 269, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Add(__pyx_v_ret, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 269, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "arrivals.pyx":270
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 ret = ret + str(evt)
 *                 ret = ret + "\n"
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_5);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 270, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_4 = __pyx_t_5; __Pyx_INCREF(__pyx_t_4); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_9 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 270, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_4))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 270, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 270, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 270, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_9(__pyx_t_4);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 270, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":271
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + str(evt)             # <<<<<<<<<<<<<<
 *                 ret = ret + "\n"
 *         return ret
 */
      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 271, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(__pyx_v_evt);
      __Pyx_GIVEREF(__pyx_v_evt);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_evt);
      __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)(&PyString_Type)), __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 271, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyNumber_Add(__pyx_v_ret, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 271, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":272
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + str(evt)
 *                 ret = ret + "\n"             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
      __pyx_t_5 = PyNumber_Add(__pyx_v_ret, __pyx_kp_s__4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 272, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":270
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 ret = ret + str(evt)
 *                 ret = ret + "\n"
 */
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "arrivals.pyx":273
 *                 ret = ret + str(evt)
 *                 ret = ret + "\n"
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def display (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "arrivals.pyx":265
 *     def __iter__ (self): return self.events.values().__iter__()
 * 
 *     def __repr__ (self):             # <<<<<<<<<<<<<<
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":275
 *         return ret
 * 
 *     def display (self):             # <<<<<<<<<<<<<<
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_7display(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_7display(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("display (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_6display(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_6display(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  __Pyx_RefNannySetupContext("display", 0);

  /* "arrivals.pyx":276
 * 
 *     def display (self):
 *         for qi in xrange(len(self.byq)):             # <<<<<<<<<<<<<<
 *             q = self.net.queues[qi]
 *             print "QUEUE %s (%d)" % (q.name, qi)
 */
  __pyx_t_1 = __pyx_v_self->byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 276, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_qi = __pyx_t_3;

    /* "arrivals.pyx":277
 *     def display (self):
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]             # <<<<<<<<<<<<<<
 *             print "QUEUE %s (%d)" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->net->queues, __pyx_v_qi, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":278
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 *             print "QUEUE %s (%d)" % (q.name, qi)             # <<<<<<<<<<<<<<
 *             for evt in self.events_of_qid (qi):
 *                 print evt
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 278, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 278, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
    __pyx_t_1 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_QUEUE_s_d_2, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 278, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__Pyx_PrintOne(0, __pyx_t_4) < 0) __PYX_ERR(0, 278, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "arrivals.pyx":279
 *             q = self.net.queues[qi]
 *             print "QUEUE %s (%d)" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 print evt
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 279, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_5 = __pyx_t_4; __Pyx_INCREF(__pyx_t_5); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 279, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 279, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 279, __pyx_L1_error)
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 279, __pyx_L1_error)
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_9(__pyx_t_5);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 279, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":280
 *             print "QUEUE %s (%d)" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 *                 print evt             # <<<<<<<<<<<<<<
 * 
 *     def dump (self):
 */
      if (__Pyx_PrintOne(0, __pyx_v_evt) < 0) __PYX_ERR(0, 280, __pyx_L1_error)

      /* "arrivals.pyx":279
 *             q = self.net.queues[qi]
 *             print "QUEUE %s (%d)" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 print evt
 * 
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }

  /* "arrivals.pyx":275
 *         return ret
 * 
 *     def display (self):             # <<<<<<<<<<<<<<
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.display", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":282
 *                 print evt
 * 
 *     def dump (self):             # <<<<<<<<<<<<<<
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_9dump(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_9dump(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("dump (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_8dump(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_8dump(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_ret = NULL;
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  __Pyx_RefNannySetupContext("dump", 0);

  /* "arrivals.pyx":283
 * 
 *     def dump (self):
 *         ret = ""             # <<<<<<<<<<<<<<
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 */
  __Pyx_INCREF(__pyx_kp_s__3);
  __pyx_v_ret = __pyx_kp_s__3;

  /* "arrivals.pyx":284
 *     def dump (self):
 *         ret = ""
 *         for qi in xrange(len(self.byq)):             # <<<<<<<<<<<<<<
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 */
  __pyx_t_1 = __pyx_v_self->byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 284, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_qi = __pyx_t_3;

    /* "arrivals.pyx":285
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]             # <<<<<<<<<<<<<<
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->net->queues, __pyx_v_qi, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":286
 *         for qi in xrange(len(self.byq)):
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)             # <<<<<<<<<<<<<<
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + evt.dump()
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
    __pyx_t_1 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_QUEUE_s_d, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Add(__pyx_v_ret, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 286, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "arrivals.pyx":287
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 ret = ret + evt.dump()
 *                 ret = ret + "\n"
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 287, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 287, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_5);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_1};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 287, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_4 = __pyx_t_5; __Pyx_INCREF(__pyx_t_4); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 287, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_9 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 287, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_4))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 287, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_8); __Pyx_INCREF(__pyx_t_5); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 287, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 287, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_9(__pyx_t_4);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 287, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":288
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + evt.dump()             # <<<<<<<<<<<<<<
 *                 ret = ret + "\n"
 *         return ret
 */
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_dump); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (__pyx_t_1) {
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 288, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 288, __pyx_L1_error)
      }
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_Add(__pyx_v_ret, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "arrivals.pyx":289
 *             for evt in self.events_of_qid (qi):
 *                 ret = ret + evt.dump()
 *                 ret = ret + "\n"             # <<<<<<<<<<<<<<
 *         return ret
 * 
 */
      __pyx_t_7 = PyNumber_Add(__pyx_v_ret, __pyx_kp_s__4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 289, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_7);
      __pyx_t_7 = 0;

      /* "arrivals.pyx":287
 *             q = self.net.queues[qi]
 *             ret = ret + "QUEUE %s (%d)\n" % (q.name, qi)
 *             for evt in self.events_of_qid (qi):             # <<<<<<<<<<<<<<
 *                 ret = ret + evt.dump()
 *                 ret = ret + "\n"
 */
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "arrivals.pyx":290
 *                 ret = ret + evt.dump()
 *                 ret = ret + "\n"
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def as_csv (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "arrivals.pyx":282
 *                 print evt
 * 
 *     def dump (self):             # <<<<<<<<<<<<<<
 *         ret = ""
 *         for qi in xrange(len(self.byq)):
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.dump", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":292
 *         return ret
 * 
 *     def as_csv (self):             # <<<<<<<<<<<<<<
 *         ret = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n"
 *         cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_11as_csv(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_11as_csv(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("as_csv (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_10as_csv(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_10as_csv(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_ret = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  __Pyx_RefNannySetupContext("as_csv", 0);

  /* "arrivals.pyx":293
 * 
 *     def as_csv (self):
 *         ret = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n"             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in self:
 */
  __Pyx_INCREF(__pyx_kp_s_EID_TID_QID_A_D_S_W_STATE_PROC_O);
  __pyx_v_ret = __pyx_kp_s_EID_TID_QID_A_D_S_W_STATE_PROC_O;

  /* "arrivals.pyx":295
 *         ret = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n"
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             ret = ret + evt.as_csv()
 *             for k in evt.auxiliaries.allvars():
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 295, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 295, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 295, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 295, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 295, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 295, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 295, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 295, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "arrivals.pyx":296
 *         cdef Event evt
 *         for evt in self:
 *             ret = ret + evt.as_csv()             # <<<<<<<<<<<<<<
 *             for k in evt.auxiliaries.allvars():
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_as_csv); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 296, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 296, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 296, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Add(__pyx_v_ret, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 296, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "arrivals.pyx":297
 *         for evt in self:
 *             ret = ret + evt.as_csv()
 *             for k in evt.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 *             if evt.auxiliaries.num_vars() == 0:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_allvars); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 297, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 297, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 297, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
      __pyx_t_4 = __pyx_t_5; __Pyx_INCREF(__pyx_t_4); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 297, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 297, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_4))) {
          if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 297, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 297, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        } else {
          if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_7); __Pyx_INCREF(__pyx_t_5); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 297, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 297, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_8(__pyx_t_4);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 297, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":298
 *             ret = ret + evt.as_csv()
 *             for k in evt.auxiliaries.allvars():
 *                 ret += " %s" % (evt.auxiliaries.get(k))             # <<<<<<<<<<<<<<
 *             if evt.auxiliaries.num_vars() == 0:
 *                 ret += " NA"
 */
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_get); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      if (!__pyx_t_9) {
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_k); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 298, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_v_k};
          __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 298, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_GOTREF(__pyx_t_5);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_v_k};
          __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 298, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_GOTREF(__pyx_t_5);
        } else
        #endif
        {
          __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 298, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9); __pyx_t_9 = NULL;
          __Pyx_INCREF(__pyx_v_k);
          __Pyx_GIVEREF(__pyx_v_k);
          PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_v_k);
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_10, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 298, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_s_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":297
 *         for evt in self:
 *             ret = ret + evt.as_csv()
 *             for k in evt.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 *             if evt.auxiliaries.num_vars() == 0:
 */
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "arrivals.pyx":299
 *             for k in evt.auxiliaries.allvars():
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 *             if evt.auxiliaries.num_vars() == 0:             # <<<<<<<<<<<<<<
 *                 ret += " NA"
 *             ret += "\n"
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_num_vars); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 299, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 299, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 299, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 299, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 299, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_11) {

      /* "arrivals.pyx":300
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 *             if evt.auxiliaries.num_vars() == 0:
 *                 ret += " NA"             # <<<<<<<<<<<<<<
 *             ret += "\n"
 * 
 */
      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_kp_s_NA); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "arrivals.pyx":299
 *             for k in evt.auxiliaries.allvars():
 *                 ret += " %s" % (evt.auxiliaries.get(k))
 *             if evt.auxiliaries.num_vars() == 0:             # <<<<<<<<<<<<<<
 *                 ret += " NA"
 *             ret += "\n"
 */
    }

    /* "arrivals.pyx":301
 *             if evt.auxiliaries.num_vars() == 0:
 *                 ret += " NA"
 *             ret += "\n"             # <<<<<<<<<<<<<<
 * 
 *         return ret
 */
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_ret, __pyx_kp_s__4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 301, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF_SET(__pyx_v_ret, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "arrivals.pyx":295
 *         ret = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n"
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             ret = ret + evt.as_csv()
 *             for k in evt.auxiliaries.allvars():
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":303
 *             ret += "\n"
 * 
 *         return ret             # <<<<<<<<<<<<<<
 * 
 *     def write_csv (self, f):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ret);
  __pyx_r = __pyx_v_ret;
  goto __pyx_L0;

  /* "arrivals.pyx":292
 *         return ret
 * 
 *     def as_csv (self):             # <<<<<<<<<<<<<<
 *         ret = "EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n"
 *         cdef Event evt
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("arrivals.Arrivals.as_csv", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ret);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":305
 *         return ret
 * 
 *     def write_csv (self, f):             # <<<<<<<<<<<<<<
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")
 *         cdef Event evt
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_13write_csv(PyObject *__pyx_v_self, PyObject *__pyx_v_f); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_13write_csv(PyObject *__pyx_v_self, PyObject *__pyx_v_f) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("write_csv (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_12write_csv(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_f));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_12write_csv(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_f) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  __Pyx_RefNannySetupContext("write_csv", 0);

  /* "arrivals.pyx":306
 * 
 *     def write_csv (self, f):
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in self:
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":308
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             f.write (evt.as_csv())
 *             for k in evt.auxiliaries.allvars():
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_2 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 308, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 308, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 308, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 308, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 308, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 308, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 308, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "arrivals.pyx":309
 *         cdef Event evt
 *         for evt in self:
 *             f.write (evt.as_csv())             # <<<<<<<<<<<<<<
 *             for k in evt.auxiliaries.allvars():
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 309, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_as_csv); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 309, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 309, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_6 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 309, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_7) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 309, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 309, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_t_6};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 309, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 309, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __pyx_t_7 = NULL;
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 309, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":310
 *         for evt in self:
 *             f.write (evt.as_csv())
 *             for k in evt.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_allvars); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 310, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_5 = __pyx_t_1; __Pyx_INCREF(__pyx_t_5); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 310, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 310, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_5))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 310, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 310, __pyx_L1_error)
          #else
          __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_10(__pyx_t_5);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 310, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "arrivals.pyx":311
 *             f.write (evt.as_csv())
 *             for k in evt.auxiliaries.allvars():
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))             # <<<<<<<<<<<<<<
 *             if evt.auxiliaries.num_vars() == 0:
 *                 f.write(" NA")
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 311, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_get); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 311, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_11 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_k); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_11, __pyx_v_k};
          __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_GOTREF(__pyx_t_6);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_11, __pyx_v_k};
          __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_GOTREF(__pyx_t_6);
        } else
        #endif
        {
          __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_11); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __pyx_t_11 = NULL;
          __Pyx_INCREF(__pyx_v_k);
          __Pyx_GIVEREF(__pyx_v_k);
          PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_v_k);
          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_12, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyString_Format(__pyx_kp_s_s_3, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 311, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      if (!__pyx_t_6) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_7};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
          PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_7};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        {
          __pyx_t_12 = PyTuple_New(1+1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_6); __pyx_t_6 = NULL;
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_12, 0+1, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "arrivals.pyx":310
 *         for evt in self:
 *             f.write (evt.as_csv())
 *             for k in evt.auxiliaries.allvars():             # <<<<<<<<<<<<<<
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:
 */
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "arrivals.pyx":312
 *             for k in evt.auxiliaries.allvars():
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:             # <<<<<<<<<<<<<<
 *                 f.write(" NA")
 *             f.write("\n")
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->auxiliaries), __pyx_n_s_num_vars); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 312, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 312, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_5 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 312, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 312, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 312, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_13) {

      /* "arrivals.pyx":313
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:
 *                 f.write(" NA")             # <<<<<<<<<<<<<<
 *             f.write("\n")
 * 
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 313, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 313, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "arrivals.pyx":312
 *             for k in evt.auxiliaries.allvars():
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:             # <<<<<<<<<<<<<<
 *                 f.write(" NA")
 *             f.write("\n")
 */
    }

    /* "arrivals.pyx":314
 *             if evt.auxiliaries.num_vars() == 0:
 *                 f.write(" NA")
 *             f.write("\n")             # <<<<<<<<<<<<<<
 * 
 *     def all_events (self):
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_f, __pyx_n_s_write); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":308
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             f.write (evt.as_csv())
 *             for k in evt.auxiliaries.allvars():
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":305
 *         return ret
 * 
 *     def write_csv (self, f):             # <<<<<<<<<<<<<<
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")
 *         cdef Event evt
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("arrivals.Arrivals.write_csv", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":316
 *             f.write("\n")
 * 
 *     def all_events (self):             # <<<<<<<<<<<<<<
 *         return self.events.values()
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_15all_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_15all_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("all_events (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_14all_events(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_14all_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("all_events", 0);

  /* "arrivals.pyx":317
 * 
 *     def all_events (self):
 *         return self.events.values()             # <<<<<<<<<<<<<<
 * 
 *     def events_of_qid (self, qid):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->events, __pyx_n_s_values); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":316
 *             f.write("\n")
 * 
 *     def all_events (self):             # <<<<<<<<<<<<<<
 *         return self.events.values()
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Arrivals.all_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":319
 *         return self.events.values()
 * 
 *     def events_of_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event e0 = self.byq[qid]
 *         result = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_17events_of_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_17events_of_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("events_of_qid (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_16events_of_qid(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_qid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_16events_of_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_e0 = 0;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_visited = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  __Pyx_RefNannySetupContext("events_of_qid", 0);

  /* "arrivals.pyx":320
 * 
 *     def events_of_qid (self, qid):
 *         cdef Event e0 = self.byq[qid]             # <<<<<<<<<<<<<<
 *         result = []
 *         if not e0: return result
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 320, __pyx_L1_error)
  __pyx_v_e0 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":321
 *     def events_of_qid (self, qid):
 *         cdef Event e0 = self.byq[qid]
 *         result = []             # <<<<<<<<<<<<<<
 *         if not e0: return result
 * 
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_result = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":322
 *         cdef Event e0 = self.byq[qid]
 *         result = []
 *         if not e0: return result             # <<<<<<<<<<<<<<
 * 
 *         visited = {}
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_e0)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 322, __pyx_L1_error)
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (__pyx_t_3) {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_result);
    __pyx_r = __pyx_v_result;
    goto __pyx_L0;
  }

  /* "arrivals.pyx":324
 *         if not e0: return result
 * 
 *         visited = {}             # <<<<<<<<<<<<<<
 *         while e0.prev_byq:
 *             if e0.eid in visited:
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_visited = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":325
 * 
 *         visited = {}
 *         while e0.prev_byq:             # <<<<<<<<<<<<<<
 *             if e0.eid in visited:
 *                 print e0
 */
  while (1) {
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_e0->prev_byq); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 325, __pyx_L1_error)
    if (!__pyx_t_3) break;

    /* "arrivals.pyx":326
 *         visited = {}
 *         while e0.prev_byq:
 *             if e0.eid in visited:             # <<<<<<<<<<<<<<
 *                 print e0
 *                 print visited.keys()
 */
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_e0->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 326, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = (__Pyx_PyDict_ContainsTF(__pyx_t_1, __pyx_v_visited, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 326, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = (__pyx_t_3 != 0);
    if (__pyx_t_2) {

      /* "arrivals.pyx":327
 *         while e0.prev_byq:
 *             if e0.eid in visited:
 *                 print e0             # <<<<<<<<<<<<<<
 *                 print visited.keys()
 *                 raise Exception ("Cycle!!!")
 */
      if (__Pyx_PrintOne(0, ((PyObject *)__pyx_v_e0)) < 0) __PYX_ERR(0, 327, __pyx_L1_error)

      /* "arrivals.pyx":328
 *             if e0.eid in visited:
 *                 print e0
 *                 print visited.keys()             # <<<<<<<<<<<<<<
 *                 raise Exception ("Cycle!!!")
 *             visited[e0.eid] = True
 */
      __pyx_t_1 = __Pyx_PyDict_Keys(__pyx_v_visited); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_PrintOne(0, __pyx_t_1) < 0) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "arrivals.pyx":329
 *                 print e0
 *                 print visited.keys()
 *                 raise Exception ("Cycle!!!")             # <<<<<<<<<<<<<<
 *             visited[e0.eid] = True
 *             e0 = e0.prev_byq
 */
      __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __PYX_ERR(0, 329, __pyx_L1_error)

      /* "arrivals.pyx":326
 *         visited = {}
 *         while e0.prev_byq:
 *             if e0.eid in visited:             # <<<<<<<<<<<<<<
 *                 print e0
 *                 print visited.keys()
 */
    }

    /* "arrivals.pyx":330
 *                 print visited.keys()
 *                 raise Exception ("Cycle!!!")
 *             visited[e0.eid] = True             # <<<<<<<<<<<<<<
 *             e0 = e0.prev_byq
 *         self.byq[qid] = e0
 */
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_e0->eid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 330, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(PyDict_SetItem(__pyx_v_visited, __pyx_t_1, Py_True) < 0)) __PYX_ERR(0, 330, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":331
 *                 raise Exception ("Cycle!!!")
 *             visited[e0.eid] = True
 *             e0 = e0.prev_byq             # <<<<<<<<<<<<<<
 *         self.byq[qid] = e0
 * 
 */
    if (!(likely(((__pyx_v_e0->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e0->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 331, __pyx_L1_error)
    __pyx_t_1 = __pyx_v_e0->prev_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_e0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":332
 *             visited[e0.eid] = True
 *             e0 = e0.prev_byq
 *         self.byq[qid] = e0             # <<<<<<<<<<<<<<
 * 
 *         # add e0 and successors
 */
  if (unlikely(PyObject_SetItem(__pyx_v_self->byq, __pyx_v_qid, ((PyObject *)__pyx_v_e0)) < 0)) __PYX_ERR(0, 332, __pyx_L1_error)

  /* "arrivals.pyx":335
 * 
 *         # add e0 and successors
 *         result = []             # <<<<<<<<<<<<<<
 *         cdef Event e = e0
 *         while e:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF_SET(__pyx_v_result, ((PyObject*)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "arrivals.pyx":336
 *         # add e0 and successors
 *         result = []
 *         cdef Event e = e0             # <<<<<<<<<<<<<<
 *         while e:
 *             result.append (e)
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_e0));
  __pyx_v_e = __pyx_v_e0;

  /* "arrivals.pyx":337
 *         result = []
 *         cdef Event e = e0
 *         while e:             # <<<<<<<<<<<<<<
 *             result.append (e)
 *             e = e.next_byq
 */
  while (1) {
    __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_e)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 337, __pyx_L1_error)
    if (!__pyx_t_2) break;

    /* "arrivals.pyx":338
 *         cdef Event e = e0
 *         while e:
 *             result.append (e)             # <<<<<<<<<<<<<<
 *             e = e.next_byq
 * 
 */
    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_result, ((PyObject *)__pyx_v_e)); if (unlikely(__pyx_t_4 == -1)) __PYX_ERR(0, 338, __pyx_L1_error)

    /* "arrivals.pyx":339
 *         while e:
 *             result.append (e)
 *             e = e.next_byq             # <<<<<<<<<<<<<<
 * 
 *         return result
 */
    if (!(likely(((__pyx_v_e->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_e->next_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 339, __pyx_L1_error)
    __pyx_t_1 = __pyx_v_e->next_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_e, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":341
 *             e = e.next_byq
 * 
 *         return result             # <<<<<<<<<<<<<<
 * 
 *     def events_of_queue (self, queue):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "arrivals.pyx":319
 *         return self.events.values()
 * 
 *     def events_of_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event e0 = self.byq[qid]
 *         result = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.events_of_qid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_e0);
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_visited);
  __Pyx_XDECREF((PyObject *)__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":343
 *         return result
 * 
 *     def events_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.events_of_qid (qid)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_19events_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_19events_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("events_of_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_18events_of_queue(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_queue));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_18events_of_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("events_of_queue", 0);

  /* "arrivals.pyx":344
 * 
 *     def events_of_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)             # <<<<<<<<<<<<<<
 *         return self.events_of_qid (qid)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_queue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 344, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 344, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 344, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 344, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_queue);
      __Pyx_GIVEREF(__pyx_v_queue);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_queue);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 344, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":345
 *     def events_of_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)
 *         return self.events_of_qid (qid)             # <<<<<<<<<<<<<<
 * 
 *     def final_arrival_by_queue (self, queue):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 345, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 345, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 345, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(__pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_qid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 345, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":343
 *         return result
 * 
 *     def events_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.events_of_qid (qid)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.events_of_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":347
 *         return self.events_of_qid (qid)
 * 
 *     def final_arrival_by_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.final_arrival_by_qid (qid)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_21final_arrival_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_21final_arrival_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("final_arrival_by_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_20final_arrival_by_queue(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_queue));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_20final_arrival_by_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("final_arrival_by_queue", 0);

  /* "arrivals.pyx":348
 * 
 *     def final_arrival_by_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)             # <<<<<<<<<<<<<<
 *         return self.final_arrival_by_qid (qid)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_queue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 348, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 348, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 348, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_queue);
      __Pyx_GIVEREF(__pyx_v_queue);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_queue);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 348, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":349
 *     def final_arrival_by_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)
 *         return self.final_arrival_by_qid (qid)             # <<<<<<<<<<<<<<
 * 
 *     def final_arrival_by_qid (self, qid):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final_arrival_by_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 349, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(__pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_qid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":347
 *         return self.events_of_qid (qid)
 * 
 *     def final_arrival_by_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.final_arrival_by_qid (qid)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.final_arrival_by_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":351
 *         return self.final_arrival_by_qid (qid)
 * 
 *     def final_arrival_by_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event final
 *         if self.byq[qid] is None:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_23final_arrival_by_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_23final_arrival_by_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("final_arrival_by_qid (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_22final_arrival_by_qid(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_qid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_22final_arrival_by_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_final = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("final_arrival_by_qid", 0);

  /* "arrivals.pyx":353
 *     def final_arrival_by_qid (self, qid):
 *         cdef Event final
 *         if self.byq[qid] is None:             # <<<<<<<<<<<<<<
 *             return None
 *         else:
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__pyx_t_1 == Py_None);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":354
 *         cdef Event final
 *         if self.byq[qid] is None:
 *             return None             # <<<<<<<<<<<<<<
 *         else:
 *             final = self.final_byq[qid]
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;

    /* "arrivals.pyx":353
 *     def final_arrival_by_qid (self, qid):
 *         cdef Event final
 *         if self.byq[qid] is None:             # <<<<<<<<<<<<<<
 *             return None
 *         else:
 */
  }

  /* "arrivals.pyx":356
 *             return None
 *         else:
 *             final = self.final_byq[qid]             # <<<<<<<<<<<<<<
 *             if final is None:
 *                 final = self.byq[qid]
 */
  /*else*/ {
    __pyx_t_1 = PyObject_GetItem(__pyx_v_self->final_byq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 356, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 356, __pyx_L1_error)
    __pyx_v_final = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":357
 *         else:
 *             final = self.final_byq[qid]
 *             if final is None:             # <<<<<<<<<<<<<<
 *                 final = self.byq[qid]
 *             while final.next_byq is not None:
 */
    __pyx_t_3 = (((PyObject *)__pyx_v_final) == Py_None);
    __pyx_t_2 = (__pyx_t_3 != 0);
    if (__pyx_t_2) {

      /* "arrivals.pyx":358
 *             final = self.final_byq[qid]
 *             if final is None:
 *                 final = self.byq[qid]             # <<<<<<<<<<<<<<
 *             while final.next_byq is not None:
 *                 final = final.next_byq
 */
      __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 358, __pyx_L1_error)
      __Pyx_DECREF_SET(__pyx_v_final, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "arrivals.pyx":357
 *         else:
 *             final = self.final_byq[qid]
 *             if final is None:             # <<<<<<<<<<<<<<
 *                 final = self.byq[qid]
 *             while final.next_byq is not None:
 */
    }

    /* "arrivals.pyx":359
 *             if final is None:
 *                 final = self.byq[qid]
 *             while final.next_byq is not None:             # <<<<<<<<<<<<<<
 *                 final = final.next_byq
 *             self.final_byq[qid] = final
 */
    while (1) {
      __pyx_t_2 = (__pyx_v_final->next_byq != Py_None);
      __pyx_t_3 = (__pyx_t_2 != 0);
      if (!__pyx_t_3) break;

      /* "arrivals.pyx":360
 *                 final = self.byq[qid]
 *             while final.next_byq is not None:
 *                 final = final.next_byq             # <<<<<<<<<<<<<<
 *             self.final_byq[qid] = final
 *             return final
 */
      if (!(likely(((__pyx_v_final->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_final->next_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 360, __pyx_L1_error)
      __pyx_t_1 = __pyx_v_final->next_byq;
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_final, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;
    }

    /* "arrivals.pyx":361
 *             while final.next_byq is not None:
 *                 final = final.next_byq
 *             self.final_byq[qid] = final             # <<<<<<<<<<<<<<
 *             return final
 * 
 */
    if (unlikely(PyObject_SetItem(__pyx_v_self->final_byq, __pyx_v_qid, ((PyObject *)__pyx_v_final)) < 0)) __PYX_ERR(0, 361, __pyx_L1_error)

    /* "arrivals.pyx":362
 *                 final = final.next_byq
 *             self.final_byq[qid] = final
 *             return final             # <<<<<<<<<<<<<<
 * 
 *     def first_arrival_by_queue (self, q):
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject *)__pyx_v_final));
    __pyx_r = ((PyObject *)__pyx_v_final);
    goto __pyx_L0;
  }

  /* "arrivals.pyx":351
 *         return self.final_arrival_by_qid (qid)
 * 
 *     def final_arrival_by_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event final
 *         if self.byq[qid] is None:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.final_arrival_by_qid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_final);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":364
 *             return final
 * 
 *     def first_arrival_by_queue (self, q):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.first_arrival_by_qid (qid)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_25first_arrival_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_q); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_25first_arrival_by_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_q) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("first_arrival_by_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_24first_arrival_by_queue(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_q));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_24first_arrival_by_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("first_arrival_by_queue", 0);

  /* "arrivals.pyx":365
 * 
 *     def first_arrival_by_queue (self, q):
 *         qid = self.net.qid_of_queue (q)             # <<<<<<<<<<<<<<
 *         return self.first_arrival_by_qid (qid)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 365, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_q); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 365, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_q);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":366
 *     def first_arrival_by_queue (self, q):
 *         qid = self.net.qid_of_queue (q)
 *         return self.first_arrival_by_qid (qid)             # <<<<<<<<<<<<<<
 * 
 *     def first_arrival_by_qid (self, qid):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_first_arrival_by_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 366, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_qid};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_3 = PyTuple_New(1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(__pyx_v_qid);
      __Pyx_GIVEREF(__pyx_v_qid);
      PyTuple_SET_ITEM(__pyx_t_3, 0+1, __pyx_v_qid);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":364
 *             return final
 * 
 *     def first_arrival_by_queue (self, q):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.first_arrival_by_qid (qid)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.first_arrival_by_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":368
 *         return self.first_arrival_by_qid (qid)
 * 
 *     def first_arrival_by_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event evt = self.byq[qid]
 *         if not evt: return None
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_27first_arrival_by_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_27first_arrival_by_qid(PyObject *__pyx_v_self, PyObject *__pyx_v_qid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("first_arrival_by_qid (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_26first_arrival_by_qid(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_qid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_26first_arrival_by_qid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_qid) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("first_arrival_by_qid", 0);

  /* "arrivals.pyx":369
 * 
 *     def first_arrival_by_qid (self, qid):
 *         cdef Event evt = self.byq[qid]             # <<<<<<<<<<<<<<
 *         if not evt: return None
 *         while evt.prev_byq:
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 369, __pyx_L1_error)
  __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":370
 *     def first_arrival_by_qid (self, qid):
 *         cdef Event evt = self.byq[qid]
 *         if not evt: return None             # <<<<<<<<<<<<<<
 *         while evt.prev_byq:
 *             evt = evt.prev_byq
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 370, __pyx_L1_error)
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (__pyx_t_3) {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_None);
    __pyx_r = Py_None;
    goto __pyx_L0;
  }

  /* "arrivals.pyx":371
 *         cdef Event evt = self.byq[qid]
 *         if not evt: return None
 *         while evt.prev_byq:             # <<<<<<<<<<<<<<
 *             evt = evt.prev_byq
 *         return evt
 */
  while (1) {
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byq); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 371, __pyx_L1_error)
    if (!__pyx_t_3) break;

    /* "arrivals.pyx":372
 *         if not evt: return None
 *         while evt.prev_byq:
 *             evt = evt.prev_byq             # <<<<<<<<<<<<<<
 *         return evt
 * 
 */
    if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 372, __pyx_L1_error)
    __pyx_t_1 = __pyx_v_evt->prev_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":373
 *         while evt.prev_byq:
 *             evt = evt.prev_byq
 *         return evt             # <<<<<<<<<<<<<<
 * 
 *     def events_of_task (self, tid):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_evt));
  __pyx_r = ((PyObject *)__pyx_v_evt);
  goto __pyx_L0;

  /* "arrivals.pyx":368
 *         return self.first_arrival_by_qid (qid)
 * 
 *     def first_arrival_by_qid (self, qid):             # <<<<<<<<<<<<<<
 *         cdef Event evt = self.byq[qid]
 *         if not evt: return None
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.first_arrival_by_qid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":375
 *         return evt
 * 
 *     def events_of_task (self, tid):             # <<<<<<<<<<<<<<
 *         return self.byt[tid]
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_29events_of_task(PyObject *__pyx_v_self, PyObject *__pyx_v_tid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_29events_of_task(PyObject *__pyx_v_self, PyObject *__pyx_v_tid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("events_of_task (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_28events_of_task(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_tid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_28events_of_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_tid) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("events_of_task", 0);

  /* "arrivals.pyx":376
 * 
 *     def events_of_task (self, tid):
 *         return self.byt[tid]             # <<<<<<<<<<<<<<
 * 
 *     def c2e_range (self, q, l, r):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byt, __pyx_v_tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":375
 *         return evt
 * 
 *     def events_of_task (self, tid):             # <<<<<<<<<<<<<<
 *         return self.byt[tid]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.events_of_task", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":378
 *         return self.byt[tid]
 * 
 *     def c2e_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.c2e_cache[qid].in_range(l,r)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_31c2e_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_31c2e_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_v_l = 0;
  PyObject *__pyx_v_r = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("c2e_range (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_q,&__pyx_n_s_l,&__pyx_n_s_r,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_l)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("c2e_range", 1, 3, 3, 1); __PYX_ERR(0, 378, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_r)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("c2e_range", 1, 3, 3, 2); __PYX_ERR(0, 378, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "c2e_range") < 0)) __PYX_ERR(0, 378, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_q = values[0];
    __pyx_v_l = values[1];
    __pyx_v_r = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("c2e_range", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 378, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.c2e_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_30c2e_range(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_q, __pyx_v_l, __pyx_v_r);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_30c2e_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("c2e_range", 0);

  /* "arrivals.pyx":379
 * 
 *     def c2e_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)             # <<<<<<<<<<<<<<
 *         return self.c2e_cache[qid].in_range(l,r)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_q); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_q);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":380
 *     def c2e_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)
 *         return self.c2e_cache[qid].in_range(l,r)             # <<<<<<<<<<<<<<
 * 
 *     def arrivals_in_range (self, q, l, r):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyObject_GetItem(__pyx_v_self->c2e_cache, __pyx_v_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_in_range); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 380, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_2) {
      __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    __Pyx_INCREF(__pyx_v_l);
    __Pyx_GIVEREF(__pyx_v_l);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_v_l);
    __Pyx_INCREF(__pyx_v_r);
    __Pyx_GIVEREF(__pyx_v_r);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, __pyx_v_r);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":378
 *         return self.byt[tid]
 * 
 *     def c2e_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.c2e_cache[qid].in_range(l,r)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.c2e_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":382
 *         return self.c2e_cache[qid].in_range(l,r)
 * 
 *     def arrivals_in_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.a2e_cache[qid].in_range(l,r)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_33arrivals_in_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_33arrivals_in_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_v_l = 0;
  PyObject *__pyx_v_r = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("arrivals_in_range (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_q,&__pyx_n_s_l,&__pyx_n_s_r,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_l)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("arrivals_in_range", 1, 3, 3, 1); __PYX_ERR(0, 382, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_r)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("arrivals_in_range", 1, 3, 3, 2); __PYX_ERR(0, 382, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "arrivals_in_range") < 0)) __PYX_ERR(0, 382, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_q = values[0];
    __pyx_v_l = values[1];
    __pyx_v_r = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("arrivals_in_range", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 382, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.arrivals_in_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_32arrivals_in_range(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_q, __pyx_v_l, __pyx_v_r);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_32arrivals_in_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_RefNannySetupContext("arrivals_in_range", 0);

  /* "arrivals.pyx":383
 * 
 *     def arrivals_in_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)             # <<<<<<<<<<<<<<
 *         return self.a2e_cache[qid].in_range(l,r)
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 383, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_q); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 383, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_q);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":384
 *     def arrivals_in_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)
 *         return self.a2e_cache[qid].in_range(l,r)             # <<<<<<<<<<<<<<
 * 
 *     def evts_in_range (self, q, l, r):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyObject_GetItem(__pyx_v_self->a2e_cache, __pyx_v_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_in_range); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 384, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_2) {
      __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    __Pyx_INCREF(__pyx_v_l);
    __Pyx_GIVEREF(__pyx_v_l);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_v_l);
    __Pyx_INCREF(__pyx_v_r);
    __Pyx_GIVEREF(__pyx_v_r);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, __pyx_v_r);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":382
 *         return self.c2e_cache[qid].in_range(l,r)
 * 
 *     def arrivals_in_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         return self.a2e_cache[qid].in_range(l,r)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.arrivals_in_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":386
 *         return self.a2e_cache[qid].in_range(l,r)
 * 
 *     def evts_in_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         nodes = self.inq[qid].all_intersect (l, r)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_35evts_in_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_35evts_in_range(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_v_l = 0;
  PyObject *__pyx_v_r = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("evts_in_range (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_q,&__pyx_n_s_l,&__pyx_n_s_r,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_l)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("evts_in_range", 1, 3, 3, 1); __PYX_ERR(0, 386, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_r)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("evts_in_range", 1, 3, 3, 2); __PYX_ERR(0, 386, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "evts_in_range") < 0)) __PYX_ERR(0, 386, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_q = values[0];
    __pyx_v_l = values[1];
    __pyx_v_r = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("evts_in_range", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 386, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.evts_in_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_34evts_in_range(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_q, __pyx_v_l, __pyx_v_r);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_34evts_in_range(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, PyObject *__pyx_v_l, PyObject *__pyx_v_r) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_v_nodes = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  __Pyx_RefNannySetupContext("evts_in_range", 0);

  /* "arrivals.pyx":387
 * 
 *     def evts_in_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)             # <<<<<<<<<<<<<<
 *         nodes = self.inq[qid].all_intersect (l, r)
 *         return [ n.other for n in nodes ]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 387, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_q); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 387, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 387, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_q};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 387, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 387, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_q);
      __Pyx_GIVEREF(__pyx_v_q);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_q);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 387, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":388
 *     def evts_in_range (self, q, l, r):
 *         qid = self.net.qid_of_queue (q)
 *         nodes = self.inq[qid].all_intersect (l, r)             # <<<<<<<<<<<<<<
 *         return [ n.other for n in nodes ]
 * 
 */
  __pyx_t_2 = PyObject_GetItem(__pyx_v_self->inq, __pyx_v_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_all_intersect); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 388, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_l, __pyx_v_r};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 388, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 388, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_2) {
      __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    __Pyx_INCREF(__pyx_v_l);
    __Pyx_GIVEREF(__pyx_v_l);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_5, __pyx_v_l);
    __Pyx_INCREF(__pyx_v_r);
    __Pyx_GIVEREF(__pyx_v_r);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_5, __pyx_v_r);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 388, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_nodes = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":389
 *         qid = self.net.qid_of_queue (q)
 *         nodes = self.inq[qid].all_intersect (l, r)
 *         return [ n.other for n in nodes ]             # <<<<<<<<<<<<<<
 * 
 *     cpdef inline int num_events (self): return len(self.events)
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_v_nodes)) || PyTuple_CheckExact(__pyx_v_nodes)) {
    __pyx_t_4 = __pyx_v_nodes; __Pyx_INCREF(__pyx_t_4); __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_nodes); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 389, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 389, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 389, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_6); __Pyx_INCREF(__pyx_t_3); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 389, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_7(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 389, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_n, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_n, __pyx_n_s_other); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 389, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":386
 *         return self.a2e_cache[qid].in_range(l,r)
 * 
 *     def evts_in_range (self, q, l, r):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (q)
 *         nodes = self.inq[qid].all_intersect (l, r)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.evts_in_range", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XDECREF(__pyx_v_nodes);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":391
 *         return [ n.other for n in nodes ]
 * 
 *     cpdef inline int num_events (self): return len(self.events)             # <<<<<<<<<<<<<<
 * 
 *     def num_hidden_events (self):
 */

static PyObject *__pyx_pw_8arrivals_8Arrivals_37num_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static CYTHON_INLINE int __pyx_f_8arrivals_8Arrivals_num_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("num_events", 0);
  __pyx_t_1 = __pyx_v_self->events;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 391, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_WriteUnraisable("arrivals.Arrivals.num_events", __pyx_clineno, __pyx_lineno, __pyx_filename, 0, 0);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_37num_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_37num_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_events (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_36num_events(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_36num_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("num_events", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_f_8arrivals_8Arrivals_num_events(__pyx_v_self, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 391, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.num_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":393
 *     cpdef inline int num_events (self): return len(self.events)
 * 
 *     def num_hidden_events (self):             # <<<<<<<<<<<<<<
 *         n = 0
 *         for e in self:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_39num_hidden_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_39num_hidden_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_hidden_events (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_38num_hidden_events(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_38num_hidden_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("num_hidden_events", 0);

  /* "arrivals.pyx":394
 * 
 *     def num_hidden_events (self):
 *         n = 0             # <<<<<<<<<<<<<<
 *         for e in self:
 *             if not e.obs_a or not e.obs_d:
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_n = __pyx_int_0;

  /* "arrivals.pyx":395
 *     def num_hidden_events (self):
 *         n = 0
 *         for e in self:             # <<<<<<<<<<<<<<
 *             if not e.obs_a or not e.obs_d:
 *                 n += 1
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 395, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 395, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 395, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 395, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 395, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 395, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 395, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "arrivals.pyx":396
 *         n = 0
 *         for e in self:
 *             if not e.obs_a or not e.obs_d:             # <<<<<<<<<<<<<<
 *                 n += 1
 *         return n
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_obs_a); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = ((!__pyx_t_6) != 0);
    if (!__pyx_t_7) {
    } else {
      __pyx_t_5 = __pyx_t_7;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_obs_d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 396, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = ((!__pyx_t_7) != 0);
    __pyx_t_5 = __pyx_t_6;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_5) {

      /* "arrivals.pyx":397
 *         for e in self:
 *             if not e.obs_a or not e.obs_d:
 *                 n += 1             # <<<<<<<<<<<<<<
 *         return n
 * 
 */
      __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_v_n, __pyx_int_1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 397, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF_SET(__pyx_v_n, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":396
 *         n = 0
 *         for e in self:
 *             if not e.obs_a or not e.obs_d:             # <<<<<<<<<<<<<<
 *                 n += 1
 *         return n
 */
    }

    /* "arrivals.pyx":395
 *     def num_hidden_events (self):
 *         n = 0
 *         for e in self:             # <<<<<<<<<<<<<<
 *             if not e.obs_a or not e.obs_d:
 *                 n += 1
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":398
 *             if not e.obs_a or not e.obs_d:
 *                 n += 1
 *         return n             # <<<<<<<<<<<<<<
 * 
 *     def num_tasks (self): return len(self.byt)
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_n);
  __pyx_r = __pyx_v_n;
  goto __pyx_L0;

  /* "arrivals.pyx":393
 *     cpdef inline int num_events (self): return len(self.events)
 * 
 *     def num_hidden_events (self):             # <<<<<<<<<<<<<<
 *         n = 0
 *         for e in self:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.num_hidden_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":400
 *         return n
 * 
 *     def num_tasks (self): return len(self.byt)             # <<<<<<<<<<<<<<
 * 
 *     def all_tasks (self): return self.byt.keys()
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_41num_tasks(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_41num_tasks(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_tasks (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_40num_tasks(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_40num_tasks(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("num_tasks", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_v_self->byt;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.num_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":402
 *     def num_tasks (self): return len(self.byt)
 * 
 *     def all_tasks (self): return self.byt.keys()             # <<<<<<<<<<<<<<
 * 
 *     def max_eidx (self):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_43all_tasks(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_43all_tasks(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("all_tasks (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_42all_tasks(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_42all_tasks(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  __Pyx_RefNannySetupContext("all_tasks", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->byt, __pyx_n_s_keys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 402, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 402, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 402, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("arrivals.Arrivals.all_tasks", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":404
 *     def all_tasks (self): return self.byt.keys()
 * 
 *     def max_eidx (self):             # <<<<<<<<<<<<<<
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.eid)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_45max_eidx(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_45max_eidx(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("max_eidx (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_44max_eidx(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_44max_eidx(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_the_max = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("max_eidx", 0);

  /* "arrivals.pyx":405
 * 
 *     def max_eidx (self):
 *         the_max = -1             # <<<<<<<<<<<<<<
 *         for evt in self: the_max = max (the_max, evt.eid)
 *         return the_max
 */
  __Pyx_INCREF(__pyx_int_neg_1);
  __pyx_v_the_max = __pyx_int_neg_1;

  /* "arrivals.pyx":406
 *     def max_eidx (self):
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.eid)             # <<<<<<<<<<<<<<
 *         return the_max
 * 
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 406, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 406, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 406, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 406, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 406, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 406, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 406, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_the_max);
    __pyx_t_5 = __pyx_v_the_max;
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 406, __pyx_L1_error)
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 406, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_8) {
      __Pyx_INCREF(__pyx_t_4);
      __pyx_t_6 = __pyx_t_4;
    } else {
      __Pyx_INCREF(__pyx_t_5);
      __pyx_t_6 = __pyx_t_5;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_t_6;
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF_SET(__pyx_v_the_max, __pyx_t_4);
    __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":407
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.eid)
 *         return the_max             # <<<<<<<<<<<<<<
 * 
 *     def max_tid (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_the_max);
  __pyx_r = __pyx_v_the_max;
  goto __pyx_L0;

  /* "arrivals.pyx":404
 *     def all_tasks (self): return self.byt.keys()
 * 
 *     def max_eidx (self):             # <<<<<<<<<<<<<<
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.eid)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.max_eidx", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_the_max);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":409
 *         return the_max
 * 
 *     def max_tid (self):             # <<<<<<<<<<<<<<
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.tid)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_47max_tid(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_47max_tid(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("max_tid (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_46max_tid(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_46max_tid(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_the_max = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  __Pyx_RefNannySetupContext("max_tid", 0);

  /* "arrivals.pyx":410
 * 
 *     def max_tid (self):
 *         the_max = -1             # <<<<<<<<<<<<<<
 *         for evt in self: the_max = max (the_max, evt.tid)
 *         return the_max
 */
  __Pyx_INCREF(__pyx_int_neg_1);
  __pyx_v_the_max = __pyx_int_neg_1;

  /* "arrivals.pyx":411
 *     def max_tid (self):
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.tid)             # <<<<<<<<<<<<<<
 *         return the_max
 * 
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 411, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 411, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 411, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 411, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 411, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 411, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_the_max);
    __pyx_t_5 = __pyx_v_the_max;
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_4, __pyx_t_5, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 411, __pyx_L1_error)
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 411, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_8) {
      __Pyx_INCREF(__pyx_t_4);
      __pyx_t_6 = __pyx_t_4;
    } else {
      __Pyx_INCREF(__pyx_t_5);
      __pyx_t_6 = __pyx_t_5;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_t_6;
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF_SET(__pyx_v_the_max, __pyx_t_4);
    __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":412
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.tid)
 *         return the_max             # <<<<<<<<<<<<<<
 * 
 *     def initial_events (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_the_max);
  __pyx_r = __pyx_v_the_max;
  goto __pyx_L0;

  /* "arrivals.pyx":409
 *         return the_max
 * 
 *     def max_tid (self):             # <<<<<<<<<<<<<<
 *         the_max = -1
 *         for evt in self: the_max = max (the_max, evt.tid)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.max_tid", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_the_max);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":414
 *         return the_max
 * 
 *     def initial_events (self):             # <<<<<<<<<<<<<<
 *         if not self._initial_events:
 *             l = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_49initial_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_49initial_events(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("initial_events (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_48initial_events(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_48initial_events(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_l = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_evts = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("initial_events", 0);

  /* "arrivals.pyx":415
 * 
 *     def initial_events (self):
 *         if not self._initial_events:             # <<<<<<<<<<<<<<
 *             l = []
 *             for tid in self.byt:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_self->_initial_events); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 415, __pyx_L1_error)
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {

    /* "arrivals.pyx":416
 *     def initial_events (self):
 *         if not self._initial_events:
 *             l = []             # <<<<<<<<<<<<<<
 *             for tid in self.byt:
 *                 evts = self.byt[tid]
 */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_v_l = ((PyObject*)__pyx_t_3);
    __pyx_t_3 = 0;

    /* "arrivals.pyx":417
 *         if not self._initial_events:
 *             l = []
 *             for tid in self.byt:             # <<<<<<<<<<<<<<
 *                 evts = self.byt[tid]
 *                 if evts:
 */
    if (likely(PyList_CheckExact(__pyx_v_self->byt)) || PyTuple_CheckExact(__pyx_v_self->byt)) {
      __pyx_t_3 = __pyx_v_self->byt; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
      __pyx_t_5 = NULL;
    } else {
      __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_self->byt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 417, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 417, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_5)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 417, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 417, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        } else {
          if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 417, __pyx_L1_error)
          #else
          __pyx_t_6 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 417, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        }
      } else {
        __pyx_t_6 = __pyx_t_5(__pyx_t_3);
        if (unlikely(!__pyx_t_6)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 417, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_6);
      }
      __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "arrivals.pyx":418
 *             l = []
 *             for tid in self.byt:
 *                 evts = self.byt[tid]             # <<<<<<<<<<<<<<
 *                 if evts:
 *                     l.append (evts[0])
 */
      __pyx_t_6 = PyObject_GetItem(__pyx_v_self->byt, __pyx_v_tid); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 418, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_XDECREF_SET(__pyx_v_evts, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "arrivals.pyx":419
 *             for tid in self.byt:
 *                 evts = self.byt[tid]
 *                 if evts:             # <<<<<<<<<<<<<<
 *                     l.append (evts[0])
 *             self._initial_events = l
 */
      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_evts); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 419, __pyx_L1_error)
      if (__pyx_t_2) {

        /* "arrivals.pyx":420
 *                 evts = self.byt[tid]
 *                 if evts:
 *                     l.append (evts[0])             # <<<<<<<<<<<<<<
 *             self._initial_events = l
 *         return self._initial_events
 */
        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_evts, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 420, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = __Pyx_PyList_Append(__pyx_v_l, __pyx_t_6); if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 420, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

        /* "arrivals.pyx":419
 *             for tid in self.byt:
 *                 evts = self.byt[tid]
 *                 if evts:             # <<<<<<<<<<<<<<
 *                     l.append (evts[0])
 *             self._initial_events = l
 */
      }

      /* "arrivals.pyx":417
 *         if not self._initial_events:
 *             l = []
 *             for tid in self.byt:             # <<<<<<<<<<<<<<
 *                 evts = self.byt[tid]
 *                 if evts:
 */
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "arrivals.pyx":421
 *                 if evts:
 *                     l.append (evts[0])
 *             self._initial_events = l             # <<<<<<<<<<<<<<
 *         return self._initial_events
 * 
 */
    __Pyx_INCREF(__pyx_v_l);
    __Pyx_GIVEREF(__pyx_v_l);
    __Pyx_GOTREF(__pyx_v_self->_initial_events);
    __Pyx_DECREF(__pyx_v_self->_initial_events);
    __pyx_v_self->_initial_events = __pyx_v_l;

    /* "arrivals.pyx":415
 * 
 *     def initial_events (self):
 *         if not self._initial_events:             # <<<<<<<<<<<<<<
 *             l = []
 *             for tid in self.byt:
 */
  }

  /* "arrivals.pyx":422
 *                     l.append (evts[0])
 *             self._initial_events = l
 *         return self._initial_events             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_self->_initial_events);
  __pyx_r = __pyx_v_self->_initial_events;
  goto __pyx_L0;

  /* "arrivals.pyx":414
 *         return the_max
 * 
 *     def initial_events (self):             # <<<<<<<<<<<<<<
 *         if not self._initial_events:
 *             l = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("arrivals.Arrivals.initial_events", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_l);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_evts);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":426
 * 
 *     # Assumes event occurs after all events in q
 *     def append (self, Event evt):             # <<<<<<<<<<<<<<
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_51append(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_51append(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("append (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 426, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_50append(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_50append(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_prev_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("append", 0);

  /* "arrivals.pyx":427
 *     # Assumes event occurs after all events in q
 *     def append (self, Event evt):
 *         if evt.tid not in self.byt:             # <<<<<<<<<<<<<<
 *             self.byt[evt.tid] = []
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_self->byt, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 427, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":428
 *     def append (self, Event evt):
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []             # <<<<<<<<<<<<<<
 * 
 *         cdef Event prev_evt
 */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, __pyx_t_1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 428, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":427
 *     # Assumes event occurs after all events in q
 *     def append (self, Event evt):
 *         if evt.tid not in self.byt:             # <<<<<<<<<<<<<<
 *             self.byt[evt.tid] = []
 * 
 */
  }

  /* "arrivals.pyx":431
 * 
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 431, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 431, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "arrivals.pyx":432
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:
 *             prev_evt = self.byt[evt.tid][-1]             # <<<<<<<<<<<<<<
 *             prev_evt.next_byt = evt
 *             evt.prev_byt = prev_evt
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 432, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 432, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 432, __pyx_L1_error)
    __pyx_v_prev_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "arrivals.pyx":433
 *         if self.byt[evt.tid]:
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt             # <<<<<<<<<<<<<<
 *             evt.prev_byt = prev_evt
 * 
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_GOTREF(__pyx_v_prev_evt->next_byt);
    __Pyx_DECREF(__pyx_v_prev_evt->next_byt);
    __pyx_v_prev_evt->next_byt = ((PyObject *)__pyx_v_evt);

    /* "arrivals.pyx":434
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 *             evt.prev_byt = prev_evt             # <<<<<<<<<<<<<<
 * 
 *         if self.byq[evt.qid]:
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GOTREF(__pyx_v_evt->prev_byt);
    __Pyx_DECREF(__pyx_v_evt->prev_byt);
    __pyx_v_evt->prev_byt = ((PyObject *)__pyx_v_prev_evt);

    /* "arrivals.pyx":431
 * 
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 */
  }

  /* "arrivals.pyx":436
 *             evt.prev_byt = prev_evt
 * 
 *         if self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.final_arrival_by_queue (evt.q)
 *             prev_evt.next_byq = evt
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_3) {

    /* "arrivals.pyx":437
 * 
 *         if self.byq[evt.qid]:
 *             prev_evt = self.final_arrival_by_queue (evt.q)             # <<<<<<<<<<<<<<
 *             prev_evt.next_byq = evt
 *             evt.prev_byq = prev_evt
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final_arrival_by_queue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 437, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt->q)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_4);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_4);
      } else
      #endif
      {
        __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 437, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
        PyTuple_SET_ITEM(__pyx_t_6, 0+1, ((PyObject *)__pyx_v_evt->q));
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 437, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 437, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_prev_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "arrivals.pyx":438
 *         if self.byq[evt.qid]:
 *             prev_evt = self.final_arrival_by_queue (evt.q)
 *             prev_evt.next_byq = evt             # <<<<<<<<<<<<<<
 *             evt.prev_byq = prev_evt
 * 
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_GOTREF(__pyx_v_prev_evt->next_byq);
    __Pyx_DECREF(__pyx_v_prev_evt->next_byq);
    __pyx_v_prev_evt->next_byq = ((PyObject *)__pyx_v_evt);

    /* "arrivals.pyx":439
 *             prev_evt = self.final_arrival_by_queue (evt.q)
 *             prev_evt.next_byq = evt
 *             evt.prev_byq = prev_evt             # <<<<<<<<<<<<<<
 * 
 *         self.byt[evt.tid].append (evt)
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GOTREF(__pyx_v_evt->prev_byq);
    __Pyx_DECREF(__pyx_v_evt->prev_byq);
    __pyx_v_evt->prev_byq = ((PyObject *)__pyx_v_prev_evt);

    /* "arrivals.pyx":436
 *             evt.prev_byt = prev_evt
 * 
 *         if self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.final_arrival_by_queue (evt.q)
 *             prev_evt.next_byq = evt
 */
  }

  /* "arrivals.pyx":441
 *             evt.prev_byq = prev_evt
 * 
 *         self.byt[evt.tid].append (evt)             # <<<<<<<<<<<<<<
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 441, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = __Pyx_PyObject_Append(__pyx_t_4, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 441, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":442
 * 
 *         self.byt[evt.tid].append (evt)
 *         self._update_final_byq (evt)             # <<<<<<<<<<<<<<
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_final_byq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_6) {
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[2] = {__pyx_t_6, ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[2] = {__pyx_t_6, ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 442, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, ((PyObject *)__pyx_v_evt));
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 442, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":443
 *         self.byt[evt.tid].append (evt)
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)             # <<<<<<<<<<<<<<
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_ninq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 443, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 443, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 443, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_6 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 443, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_8, Py_None);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_8, ((PyObject *)__pyx_v_evt));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 443, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":444
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)             # <<<<<<<<<<<<<<
 *         self.update_arrival_cache (evt, -1, evt.a)
 *         self.update_inq_cache (None, evt)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_evt->c); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_5, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_6};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_5, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_6};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 444, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, ((PyObject *)__pyx_v_evt));
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_t_6);
    PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":445
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)             # <<<<<<<<<<<<<<
 *         self.update_inq_cache (None, evt)
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_arrival_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 445, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_9 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 445, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_6 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_9};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_9};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_6) {
      __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_8, ((PyObject *)__pyx_v_evt));
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_8, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_8, __pyx_t_9);
    __pyx_t_9 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 445, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":446
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)
 *         self.update_inq_cache (None, evt)             # <<<<<<<<<<<<<<
 * 
 *         self.events[evt.eid] = evt
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_inq_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 446, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 446, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 446, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 446, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, Py_None);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, ((PyObject *)__pyx_v_evt));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 446, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":448
 *         self.update_inq_cache (None, evt)
 * 
 *         self.events[evt.eid] = evt             # <<<<<<<<<<<<<<
 *         evt.arrv = self
 * 
 */
  if (unlikely(__Pyx_SetItemInt(__pyx_v_self->events, __pyx_v_evt->eid, ((PyObject *)__pyx_v_evt), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 448, __pyx_L1_error)

  /* "arrivals.pyx":449
 * 
 *         self.events[evt.eid] = evt
 *         evt.arrv = self             # <<<<<<<<<<<<<<
 * 
 *     def insert (self, Event evt):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __Pyx_GOTREF(__pyx_v_evt->arrv);
  __Pyx_DECREF(__pyx_v_evt->arrv);
  __pyx_v_evt->arrv = ((PyObject *)__pyx_v_self);

  /* "arrivals.pyx":426
 * 
 *     # Assumes event occurs after all events in q
 *     def append (self, Event evt):             # <<<<<<<<<<<<<<
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("arrivals.Arrivals.append", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_prev_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":451
 *         evt.arrv = self
 * 
 *     def insert (self, Event evt):             # <<<<<<<<<<<<<<
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_53insert(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_53insert(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("insert (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 451, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_52insert(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_52insert(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_prev_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_next_evt = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("insert", 0);

  /* "arrivals.pyx":452
 * 
 *     def insert (self, Event evt):
 *         if evt.tid not in self.byt:             # <<<<<<<<<<<<<<
 *             self.byt[evt.tid] = []
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_self->byt, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 452, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":453
 *     def insert (self, Event evt):
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []             # <<<<<<<<<<<<<<
 * 
 *         cdef Event prev_evt
 */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, __pyx_t_1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":452
 * 
 *     def insert (self, Event evt):
 *         if evt.tid not in self.byt:             # <<<<<<<<<<<<<<
 *             self.byt[evt.tid] = []
 * 
 */
  }

  /* "arrivals.pyx":456
 * 
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 456, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_3) {

    /* "arrivals.pyx":457
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:
 *             prev_evt = self.byt[evt.tid][-1]             # <<<<<<<<<<<<<<
 *             prev_evt.next_byt = evt
 *             evt.prev_byt = prev_evt
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 457, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 457, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 457, __pyx_L1_error)
    __pyx_v_prev_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "arrivals.pyx":458
 *         if self.byt[evt.tid]:
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt             # <<<<<<<<<<<<<<
 *             evt.prev_byt = prev_evt
 * 
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_GOTREF(__pyx_v_prev_evt->next_byt);
    __Pyx_DECREF(__pyx_v_prev_evt->next_byt);
    __pyx_v_prev_evt->next_byt = ((PyObject *)__pyx_v_evt);

    /* "arrivals.pyx":459
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 *             evt.prev_byt = prev_evt             # <<<<<<<<<<<<<<
 * 
 *         cdef Event next_evt
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GOTREF(__pyx_v_evt->prev_byt);
    __Pyx_DECREF(__pyx_v_evt->prev_byt);
    __pyx_v_evt->prev_byt = ((PyObject *)__pyx_v_prev_evt);

    /* "arrivals.pyx":456
 * 
 *         cdef Event prev_evt
 *         if self.byt[evt.tid]:             # <<<<<<<<<<<<<<
 *             prev_evt = self.byt[evt.tid][-1]
 *             prev_evt.next_byt = evt
 */
  }

  /* "arrivals.pyx":462
 * 
 *         cdef Event next_evt
 *         if self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             next_evt = self.find_next_byq (evt.q, evt)
 *             prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 462, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_3) {

    /* "arrivals.pyx":463
 *         cdef Event next_evt
 *         if self.byq[evt.qid]:
 *             next_evt = self.find_next_byq (evt.q, evt)             # <<<<<<<<<<<<<<
 *             prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_find_next_byq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 463, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q), ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 463, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q), ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 463, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 463, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, ((PyObject *)__pyx_v_evt->q));
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, ((PyObject *)__pyx_v_evt));
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 463, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 463, __pyx_L1_error)
    __pyx_v_next_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "arrivals.pyx":464
 *         if self.byq[evt.qid]:
 *             next_evt = self.find_next_byq (evt.q, evt)
 *             prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)             # <<<<<<<<<<<<<<
 * 
 *             # evt --> next
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_next_evt)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 464, __pyx_L1_error)
    if (__pyx_t_3) {
      if (!(likely(((__pyx_v_next_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_next_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 464, __pyx_L1_error)
      __Pyx_INCREF(__pyx_v_next_evt->prev_byq);
      __pyx_t_4 = __pyx_v_next_evt->prev_byq;
    } else {
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final_arrival_by_queue); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 464, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_5) {
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt->q)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_1);
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 464, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt->q));
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 464, __pyx_L1_error)
      __pyx_t_4 = __pyx_t_1;
      __pyx_t_1 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_prev_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "arrivals.pyx":467
 * 
 *             # evt --> next
 *             evt.next_byq = next_evt             # <<<<<<<<<<<<<<
 *             if next_evt: next_evt.prev_byq = evt
 * 
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_next_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_next_evt));
    __Pyx_GOTREF(__pyx_v_evt->next_byq);
    __Pyx_DECREF(__pyx_v_evt->next_byq);
    __pyx_v_evt->next_byq = ((PyObject *)__pyx_v_next_evt);

    /* "arrivals.pyx":468
 *             # evt --> next
 *             evt.next_byq = next_evt
 *             if next_evt: next_evt.prev_byq = evt             # <<<<<<<<<<<<<<
 * 
 *             # prev --> evt
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_next_evt)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 468, __pyx_L1_error)
    if (__pyx_t_3) {
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __Pyx_GOTREF(__pyx_v_next_evt->prev_byq);
      __Pyx_DECREF(__pyx_v_next_evt->prev_byq);
      __pyx_v_next_evt->prev_byq = ((PyObject *)__pyx_v_evt);
    }

    /* "arrivals.pyx":471
 * 
 *             # prev --> evt
 *             evt.prev_byq = prev_evt             # <<<<<<<<<<<<<<
 *             if prev_evt: prev_evt.next_byq = evt
 * 
 */
    __Pyx_INCREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_prev_evt));
    __Pyx_GOTREF(__pyx_v_evt->prev_byq);
    __Pyx_DECREF(__pyx_v_evt->prev_byq);
    __pyx_v_evt->prev_byq = ((PyObject *)__pyx_v_prev_evt);

    /* "arrivals.pyx":472
 *             # prev --> evt
 *             evt.prev_byq = prev_evt
 *             if prev_evt: prev_evt.next_byq = evt             # <<<<<<<<<<<<<<
 * 
 *         self.byt[evt.tid].append (evt)
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_prev_evt)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 472, __pyx_L1_error)
    if (__pyx_t_3) {
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      __Pyx_GOTREF(__pyx_v_prev_evt->next_byq);
      __Pyx_DECREF(__pyx_v_prev_evt->next_byq);
      __pyx_v_prev_evt->next_byq = ((PyObject *)__pyx_v_evt);
    }

    /* "arrivals.pyx":462
 * 
 *         cdef Event next_evt
 *         if self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             next_evt = self.find_next_byq (evt.q, evt)
 *             prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)
 */
  }

  /* "arrivals.pyx":474
 *             if prev_evt: prev_evt.next_byq = evt
 * 
 *         self.byt[evt.tid].append (evt)             # <<<<<<<<<<<<<<
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)
 */
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->byt, __pyx_v_evt->tid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 474, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_9 = __Pyx_PyObject_Append(__pyx_t_4, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_9 == -1)) __PYX_ERR(0, 474, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":475
 * 
 *         self.byt[evt.tid].append (evt)
 *         self._update_final_byq (evt)             # <<<<<<<<<<<<<<
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_final_byq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 475, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (!__pyx_t_7) {
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[2] = {__pyx_t_7, ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[2] = {__pyx_t_7, ((PyObject *)__pyx_v_evt)};
      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_4);
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 475, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __pyx_t_7 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt));
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":476
 *         self.byt[evt.tid].append (evt)
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)             # <<<<<<<<<<<<<<
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_ninq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 476, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 476, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 476, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 476, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, Py_None);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, ((PyObject *)__pyx_v_evt));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 476, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":477
 *         self._update_final_byq (evt)
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)             # <<<<<<<<<<<<<<
 *         self.update_arrival_cache (evt, -1, evt.a)
 *         self.update_inq_cache (None, evt)
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = PyFloat_FromDouble(__pyx_v_evt->c); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_8, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_7};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 477, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_8, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_7};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 477, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 477, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, ((PyObject *)__pyx_v_evt));
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, __pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 477, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":478
 *         self._update_ninq (None, evt)
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)             # <<<<<<<<<<<<<<
 *         self.update_inq_cache (None, evt)
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_arrival_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 478, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 478, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_7 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[4] = {__pyx_t_7, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_8 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 478, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (__pyx_t_7) {
      __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7); __pyx_t_7 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_6, ((PyObject *)__pyx_v_evt));
    __Pyx_INCREF(__pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_int_neg_1);
    PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_6, __pyx_int_neg_1);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_6, __pyx_t_5);
    __pyx_t_5 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":479
 *         self.update_commencement_cache (evt, -1, evt.c)
 *         self.update_arrival_cache (evt, -1, evt.a)
 *         self.update_inq_cache (None, evt)             # <<<<<<<<<<<<<<
 * 
 *         self.events[evt.eid] = evt
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_inq_cache); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 479, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, Py_None, ((PyObject *)__pyx_v_evt)};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 479, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GOTREF(__pyx_t_4);
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_8) {
      __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, Py_None);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, ((PyObject *)__pyx_v_evt));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "arrivals.pyx":481
 *         self.update_inq_cache (None, evt)
 * 
 *         self.events[evt.eid] = evt             # <<<<<<<<<<<<<<
 *         evt.arrv = self
 * 
 */
  if (unlikely(__Pyx_SetItemInt(__pyx_v_self->events, __pyx_v_evt->eid, ((PyObject *)__pyx_v_evt), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 481, __pyx_L1_error)

  /* "arrivals.pyx":482
 * 
 *         self.events[evt.eid] = evt
 *         evt.arrv = self             # <<<<<<<<<<<<<<
 * 
 *     def resort_byq (self, Event evt):
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_self));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
  __Pyx_GOTREF(__pyx_v_evt->arrv);
  __Pyx_DECREF(__pyx_v_evt->arrv);
  __pyx_v_evt->arrv = ((PyObject *)__pyx_v_self);

  /* "arrivals.pyx":451
 *         evt.arrv = self
 * 
 *     def insert (self, Event evt):             # <<<<<<<<<<<<<<
 *         if evt.tid not in self.byt:
 *             self.byt[evt.tid] = []
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.insert", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_prev_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_next_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":484
 *         evt.arrv = self
 * 
 *     def resort_byq (self, Event evt):             # <<<<<<<<<<<<<<
 *         cdef Event next_evt, prev_evt, old_prev, old_next
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_55resort_byq(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_55resort_byq(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("resort_byq (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 484, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_54resort_byq(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_54resort_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_next_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_prev_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_old_prev = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_old_next = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("resort_byq", 0);

  /* "arrivals.pyx":488
 * 
 *         # first remove evt
 *         old_prev = evt.prev_byq             # <<<<<<<<<<<<<<
 *         old_next = evt.next_byq
 *         if old_prev: old_prev.next_byq = old_next
 */
  if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 488, __pyx_L1_error)
  __pyx_t_1 = __pyx_v_evt->prev_byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_old_prev = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":489
 *         # first remove evt
 *         old_prev = evt.prev_byq
 *         old_next = evt.next_byq             # <<<<<<<<<<<<<<
 *         if old_prev: old_prev.next_byq = old_next
 *         if old_next: old_next.prev_byq = old_prev
 */
  if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 489, __pyx_L1_error)
  __pyx_t_1 = __pyx_v_evt->next_byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_old_next = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":490
 *         old_prev = evt.prev_byq
 *         old_next = evt.next_byq
 *         if old_prev: old_prev.next_byq = old_next             # <<<<<<<<<<<<<<
 *         if old_next: old_next.prev_byq = old_prev
 *         if self.final_byq[evt.qid] is evt:
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_old_prev)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 490, __pyx_L1_error)
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_old_next));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_old_next));
    __Pyx_GOTREF(__pyx_v_old_prev->next_byq);
    __Pyx_DECREF(__pyx_v_old_prev->next_byq);
    __pyx_v_old_prev->next_byq = ((PyObject *)__pyx_v_old_next);
  }

  /* "arrivals.pyx":491
 *         old_next = evt.next_byq
 *         if old_prev: old_prev.next_byq = old_next
 *         if old_next: old_next.prev_byq = old_prev             # <<<<<<<<<<<<<<
 *         if self.final_byq[evt.qid] is evt:
 *             self.final_byq[evt.qid] = old_prev
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_old_next)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 491, __pyx_L1_error)
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_old_prev));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_old_prev));
    __Pyx_GOTREF(__pyx_v_old_next->prev_byq);
    __Pyx_DECREF(__pyx_v_old_next->prev_byq);
    __pyx_v_old_next->prev_byq = ((PyObject *)__pyx_v_old_prev);
  }

  /* "arrivals.pyx":492
 *         if old_prev: old_prev.next_byq = old_next
 *         if old_next: old_next.prev_byq = old_prev
 *         if self.final_byq[evt.qid] is evt:             # <<<<<<<<<<<<<<
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->final_byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__pyx_t_1 == ((PyObject *)__pyx_v_evt));
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":493
 *         if old_next: old_next.prev_byq = old_prev
 *         if self.final_byq[evt.qid] is evt:
 *             self.final_byq[evt.qid] = old_prev             # <<<<<<<<<<<<<<
 *         if self.byq[evt.qid] is evt:
 *             if old_prev:
 */
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->final_byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_old_prev), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 493, __pyx_L1_error)

    /* "arrivals.pyx":492
 *         if old_prev: old_prev.next_byq = old_next
 *         if old_next: old_next.prev_byq = old_prev
 *         if self.final_byq[evt.qid] is evt:             # <<<<<<<<<<<<<<
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:
 */
  }

  /* "arrivals.pyx":494
 *         if self.final_byq[evt.qid] is evt:
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:             # <<<<<<<<<<<<<<
 *             if old_prev:
 *                 self.byq[evt.qid] = old_prev
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = (__pyx_t_1 == ((PyObject *)__pyx_v_evt));
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = (__pyx_t_3 != 0);
  if (__pyx_t_2) {

    /* "arrivals.pyx":495
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:
 *             if old_prev:             # <<<<<<<<<<<<<<
 *                 self.byq[evt.qid] = old_prev
 *             else:
 */
    __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_old_prev)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 495, __pyx_L1_error)
    if (__pyx_t_2) {

      /* "arrivals.pyx":496
 *         if self.byq[evt.qid] is evt:
 *             if old_prev:
 *                 self.byq[evt.qid] = old_prev             # <<<<<<<<<<<<<<
 *             else:
 *                 self.byq[evt.qid] = old_next
 */
      if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_old_prev), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 496, __pyx_L1_error)

      /* "arrivals.pyx":495
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:
 *             if old_prev:             # <<<<<<<<<<<<<<
 *                 self.byq[evt.qid] = old_prev
 *             else:
 */
      goto __pyx_L7;
    }

    /* "arrivals.pyx":498
 *                 self.byq[evt.qid] = old_prev
 *             else:
 *                 self.byq[evt.qid] = old_next             # <<<<<<<<<<<<<<
 * 
 *         # can't use insert b/c it screws up the byt caches
 */
    /*else*/ {
      if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_old_next), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 498, __pyx_L1_error)
    }
    __pyx_L7:;

    /* "arrivals.pyx":494
 *         if self.final_byq[evt.qid] is evt:
 *             self.final_byq[evt.qid] = old_prev
 *         if self.byq[evt.qid] is evt:             # <<<<<<<<<<<<<<
 *             if old_prev:
 *                 self.byq[evt.qid] = old_prev
 */
  }

  /* "arrivals.pyx":501
 * 
 *         # can't use insert b/c it screws up the byt caches
 *         next_evt = self.find_next_byq (evt.q, evt)             # <<<<<<<<<<<<<<
 *         prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)
 *         # evt --> next
 */
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_find_next_byq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 501, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q), ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q), ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 501, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, ((PyObject *)__pyx_v_evt->q));
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, ((PyObject *)__pyx_v_evt));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 501, __pyx_L1_error)
  __pyx_v_next_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":502
 *         # can't use insert b/c it screws up the byt caches
 *         next_evt = self.find_next_byq (evt.q, evt)
 *         prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)             # <<<<<<<<<<<<<<
 *         # evt --> next
 *         evt.next_byq = next_evt
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_next_evt)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 502, __pyx_L1_error)
  if (__pyx_t_2) {
    if (!(likely(((__pyx_v_next_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_next_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 502, __pyx_L1_error)
    __Pyx_INCREF(__pyx_v_next_evt->prev_byq);
    __pyx_t_1 = __pyx_v_next_evt->prev_byq;
  } else {
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final_arrival_by_queue); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_5) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt->q)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_4);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_5, ((PyObject *)__pyx_v_evt->q)};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_4);
      } else
      #endif
      {
        __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 502, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_evt->q));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt->q));
        PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt->q));
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 502, __pyx_L1_error)
    __pyx_t_1 = __pyx_t_4;
    __pyx_t_4 = 0;
  }
  __pyx_v_prev_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":504
 *         prev_evt = next_evt.prev_byq if next_evt else self.final_arrival_by_queue(evt.q)
 *         # evt --> next
 *         evt.next_byq = next_evt             # <<<<<<<<<<<<<<
 *         if next_evt: next_evt.prev_byq = evt
 *         # prev --> evt
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_next_evt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_next_evt));
  __Pyx_GOTREF(__pyx_v_evt->next_byq);
  __Pyx_DECREF(__pyx_v_evt->next_byq);
  __pyx_v_evt->next_byq = ((PyObject *)__pyx_v_next_evt);

  /* "arrivals.pyx":505
 *         # evt --> next
 *         evt.next_byq = next_evt
 *         if next_evt: next_evt.prev_byq = evt             # <<<<<<<<<<<<<<
 *         # prev --> evt
 *         evt.prev_byq = prev_evt
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_next_evt)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 505, __pyx_L1_error)
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_GOTREF(__pyx_v_next_evt->prev_byq);
    __Pyx_DECREF(__pyx_v_next_evt->prev_byq);
    __pyx_v_next_evt->prev_byq = ((PyObject *)__pyx_v_evt);
  }

  /* "arrivals.pyx":507
 *         if next_evt: next_evt.prev_byq = evt
 *         # prev --> evt
 *         evt.prev_byq = prev_evt             # <<<<<<<<<<<<<<
 *         if prev_evt: prev_evt.next_byq = evt
 *         # you'll have to regenerate teh caches after doing this
 */
  __Pyx_INCREF(((PyObject *)__pyx_v_prev_evt));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_prev_evt));
  __Pyx_GOTREF(__pyx_v_evt->prev_byq);
  __Pyx_DECREF(__pyx_v_evt->prev_byq);
  __pyx_v_evt->prev_byq = ((PyObject *)__pyx_v_prev_evt);

  /* "arrivals.pyx":508
 *         # prev --> evt
 *         evt.prev_byq = prev_evt
 *         if prev_evt: prev_evt.next_byq = evt             # <<<<<<<<<<<<<<
 *         # you'll have to regenerate teh caches after doing this
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_prev_evt)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 508, __pyx_L1_error)
  if (__pyx_t_2) {
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    __Pyx_GOTREF(__pyx_v_prev_evt->next_byq);
    __Pyx_DECREF(__pyx_v_prev_evt->next_byq);
    __pyx_v_prev_evt->next_byq = ((PyObject *)__pyx_v_evt);
  }

  /* "arrivals.pyx":484
 *         evt.arrv = self
 * 
 *     def resort_byq (self, Event evt):             # <<<<<<<<<<<<<<
 *         cdef Event next_evt, prev_evt, old_prev, old_next
 * 
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.resort_byq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_next_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_prev_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_old_prev);
  __Pyx_XDECREF((PyObject *)__pyx_v_old_next);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":512
 * 
 * 
 *     def find_next_byq (self, q, Event evt):             # <<<<<<<<<<<<<<
 * #         cdef Event next_evt = self.byq[evt.qid]
 * #         order = self.queue_orders[evt.qid]
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_57find_next_byq(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_57find_next_byq(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_q = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("find_next_byq (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_q,&__pyx_n_s_evt,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("find_next_byq", 1, 2, 2, 1); __PYX_ERR(0, 512, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_next_byq") < 0)) __PYX_ERR(0, 512, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_q = values[0];
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("find_next_byq", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 512, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.find_next_byq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 512, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_56find_next_byq(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_q, __pyx_v_evt);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_56find_next_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_q, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_v_order = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt0 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt1 = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("find_next_byq", 0);

  /* "arrivals.pyx":522
 * #             while next_evt and evt.a >= next_evt.a:
 * #                 next_evt = next_evt.next_byq
 *         order = self.queue_orders[evt.qid]             # <<<<<<<<<<<<<<
 *         cdef Event evt0 = self.final_arrival_by_qid(evt.qid)
 *         cdef Event evt1 = None
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->queue_orders, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_order = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":523
 * #                 next_evt = next_evt.next_byq
 *         order = self.queue_orders[evt.qid]
 *         cdef Event evt0 = self.final_arrival_by_qid(evt.qid)             # <<<<<<<<<<<<<<
 *         cdef Event evt1 = None
 *         if order == ARRV_BY_D:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_final_arrival_by_qid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 523, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 523, __pyx_L1_error)
  __pyx_v_evt0 = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":524
 *         order = self.queue_orders[evt.qid]
 *         cdef Event evt0 = self.final_arrival_by_qid(evt.qid)
 *         cdef Event evt1 = None             # <<<<<<<<<<<<<<
 *         if order == ARRV_BY_D:
 *             while evt0 and evt0.d >= evt.d:
 */
  __Pyx_INCREF(Py_None);
  __pyx_v_evt1 = ((struct __pyx_obj_8arrivals_Event *)Py_None);

  /* "arrivals.pyx":525
 *         cdef Event evt0 = self.final_arrival_by_qid(evt.qid)
 *         cdef Event evt1 = None
 *         if order == ARRV_BY_D:             # <<<<<<<<<<<<<<
 *             while evt0 and evt0.d >= evt.d:
 *                 evt1 = evt0
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_ARRV_BY_D); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 525, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_order, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 525, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 525, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {

    /* "arrivals.pyx":526
 *         cdef Event evt1 = None
 *         if order == ARRV_BY_D:
 *             while evt0 and evt0.d >= evt.d:             # <<<<<<<<<<<<<<
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq
 */
    while (1) {
      __pyx_t_7 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt0)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 526, __pyx_L1_error)
      if (__pyx_t_7) {
      } else {
        __pyx_t_6 = __pyx_t_7;
        goto __pyx_L6_bool_binop_done;
      }
      __pyx_t_7 = ((__pyx_v_evt0->d >= __pyx_v_evt->d) != 0);
      __pyx_t_6 = __pyx_t_7;
      __pyx_L6_bool_binop_done:;
      if (!__pyx_t_6) break;

      /* "arrivals.pyx":527
 *         if order == ARRV_BY_D:
 *             while evt0 and evt0.d >= evt.d:
 *                 evt1 = evt0             # <<<<<<<<<<<<<<
 *                 evt0 = evt0.prev_byq
 *         elif order == ARRV_BY_A:
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
      __Pyx_DECREF_SET(__pyx_v_evt1, __pyx_v_evt0);

      /* "arrivals.pyx":528
 *             while evt0 and evt0.d >= evt.d:
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq             # <<<<<<<<<<<<<<
 *         elif order == ARRV_BY_A:
 * #            print "+++++++++"
 */
      if (!(likely(((__pyx_v_evt0->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt0->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 528, __pyx_L1_error)
      __pyx_t_2 = __pyx_v_evt0->prev_byq;
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_2));
      __pyx_t_2 = 0;
    }

    /* "arrivals.pyx":525
 *         cdef Event evt0 = self.final_arrival_by_qid(evt.qid)
 *         cdef Event evt1 = None
 *         if order == ARRV_BY_D:             # <<<<<<<<<<<<<<
 *             while evt0 and evt0.d >= evt.d:
 *                 evt1 = evt0
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":529
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq
 *         elif order == ARRV_BY_A:             # <<<<<<<<<<<<<<
 * #            print "+++++++++"
 *             while evt0 and evt0.a >= evt.a:
 */
  __pyx_t_2 = __Pyx_GetModuleGlobalName(__pyx_n_s_ARRV_BY_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_order, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "arrivals.pyx":531
 *         elif order == ARRV_BY_A:
 * #            print "+++++++++"
 *             while evt0 and evt0.a >= evt.a:             # <<<<<<<<<<<<<<
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq
 */
    while (1) {
      __pyx_t_7 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt0)); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 531, __pyx_L1_error)
      if (__pyx_t_7) {
      } else {
        __pyx_t_6 = __pyx_t_7;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_7 = ((__pyx_v_evt0->a >= __pyx_v_evt->a) != 0);
      __pyx_t_6 = __pyx_t_7;
      __pyx_L10_bool_binop_done:;
      if (!__pyx_t_6) break;

      /* "arrivals.pyx":532
 * #            print "+++++++++"
 *             while evt0 and evt0.a >= evt.a:
 *                 evt1 = evt0             # <<<<<<<<<<<<<<
 *                 evt0 = evt0.prev_byq
 *         else:
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
      __Pyx_DECREF_SET(__pyx_v_evt1, __pyx_v_evt0);

      /* "arrivals.pyx":533
 *             while evt0 and evt0.a >= evt.a:
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq             # <<<<<<<<<<<<<<
 *         else:
 *             raise Exception ("Bad order %d for queue %s" % (order, q))
 */
      if (!(likely(((__pyx_v_evt0->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt0->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 533, __pyx_L1_error)
      __pyx_t_1 = __pyx_v_evt0->prev_byq;
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;
    }

    /* "arrivals.pyx":529
 *                 evt1 = evt0
 *                 evt0 = evt0.prev_byq
 *         elif order == ARRV_BY_A:             # <<<<<<<<<<<<<<
 * #            print "+++++++++"
 *             while evt0 and evt0.a >= evt.a:
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":535
 *                 evt0 = evt0.prev_byq
 *         else:
 *             raise Exception ("Bad order %d for queue %s" % (order, q))             # <<<<<<<<<<<<<<
 * 
 * #        print evt
 */
  /*else*/ {
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_order);
    __Pyx_GIVEREF(__pyx_v_order);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_order);
    __Pyx_INCREF(__pyx_v_q);
    __Pyx_GIVEREF(__pyx_v_q);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_q);
    __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_Bad_order_d_for_queue_s, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 535, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "arrivals.pyx":540
 * #        print next_evt
 * 
 *         return evt1             # <<<<<<<<<<<<<<
 * 
 *     def applyDiffList (self, diff_list, lik=None):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
  __pyx_r = ((PyObject *)__pyx_v_evt1);
  goto __pyx_L0;

  /* "arrivals.pyx":512
 * 
 * 
 *     def find_next_byq (self, q, Event evt):             # <<<<<<<<<<<<<<
 * #         cdef Event next_evt = self.byq[evt.qid]
 * #         order = self.queue_orders[evt.qid]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.Arrivals.find_next_byq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_order);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt0);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt1);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":542
 *         return evt1
 * 
 *     def applyDiffList (self, diff_list, lik=None):             # <<<<<<<<<<<<<<
 *         cdef Event e_new, e_old
 *         cdef Event evt_prev, evt_next
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_59applyDiffList(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_59applyDiffList(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_diff_list = 0;
  PyObject *__pyx_v_lik = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("applyDiffList (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_diff_list,&__pyx_n_s_lik,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_diff_list)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_lik);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "applyDiffList") < 0)) __PYX_ERR(0, 542, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_diff_list = values[0];
    __pyx_v_lik = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("applyDiffList", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 542, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.applyDiffList", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_58applyDiffList(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_diff_list, __pyx_v_lik);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_58applyDiffList(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_diff_list, PyObject *__pyx_v_lik) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e_old = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_prev = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_next = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_e = 0;
  PyObject *__pyx_v_done = NULL;
  double __pyx_v_delta;
  PyObject *__pyx_v_c_old = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  double __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  __Pyx_RefNannySetupContext("applyDiffList", 0);
  __Pyx_INCREF(__pyx_v_lik);

  /* "arrivals.pyx":549
 *         # must be done first
 *         # the dict() thing sucks
 *         if lik:             # <<<<<<<<<<<<<<
 *             done = dict()
 *             for e in diff_list:
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_lik); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 549, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "arrivals.pyx":550
 *         # the dict() thing sucks
 *         if lik:
 *             done = dict()             # <<<<<<<<<<<<<<
 *             for e in diff_list:
 *                 if e.qid not in done:
 */
    __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 550, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_v_done = ((PyObject*)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "arrivals.pyx":551
 *         if lik:
 *             done = dict()
 *             for e in diff_list:             # <<<<<<<<<<<<<<
 *                 if e.qid not in done:
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 */
    if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
      __pyx_t_2 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
      __pyx_t_4 = NULL;
    } else {
      __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 551, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 551, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_4)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 551, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 551, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        } else {
          if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 551, __pyx_L1_error)
          #else
          __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 551, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          #endif
        }
      } else {
        __pyx_t_5 = __pyx_t_4(__pyx_t_2);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 551, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_5);
      }
      if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 551, __pyx_L1_error)
      __Pyx_XDECREF_SET(__pyx_v_e, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_5));
      __pyx_t_5 = 0;

      /* "arrivals.pyx":552
 *             done = dict()
 *             for e in diff_list:
 *                 if e.qid not in done:             # <<<<<<<<<<<<<<
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 *                     done[e.qid] = 1
 */
      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_e->qid); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 552, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = (__Pyx_PyDict_ContainsTF(__pyx_t_5, __pyx_v_done, Py_NE)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 552, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_6 = (__pyx_t_1 != 0);
      if (__pyx_t_6) {

        /* "arrivals.pyx":553
 *             for e in diff_list:
 *                 if e.qid not in done:
 *                     delta = e.q.likelihoodDelta (self, diff_list)             # <<<<<<<<<<<<<<
 *                     done[e.qid] = 1
 *                     lik += delta
 */
        __pyx_t_7 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_e->q->__pyx_vtab)->likelihoodDelta(__pyx_v_e->q, __pyx_v_self, __pyx_v_diff_list, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 553, __pyx_L1_error)
        __pyx_v_delta = __pyx_t_7;

        /* "arrivals.pyx":554
 *                 if e.qid not in done:
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 *                     done[e.qid] = 1             # <<<<<<<<<<<<<<
 *                     lik += delta
 * 
 */
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_e->qid); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 554, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (unlikely(PyDict_SetItem(__pyx_v_done, __pyx_t_5, __pyx_int_1) < 0)) __PYX_ERR(0, 554, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "arrivals.pyx":555
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 *                     done[e.qid] = 1
 *                     lik += delta             # <<<<<<<<<<<<<<
 * 
 *         for e_new in diff_list:
 */
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 555, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_lik, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 555, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF_SET(__pyx_v_lik, __pyx_t_8);
        __pyx_t_8 = 0;

        /* "arrivals.pyx":552
 *             done = dict()
 *             for e in diff_list:
 *                 if e.qid not in done:             # <<<<<<<<<<<<<<
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 *                     done[e.qid] = 1
 */
      }

      /* "arrivals.pyx":551
 *         if lik:
 *             done = dict()
 *             for e in diff_list:             # <<<<<<<<<<<<<<
 *                 if e.qid not in done:
 *                     delta = e.q.likelihoodDelta (self, diff_list)
 */
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":549
 *         # must be done first
 *         # the dict() thing sucks
 *         if lik:             # <<<<<<<<<<<<<<
 *             done = dict()
 *             for e in diff_list:
 */
  }

  /* "arrivals.pyx":557
 *                     lik += delta
 * 
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             e_old = self.event (e_new.eid)
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_2 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 557, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 557, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_8); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 557, __pyx_L1_error)
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 557, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_8); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 557, __pyx_L1_error)
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 557, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 557, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 557, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_e_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "arrivals.pyx":558
 * 
 *         for e_new in diff_list:
 *             e_old = self.event (e_new.eid)             # <<<<<<<<<<<<<<
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old
 *             self.update_arrival_cache (e_old, e_old.a, e_new.a)
 */
    __pyx_t_8 = ((PyObject *)__pyx_f_8arrivals_8Arrivals_event(__pyx_v_self, __pyx_v_e_new->eid, 0)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 558, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_e_old, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "arrivals.pyx":559
 *         for e_new in diff_list:
 *             e_old = self.event (e_new.eid)
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old             # <<<<<<<<<<<<<<
 *             self.update_arrival_cache (e_old, e_old.a, e_new.a)
 *             self.update_inq_cache (e_old, e_new)
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_ninq); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 559, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_9 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old), ((PyObject *)__pyx_v_e_new)};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 559, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_8);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old), ((PyObject *)__pyx_v_e_new)};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 559, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_8);
    } else
    #endif
    {
      __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 559, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      if (__pyx_t_9) {
        __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
      __Pyx_INCREF(((PyObject *)__pyx_v_e_new));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_new));
      PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, ((PyObject *)__pyx_v_e_new));
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 559, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":560
 *             e_old = self.event (e_new.eid)
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old
 *             self.update_arrival_cache (e_old, e_old.a, e_new.a)             # <<<<<<<<<<<<<<
 *             self.update_inq_cache (e_old, e_new)
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_arrival_cache); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_11 = PyFloat_FromDouble(__pyx_v_e_old->a); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_e_new->a); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_12 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_12)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_12);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_12, ((PyObject *)__pyx_v_e_old), __pyx_t_11, __pyx_t_9};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 560, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_12, ((PyObject *)__pyx_v_e_old), __pyx_t_11, __pyx_t_9};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 560, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    {
      __pyx_t_13 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 560, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_13);
      if (__pyx_t_12) {
        __Pyx_GIVEREF(__pyx_t_12); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_12); __pyx_t_12 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(__pyx_t_11);
      PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_10, __pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_13, 2+__pyx_t_10, __pyx_t_9);
      __pyx_t_11 = 0;
      __pyx_t_9 = 0;
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_13, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 560, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":561
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old
 *             self.update_arrival_cache (e_old, e_old.a, e_new.a)
 *             self.update_inq_cache (e_old, e_new)             # <<<<<<<<<<<<<<
 * 
 * #            print "DL NEW ", e_new, e_new.c
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_inq_cache); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 561, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_13 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_13)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_13);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_13, ((PyObject *)__pyx_v_e_old), ((PyObject *)__pyx_v_e_new)};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
      __Pyx_GOTREF(__pyx_t_8);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_13, ((PyObject *)__pyx_v_e_old), ((PyObject *)__pyx_v_e_new)};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
      __Pyx_GOTREF(__pyx_t_8);
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 561, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_13) {
        __Pyx_GIVEREF(__pyx_t_13); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_13); __pyx_t_13 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
      __Pyx_INCREF(((PyObject *)__pyx_v_e_new));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_new));
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_10, ((PyObject *)__pyx_v_e_new));
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 561, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":566
 * #            print "DL OLD ", e_old, e_old.c
 * 
 *             e_old.a = e_new.a             # <<<<<<<<<<<<<<
 *             e_old.d = e_new.d
 *             e_old.s = e_new.s
 */
    __pyx_t_7 = __pyx_v_e_new->a;
    __pyx_v_e_old->a = __pyx_t_7;

    /* "arrivals.pyx":567
 * 
 *             e_old.a = e_new.a
 *             e_old.d = e_new.d             # <<<<<<<<<<<<<<
 *             e_old.s = e_new.s
 *             e_old.proc = e_new.proc
 */
    __pyx_t_7 = __pyx_v_e_new->d;
    __pyx_v_e_old->d = __pyx_t_7;

    /* "arrivals.pyx":568
 *             e_old.a = e_new.a
 *             e_old.d = e_new.d
 *             e_old.s = e_new.s             # <<<<<<<<<<<<<<
 *             e_old.proc = e_new.proc
 *             e_old.copy_dtimes (e_new)
 */
    __pyx_t_7 = __pyx_v_e_new->s;
    __pyx_v_e_old->s = __pyx_t_7;

    /* "arrivals.pyx":569
 *             e_old.d = e_new.d
 *             e_old.s = e_new.s
 *             e_old.proc = e_new.proc             # <<<<<<<<<<<<<<
 *             e_old.copy_dtimes (e_new)
 * 
 */
    __pyx_t_10 = __pyx_v_e_new->proc;
    __pyx_v_e_old->proc = __pyx_t_10;

    /* "arrivals.pyx":570
 *             e_old.s = e_new.s
 *             e_old.proc = e_new.proc
 *             e_old.copy_dtimes (e_new)             # <<<<<<<<<<<<<<
 * 
 *             # arrival order
 */
    __pyx_t_8 = ((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_e_old->__pyx_vtab)->copy_dtimes(__pyx_v_e_old, __pyx_v_e_new); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":573
 * 
 *             # arrival order
 *             if e_new.prev_byq:             # <<<<<<<<<<<<<<
 *                 # add evt_prev --> e_new
 *                 evt_prev =  self.event (e_new.prev_byq.eid)
 */
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_e_new->prev_byq); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 573, __pyx_L1_error)
    if (__pyx_t_6) {

      /* "arrivals.pyx":575
 *             if e_new.prev_byq:
 *                 # add evt_prev --> e_new
 *                 evt_prev =  self.event (e_new.prev_byq.eid)             # <<<<<<<<<<<<<<
 *                 e_old.prev_byq = evt_prev
 *                 evt_prev.next_byq = e_old
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_e_new->prev_byq, __pyx_n_s_eid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 575, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_8); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 575, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = ((PyObject *)__pyx_f_8arrivals_8Arrivals_event(__pyx_v_self, __pyx_t_10, 0)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 575, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_XDECREF_SET(__pyx_v_evt_prev, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
      __pyx_t_8 = 0;

      /* "arrivals.pyx":576
 *                 # add evt_prev --> e_new
 *                 evt_prev =  self.event (e_new.prev_byq.eid)
 *                 e_old.prev_byq = evt_prev             # <<<<<<<<<<<<<<
 *                 evt_prev.next_byq = e_old
 *             else:
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_evt_prev));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_prev));
      __Pyx_GOTREF(__pyx_v_e_old->prev_byq);
      __Pyx_DECREF(__pyx_v_e_old->prev_byq);
      __pyx_v_e_old->prev_byq = ((PyObject *)__pyx_v_evt_prev);

      /* "arrivals.pyx":577
 *                 evt_prev =  self.event (e_new.prev_byq.eid)
 *                 e_old.prev_byq = evt_prev
 *                 evt_prev.next_byq = e_old             # <<<<<<<<<<<<<<
 *             else:
 *                 e_old.prev_byq = None
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GOTREF(__pyx_v_evt_prev->next_byq);
      __Pyx_DECREF(__pyx_v_evt_prev->next_byq);
      __pyx_v_evt_prev->next_byq = ((PyObject *)__pyx_v_e_old);

      /* "arrivals.pyx":573
 * 
 *             # arrival order
 *             if e_new.prev_byq:             # <<<<<<<<<<<<<<
 *                 # add evt_prev --> e_new
 *                 evt_prev =  self.event (e_new.prev_byq.eid)
 */
      goto __pyx_L9;
    }

    /* "arrivals.pyx":579
 *                 evt_prev.next_byq = e_old
 *             else:
 *                 e_old.prev_byq = None             # <<<<<<<<<<<<<<
 * 
 *             if e_new.next_byq:
 */
    /*else*/ {
      __Pyx_INCREF(Py_None);
      __Pyx_GIVEREF(Py_None);
      __Pyx_GOTREF(__pyx_v_e_old->prev_byq);
      __Pyx_DECREF(__pyx_v_e_old->prev_byq);
      __pyx_v_e_old->prev_byq = Py_None;
    }
    __pyx_L9:;

    /* "arrivals.pyx":581
 *                 e_old.prev_byq = None
 * 
 *             if e_new.next_byq:             # <<<<<<<<<<<<<<
 *                 evt_next = self.event (e_new.next_byq.eid)
 *                 e_old.next_byq = evt_next
 */
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_e_new->next_byq); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 581, __pyx_L1_error)
    if (__pyx_t_6) {

      /* "arrivals.pyx":582
 * 
 *             if e_new.next_byq:
 *                 evt_next = self.event (e_new.next_byq.eid)             # <<<<<<<<<<<<<<
 *                 e_old.next_byq = evt_next
 *                 evt_next.prev_byq = e_old
 */
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_e_new->next_byq, __pyx_n_s_eid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_8); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 582, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = ((PyObject *)__pyx_f_8arrivals_8Arrivals_event(__pyx_v_self, __pyx_t_10, 0)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_XDECREF_SET(__pyx_v_evt_next, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
      __pyx_t_8 = 0;

      /* "arrivals.pyx":583
 *             if e_new.next_byq:
 *                 evt_next = self.event (e_new.next_byq.eid)
 *                 e_old.next_byq = evt_next             # <<<<<<<<<<<<<<
 *                 evt_next.prev_byq = e_old
 *             else:
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_evt_next));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_next));
      __Pyx_GOTREF(__pyx_v_e_old->next_byq);
      __Pyx_DECREF(__pyx_v_e_old->next_byq);
      __pyx_v_e_old->next_byq = ((PyObject *)__pyx_v_evt_next);

      /* "arrivals.pyx":584
 *                 evt_next = self.event (e_new.next_byq.eid)
 *                 e_old.next_byq = evt_next
 *                 evt_next.prev_byq = e_old             # <<<<<<<<<<<<<<
 *             else:
 *                 e_old.next_byq = None
 */
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GOTREF(__pyx_v_evt_next->prev_byq);
      __Pyx_DECREF(__pyx_v_evt_next->prev_byq);
      __pyx_v_evt_next->prev_byq = ((PyObject *)__pyx_v_e_old);

      /* "arrivals.pyx":581
 *                 e_old.prev_byq = None
 * 
 *             if e_new.next_byq:             # <<<<<<<<<<<<<<
 *                 evt_next = self.event (e_new.next_byq.eid)
 *                 e_old.next_byq = evt_next
 */
      goto __pyx_L10;
    }

    /* "arrivals.pyx":586
 *                 evt_next.prev_byq = e_old
 *             else:
 *                 e_old.next_byq = None             # <<<<<<<<<<<<<<
 * 
 *             e_old.q.update_caches_for (e_old)
 */
    /*else*/ {
      __Pyx_INCREF(Py_None);
      __Pyx_GIVEREF(Py_None);
      __Pyx_GOTREF(__pyx_v_e_old->next_byq);
      __Pyx_DECREF(__pyx_v_e_old->next_byq);
      __pyx_v_e_old->next_byq = Py_None;
    }
    __pyx_L10:;

    /* "arrivals.pyx":588
 *                 e_old.next_byq = None
 * 
 *             e_old.q.update_caches_for (e_old)             # <<<<<<<<<<<<<<
 * 
 *             c_old = e_old.commencement()
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_e_old->q), __pyx_n_s_update_caches_for); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 588, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (!__pyx_t_9) {
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_e_old)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 588, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 588, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_8);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[2] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 588, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_8);
      } else
      #endif
      {
        __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 588, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_13);
        __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_9); __pyx_t_9 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
        PyTuple_SET_ITEM(__pyx_t_13, 0+1, ((PyObject *)__pyx_v_e_old));
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_13, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 588, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":590
 *             e_old.q.update_caches_for (e_old)
 * 
 *             c_old = e_old.commencement()             # <<<<<<<<<<<<<<
 *             e_old.reset_commencement()
 *             self.update_commencement_cache (e_old, c_old, e_old.c)
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_e_old), __pyx_n_s_commencement); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 590, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_13 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_13)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_13);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_13) {
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 590, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else {
      __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 590, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_c_old, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "arrivals.pyx":591
 * 
 *             c_old = e_old.commencement()
 *             e_old.reset_commencement()             # <<<<<<<<<<<<<<
 *             self.update_commencement_cache (e_old, c_old, e_old.c)
 *             assert self.c2e_cache[e_old.qid].contains_kv (e_old.c, e_old)
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_e_old), __pyx_n_s_reset_commencement); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 591, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_13 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_13)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_13);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_13) {
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 591, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else {
      __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 591, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":592
 *             c_old = e_old.commencement()
 *             e_old.reset_commencement()
 *             self.update_commencement_cache (e_old, c_old, e_old.c)             # <<<<<<<<<<<<<<
 *             assert self.c2e_cache[e_old.qid].contains_kv (e_old.c, e_old)
 *             assert self.a2e_cache[e_old.qid].contains_kv (e_old.a, e_old)
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 592, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_13 = PyFloat_FromDouble(__pyx_v_e_old->c); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 592, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __pyx_t_9 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old), __pyx_v_c_old, __pyx_t_13};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_9, ((PyObject *)__pyx_v_e_old), __pyx_v_c_old, __pyx_t_13};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    } else
    #endif
    {
      __pyx_t_11 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      if (__pyx_t_9) {
        __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
      PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
      __Pyx_INCREF(__pyx_v_c_old);
      __Pyx_GIVEREF(__pyx_v_c_old);
      PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_v_c_old);
      __Pyx_GIVEREF(__pyx_t_13);
      PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_10, __pyx_t_13);
      __pyx_t_13 = 0;
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":593
 *             e_old.reset_commencement()
 *             self.update_commencement_cache (e_old, c_old, e_old.c)
 *             assert self.c2e_cache[e_old.qid].contains_kv (e_old.c, e_old)             # <<<<<<<<<<<<<<
 *             assert self.a2e_cache[e_old.qid].contains_kv (e_old.a, e_old)
 * 
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_self->c2e_cache, __pyx_v_e_old->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 593, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_contains_kv); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 593, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_e_old->c); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 593, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_13 = NULL;
      __pyx_t_10 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_10 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_11)) {
        PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_5, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 593, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
        PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_5, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 593, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 593, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        if (__pyx_t_13) {
          __Pyx_GIVEREF(__pyx_t_13); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_13); __pyx_t_13 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_10, __pyx_t_5);
        __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
        PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
        __pyx_t_5 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 593, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 593, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_6)) {
        PyErr_SetNone(PyExc_AssertionError);
        __PYX_ERR(0, 593, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":594
 *             self.update_commencement_cache (e_old, c_old, e_old.c)
 *             assert self.c2e_cache[e_old.qid].contains_kv (e_old.c, e_old)
 *             assert self.a2e_cache[e_old.qid].contains_kv (e_old.a, e_old)             # <<<<<<<<<<<<<<
 * 
 *             # TODO: auxiliaries
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_11 = __Pyx_GetItemInt(__pyx_v_self->a2e_cache, __pyx_v_e_old->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 594, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_contains_kv); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 594, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = PyFloat_FromDouble(__pyx_v_e_old->a); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 594, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_5 = NULL;
      __pyx_t_10 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
          __pyx_t_10 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_11, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 594, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_11, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 594, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      } else
      #endif
      {
        __pyx_t_13 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 594, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_13);
        if (__pyx_t_5) {
          __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_5); __pyx_t_5 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_10, __pyx_t_11);
        __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
        PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_10, ((PyObject *)__pyx_v_e_old));
        __pyx_t_11 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 594, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 594, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_6)) {
        PyErr_SetNone(PyExc_AssertionError);
        __PYX_ERR(0, 594, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":557
 *                     lik += delta
 * 
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             e_old = self.event (e_new.eid)
 *             self._update_ninq (e_old, e_new)  # need to do this BEFORE mucking with e_old
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":600
 *         # Can't do this sooner, b/c there may be temporary cycles in the byq
 *         #   list while the above loop
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             e_old = self.event (e_new.eid)
 *             self._update_final_byq(e_old)
 */
  if (likely(PyList_CheckExact(__pyx_v_diff_list)) || PyTuple_CheckExact(__pyx_v_diff_list)) {
    __pyx_t_2 = __pyx_v_diff_list; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_diff_list); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 600, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 600, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_8); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 600, __pyx_L1_error)
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_8); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 600, __pyx_L1_error)
        #else
        __pyx_t_8 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 600, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 600, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_e_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "arrivals.pyx":601
 *         #   list while the above loop
 *         for e_new in diff_list:
 *             e_old = self.event (e_new.eid)             # <<<<<<<<<<<<<<
 *             self._update_final_byq(e_old)
 * 
 */
    __pyx_t_8 = ((PyObject *)__pyx_f_8arrivals_8Arrivals_event(__pyx_v_self, __pyx_v_e_new->eid, 0)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 601, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_e_old, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "arrivals.pyx":602
 *         for e_new in diff_list:
 *             e_old = self.event (e_new.eid)
 *             self._update_final_byq(e_old)             # <<<<<<<<<<<<<<
 * 
 *         return lik
 */
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_final_byq); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 602, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_13 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_13)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_13);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (!__pyx_t_13) {
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_9, ((PyObject *)__pyx_v_e_old)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 602, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[2] = {__pyx_t_13, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_8);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
        PyObject *__pyx_temp[2] = {__pyx_t_13, ((PyObject *)__pyx_v_e_old)};
        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_GOTREF(__pyx_t_8);
      } else
      #endif
      {
        __pyx_t_11 = PyTuple_New(1+1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_GIVEREF(__pyx_t_13); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_13); __pyx_t_13 = NULL;
        __Pyx_INCREF(((PyObject *)__pyx_v_e_old));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_e_old));
        PyTuple_SET_ITEM(__pyx_t_11, 0+1, ((PyObject *)__pyx_v_e_old));
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_11, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "arrivals.pyx":600
 *         # Can't do this sooner, b/c there may be temporary cycles in the byq
 *         #   list while the above loop
 *         for e_new in diff_list:             # <<<<<<<<<<<<<<
 *             e_old = self.event (e_new.eid)
 *             self._update_final_byq(e_old)
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":604
 *             self._update_final_byq(e_old)
 * 
 *         return lik             # <<<<<<<<<<<<<<
 * 
 *     def _update_final_byq (self, Event evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_lik);
  __pyx_r = __pyx_v_lik;
  goto __pyx_L0;

  /* "arrivals.pyx":542
 *         return evt1
 * 
 *     def applyDiffList (self, diff_list, lik=None):             # <<<<<<<<<<<<<<
 *         cdef Event e_new, e_old
 *         cdef Event evt_prev, evt_next
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("arrivals.Arrivals.applyDiffList", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_e_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_e_old);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_prev);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_next);
  __Pyx_XDECREF((PyObject *)__pyx_v_e);
  __Pyx_XDECREF(__pyx_v_done);
  __Pyx_XDECREF(__pyx_v_c_old);
  __Pyx_XDECREF(__pyx_v_lik);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":606
 *         return lik
 * 
 *     def _update_final_byq (self, Event evt):             # <<<<<<<<<<<<<<
 *         cdef Event final
 *         if not self.byq[evt.qid]:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_61_update_final_byq(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_61_update_final_byq(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_update_final_byq (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 606, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_60_update_final_byq(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_60_update_final_byq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_final = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  __Pyx_RefNannySetupContext("_update_final_byq", 0);

  /* "arrivals.pyx":608
 *     def _update_final_byq (self, Event evt):
 *         cdef Event final
 *         if not self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             self.byq[evt.qid] = evt
 *             self.final_byq[evt.qid] = evt
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":609
 *         cdef Event final
 *         if not self.byq[evt.qid]:
 *             self.byq[evt.qid] = evt             # <<<<<<<<<<<<<<
 *             self.final_byq[evt.qid] = evt
 *         else:
 */
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_evt), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 609, __pyx_L1_error)

    /* "arrivals.pyx":610
 *         if not self.byq[evt.qid]:
 *             self.byq[evt.qid] = evt
 *             self.final_byq[evt.qid] = evt             # <<<<<<<<<<<<<<
 *         else:
 *             final = self.final_byq[evt.qid]
 */
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->final_byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_evt), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 610, __pyx_L1_error)

    /* "arrivals.pyx":608
 *     def _update_final_byq (self, Event evt):
 *         cdef Event final
 *         if not self.byq[evt.qid]:             # <<<<<<<<<<<<<<
 *             self.byq[evt.qid] = evt
 *             self.final_byq[evt.qid] = evt
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":612
 *             self.final_byq[evt.qid] = evt
 *         else:
 *             final = self.final_byq[evt.qid]             # <<<<<<<<<<<<<<
 *             while final.next_byq:
 *                 final = final.next_byq
 */
  /*else*/ {
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->final_byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 612, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 612, __pyx_L1_error)
    __pyx_v_final = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":613
 *         else:
 *             final = self.final_byq[evt.qid]
 *             while final.next_byq:             # <<<<<<<<<<<<<<
 *                 final = final.next_byq
 *             self.final_byq[evt.qid] = final
 */
    while (1) {
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_final->next_byq); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 613, __pyx_L1_error)
      if (!__pyx_t_3) break;

      /* "arrivals.pyx":614
 *             final = self.final_byq[evt.qid]
 *             while final.next_byq:
 *                 final = final.next_byq             # <<<<<<<<<<<<<<
 *             self.final_byq[evt.qid] = final
 * 
 */
      if (!(likely(((__pyx_v_final->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_final->next_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 614, __pyx_L1_error)
      __pyx_t_1 = __pyx_v_final->next_byq;
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_final, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
      __pyx_t_1 = 0;
    }

    /* "arrivals.pyx":615
 *             while final.next_byq:
 *                 final = final.next_byq
 *             self.final_byq[evt.qid] = final             # <<<<<<<<<<<<<<
 * 
 *     def _update_ninq (self, evt_old, evt):
 */
    if (unlikely(__Pyx_SetItemInt(__pyx_v_self->final_byq, __pyx_v_evt->qid, ((PyObject *)__pyx_v_final), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 615, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "arrivals.pyx":606
 *         return lik
 * 
 *     def _update_final_byq (self, Event evt):             # <<<<<<<<<<<<<<
 *         cdef Event final
 *         if not self.byq[evt.qid]:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals._update_final_byq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_final);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":617
 *             self.final_byq[evt.qid] = final
 * 
 *     def _update_ninq (self, evt_old, evt):             # <<<<<<<<<<<<<<
 *         if evt_old:
 *             if evt_old.a != evt.a:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_63_update_ninq(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_63_update_ninq(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_evt_old = 0;
  PyObject *__pyx_v_evt = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_update_ninq (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_evt_old,&__pyx_n_s_evt,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt_old)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("_update_ninq", 1, 2, 2, 1); __PYX_ERR(0, 617, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_update_ninq") < 0)) __PYX_ERR(0, 617, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_evt_old = values[0];
    __pyx_v_evt = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_update_ninq", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 617, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals._update_ninq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_62_update_ninq(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_evt_old, __pyx_v_evt);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_62_update_ninq(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt_old, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("_update_ninq", 0);

  /* "arrivals.pyx":618
 * 
 *     def _update_ninq (self, evt_old, evt):
 *         if evt_old:             # <<<<<<<<<<<<<<
 *             if evt_old.a != evt.a:
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 */
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_evt_old); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 618, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "arrivals.pyx":619
 *     def _update_ninq (self, evt_old, evt):
 *         if evt_old:
 *             if evt_old.a != evt.a:             # <<<<<<<<<<<<<<
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 *             if evt_old.d != evt.d:
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt_old, __pyx_n_s_a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 619, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 619, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 619, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 619, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {

      /* "arrivals.pyx":620
 *         if evt_old:
 *             if evt_old.a != evt.a:
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)             # <<<<<<<<<<<<<<
 *             if evt_old.d != evt.d:
 *                 self.ninq[evt.qid].move_departure(evt_old.d, evt.d)
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyObject_GetItem(__pyx_v_self->ninq, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_move_arrival); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt_old, __pyx_n_s_a); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = NULL;
      __pyx_t_7 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_7 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_2, __pyx_t_5};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 620, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_2, __pyx_t_5};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 620, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 620, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_5);
        __pyx_t_2 = 0;
        __pyx_t_5 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 620, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "arrivals.pyx":619
 *     def _update_ninq (self, evt_old, evt):
 *         if evt_old:
 *             if evt_old.a != evt.a:             # <<<<<<<<<<<<<<
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 *             if evt_old.d != evt.d:
 */
    }

    /* "arrivals.pyx":621
 *             if evt_old.a != evt.a:
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 *             if evt_old.d != evt.d:             # <<<<<<<<<<<<<<
 *                 self.ninq[evt.qid].move_departure(evt_old.d, evt.d)
 *         else:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt_old, __pyx_n_s_d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = PyObject_RichCompare(__pyx_t_4, __pyx_t_3, Py_NE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_1) {

      /* "arrivals.pyx":622
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 *             if evt_old.d != evt.d:
 *                 self.ninq[evt.qid].move_departure(evt_old.d, evt.d)             # <<<<<<<<<<<<<<
 *         else:
 *             self.ninq[evt.qid].add_birth_death(evt.a, evt.d)
 */
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 622, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyObject_GetItem(__pyx_v_self->ninq, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 622, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_move_departure); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 622, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt_old, __pyx_n_s_d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 622, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 622, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = NULL;
      __pyx_t_7 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_7 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_4, __pyx_t_5};
        __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 622, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_4, __pyx_t_5};
        __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 622, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_6 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 622, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        if (__pyx_t_2) {
          __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2); __pyx_t_2 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_7, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_7, __pyx_t_5);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 622, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

      /* "arrivals.pyx":621
 *             if evt_old.a != evt.a:
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 *             if evt_old.d != evt.d:             # <<<<<<<<<<<<<<
 *                 self.ninq[evt.qid].move_departure(evt_old.d, evt.d)
 *         else:
 */
    }

    /* "arrivals.pyx":618
 * 
 *     def _update_ninq (self, evt_old, evt):
 *         if evt_old:             # <<<<<<<<<<<<<<
 *             if evt_old.a != evt.a:
 *                 self.ninq[evt.qid].move_arrival(evt_old.a, evt.a)
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":624
 *                 self.ninq[evt.qid].move_departure(evt_old.d, evt.d)
 *         else:
 *             self.ninq[evt.qid].add_birth_death(evt.a, evt.d)             # <<<<<<<<<<<<<<
 * 
 *     def update_commencement_cache (self, Event evt, double c0, double c1):
 */
  /*else*/ {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_qid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = PyObject_GetItem(__pyx_v_self->ninq, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_add_birth_death); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_6, __pyx_t_5};
      __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 624, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_6, __pyx_t_5};
      __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 624, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else
    #endif
    {
      __pyx_t_2 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_7, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_7, __pyx_t_5);
      __pyx_t_6 = 0;
      __pyx_t_5 = 0;
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 624, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_L3:;

  /* "arrivals.pyx":617
 *             self.final_byq[evt.qid] = final
 * 
 *     def _update_ninq (self, evt_old, evt):             # <<<<<<<<<<<<<<
 *         if evt_old:
 *             if evt_old.a != evt.a:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals._update_ninq", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":626
 *             self.ninq[evt.qid].add_birth_death(evt.a, evt.d)
 * 
 *     def update_commencement_cache (self, Event evt, double c0, double c1):             # <<<<<<<<<<<<<<
 *         cache = self.c2e_cache[evt.qid]
 *         if cache.contains_key(c0):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_65update_commencement_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_65update_commencement_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_c0;
  double __pyx_v_c1;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update_commencement_cache (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_evt,&__pyx_n_s_c0,&__pyx_n_s_c1,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_c0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_commencement_cache", 1, 3, 3, 1); __PYX_ERR(0, 626, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_c1)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_commencement_cache", 1, 3, 3, 2); __PYX_ERR(0, 626, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "update_commencement_cache") < 0)) __PYX_ERR(0, 626, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[0]);
    __pyx_v_c0 = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_c0 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 626, __pyx_L3_error)
    __pyx_v_c1 = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_c1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 626, __pyx_L3_error)
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_commencement_cache", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 626, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.update_commencement_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 626, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_64update_commencement_cache(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_evt, __pyx_v_c0, __pyx_v_c1);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_64update_commencement_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_c0, double __pyx_v_c1) {
  PyObject *__pyx_v_cache = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("update_commencement_cache", 0);

  /* "arrivals.pyx":627
 * 
 *     def update_commencement_cache (self, Event evt, double c0, double c1):
 *         cache = self.c2e_cache[evt.qid]             # <<<<<<<<<<<<<<
 *         if cache.contains_key(c0):
 *             cache.remove (c0, evt.eid)
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->c2e_cache, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 627, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":628
 *     def update_commencement_cache (self, Event evt, double c0, double c1):
 *         cache = self.c2e_cache[evt.qid]
 *         if cache.contains_key(c0):             # <<<<<<<<<<<<<<
 *             cache.remove (c0, evt.eid)
 *         cache.add (c1, evt)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_contains_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_c0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 628, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "arrivals.pyx":629
 *         cache = self.c2e_cache[evt.qid]
 *         if cache.contains_key(c0):
 *             cache.remove (c0, evt.eid)             # <<<<<<<<<<<<<<
 *         cache.add (c1, evt)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_remove); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 629, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = PyFloat_FromDouble(__pyx_v_c0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 629, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 629, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 629, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 629, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 629, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_3);
      __pyx_t_5 = 0;
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 629, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":628
 *     def update_commencement_cache (self, Event evt, double c0, double c1):
 *         cache = self.c2e_cache[evt.qid]
 *         if cache.contains_key(c0):             # <<<<<<<<<<<<<<
 *             cache.remove (c0, evt.eid)
 *         cache.add (c1, evt)
 */
  }

  /* "arrivals.pyx":630
 *         if cache.contains_key(c0):
 *             cache.remove (c0, evt.eid)
 *         cache.add (c1, evt)             # <<<<<<<<<<<<<<
 * 
 *     def update_arrival_cache (self, Event evt, double a0, double a1):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_add); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 630, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = PyFloat_FromDouble(__pyx_v_c1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 630, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_8, ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_8, ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 630, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_t_8);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, ((PyObject *)__pyx_v_evt));
    __pyx_t_8 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":626
 *             self.ninq[evt.qid].add_birth_death(evt.a, evt.d)
 * 
 *     def update_commencement_cache (self, Event evt, double c0, double c1):             # <<<<<<<<<<<<<<
 *         cache = self.c2e_cache[evt.qid]
 *         if cache.contains_key(c0):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.update_commencement_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cache);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":632
 *         cache.add (c1, evt)
 * 
 *     def update_arrival_cache (self, Event evt, double a0, double a1):             # <<<<<<<<<<<<<<
 *         cache = self.a2e_cache[evt.qid]
 *         if cache.contains_key(a0):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_67update_arrival_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_67update_arrival_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_a0;
  double __pyx_v_a1;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update_arrival_cache (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_evt,&__pyx_n_s_a0,&__pyx_n_s_a1,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_arrival_cache", 1, 3, 3, 1); __PYX_ERR(0, 632, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_a1)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_arrival_cache", 1, 3, 3, 2); __PYX_ERR(0, 632, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "update_arrival_cache") < 0)) __PYX_ERR(0, 632, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[0]);
    __pyx_v_a0 = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_a0 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L3_error)
    __pyx_v_a1 = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_a1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L3_error)
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_arrival_cache", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 632, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.update_arrival_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 632, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_66update_arrival_cache(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_evt, __pyx_v_a0, __pyx_v_a1);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_66update_arrival_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_a0, double __pyx_v_a1) {
  PyObject *__pyx_v_cache = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("update_arrival_cache", 0);

  /* "arrivals.pyx":633
 * 
 *     def update_arrival_cache (self, Event evt, double a0, double a1):
 *         cache = self.a2e_cache[evt.qid]             # <<<<<<<<<<<<<<
 *         if cache.contains_key(a0):
 *             cache.remove (a0, evt.eid)
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->a2e_cache, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 633, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":634
 *     def update_arrival_cache (self, Event evt, double a0, double a1):
 *         cache = self.a2e_cache[evt.qid]
 *         if cache.contains_key(a0):             # <<<<<<<<<<<<<<
 *             cache.remove (a0, evt.eid)
 *         cache.add (a1, evt)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_contains_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 634, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_a0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 634, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 634, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 634, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 634, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 634, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 634, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 634, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "arrivals.pyx":635
 *         cache = self.a2e_cache[evt.qid]
 *         if cache.contains_key(a0):
 *             cache.remove (a0, evt.eid)             # <<<<<<<<<<<<<<
 *         cache.add (a1, evt)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_remove); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = PyFloat_FromDouble(__pyx_v_a0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 635, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_evt->eid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_4) {
        __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_3);
      __pyx_t_5 = 0;
      __pyx_t_3 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":634
 *     def update_arrival_cache (self, Event evt, double a0, double a1):
 *         cache = self.a2e_cache[evt.qid]
 *         if cache.contains_key(a0):             # <<<<<<<<<<<<<<
 *             cache.remove (a0, evt.eid)
 *         cache.add (a1, evt)
 */
  }

  /* "arrivals.pyx":636
 *         if cache.contains_key(a0):
 *             cache.remove (a0, evt.eid)
 *         cache.add (a1, evt)             # <<<<<<<<<<<<<<
 * 
 *     def setup_inq_cache (self):
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_cache, __pyx_n_s_add); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 636, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = PyFloat_FromDouble(__pyx_v_a1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 636, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_8, ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_8, ((PyObject *)__pyx_v_evt)};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_7, __pyx_t_8);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_7, ((PyObject *)__pyx_v_evt));
    __pyx_t_8 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":632
 *         cache.add (c1, evt)
 * 
 *     def update_arrival_cache (self, Event evt, double a0, double a1):             # <<<<<<<<<<<<<<
 *         cache = self.a2e_cache[evt.qid]
 *         if cache.contains_key(a0):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.update_arrival_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cache);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":638
 *         cache.add (a1, evt)
 * 
 *     def setup_inq_cache (self):             # <<<<<<<<<<<<<<
 *         inq = list()
 *         for q in self.net.all_queues():
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_69setup_inq_cache(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_69setup_inq_cache(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("setup_inq_cache (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_68setup_inq_cache(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_68setup_inq_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_inq = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_treap = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("setup_inq_cache", 0);

  /* "arrivals.pyx":639
 * 
 *     def setup_inq_cache (self):
 *         inq = list()             # <<<<<<<<<<<<<<
 *         for q in self.net.all_queues():
 *             if isinstance(q, queues.QueuePS):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 639, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_inq = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":640
 *     def setup_inq_cache (self):
 *         inq = list()
 *         for q in self.net.all_queues():             # <<<<<<<<<<<<<<
 *             if isinstance(q, queues.QueuePS):
 *                 treap = ivltreap.IntervalTreap()
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_all_queues); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 640, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 640, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_1); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 640, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 640, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 640, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":641
 *         inq = list()
 *         for q in self.net.all_queues():
 *             if isinstance(q, queues.QueuePS):             # <<<<<<<<<<<<<<
 *                 treap = ivltreap.IntervalTreap()
 *             else: treap = None
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_queues); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 641, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_QueuePS); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 641, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = PyObject_IsInstance(__pyx_v_q, __pyx_t_3); if (unlikely(__pyx_t_6 == -1)) __PYX_ERR(0, 641, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = (__pyx_t_6 != 0);
    if (__pyx_t_7) {

      /* "arrivals.pyx":642
 *         for q in self.net.all_queues():
 *             if isinstance(q, queues.QueuePS):
 *                 treap = ivltreap.IntervalTreap()             # <<<<<<<<<<<<<<
 *             else: treap = None
 *             inq.append (treap)
 */
      __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_ivltreap); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_IntervalTreap); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      if (__pyx_t_1) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
      }
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF_SET(__pyx_v_treap, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "arrivals.pyx":641
 *         inq = list()
 *         for q in self.net.all_queues():
 *             if isinstance(q, queues.QueuePS):             # <<<<<<<<<<<<<<
 *                 treap = ivltreap.IntervalTreap()
 *             else: treap = None
 */
      goto __pyx_L5;
    }

    /* "arrivals.pyx":643
 *             if isinstance(q, queues.QueuePS):
 *                 treap = ivltreap.IntervalTreap()
 *             else: treap = None             # <<<<<<<<<<<<<<
 *             inq.append (treap)
 *         return inq
 */
    /*else*/ {
      __Pyx_INCREF(Py_None);
      __Pyx_XDECREF_SET(__pyx_v_treap, Py_None);
    }
    __pyx_L5:;

    /* "arrivals.pyx":644
 *                 treap = ivltreap.IntervalTreap()
 *             else: treap = None
 *             inq.append (treap)             # <<<<<<<<<<<<<<
 *         return inq
 * 
 */
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_inq, __pyx_v_treap); if (unlikely(__pyx_t_9 == -1)) __PYX_ERR(0, 644, __pyx_L1_error)

    /* "arrivals.pyx":640
 *     def setup_inq_cache (self):
 *         inq = list()
 *         for q in self.net.all_queues():             # <<<<<<<<<<<<<<
 *             if isinstance(q, queues.QueuePS):
 *                 treap = ivltreap.IntervalTreap()
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":645
 *             else: treap = None
 *             inq.append (treap)
 *         return inq             # <<<<<<<<<<<<<<
 * 
 *     def update_inq_cache (self, Event evt_old, Event evt_new):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_inq);
  __pyx_r = __pyx_v_inq;
  goto __pyx_L0;

  /* "arrivals.pyx":638
 *         cache.add (a1, evt)
 * 
 *     def setup_inq_cache (self):             # <<<<<<<<<<<<<<
 *         inq = list()
 *         for q in self.net.all_queues():
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.setup_inq_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_inq);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_treap);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":647
 *         return inq
 * 
 *     def update_inq_cache (self, Event evt_old, Event evt_new):             # <<<<<<<<<<<<<<
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_71update_inq_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_71update_inq_cache(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_old = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update_inq_cache (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_evt_old,&__pyx_n_s_evt_new,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt_old)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt_new)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_inq_cache", 1, 2, 2, 1); __PYX_ERR(0, 647, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "update_inq_cache") < 0)) __PYX_ERR(0, 647, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
    }
    __pyx_v_evt_old = ((struct __pyx_obj_8arrivals_Event *)values[0]);
    __pyx_v_evt_new = ((struct __pyx_obj_8arrivals_Event *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_inq_cache", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 647, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.update_inq_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt_old), __pyx_ptype_8arrivals_Event, 1, "evt_old", 0))) __PYX_ERR(0, 647, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt_new), __pyx_ptype_8arrivals_Event, 1, "evt_new", 0))) __PYX_ERR(0, 647, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_70update_inq_cache(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_evt_old, __pyx_v_evt_new);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_70update_inq_cache(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt_old, struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new) {
  PyObject *__pyx_v_ivltr = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  __Pyx_RefNannySetupContext("update_inq_cache", 0);

  /* "arrivals.pyx":648
 * 
 *     def update_inq_cache (self, Event evt_old, Event evt_new):
 *         ivltr = self.inq[evt_new.qid]             # <<<<<<<<<<<<<<
 *         if ivltr is not None:  # if it's none, the inq cache is disabled
 *             if evt_old:
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->inq, __pyx_v_evt_new->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 648, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_ivltr = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":649
 *     def update_inq_cache (self, Event evt_old, Event evt_new):
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled             # <<<<<<<<<<<<<<
 *             if evt_old:
 * #            print "REM %.5f %.5f %s" % (evt_old.a, evt_old.d, evt_old) #GG
 */
  __pyx_t_2 = (__pyx_v_ivltr != Py_None);
  __pyx_t_3 = (__pyx_t_2 != 0);
  if (__pyx_t_3) {

    /* "arrivals.pyx":650
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled
 *             if evt_old:             # <<<<<<<<<<<<<<
 * #            print "REM %.5f %.5f %s" % (evt_old.a, evt_old.d, evt_old) #GG
 *                 ivltr.remove (evt_old.a, evt_old.d, evt_old)
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_old)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 650, __pyx_L1_error)
    if (__pyx_t_3) {

      /* "arrivals.pyx":652
 *             if evt_old:
 * #            print "REM %.5f %.5f %s" % (evt_old.a, evt_old.d, evt_old) #GG
 *                 ivltr.remove (evt_old.a, evt_old.d, evt_old)             # <<<<<<<<<<<<<<
 *             # N.B. applyDiffList updates in place
 *             evt = evt_old if evt_old else evt_new
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_ivltr, __pyx_n_s_remove); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 652, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_evt_old->a); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 652, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_evt_old->d); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 652, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = NULL;
      __pyx_t_8 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_8 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_t_6, ((PyObject *)__pyx_v_evt_old)};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_t_6, ((PyObject *)__pyx_v_evt_old)};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 652, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        if (__pyx_t_7) {
          __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_t_6);
        __Pyx_INCREF(((PyObject *)__pyx_v_evt_old));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_old));
        PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, ((PyObject *)__pyx_v_evt_old));
        __pyx_t_5 = 0;
        __pyx_t_6 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 652, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "arrivals.pyx":650
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled
 *             if evt_old:             # <<<<<<<<<<<<<<
 * #            print "REM %.5f %.5f %s" % (evt_old.a, evt_old.d, evt_old) #GG
 *                 ivltr.remove (evt_old.a, evt_old.d, evt_old)
 */
    }

    /* "arrivals.pyx":654
 *                 ivltr.remove (evt_old.a, evt_old.d, evt_old)
 *             # N.B. applyDiffList updates in place
 *             evt = evt_old if evt_old else evt_new             # <<<<<<<<<<<<<<
 * #        print "INQ %.5f %.5f %s" % (evt_new.a, evt_new.d, evt) #GG
 *             ivltr.insert (evt_new.a, evt_new.d, evt)
 */
    __pyx_t_3 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_evt_old)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 654, __pyx_L1_error)
    if (__pyx_t_3) {
      __Pyx_INCREF(((PyObject *)__pyx_v_evt_old));
      __pyx_t_1 = ((PyObject *)__pyx_v_evt_old);
    } else {
      __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
      __pyx_t_1 = ((PyObject *)__pyx_v_evt_new);
    }
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":656
 *             evt = evt_old if evt_old else evt_new
 * #        print "INQ %.5f %.5f %s" % (evt_new.a, evt_new.d, evt) #GG
 *             ivltr.insert (evt_new.a, evt_new.d, evt)             # <<<<<<<<<<<<<<
 * 
 *     def update_departure_caches (self, Event evt, double d0, double d1):
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_ivltr, __pyx_n_s_insert); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 656, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_evt_new->a); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 656, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_6 = PyFloat_FromDouble(__pyx_v_evt_new->d); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 656, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = NULL;
    __pyx_t_8 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_8 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_9, __pyx_t_6, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 656, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_9, __pyx_t_6, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 656, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 656, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_6);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_8, ((PyObject *)__pyx_v_evt));
      __pyx_t_9 = 0;
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 656, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":649
 *     def update_inq_cache (self, Event evt_old, Event evt_new):
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled             # <<<<<<<<<<<<<<
 *             if evt_old:
 * #            print "REM %.5f %.5f %s" % (evt_old.a, evt_old.d, evt_old) #GG
 */
  }

  /* "arrivals.pyx":647
 *         return inq
 * 
 *     def update_inq_cache (self, Event evt_old, Event evt_new):             # <<<<<<<<<<<<<<
 *         ivltr = self.inq[evt_new.qid]
 *         if ivltr is not None:  # if it's none, the inq cache is disabled
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("arrivals.Arrivals.update_inq_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ivltr);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":658
 *             ivltr.insert (evt_new.a, evt_new.d, evt)
 * 
 *     def update_departure_caches (self, Event evt, double d0, double d1):             # <<<<<<<<<<<<<<
 *         self.ninq[evt.qid].move_departure (d0, d1)
 *         if self.inq[evt.qid] is not None:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_73update_departure_caches(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_73update_departure_caches(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  double __pyx_v_d0;
  double __pyx_v_d1;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("update_departure_caches (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_evt,&__pyx_n_s_d0,&__pyx_n_s_d1,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_evt)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_d0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_departure_caches", 1, 3, 3, 1); __PYX_ERR(0, 658, __pyx_L3_error)
        }
        case  2:
        if (likely((values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_d1)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("update_departure_caches", 1, 3, 3, 2); __PYX_ERR(0, 658, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "update_departure_caches") < 0)) __PYX_ERR(0, 658, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_evt = ((struct __pyx_obj_8arrivals_Event *)values[0]);
    __pyx_v_d0 = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_d0 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 658, __pyx_L3_error)
    __pyx_v_d1 = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_d1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 658, __pyx_L3_error)
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_departure_caches", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 658, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.update_departure_caches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 658, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_72update_departure_caches(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_evt, __pyx_v_d0, __pyx_v_d1);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_72update_departure_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt, double __pyx_v_d0, double __pyx_v_d1) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("update_departure_caches", 0);

  /* "arrivals.pyx":659
 * 
 *     def update_departure_caches (self, Event evt, double d0, double d1):
 *         self.ninq[evt.qid].move_departure (d0, d1)             # <<<<<<<<<<<<<<
 *         if self.inq[evt.qid] is not None:
 *             self.inq[evt.qid].remove (evt.a, d0, evt)
 */
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_self->ninq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_move_departure); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_d0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 659, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 659, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 659, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_4);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 659, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":660
 *     def update_departure_caches (self, Event evt, double d0, double d1):
 *         self.ninq[evt.qid].move_departure (d0, d1)
 *         if self.inq[evt.qid] is not None:             # <<<<<<<<<<<<<<
 *             self.inq[evt.qid].remove (evt.a, d0, evt)
 *             self.inq[evt.qid].insert (evt.a, d1, evt)
 */
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->inq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = (__pyx_t_1 != Py_None);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_9 = (__pyx_t_8 != 0);
  if (__pyx_t_9) {

    /* "arrivals.pyx":661
 *         self.ninq[evt.qid].move_departure (d0, d1)
 *         if self.inq[evt.qid] is not None:
 *             self.inq[evt.qid].remove (evt.a, d0, evt)             # <<<<<<<<<<<<<<
 *             self.inq[evt.qid].insert (evt.a, d1, evt)
 * #        self.inq[evt.qid].validate()
 */
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_self->inq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_remove); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 661, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[4] = {__pyx_t_2, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 661, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 661, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (__pyx_t_2) {
        __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2); __pyx_t_2 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_t_4);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_6, ((PyObject *)__pyx_v_evt));
      __pyx_t_3 = 0;
      __pyx_t_4 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 661, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":662
 *         if self.inq[evt.qid] is not None:
 *             self.inq[evt.qid].remove (evt.a, d0, evt)
 *             self.inq[evt.qid].insert (evt.a, d1, evt)             # <<<<<<<<<<<<<<
 * #        self.inq[evt.qid].validate()
 * 
 */
    __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_self->inq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_insert); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyFloat_FromDouble(__pyx_v_evt->a); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_4, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_4, ((PyObject *)__pyx_v_evt)};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_2 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 662, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (__pyx_t_3) {
        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3); __pyx_t_3 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_6, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_6, __pyx_t_4);
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_2, 2+__pyx_t_6, ((PyObject *)__pyx_v_evt));
      __pyx_t_7 = 0;
      __pyx_t_4 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 662, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":660
 *     def update_departure_caches (self, Event evt, double d0, double d1):
 *         self.ninq[evt.qid].move_departure (d0, d1)
 *         if self.inq[evt.qid] is not None:             # <<<<<<<<<<<<<<
 *             self.inq[evt.qid].remove (evt.a, d0, evt)
 *             self.inq[evt.qid].insert (evt.a, d1, evt)
 */
  }

  /* "arrivals.pyx":658
 *             ivltr.insert (evt_new.a, evt_new.d, evt)
 * 
 *     def update_departure_caches (self, Event evt, double d0, double d1):             # <<<<<<<<<<<<<<
 *         self.ninq[evt.qid].move_departure (d0, d1)
 *         if self.inq[evt.qid] is not None:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.update_departure_caches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":665
 * #        self.inq[evt.qid].validate()
 * 
 *     def regenerate_all_caches (self):             # <<<<<<<<<<<<<<
 *         nq = self.num_queues()
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_75regenerate_all_caches(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_75regenerate_all_caches(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("regenerate_all_caches (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_74regenerate_all_caches(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_74regenerate_all_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_v_nq = NULL;
  PyObject *__pyx_v_evt = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  __Pyx_RefNannySetupContext("regenerate_all_caches", 0);

  /* "arrivals.pyx":666
 * 
 *     def regenerate_all_caches (self):
 *         nq = self.num_queues()             # <<<<<<<<<<<<<<
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_queues); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 666, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 666, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":667
 *     def regenerate_all_caches (self):
 *         nq = self.num_queues()
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 667, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 667, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_nq);
  __Pyx_GIVEREF(__pyx_v_nq);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_nq);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 667, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 667, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 667, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 667, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 667, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_cninq); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 667, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_Ninq); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 667, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_self->cap); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 667, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (!__pyx_t_8) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_6};
        __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_t_6};
        __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_9 = PyTuple_New(1+1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8); __pyx_t_8 = NULL;
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_9, 0+1, __pyx_t_6);
        __pyx_t_6 = 0;
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 667, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->ninq);
  __Pyx_DECREF(__pyx_v_self->ninq);
  __pyx_v_self->ninq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":668
 *         nq = self.num_queues()
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 668, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 668, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_nq);
  __Pyx_GIVEREF(__pyx_v_nq);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_nq);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 668, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 668, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 668, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 668, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_ninqueue); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 668, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_SortedList); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 668, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    if (__pyx_t_7) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 668, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->c2e_cache);
  __Pyx_DECREF(__pyx_v_self->c2e_cache);
  __pyx_v_self->c2e_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":669
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]             # <<<<<<<<<<<<<<
 *         self.inq = self.setup_inq_cache()
 *         for evt in self:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_nq);
  __Pyx_GIVEREF(__pyx_v_nq);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_nq);
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 669, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 669, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 669, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 669, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 669, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_9 = __Pyx_GetModuleGlobalName(__pyx_n_s_ninqueue); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 669, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_SortedList); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 669, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (__pyx_t_9) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else {
      __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 669, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->a2e_cache);
  __Pyx_DECREF(__pyx_v_self->a2e_cache);
  __pyx_v_self->a2e_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":670
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()             # <<<<<<<<<<<<<<
 *         for evt in self:
 *             evt.reset_commencement()
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_setup_inq_cache); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 670, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 670, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->inq);
  __Pyx_DECREF(__pyx_v_self->inq);
  __pyx_v_self->inq = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":671
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             evt.reset_commencement()
 *             self._update_ninq (None, evt)
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 671, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 671, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 671, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 671, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 671, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 671, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "arrivals.pyx":672
 *         self.inq = self.setup_inq_cache()
 *         for evt in self:
 *             evt.reset_commencement()             # <<<<<<<<<<<<<<
 *             self._update_ninq (None, evt)
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_reset_commencement); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    if (__pyx_t_7) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 672, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 672, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":673
 *         for evt in self:
 *             evt.reset_commencement()
 *             self._update_ninq (None, evt)             # <<<<<<<<<<<<<<
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 *             self.update_arrival_cache (evt, -1, evt.a)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_ninq); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, Py_None, __pyx_v_evt};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, Py_None, __pyx_v_evt};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(Py_None);
      __Pyx_GIVEREF(Py_None);
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_10, Py_None);
      __Pyx_INCREF(__pyx_v_evt);
      __Pyx_GIVEREF(__pyx_v_evt);
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_10, __pyx_v_evt);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":674
 *             evt.reset_commencement()
 *             self._update_ninq (None, evt)
 *             self.update_commencement_cache (evt, -1, evt.commencement())             # <<<<<<<<<<<<<<
 *             self.update_arrival_cache (evt, -1, evt.a)
 *             self.update_inq_cache (None, evt)
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 674, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_commencement); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 674, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 674, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_9 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 674, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_v_evt, __pyx_int_neg_1, __pyx_t_9};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 674, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_v_evt, __pyx_int_neg_1, __pyx_t_9};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 674, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 674, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(__pyx_v_evt);
      __Pyx_GIVEREF(__pyx_v_evt);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_10, __pyx_v_evt);
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_10, __pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_10, __pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 674, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":675
 *             self._update_ninq (None, evt)
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 *             self.update_arrival_cache (evt, -1, evt.a)             # <<<<<<<<<<<<<<
 *             self.update_inq_cache (None, evt)
 * 
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_arrival_cache); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 675, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 675, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_9 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_v_evt, __pyx_int_neg_1, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 675, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_v_evt, __pyx_int_neg_1, __pyx_t_6};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 675, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_7 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 675, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (__pyx_t_9) {
        __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_9); __pyx_t_9 = NULL;
      }
      __Pyx_INCREF(__pyx_v_evt);
      __Pyx_GIVEREF(__pyx_v_evt);
      PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_10, __pyx_v_evt);
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_10, __pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_10, __pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 675, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":676
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 *             self.update_arrival_cache (evt, -1, evt.a)
 *             self.update_inq_cache (None, evt)             # <<<<<<<<<<<<<<
 * 
 *     def ninq_of_queue (self, queue):
 */
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_inq_cache); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 676, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = NULL;
    __pyx_t_10 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_10 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, Py_None, __pyx_v_evt};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 676, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
      PyObject *__pyx_temp[3] = {__pyx_t_7, Py_None, __pyx_v_evt};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 676, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    {
      __pyx_t_6 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 676, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (__pyx_t_7) {
        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      __Pyx_INCREF(Py_None);
      __Pyx_GIVEREF(Py_None);
      PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_10, Py_None);
      __Pyx_INCREF(__pyx_v_evt);
      __Pyx_GIVEREF(__pyx_v_evt);
      PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_10, __pyx_v_evt);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 676, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":671
 *         self.a2e_cache = [ ninqueue.SortedList() for q in range(nq) ]
 *         self.inq = self.setup_inq_cache()
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             evt.reset_commencement()
 *             self._update_ninq (None, evt)
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":665
 * #        self.inq[evt.qid].validate()
 * 
 *     def regenerate_all_caches (self):             # <<<<<<<<<<<<<<
 *         nq = self.num_queues()
 *         self.ninq = [ cninq.Ninq(self.cap) for q in range(nq) ]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("arrivals.Arrivals.regenerate_all_caches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_nq);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":678
 *             self.update_inq_cache (None, evt)
 * 
 *     def ninq_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.ninq[qid]
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_77ninq_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_77ninq_of_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("ninq_of_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_76ninq_of_queue(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_queue));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_76ninq_of_queue(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_queue) {
  PyObject *__pyx_v_qid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_RefNannySetupContext("ninq_of_queue", 0);

  /* "arrivals.pyx":679
 * 
 *     def ninq_of_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)             # <<<<<<<<<<<<<<
 *         return self.ninq[qid]
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self->net), __pyx_n_s_qid_of_queue); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_queue); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_v_queue};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 679, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(__pyx_v_queue);
      __Pyx_GIVEREF(__pyx_v_queue);
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_v_queue);
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 679, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_qid = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":680
 *     def ninq_of_queue (self, queue):
 *         qid = self.net.qid_of_queue (queue)
 *         return self.ninq[qid]             # <<<<<<<<<<<<<<
 * 
 *     # expensive
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->ninq, __pyx_v_qid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":678
 *             self.update_inq_cache (None, evt)
 * 
 *     def ninq_of_queue (self, queue):             # <<<<<<<<<<<<<<
 *         qid = self.net.qid_of_queue (queue)
 *         return self.ninq[qid]
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("arrivals.Arrivals.ninq_of_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_qid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":683
 * 
 *     # expensive
 *     def delete_task (self, tid):             # <<<<<<<<<<<<<<
 *         task_list = self.byt[tid][:]
 *         cdef Event evt, prev, next
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_79delete_task(PyObject *__pyx_v_self, PyObject *__pyx_v_tid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_79delete_task(PyObject *__pyx_v_self, PyObject *__pyx_v_tid) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("delete_task (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_78delete_task(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_tid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_78delete_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_tid) {
  PyObject *__pyx_v_task_list = NULL;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_prev = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_next = 0;
  PyObject *__pyx_v_exemplar = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  Py_ssize_t __pyx_t_3;
  PyObject *(*__pyx_t_4)(PyObject *);
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("delete_task", 0);

  /* "arrivals.pyx":684
 *     # expensive
 *     def delete_task (self, tid):
 *         task_list = self.byt[tid][:]             # <<<<<<<<<<<<<<
 *         cdef Event evt, prev, next
 *         for evt in task_list:
 */
  __pyx_t_1 = PyObject_GetItem(__pyx_v_self->byt, __pyx_v_tid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_t_1, 0, 0, NULL, NULL, &__pyx_slice__9, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_task_list = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "arrivals.pyx":686
 *         task_list = self.byt[tid][:]
 *         cdef Event evt, prev, next
 *         for evt in task_list:             # <<<<<<<<<<<<<<
 *             self.events.pop (evt.eid) # workaround cython bug??
 * 
 */
  if (likely(PyList_CheckExact(__pyx_v_task_list)) || PyTuple_CheckExact(__pyx_v_task_list)) {
    __pyx_t_2 = __pyx_v_task_list; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_task_list); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 686, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 686, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 686, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 686, __pyx_L1_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 686, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 686, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 686, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "arrivals.pyx":687
 *         cdef Event evt, prev, next
 *         for evt in task_list:
 *             self.events.pop (evt.eid) # workaround cython bug??             # <<<<<<<<<<<<<<
 * 
 *             prev = evt.prev_byq
 */
    __pyx_t_1 = __Pyx_PyObject_PopIndex(__pyx_v_self->events, Py_None, __pyx_v_evt->eid, 1, int, __Pyx_PyInt_From_int); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 687, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":689
 *             self.events.pop (evt.eid) # workaround cython bug??
 * 
 *             prev = evt.prev_byq             # <<<<<<<<<<<<<<
 *             next = evt.next_byq
 *             if prev: prev.next_byq = next
 */
    if (!(likely(((__pyx_v_evt->prev_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 689, __pyx_L1_error)
    __pyx_t_1 = __pyx_v_evt->prev_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_prev, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "arrivals.pyx":690
 * 
 *             prev = evt.prev_byq
 *             next = evt.next_byq             # <<<<<<<<<<<<<<
 *             if prev: prev.next_byq = next
 *             if next: next.prev_byq = prev
 */
    if (!(likely(((__pyx_v_evt->next_byq) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byq, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 690, __pyx_L1_error)
    __pyx_t_1 = __pyx_v_evt->next_byq;
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_next, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "arrivals.pyx":691
 *             prev = evt.prev_byq
 *             next = evt.next_byq
 *             if prev: prev.next_byq = next             # <<<<<<<<<<<<<<
 *             if next: next.prev_byq = prev
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_prev)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 691, __pyx_L1_error)
    if (__pyx_t_5) {
      __Pyx_INCREF(((PyObject *)__pyx_v_next));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_next));
      __Pyx_GOTREF(__pyx_v_prev->next_byq);
      __Pyx_DECREF(__pyx_v_prev->next_byq);
      __pyx_v_prev->next_byq = ((PyObject *)__pyx_v_next);
    }

    /* "arrivals.pyx":692
 *             next = evt.next_byq
 *             if prev: prev.next_byq = next
 *             if next: next.prev_byq = prev             # <<<<<<<<<<<<<<
 * 
 *             exemplar = self.byq[evt.qid]
 */
    __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_next)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 692, __pyx_L1_error)
    if (__pyx_t_5) {
      __Pyx_INCREF(((PyObject *)__pyx_v_prev));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_prev));
      __Pyx_GOTREF(__pyx_v_next->prev_byq);
      __Pyx_DECREF(__pyx_v_next->prev_byq);
      __pyx_v_next->prev_byq = ((PyObject *)__pyx_v_prev);
    }

    /* "arrivals.pyx":694
 *             if next: next.prev_byq = prev
 * 
 *             exemplar = self.byq[evt.qid]             # <<<<<<<<<<<<<<
 *             if exemplar == evt:
 *                 exemplar = evt.prev_byq
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 694, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_exemplar, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":695
 * 
 *             exemplar = self.byq[evt.qid]
 *             if exemplar == evt:             # <<<<<<<<<<<<<<
 *                 exemplar = evt.prev_byq
 *                 if not exemplar: exemplar = evt.next_byq
 */
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_exemplar, ((PyObject *)__pyx_v_evt), Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 695, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_5) {

      /* "arrivals.pyx":696
 *             exemplar = self.byq[evt.qid]
 *             if exemplar == evt:
 *                 exemplar = evt.prev_byq             # <<<<<<<<<<<<<<
 *                 if not exemplar: exemplar = evt.next_byq
 *                 self.byq[evt.qid] = exemplar
 */
      __pyx_t_1 = __pyx_v_evt->prev_byq;
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_exemplar, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "arrivals.pyx":697
 *             if exemplar == evt:
 *                 exemplar = evt.prev_byq
 *                 if not exemplar: exemplar = evt.next_byq             # <<<<<<<<<<<<<<
 *                 self.byq[evt.qid] = exemplar
 * 
 */
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_exemplar); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 697, __pyx_L1_error)
      __pyx_t_6 = ((!__pyx_t_5) != 0);
      if (__pyx_t_6) {
        __pyx_t_1 = __pyx_v_evt->next_byq;
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_DECREF_SET(__pyx_v_exemplar, __pyx_t_1);
        __pyx_t_1 = 0;
      }

      /* "arrivals.pyx":698
 *                 exemplar = evt.prev_byq
 *                 if not exemplar: exemplar = evt.next_byq
 *                 self.byq[evt.qid] = exemplar             # <<<<<<<<<<<<<<
 * 
 *         del self.byt[tid]
 */
      if (unlikely(__Pyx_SetItemInt(__pyx_v_self->byq, __pyx_v_evt->qid, __pyx_v_exemplar, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 698, __pyx_L1_error)

      /* "arrivals.pyx":695
 * 
 *             exemplar = self.byq[evt.qid]
 *             if exemplar == evt:             # <<<<<<<<<<<<<<
 *                 exemplar = evt.prev_byq
 *                 if not exemplar: exemplar = evt.next_byq
 */
    }

    /* "arrivals.pyx":686
 *         task_list = self.byt[tid][:]
 *         cdef Event evt, prev, next
 *         for evt in task_list:             # <<<<<<<<<<<<<<
 *             self.events.pop (evt.eid) # workaround cython bug??
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":700
 *                 self.byq[evt.qid] = exemplar
 * 
 *         del self.byt[tid]             # <<<<<<<<<<<<<<
 * 
 *         self.recompute_all_service()
 */
  if (unlikely(PyObject_DelItem(__pyx_v_self->byt, __pyx_v_tid) < 0)) __PYX_ERR(0, 700, __pyx_L1_error)

  /* "arrivals.pyx":702
 *         del self.byt[tid]
 * 
 *         self.recompute_all_service()             # <<<<<<<<<<<<<<
 * 
 *     def append_and_check (self, Event evt):
 */
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_recompute_all_service); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 702, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  if (__pyx_t_7) {
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else {
    __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":683
 * 
 *     # expensive
 *     def delete_task (self, tid):             # <<<<<<<<<<<<<<
 *         task_list = self.byt[tid][:]
 *         cdef Event evt, prev, next
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.delete_task", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_task_list);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_prev);
  __Pyx_XDECREF((PyObject *)__pyx_v_next);
  __Pyx_XDECREF(__pyx_v_exemplar);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":704
 *         self.recompute_all_service()
 * 
 *     def append_and_check (self, Event evt):             # <<<<<<<<<<<<<<
 *         """Adds the given event to this Arrivals object.
 *             Event must arrive after all other arrivals to this object.
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_81append_and_check(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static char __pyx_doc_8arrivals_8Arrivals_80append_and_check[] = "Adds the given event to this Arrivals object.\n            Event must arrive after all other arrivals to this object.\n            This method checks that adding evt would not break FIFO constraints.\n            If it would, a warning is printed and the event is not added.";
static PyObject *__pyx_pw_8arrivals_8Arrivals_81append_and_check(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("append_and_check (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_evt), __pyx_ptype_8arrivals_Event, 1, "evt", 0))) __PYX_ERR(0, 704, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_80append_and_check(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_80append_and_check(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_v_clear_time = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  __Pyx_RefNannySetupContext("append_and_check", 0);

  /* "arrivals.pyx":709
 *             This method checks that adding evt would not break FIFO constraints.
 *             If it would, a warning is printed and the event is not added."""
 *         clear_time = evt.q.when_clear (self)             # <<<<<<<<<<<<<<
 *         if clear_time > evt.d:
 *             warnings.warn ("Arrivals: Disregarding event %s (breaks FIFO assumptions)" % evt)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt->q), __pyx_n_s_when_clear); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 709, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, ((PyObject *)__pyx_v_self)};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, ((PyObject *)__pyx_v_self)};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 709, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_4, 0+1, ((PyObject *)__pyx_v_self));
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_clear_time = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":710
 *             If it would, a warning is printed and the event is not added."""
 *         clear_time = evt.q.when_clear (self)
 *         if clear_time > evt.d:             # <<<<<<<<<<<<<<
 *             warnings.warn ("Arrivals: Disregarding event %s (breaks FIFO assumptions)" % evt)
 *         else:
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_evt->d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 710, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_clear_time, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 710, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 710, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "arrivals.pyx":711
 *         clear_time = evt.q.when_clear (self)
 *         if clear_time > evt.d:
 *             warnings.warn ("Arrivals: Disregarding event %s (breaks FIFO assumptions)" % evt)             # <<<<<<<<<<<<<<
 *         else:
 *             self.append (evt)
 */
    __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_warnings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_warn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Arrivals_Disregarding_event_s_br, ((PyObject *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 711, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_3) {
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_t_1};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_t_1};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      {
        __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "arrivals.pyx":710
 *             If it would, a warning is printed and the event is not added."""
 *         clear_time = evt.q.when_clear (self)
 *         if clear_time > evt.d:             # <<<<<<<<<<<<<<
 *             warnings.warn ("Arrivals: Disregarding event %s (breaks FIFO assumptions)" % evt)
 *         else:
 */
    goto __pyx_L3;
  }

  /* "arrivals.pyx":713
 *             warnings.warn ("Arrivals: Disregarding event %s (breaks FIFO assumptions)" % evt)
 *         else:
 *             self.append (evt)             # <<<<<<<<<<<<<<
 * 
 *     def qnet (self): return self.net
 */
  /*else*/ {
    __pyx_t_7 = __Pyx_PyObject_Append(((PyObject *)__pyx_v_self), ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 713, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "arrivals.pyx":704
 *         self.recompute_all_service()
 * 
 *     def append_and_check (self, Event evt):             # <<<<<<<<<<<<<<
 *         """Adds the given event to this Arrivals object.
 *             Event must arrive after all other arrivals to this object.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("arrivals.Arrivals.append_and_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_clear_time);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":715
 *             self.append (evt)
 * 
 *     def qnet (self): return self.net             # <<<<<<<<<<<<<<
 * 
 *     def num_queues (self): return len(self.byq)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_83qnet(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_83qnet(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("qnet (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_82qnet(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_82qnet(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("qnet", 0);
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->net));
  __pyx_r = ((PyObject *)__pyx_v_self->net);
  goto __pyx_L0;

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":717
 *     def qnet (self): return self.net
 * 
 *     def num_queues (self): return len(self.byq)             # <<<<<<<<<<<<<<
 * 
 *     cpdef inline Event event (self, int eid):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_85num_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_85num_queues(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("num_queues (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_84num_queues(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_84num_queues(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  __Pyx_RefNannySetupContext("num_queues", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_v_self->byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 717, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.num_queues", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":719
 *     def num_queues (self): return len(self.byq)
 * 
 *     cpdef inline Event event (self, int eid):             # <<<<<<<<<<<<<<
 *         return self.events[eid]
 * 
 */

static PyObject *__pyx_pw_8arrivals_8Arrivals_87event(PyObject *__pyx_v_self, PyObject *__pyx_arg_eid); /*proto*/
static CYTHON_INLINE struct __pyx_obj_8arrivals_Event *__pyx_f_8arrivals_8Arrivals_event(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, int __pyx_v_eid, CYTHON_UNUSED int __pyx_skip_dispatch) {
  struct __pyx_obj_8arrivals_Event *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("event", 0);

  /* "arrivals.pyx":720
 * 
 *     cpdef inline Event event (self, int eid):
 *         return self.events[eid]             # <<<<<<<<<<<<<<
 * 
 *     def is_initial (self, evt):
 */
  __Pyx_XDECREF(((PyObject *)__pyx_r));
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_self->events, __pyx_v_eid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 720, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 720, __pyx_L1_error)
  __pyx_r = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":719
 *     def num_queues (self): return len(self.byq)
 * 
 *     cpdef inline Event event (self, int eid):             # <<<<<<<<<<<<<<
 *         return self.events[eid]
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.event", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF((PyObject *)__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_87event(PyObject *__pyx_v_self, PyObject *__pyx_arg_eid); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_87event(PyObject *__pyx_v_self, PyObject *__pyx_arg_eid) {
  int __pyx_v_eid;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("event (wrapper)", 0);
  assert(__pyx_arg_eid); {
    __pyx_v_eid = __Pyx_PyInt_As_int(__pyx_arg_eid); if (unlikely((__pyx_v_eid == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 719, __pyx_L3_error)
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.event", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_86event(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((int)__pyx_v_eid));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_86event(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, int __pyx_v_eid) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("event", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = ((PyObject *)__pyx_f_8arrivals_8Arrivals_event(__pyx_v_self, __pyx_v_eid, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 719, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.event", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":722
 *         return self.events[eid]
 * 
 *     def is_initial (self, evt):             # <<<<<<<<<<<<<<
 *         return self._is_initial (evt)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_89is_initial(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_89is_initial(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_initial (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_88is_initial(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_88is_initial(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("is_initial", 0);

  /* "arrivals.pyx":723
 * 
 *     def is_initial (self, evt):
 *         return self._is_initial (evt)             # <<<<<<<<<<<<<<
 * 
 *     cdef _is_initial (self, Event evt):
 */
  __Pyx_XDECREF(__pyx_r);
  if (!(likely(((__pyx_v_evt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 723, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_8arrivals_8Arrivals__is_initial(__pyx_v_self, ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 723, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":722
 *         return self.events[eid]
 * 
 *     def is_initial (self, evt):             # <<<<<<<<<<<<<<
 *         return self._is_initial (evt)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.is_initial", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":725
 *         return self._is_initial (evt)
 * 
 *     cdef _is_initial (self, Event evt):             # <<<<<<<<<<<<<<
 *         return not evt.prev_byt
 * 
 */

static PyObject *__pyx_f_8arrivals_8Arrivals__is_initial(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("_is_initial", 0);

  /* "arrivals.pyx":726
 * 
 *     cdef _is_initial (self, Event evt):
 *         return not evt.prev_byt             # <<<<<<<<<<<<<<
 * 
 *     def is_final (self, evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 726, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 726, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":725
 *         return self._is_initial (evt)
 * 
 *     cdef _is_initial (self, Event evt):             # <<<<<<<<<<<<<<
 *         return not evt.prev_byt
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("arrivals.Arrivals._is_initial", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":728
 *         return not evt.prev_byt
 * 
 *     def is_final (self, evt):             # <<<<<<<<<<<<<<
 *         return self._is_final (evt)
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_91is_final(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_91is_final(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_final (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_90is_final(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_90is_final(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannySetupContext("is_final", 0);

  /* "arrivals.pyx":729
 * 
 *     def is_final (self, evt):
 *         return self._is_final (evt)             # <<<<<<<<<<<<<<
 * 
 *     cdef _is_final (self, Event evt):
 */
  __Pyx_XDECREF(__pyx_r);
  if (!(likely(((__pyx_v_evt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 729, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_8arrivals_8Arrivals__is_final(__pyx_v_self, ((struct __pyx_obj_8arrivals_Event *)__pyx_v_evt)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":728
 *         return not evt.prev_byt
 * 
 *     def is_final (self, evt):             # <<<<<<<<<<<<<<
 *         return self._is_final (evt)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.is_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":731
 *         return self._is_final (evt)
 * 
 *     cdef _is_final (self, Event evt):             # <<<<<<<<<<<<<<
 *         return not evt.next_byt
 * 
 */

static PyObject *__pyx_f_8arrivals_8Arrivals__is_final(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, struct __pyx_obj_8arrivals_Event *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_RefNannySetupContext("_is_final", 0);

  /* "arrivals.pyx":732
 * 
 *     cdef _is_final (self, Event evt):
 *         return not evt.next_byt             # <<<<<<<<<<<<<<
 * 
 *     def is_last_in_queue (self, evt):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byt); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 732, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyBool_FromLong((!__pyx_t_1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":731
 *         return self._is_final (evt)
 * 
 *     cdef _is_final (self, Event evt):             # <<<<<<<<<<<<<<
 *         return not evt.next_byt
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("arrivals.Arrivals._is_final", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":734
 *         return not evt.next_byt
 * 
 *     def is_last_in_queue (self, evt):             # <<<<<<<<<<<<<<
 *         cdef Event e = evt
 *         return not e.next_byq
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_93is_last_in_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_evt); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_93is_last_in_queue(PyObject *__pyx_v_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_last_in_queue (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_92is_last_in_queue(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_92is_last_in_queue(CYTHON_UNUSED struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_evt) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_e = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  __Pyx_RefNannySetupContext("is_last_in_queue", 0);

  /* "arrivals.pyx":735
 * 
 *     def is_last_in_queue (self, evt):
 *         cdef Event e = evt             # <<<<<<<<<<<<<<
 *         return not e.next_byq
 * 
 */
  if (!(likely(((__pyx_v_evt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 735, __pyx_L1_error)
  __pyx_t_1 = __pyx_v_evt;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_e = ((struct __pyx_obj_8arrivals_Event *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":736
 *     def is_last_in_queue (self, evt):
 *         cdef Event e = evt
 *         return not e.next_byq             # <<<<<<<<<<<<<<
 * 
 *     def recompute_all_service (self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_e->next_byq); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 736, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyBool_FromLong((!__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":734
 *         return not evt.next_byt
 * 
 *     def is_last_in_queue (self, evt):             # <<<<<<<<<<<<<<
 *         cdef Event e = evt
 *         return not e.next_byq
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("arrivals.Arrivals.is_last_in_queue", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":738
 *         return not e.next_byq
 * 
 *     def recompute_all_service (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in self:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_95recompute_all_service(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_95recompute_all_service(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("recompute_all_service (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_94recompute_all_service(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_94recompute_all_service(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  CYTHON_UNUSED PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("recompute_all_service", 0);

  /* "arrivals.pyx":740
 *     def recompute_all_service (self):
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             evt.q.recompute_service (evt)
 *             evt.reset_commencement()
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 740, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 740, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 740, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 740, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 740, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 740, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "arrivals.pyx":741
 *         cdef Event evt
 *         for evt in self:
 *             evt.q.recompute_service (evt)             # <<<<<<<<<<<<<<
 *             evt.reset_commencement()
 *         # regenerate the commencement caches
 */
    __pyx_t_4 = ((struct __pyx_vtabstruct_6queues_Queue *)__pyx_v_evt->q->__pyx_vtab)->recompute_service(__pyx_v_evt->q, __pyx_v_evt, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "arrivals.pyx":742
 *         for evt in self:
 *             evt.q.recompute_service (evt)
 *             evt.reset_commencement()             # <<<<<<<<<<<<<<
 *         # regenerate the commencement caches
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(self.num_queues()) ]  #
 */
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_reset_commencement); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 742, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "arrivals.pyx":740
 *     def recompute_all_service (self):
 *         cdef Event evt
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             evt.q.recompute_service (evt)
 *             evt.reset_commencement()
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":744
 *             evt.reset_commencement()
 *         # regenerate the commencement caches
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(self.num_queues()) ]  #             # <<<<<<<<<<<<<<
 *         for evt in self:
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_queues); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  if (__pyx_t_6) {
    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  } else {
    __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_5 = __pyx_t_4; __Pyx_INCREF(__pyx_t_5); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 744, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 744, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_5))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 744, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 744, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_5);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 744, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_GetModuleGlobalName(__pyx_n_s_ninqueue); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 744, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_SortedList); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 744, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 744, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v_self->c2e_cache);
  __Pyx_DECREF(__pyx_v_self->c2e_cache);
  __pyx_v_self->c2e_cache = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":745
 *         # regenerate the commencement caches
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(self.num_queues()) ]  #
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 * 
 */
  if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
    __pyx_t_1 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 745, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 745, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 745, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 745, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 745, __pyx_L1_error)
        #else
        __pyx_t_5 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 745, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        #endif
      }
    } else {
      __pyx_t_5 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 745, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_5);
    }
    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 745, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_5));
    __pyx_t_5 = 0;

    /* "arrivals.pyx":746
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(self.num_queues()) ]  #
 *         for evt in self:
 *             self.update_commencement_cache (evt, -1, evt.commencement())             # <<<<<<<<<<<<<<
 * 
 *     def subset (self, fn, adapt_fn=None):
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_update_commencement_cache); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 746, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt), __pyx_n_s_commencement); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 746, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
      }
    }
    if (__pyx_t_8) {
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 746, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 746, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_7};
      __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 746, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, ((PyObject *)__pyx_v_evt), __pyx_int_neg_1, __pyx_t_7};
      __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 746, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(3+__pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 746, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_6) {
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_evt));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_9, ((PyObject *)__pyx_v_evt));
      __Pyx_INCREF(__pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_9, __pyx_int_neg_1);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_9, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_8, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 746, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "arrivals.pyx":745
 *         # regenerate the commencement caches
 *         self.c2e_cache = [ ninqueue.SortedList() for q in range(self.num_queues()) ]  #
 *         for evt in self:             # <<<<<<<<<<<<<<
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":738
 *         return not e.next_byq
 * 
 *     def recompute_all_service (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in self:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.recompute_all_service", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":748
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 * 
 *     def subset (self, fn, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         cdef Arrivals a_new
 *         cdef Event evt, evt_new
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_97subset(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_97subset(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fn = 0;
  CYTHON_UNUSED PyObject *__pyx_v_adapt_fn = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("subset (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_fn,&__pyx_n_s_adapt_fn,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_fn)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_adapt_fn);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "subset") < 0)) __PYX_ERR(0, 748, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_fn = values[0];
    __pyx_v_adapt_fn = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("subset", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 748, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.subset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_96subset(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_fn, __pyx_v_adapt_fn);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_96subset(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_fn, CYTHON_UNUSED PyObject *__pyx_v_adapt_fn) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_a_new = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt_new = 0;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  int __pyx_t_13;
  __Pyx_RefNannySetupContext("subset", 0);

  /* "arrivals.pyx":752
 *         cdef Event evt, evt_new
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)             # <<<<<<<<<<<<<<
 *         for tid in self.byt.keys():
 *             for evt in self.events_of_task (tid):
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->net));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self->net));
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->cap); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_cap, __pyx_t_3) < 0) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_8arrivals_Arrivals), __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_a_new = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "arrivals.pyx":753
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt.keys():             # <<<<<<<<<<<<<<
 *             for evt in self.events_of_task (tid):
 *                 evt_new = evt.duplicate()
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->byt, __pyx_n_s_keys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 753, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 753, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_4); __Pyx_INCREF(__pyx_t_3); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 753, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_5(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 753, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "arrivals.pyx":754
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt.keys():
 *             for evt in self.events_of_task (tid):             # <<<<<<<<<<<<<<
 *                 evt_new = evt.duplicate()
 *                 if not fn(self,evt):
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 754, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_tid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_tid};
        __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_v_tid};
        __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 754, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_INCREF(__pyx_v_tid);
        __Pyx_GIVEREF(__pyx_v_tid);
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_v_tid);
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
      __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 754, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 754, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 754, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        } else {
          if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 754, __pyx_L1_error)
          #else
          __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_9(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 754, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 754, __pyx_L1_error)
      __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "arrivals.pyx":755
 *         for tid in self.byt.keys():
 *             for evt in self.events_of_task (tid):
 *                 evt_new = evt.duplicate()             # <<<<<<<<<<<<<<
 *                 if not fn(self,evt):
 *                     evt_new.obs_a = evt_new.obs_d = 0
 */
      __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_8arrivals_Event *)__pyx_v_evt->__pyx_vtab)->duplicate(__pyx_v_evt, 0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_evt_new, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "arrivals.pyx":756
 *             for evt in self.events_of_task (tid):
 *                 evt_new = evt.duplicate()
 *                 if not fn(self,evt):             # <<<<<<<<<<<<<<
 *                     evt_new.obs_a = evt_new.obs_d = 0
 *                 a_new.insert (evt_new)
 */
      __Pyx_INCREF(__pyx_v_fn);
      __pyx_t_7 = __pyx_v_fn; __pyx_t_6 = NULL;
      __pyx_t_10 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
          __pyx_t_10 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_v_self), ((PyObject *)__pyx_v_evt)};
        __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 756, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
        PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_v_self), ((PyObject *)__pyx_v_evt)};
        __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 756, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_3);
      } else
      #endif
      {
        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 756, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_INCREF(((PyObject *)__pyx_v_self));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
        PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, ((PyObject *)__pyx_v_self));
        __Pyx_INCREF(((PyObject *)__pyx_v_evt));
        __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
        PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, ((PyObject *)__pyx_v_evt));
        __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 756, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 756, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_13 = ((!__pyx_t_12) != 0);
      if (__pyx_t_13) {

        /* "arrivals.pyx":757
 *                 evt_new = evt.duplicate()
 *                 if not fn(self,evt):
 *                     evt_new.obs_a = evt_new.obs_d = 0             # <<<<<<<<<<<<<<
 *                 a_new.insert (evt_new)
 * 
 */
        __pyx_v_evt_new->obs_a = 0;
        __pyx_v_evt_new->obs_d = 0;

        /* "arrivals.pyx":756
 *             for evt in self.events_of_task (tid):
 *                 evt_new = evt.duplicate()
 *                 if not fn(self,evt):             # <<<<<<<<<<<<<<
 *                     evt_new.obs_a = evt_new.obs_d = 0
 *                 a_new.insert (evt_new)
 */
      }

      /* "arrivals.pyx":758
 *                 if not fn(self,evt):
 *                     evt_new.obs_a = evt_new.obs_d = 0
 *                 a_new.insert (evt_new)             # <<<<<<<<<<<<<<
 * 
 *         return a_new
 */
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_a_new), __pyx_n_s_insert); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 758, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_11 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (!__pyx_t_11) {
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_evt_new)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_11, ((PyObject *)__pyx_v_evt_new)};
          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[2] = {__pyx_t_11, ((PyObject *)__pyx_v_evt_new)};
          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_GOTREF(__pyx_t_3);
        } else
        #endif
        {
          __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 758, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_11); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_11); __pyx_t_11 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_evt_new));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_evt_new));
          PyTuple_SET_ITEM(__pyx_t_6, 0+1, ((PyObject *)__pyx_v_evt_new));
          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "arrivals.pyx":754
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt.keys():
 *             for evt in self.events_of_task (tid):             # <<<<<<<<<<<<<<
 *                 evt_new = evt.duplicate()
 *                 if not fn(self,evt):
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "arrivals.pyx":753
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt.keys():             # <<<<<<<<<<<<<<
 *             for evt in self.events_of_task (tid):
 *                 evt_new = evt.duplicate()
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "arrivals.pyx":760
 *                 a_new.insert (evt_new)
 * 
 *         return a_new             # <<<<<<<<<<<<<<
 * 
 *     def subset_by_task (self, pct, adapt_fn=None):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_a_new));
  __pyx_r = ((PyObject *)__pyx_v_a_new);
  goto __pyx_L0;

  /* "arrivals.pyx":748
 *             self.update_commencement_cache (evt, -1, evt.commencement())
 * 
 *     def subset (self, fn, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         cdef Arrivals a_new
 *         cdef Event evt, evt_new
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("arrivals.Arrivals.subset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_a_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt_new);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":762
 *         return a_new
 * 
 *     def subset_by_task (self, pct, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         """Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed."""
 *         to_inc = dict()
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_99subset_by_task(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8arrivals_8Arrivals_98subset_by_task[] = "Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed.";
static PyObject *__pyx_pw_8arrivals_8Arrivals_99subset_by_task(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_pct = 0;
  PyObject *__pyx_v_adapt_fn = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("subset_by_task (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pct,&__pyx_n_s_adapt_fn,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_pct)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_adapt_fn);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "subset_by_task") < 0)) __PYX_ERR(0, 762, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_pct = values[0];
    __pyx_v_adapt_fn = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("subset_by_task", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 762, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.subset_by_task", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_98subset_by_task(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_pct, __pyx_v_adapt_fn);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_98subset_by_task(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_pct, PyObject *__pyx_v_adapt_fn) {
  PyObject *__pyx_v_to_inc = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  __Pyx_RefNannySetupContext("subset_by_task", 0);

  /* "arrivals.pyx":764
 *     def subset_by_task (self, pct, adapt_fn=None):
 *         """Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed."""
 *         to_inc = dict()             # <<<<<<<<<<<<<<
 *         for tid in self.byt:
 *             if numpy.random.rand() > pct:
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_to_inc = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":765
 *         """Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed."""
 *         to_inc = dict()
 *         for tid in self.byt:             # <<<<<<<<<<<<<<
 *             if numpy.random.rand() > pct:
 *                 to_inc[tid] = 1.0
 */
  if (likely(PyList_CheckExact(__pyx_v_self->byt)) || PyTuple_CheckExact(__pyx_v_self->byt)) {
    __pyx_t_1 = __pyx_v_self->byt; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->byt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 765, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 765, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 765, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 765, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 765, __pyx_L1_error)
        #else
        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 765, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 765, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "arrivals.pyx":766
 *         to_inc = dict()
 *         for tid in self.byt:
 *             if numpy.random.rand() > pct:             # <<<<<<<<<<<<<<
 *                 to_inc[tid] = 1.0
 *         return self.subset (netutils.not_in_set2 (to_inc), adapt_fn=adapt_fn)
 */
    __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_numpy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_random); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_rand); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    if (__pyx_t_6) {
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 766, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else {
      __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 766, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_pct, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 766, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_7) {

      /* "arrivals.pyx":767
 *         for tid in self.byt:
 *             if numpy.random.rand() > pct:
 *                 to_inc[tid] = 1.0             # <<<<<<<<<<<<<<
 *         return self.subset (netutils.not_in_set2 (to_inc), adapt_fn=adapt_fn)
 * 
 */
      if (unlikely(PyDict_SetItem(__pyx_v_to_inc, __pyx_v_tid, __pyx_float_1_0) < 0)) __PYX_ERR(0, 767, __pyx_L1_error)

      /* "arrivals.pyx":766
 *         to_inc = dict()
 *         for tid in self.byt:
 *             if numpy.random.rand() > pct:             # <<<<<<<<<<<<<<
 *                 to_inc[tid] = 1.0
 *         return self.subset (netutils.not_in_set2 (to_inc), adapt_fn=adapt_fn)
 */
    }

    /* "arrivals.pyx":765
 *         """Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed."""
 *         to_inc = dict()
 *         for tid in self.byt:             # <<<<<<<<<<<<<<
 *             if numpy.random.rand() > pct:
 *                 to_inc[tid] = 1.0
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":768
 *             if numpy.random.rand() > pct:
 *                 to_inc[tid] = 1.0
 *         return self.subset (netutils.not_in_set2 (to_inc), adapt_fn=adapt_fn)             # <<<<<<<<<<<<<<
 * 
 *     # if function(arrv, tid) is true, put tid in return
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_subset); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_netutils); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_not_in_set2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  if (!__pyx_t_4) {
    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_to_inc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 768, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_6)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_to_inc};
      __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_5);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
      PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_v_to_inc};
      __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_GOTREF(__pyx_t_5);
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4); __pyx_t_4 = NULL;
      __Pyx_INCREF(__pyx_v_to_inc);
      __Pyx_GIVEREF(__pyx_v_to_inc);
      PyTuple_SET_ITEM(__pyx_t_8, 0+1, __pyx_v_to_inc);
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = PyDict_New(); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_adapt_fn, __pyx_v_adapt_fn) < 0) __PYX_ERR(0, 768, __pyx_L1_error)
  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_8;
  __pyx_t_8 = 0;
  goto __pyx_L0;

  /* "arrivals.pyx":762
 *         return a_new
 * 
 *     def subset_by_task (self, pct, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         """Return a new copy of this Arrivals object in which about PCT %% of the tasks are observed."""
 *         to_inc = dict()
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("arrivals.Arrivals.subset_by_task", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_to_inc);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":771
 * 
 *     # if function(arrv, tid) is true, put tid in return
 *     def subset_by_task_fn (self, fn, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         cdef Arrivals a_new
 *         cdef Event evt, evt_new
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_101subset_by_task_fn(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_101subset_by_task_fn(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fn = 0;
  CYTHON_UNUSED PyObject *__pyx_v_adapt_fn = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("subset_by_task_fn (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_fn,&__pyx_n_s_adapt_fn,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_fn)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args > 0) {
          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_adapt_fn);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "subset_by_task_fn") < 0)) __PYX_ERR(0, 771, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_fn = values[0];
    __pyx_v_adapt_fn = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("subset_by_task_fn", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 771, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("arrivals.Arrivals.subset_by_task_fn", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_100subset_by_task_fn(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self), __pyx_v_fn, __pyx_v_adapt_fn);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_100subset_by_task_fn(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self, PyObject *__pyx_v_fn, CYTHON_UNUSED PyObject *__pyx_v_adapt_fn) {
  struct __pyx_obj_8arrivals_Arrivals *__pyx_v_a_new = 0;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  __Pyx_RefNannySetupContext("subset_by_task_fn", 0);

  /* "arrivals.pyx":775
 *         cdef Event evt, evt_new
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)             # <<<<<<<<<<<<<<
 *         for tid in self.byt:
 *             if fn(self, tid):
 */
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_self->net));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_self->net));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_self->net));
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->cap); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_cap, __pyx_t_3) < 0) __PYX_ERR(0, 775, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)__pyx_ptype_8arrivals_Arrivals), __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_a_new = ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "arrivals.pyx":776
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt:             # <<<<<<<<<<<<<<
 *             if fn(self, tid):
 *                 for e in self.events_of_task (tid):
 */
  if (likely(PyList_CheckExact(__pyx_v_self->byt)) || PyTuple_CheckExact(__pyx_v_self->byt)) {
    __pyx_t_3 = __pyx_v_self->byt; __Pyx_INCREF(__pyx_t_3); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_self->byt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 776, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 776, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 776, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 776, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "arrivals.pyx":777
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt:
 *             if fn(self, tid):             # <<<<<<<<<<<<<<
 *                 for e in self.events_of_task (tid):
 *                     a_new.insert (e.duplicate())
 */
    __Pyx_INCREF(__pyx_v_fn);
    __pyx_t_1 = __pyx_v_fn; __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_v_self), __pyx_v_tid};
      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 777, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_6, ((PyObject *)__pyx_v_self), __pyx_v_tid};
      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 777, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_GOTREF(__pyx_t_2);
    } else
    #endif
    {
      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 777, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (__pyx_t_6) {
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_self));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
      PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_v_self));
      __Pyx_INCREF(__pyx_v_tid);
      __Pyx_GIVEREF(__pyx_v_tid);
      PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_tid);
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 777, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 777, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_9) {

      /* "arrivals.pyx":778
 *         for tid in self.byt:
 *             if fn(self, tid):
 *                 for e in self.events_of_task (tid):             # <<<<<<<<<<<<<<
 *                     a_new.insert (e.duplicate())
 * 
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_task); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      if (!__pyx_t_8) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_tid); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_tid};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
          PyObject *__pyx_temp[2] = {__pyx_t_8, __pyx_v_tid};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
        } else
        #endif
        {
          __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 778, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8); __pyx_t_8 = NULL;
          __Pyx_INCREF(__pyx_v_tid);
          __Pyx_GIVEREF(__pyx_v_tid);
          PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_v_tid);
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
        __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_10 = 0;
        __pyx_t_11 = NULL;
      } else {
        __pyx_t_10 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 778, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_11 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 778, __pyx_L1_error)
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      for (;;) {
        if (likely(!__pyx_t_11)) {
          if (likely(PyList_CheckExact(__pyx_t_1))) {
            if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          } else {
            if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 778, __pyx_L1_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 778, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_11(__pyx_t_1);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 778, __pyx_L1_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_2);
        __pyx_t_2 = 0;

        /* "arrivals.pyx":779
 *             if fn(self, tid):
 *                 for e in self.events_of_task (tid):
 *                     a_new.insert (e.duplicate())             # <<<<<<<<<<<<<<
 * 
 *         return a_new
 */
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_a_new), __pyx_n_s_insert); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 779, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_duplicate); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 779, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_13 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_12))) {
          __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
          if (likely(__pyx_t_13)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
            __Pyx_INCREF(__pyx_t_13);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_12, function);
          }
        }
        if (__pyx_t_13) {
          __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 779, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        } else {
          __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 779, __pyx_L1_error)
        }
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_12)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_12);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_12) {
          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_6)) {
            PyObject *__pyx_temp[2] = {__pyx_t_12, __pyx_t_8};
            __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
            PyObject *__pyx_temp[2] = {__pyx_t_12, __pyx_t_8};
            __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else
          #endif
          {
            __pyx_t_13 = PyTuple_New(1+1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 779, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_13);
            __Pyx_GIVEREF(__pyx_t_12); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_12); __pyx_t_12 = NULL;
            __Pyx_GIVEREF(__pyx_t_8);
            PyTuple_SET_ITEM(__pyx_t_13, 0+1, __pyx_t_8);
            __pyx_t_8 = 0;
            __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_13, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "arrivals.pyx":778
 *         for tid in self.byt:
 *             if fn(self, tid):
 *                 for e in self.events_of_task (tid):             # <<<<<<<<<<<<<<
 *                     a_new.insert (e.duplicate())
 * 
 */
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "arrivals.pyx":777
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt:
 *             if fn(self, tid):             # <<<<<<<<<<<<<<
 *                 for e in self.events_of_task (tid):
 *                     a_new.insert (e.duplicate())
 */
    }

    /* "arrivals.pyx":776
 * 
 *         a_new = Arrivals (self.net, cap=self.cap)
 *         for tid in self.byt:             # <<<<<<<<<<<<<<
 *             if fn(self, tid):
 *                 for e in self.events_of_task (tid):
 */
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "arrivals.pyx":781
 *                     a_new.insert (e.duplicate())
 * 
 *         return a_new             # <<<<<<<<<<<<<<
 * 
 *     # Updates all of the by_task pointer.  Use this if you've rearranged the task orders.
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_a_new));
  __pyx_r = ((PyObject *)__pyx_v_a_new);
  goto __pyx_L0;

  /* "arrivals.pyx":771
 * 
 *     # if function(arrv, tid) is true, put tid in return
 *     def subset_by_task_fn (self, fn, adapt_fn=None):             # <<<<<<<<<<<<<<
 *         cdef Arrivals a_new
 *         cdef Event evt, evt_new
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("arrivals.Arrivals.subset_by_task_fn", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_a_new);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":784
 * 
 *     # Updates all of the by_task pointer.  Use this if you've rearranged the task orders.
 *     def recompute_caches (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         dct_new = dict()
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_103recompute_caches(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_103recompute_caches(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("recompute_caches (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_102recompute_caches(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_102recompute_caches(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt = 0;
  PyObject *__pyx_v_dct_new = NULL;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_v_lst = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  __Pyx_RefNannySetupContext("recompute_caches", 0);

  /* "arrivals.pyx":786
 *     def recompute_caches (self):
 *         cdef Event evt
 *         dct_new = dict()             # <<<<<<<<<<<<<<
 *         for k,v in self.byt.iteritems():
 *             evt = v[0]
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_dct_new = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":787
 *         cdef Event evt
 *         dct_new = dict()
 *         for k,v in self.byt.iteritems():             # <<<<<<<<<<<<<<
 *             evt = v[0]
 *             assert evt.tid == k
 */
  __pyx_t_2 = 0;
  if (unlikely(__pyx_v_self->byt == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
    __PYX_ERR(0, 787, __pyx_L1_error)
  }
  __pyx_t_5 = __Pyx_dict_iterator(__pyx_v_self->byt, 0, __pyx_n_s_iteritems, (&__pyx_t_3), (&__pyx_t_4)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 787, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_1);
  __pyx_t_1 = __pyx_t_5;
  __pyx_t_5 = 0;
  while (1) {
    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &__pyx_t_2, &__pyx_t_5, &__pyx_t_6, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_7 == 0)) break;
    if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 787, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_5);
    __pyx_t_5 = 0;
    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "arrivals.pyx":788
 *         dct_new = dict()
 *         for k,v in self.byt.iteritems():
 *             evt = v[0]             # <<<<<<<<<<<<<<
 *             assert evt.tid == k
 *             while evt.prev_byt: evt = evt.prev_byt
 */
    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_v, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 788, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 788, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "arrivals.pyx":789
 *         for k,v in self.byt.iteritems():
 *             evt = v[0]
 *             assert evt.tid == k             # <<<<<<<<<<<<<<
 *             while evt.prev_byt: evt = evt.prev_byt
 * 
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_evt->tid); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_v_k, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_8)) {
        PyErr_SetNone(PyExc_AssertionError);
        __PYX_ERR(0, 789, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":790
 *             evt = v[0]
 *             assert evt.tid == k
 *             while evt.prev_byt: evt = evt.prev_byt             # <<<<<<<<<<<<<<
 * 
 *             lst = [evt]
 */
    while (1) {
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_evt->prev_byt); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 790, __pyx_L1_error)
      if (!__pyx_t_8) break;
      if (!(likely(((__pyx_v_evt->prev_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->prev_byt, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 790, __pyx_L1_error)
      __pyx_t_5 = __pyx_v_evt->prev_byt;
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_5));
      __pyx_t_5 = 0;
    }

    /* "arrivals.pyx":792
 *             while evt.prev_byt: evt = evt.prev_byt
 * 
 *             lst = [evt]             # <<<<<<<<<<<<<<
 *             while evt.next_byt:
 *                 evt = evt.next_byt
 */
    __pyx_t_5 = PyList_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 792, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(((PyObject *)__pyx_v_evt));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_evt));
    PyList_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_v_evt));
    __Pyx_XDECREF_SET(__pyx_v_lst, ((PyObject*)__pyx_t_5));
    __pyx_t_5 = 0;

    /* "arrivals.pyx":793
 * 
 *             lst = [evt]
 *             while evt.next_byt:             # <<<<<<<<<<<<<<
 *                 evt = evt.next_byt
 *                 lst.append (evt)
 */
    while (1) {
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_evt->next_byt); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 793, __pyx_L1_error)
      if (!__pyx_t_8) break;

      /* "arrivals.pyx":794
 *             lst = [evt]
 *             while evt.next_byt:
 *                 evt = evt.next_byt             # <<<<<<<<<<<<<<
 *                 lst.append (evt)
 * 
 */
      if (!(likely(((__pyx_v_evt->next_byt) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_evt->next_byt, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 794, __pyx_L1_error)
      __pyx_t_5 = __pyx_v_evt->next_byt;
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_evt, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_5));
      __pyx_t_5 = 0;

      /* "arrivals.pyx":795
 *             while evt.next_byt:
 *                 evt = evt.next_byt
 *                 lst.append (evt)             # <<<<<<<<<<<<<<
 * 
 *             dct_new[k] = lst
 */
      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_lst, ((PyObject *)__pyx_v_evt)); if (unlikely(__pyx_t_9 == -1)) __PYX_ERR(0, 795, __pyx_L1_error)
    }

    /* "arrivals.pyx":797
 *                 lst.append (evt)
 * 
 *             dct_new[k] = lst             # <<<<<<<<<<<<<<
 *         self.byt = dct_new
 * 
 */
    if (unlikely(PyDict_SetItem(__pyx_v_dct_new, __pyx_v_k, __pyx_v_lst) < 0)) __PYX_ERR(0, 797, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":798
 * 
 *             dct_new[k] = lst
 *         self.byt = dct_new             # <<<<<<<<<<<<<<
 * 
 *     def duplicate (self): return self.subset (netutils.all_true)
 */
  __Pyx_INCREF(__pyx_v_dct_new);
  __Pyx_GIVEREF(__pyx_v_dct_new);
  __Pyx_GOTREF(__pyx_v_self->byt);
  __Pyx_DECREF(__pyx_v_self->byt);
  __pyx_v_self->byt = __pyx_v_dct_new;

  /* "arrivals.pyx":784
 * 
 *     # Updates all of the by_task pointer.  Use this if you've rearranged the task orders.
 *     def recompute_caches (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         dct_new = dict()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("arrivals.Arrivals.recompute_caches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_dct_new);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XDECREF(__pyx_v_lst);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":800
 *         self.byt = dct_new
 * 
 *     def duplicate (self): return self.subset (netutils.all_true)             # <<<<<<<<<<<<<<
 * 
 *     def validate (self):
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_105duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_105duplicate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("duplicate (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_104duplicate(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_104duplicate(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("duplicate", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_subset); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_GetModuleGlobalName(__pyx_n_s_netutils); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_all_true); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (!__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 800, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
  } else {
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 800, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
      PyObject *__pyx_temp[2] = {__pyx_t_3, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 800, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_5 = PyTuple_New(1+1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 800, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_5, 0+1, __pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 800, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.Arrivals.duplicate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":802
 *     def duplicate (self): return self.subset (netutils.all_true)
 * 
 *     def validate (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt0, evt1
 *         try:
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_107validate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_107validate(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("validate (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_106validate(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_106validate(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt0 = 0;
  struct __pyx_obj_8arrivals_Event *__pyx_v_evt1 = 0;
  PyObject *__pyx_v_evts_byq = NULL;
  PyObject *__pyx_v_evts_byt = NULL;
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_qevts = NULL;
  PyObject *__pyx_v_evt = NULL;
  PyObject *__pyx_v_tid = NULL;
  PyObject *__pyx_v_task_evts = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_eid = NULL;
  PyObject *__pyx_v_ninq = NULL;
  PyObject *__pyx_v_inq = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  PyObject *(*__pyx_t_12)(PyObject *);
  PyObject *(*__pyx_t_13)(PyObject *);
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  PyObject *__pyx_t_19 = NULL;
  __Pyx_RefNannySetupContext("validate", 0);

  /* "arrivals.pyx":804
 *     def validate (self):
 *         cdef Event evt0, evt1
 *         try:             # <<<<<<<<<<<<<<
 *             evts_byq = dict()
 *             evts_byt = dict()
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "arrivals.pyx":805
 *         cdef Event evt0, evt1
 *         try:
 *             evts_byq = dict()             # <<<<<<<<<<<<<<
 *             evts_byt = dict()
 *             for qi in range(len(self.byq)):
 */
      __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 805, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_v_evts_byq = ((PyObject*)__pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":806
 *         try:
 *             evts_byq = dict()
 *             evts_byt = dict()             # <<<<<<<<<<<<<<
 *             for qi in range(len(self.byq)):
 *                qevts = self.events_of_qid (qi)
 */
      __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 806, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_v_evts_byt = ((PyObject*)__pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":807
 *             evts_byq = dict()
 *             evts_byt = dict()
 *             for qi in range(len(self.byq)):             # <<<<<<<<<<<<<<
 *                qevts = self.events_of_qid (qi)
 *                for evt in qevts: evts_byq[evt.eid] = 1
 */
      __pyx_t_4 = __pyx_v_self->byq;
      __Pyx_INCREF(__pyx_t_4);
      __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == -1)) __PYX_ERR(0, 807, __pyx_L3_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
        __pyx_v_qi = __pyx_t_6;

        /* "arrivals.pyx":808
 *             evts_byt = dict()
 *             for qi in range(len(self.byq)):
 *                qevts = self.events_of_qid (qi)             # <<<<<<<<<<<<<<
 *                for evt in qevts: evts_byq[evt.eid] = 1
 *                for evt0, evt1 in zip(qevts, qevts[1:]):
 */
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 808, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 808, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_9 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_9)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_9);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_9) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 808, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_t_8};
            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 808, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_t_8};
            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 808, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else
          #endif
          {
            __pyx_t_10 = PyTuple_New(1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 808, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9); __pyx_t_9 = NULL;
            __Pyx_GIVEREF(__pyx_t_8);
            PyTuple_SET_ITEM(__pyx_t_10, 0+1, __pyx_t_8);
            __pyx_t_8 = 0;
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 808, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF_SET(__pyx_v_qevts, __pyx_t_4);
        __pyx_t_4 = 0;

        /* "arrivals.pyx":809
 *             for qi in range(len(self.byq)):
 *                qevts = self.events_of_qid (qi)
 *                for evt in qevts: evts_byq[evt.eid] = 1             # <<<<<<<<<<<<<<
 *                for evt0, evt1 in zip(qevts, qevts[1:]):
 *                     evts_byq[evt0.eid] = 1
 */
        if (likely(PyList_CheckExact(__pyx_v_qevts)) || PyTuple_CheckExact(__pyx_v_qevts)) {
          __pyx_t_4 = __pyx_v_qevts; __Pyx_INCREF(__pyx_t_4); __pyx_t_11 = 0;
          __pyx_t_12 = NULL;
        } else {
          __pyx_t_11 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_qevts); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 809, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_12 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 809, __pyx_L3_error)
        }
        for (;;) {
          if (likely(!__pyx_t_12)) {
            if (likely(PyList_CheckExact(__pyx_t_4))) {
              if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_4)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_7); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 809, __pyx_L3_error)
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 809, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_7);
              #endif
            } else {
              if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_7); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 809, __pyx_L3_error)
              #else
              __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 809, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_7);
              #endif
            }
          } else {
            __pyx_t_7 = __pyx_t_12(__pyx_t_4);
            if (unlikely(!__pyx_t_7)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 809, __pyx_L3_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_7);
          }
          __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 809, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (unlikely(PyDict_SetItem(__pyx_v_evts_byq, __pyx_t_7, __pyx_int_1) < 0)) __PYX_ERR(0, 809, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "arrivals.pyx":810
 *                qevts = self.events_of_qid (qi)
 *                for evt in qevts: evts_byq[evt.eid] = 1
 *                for evt0, evt1 in zip(qevts, qevts[1:]):             # <<<<<<<<<<<<<<
 *                     evts_byq[evt0.eid] = 1
 *                     evts_byq[evt1.eid] = 1
 */
        __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_qevts, 1, 0, NULL, NULL, &__pyx_slice__10, 1, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 810, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 810, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_INCREF(__pyx_v_qevts);
        __Pyx_GIVEREF(__pyx_v_qevts);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_qevts);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_zip, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 810, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
          __pyx_t_7 = __pyx_t_4; __Pyx_INCREF(__pyx_t_7); __pyx_t_11 = 0;
          __pyx_t_12 = NULL;
        } else {
          __pyx_t_11 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 810, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_12 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 810, __pyx_L3_error)
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        for (;;) {
          if (likely(!__pyx_t_12)) {
            if (likely(PyList_CheckExact(__pyx_t_7))) {
              if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_7)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_4 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_11); __Pyx_INCREF(__pyx_t_4); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 810, __pyx_L3_error)
              #else
              __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 810, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              #endif
            } else {
              if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_11); __Pyx_INCREF(__pyx_t_4); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 810, __pyx_L3_error)
              #else
              __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 810, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              #endif
            }
          } else {
            __pyx_t_4 = __pyx_t_12(__pyx_t_7);
            if (unlikely(!__pyx_t_4)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 810, __pyx_L3_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_4);
          }
          if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
            PyObject* sequence = __pyx_t_4;
            #if !CYTHON_COMPILING_IN_PYPY
            Py_ssize_t size = Py_SIZE(sequence);
            #else
            Py_ssize_t size = PySequence_Size(sequence);
            #endif
            if (unlikely(size != 2)) {
              if (size > 2) __Pyx_RaiseTooManyValuesError(2);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 810, __pyx_L3_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_10 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_8 = PyTuple_GET_ITEM(sequence, 1); 
            } else {
              __pyx_t_10 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_8 = PyList_GET_ITEM(sequence, 1); 
            }
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_8);
            #else
            __pyx_t_10 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 810, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_8 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 810, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            #endif
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          } else {
            Py_ssize_t index = -1;
            __pyx_t_9 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 810, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_13 = Py_TYPE(__pyx_t_9)->tp_iternext;
            index = 0; __pyx_t_10 = __pyx_t_13(__pyx_t_9); if (unlikely(!__pyx_t_10)) goto __pyx_L17_unpacking_failed;
            __Pyx_GOTREF(__pyx_t_10);
            index = 1; __pyx_t_8 = __pyx_t_13(__pyx_t_9); if (unlikely(!__pyx_t_8)) goto __pyx_L17_unpacking_failed;
            __Pyx_GOTREF(__pyx_t_8);
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_13(__pyx_t_9), 2) < 0) __PYX_ERR(0, 810, __pyx_L3_error)
            __pyx_t_13 = NULL;
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            goto __pyx_L18_unpacking_done;
            __pyx_L17_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_13 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 810, __pyx_L3_error)
            __pyx_L18_unpacking_done:;
          }
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 810, __pyx_L3_error)
          if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 810, __pyx_L3_error)
          __Pyx_XDECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_10));
          __pyx_t_10 = 0;
          __Pyx_XDECREF_SET(__pyx_v_evt1, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_8));
          __pyx_t_8 = 0;

          /* "arrivals.pyx":811
 *                for evt in qevts: evts_byq[evt.eid] = 1
 *                for evt0, evt1 in zip(qevts, qevts[1:]):
 *                     evts_byq[evt0.eid] = 1             # <<<<<<<<<<<<<<
 *                     evts_byq[evt1.eid] = 1
 *                     assert evt0.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt0.s, format_evt (evt0.prev_byq), format_evt(evt0))
 */
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt0->eid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 811, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
          if (unlikely(PyDict_SetItem(__pyx_v_evts_byq, __pyx_t_4, __pyx_int_1) < 0)) __PYX_ERR(0, 811, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

          /* "arrivals.pyx":812
 *                for evt0, evt1 in zip(qevts, qevts[1:]):
 *                     evts_byq[evt0.eid] = 1
 *                     evts_byq[evt1.eid] = 1             # <<<<<<<<<<<<<<
 *                     assert evt0.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt0.s, format_evt (evt0.prev_byq), format_evt(evt0))
 *                     assert evt1.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt1.s, evt1.prev_byq.dump(), evt1.dump())
 */
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_evt1->eid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 812, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
          if (unlikely(PyDict_SetItem(__pyx_v_evts_byq, __pyx_t_4, __pyx_int_1) < 0)) __PYX_ERR(0, 812, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

          /* "arrivals.pyx":813
 *                     evts_byq[evt0.eid] = 1
 *                     evts_byq[evt1.eid] = 1
 *                     assert evt0.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt0.s, format_evt (evt0.prev_byq), format_evt(evt0))             # <<<<<<<<<<<<<<
 *                     assert evt1.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt1.s, evt1.prev_byq.dump(), evt1.dump())
 *                     assert evt0.next_byq == evt1, "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s" % (evt0, evt0.next_byq, evt1, evt1.prev_byq)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            if (unlikely(!((__pyx_v_evt0->s >= 0.0) != 0))) {
              __pyx_t_4 = PyFloat_FromDouble(__pyx_v_evt0->s); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 813, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __pyx_t_10 = __Pyx_GetModuleGlobalName(__pyx_n_s_format_evt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __pyx_t_9 = NULL;
              if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
                __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
                if (likely(__pyx_t_9)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
                  __Pyx_INCREF(__pyx_t_9);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_10, function);
                }
              }
              if (!__pyx_t_9) {
                __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_v_evt0->prev_byq); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 813, __pyx_L3_error)
                __Pyx_GOTREF(__pyx_t_8);
              } else {
                #if CYTHON_FAST_PYCALL
                if (PyFunction_Check(__pyx_t_10)) {
                  PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_v_evt0->prev_byq};
                  __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
                  __Pyx_GOTREF(__pyx_t_8);
                } else
                #endif
                #if CYTHON_FAST_PYCCALL
                if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
                  PyObject *__pyx_temp[2] = {__pyx_t_9, __pyx_v_evt0->prev_byq};
                  __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
                  __Pyx_GOTREF(__pyx_t_8);
                } else
                #endif
                {
                  __pyx_t_14 = PyTuple_New(1+1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_GOTREF(__pyx_t_14);
                  __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_9); __pyx_t_9 = NULL;
                  __Pyx_INCREF(__pyx_v_evt0->prev_byq);
                  __Pyx_GIVEREF(__pyx_v_evt0->prev_byq);
                  PyTuple_SET_ITEM(__pyx_t_14, 0+1, __pyx_v_evt0->prev_byq);
                  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_14, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_GOTREF(__pyx_t_8);
                  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
                }
              }
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __pyx_t_14 = __Pyx_GetModuleGlobalName(__pyx_n_s_format_evt); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 813, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_14);
              __pyx_t_9 = NULL;
              if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
                __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_14);
                if (likely(__pyx_t_9)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
                  __Pyx_INCREF(__pyx_t_9);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_14, function);
                }
              }
              if (!__pyx_t_9) {
                __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_14, ((PyObject *)__pyx_v_evt0)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
                __Pyx_GOTREF(__pyx_t_10);
              } else {
                #if CYTHON_FAST_PYCALL
                if (PyFunction_Check(__pyx_t_14)) {
                  PyObject *__pyx_temp[2] = {__pyx_t_9, ((PyObject *)__pyx_v_evt0)};
                  __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_14, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
                  __Pyx_GOTREF(__pyx_t_10);
                } else
                #endif
                #if CYTHON_FAST_PYCCALL
                if (__Pyx_PyFastCFunction_Check(__pyx_t_14)) {
                  PyObject *__pyx_temp[2] = {__pyx_t_9, ((PyObject *)__pyx_v_evt0)};
                  __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_14, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
                  __Pyx_GOTREF(__pyx_t_10);
                } else
                #endif
                {
                  __pyx_t_15 = PyTuple_New(1+1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_GOTREF(__pyx_t_15);
                  __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_9); __pyx_t_9 = NULL;
                  __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
                  __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
                  PyTuple_SET_ITEM(__pyx_t_15, 0+1, ((PyObject *)__pyx_v_evt0));
                  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_15, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
                  __Pyx_GOTREF(__pyx_t_10);
                  __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
                }
              }
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 813, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_GIVEREF(__pyx_t_4);
              PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_4);
              __Pyx_GIVEREF(__pyx_t_8);
              PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_8);
              __Pyx_GIVEREF(__pyx_t_10);
              PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_t_10);
              __pyx_t_4 = 0;
              __pyx_t_8 = 0;
              __pyx_t_10 = 0;
              __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Invalid_negative_service_time_s, __pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 813, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __PYX_ERR(0, 813, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":814
 *                     evts_byq[evt1.eid] = 1
 *                     assert evt0.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt0.s, format_evt (evt0.prev_byq), format_evt(evt0))
 *                     assert evt1.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt1.s, evt1.prev_byq.dump(), evt1.dump())             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byq == evt1, "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s" % (evt0, evt0.next_byq, evt1, evt1.prev_byq)
 *                     assert evt1.prev_byq == evt0, "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s" % (evt1, evt1.prev_byq, evt0, evt0.next_byq)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            if (unlikely(!((__pyx_v_evt1->s >= 0.0) != 0))) {
              __pyx_t_10 = PyFloat_FromDouble(__pyx_v_evt1->s); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 814, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt1->prev_byq, __pyx_n_s_dump); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 814, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __pyx_t_4 = NULL;
              if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
                __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
                if (likely(__pyx_t_4)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
                  __Pyx_INCREF(__pyx_t_4);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_8, function);
                }
              }
              if (__pyx_t_4) {
                __pyx_t_14 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 814, __pyx_L3_error)
                __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              } else {
                __pyx_t_14 = __Pyx_PyObject_CallNoArg(__pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 814, __pyx_L3_error)
              }
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt1), __pyx_n_s_dump); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 814, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __pyx_t_15 = NULL;
              if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
                __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_4);
                if (likely(__pyx_t_15)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
                  __Pyx_INCREF(__pyx_t_15);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_4, function);
                }
              }
              if (__pyx_t_15) {
                __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_15); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 814, __pyx_L3_error)
                __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
              } else {
                __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 814, __pyx_L3_error)
              }
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 814, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_GIVEREF(__pyx_t_10);
              PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_10);
              __Pyx_GIVEREF(__pyx_t_14);
              PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_14);
              __Pyx_GIVEREF(__pyx_t_8);
              PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_8);
              __pyx_t_10 = 0;
              __pyx_t_14 = 0;
              __pyx_t_8 = 0;
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Invalid_negative_service_time_s, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 814, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 814, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":815
 *                     assert evt0.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt0.s, format_evt (evt0.prev_byq), format_evt(evt0))
 *                     assert evt1.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt1.s, evt1.prev_byq.dump(), evt1.dump())
 *                     assert evt0.next_byq == evt1, "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s" % (evt0, evt0.next_byq, evt1, evt1.prev_byq)             # <<<<<<<<<<<<<<
 *                     assert evt1.prev_byq == evt0, "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s" % (evt1, evt1.prev_byq, evt0, evt0.next_byq)
 *                     assert evt0.eid in self.events, "Event not in event list:\n  %s" % evt0
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = PyObject_RichCompare(__pyx_v_evt0->next_byq, ((PyObject *)__pyx_v_evt1), Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 815, __pyx_L3_error)
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 815, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_8 = PyTuple_New(4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 815, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(__pyx_v_evt0->next_byq);
              __Pyx_GIVEREF(__pyx_v_evt0->next_byq);
              PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_evt0->next_byq);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_8, 2, ((PyObject *)__pyx_v_evt1));
              __Pyx_INCREF(__pyx_v_evt1->prev_byq);
              __Pyx_GIVEREF(__pyx_v_evt1->prev_byq);
              PyTuple_SET_ITEM(__pyx_t_8, 3, __pyx_v_evt1->prev_byq);
              __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Next_byq_pointers_don_t_match_s, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 815, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_4);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              __PYX_ERR(0, 815, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":816
 *                     assert evt1.s >= 0.0, "Invalid (negative) service time %s for:\n  %s\n  %s" % (evt1.s, evt1.prev_byq.dump(), evt1.dump())
 *                     assert evt0.next_byq == evt1, "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s" % (evt0, evt0.next_byq, evt1, evt1.prev_byq)
 *                     assert evt1.prev_byq == evt0, "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s" % (evt1, evt1.prev_byq, evt0, evt0.next_byq)             # <<<<<<<<<<<<<<
 *                     assert evt0.eid in self.events, "Event not in event list:\n  %s" % evt0
 *                     assert self.events[evt0.eid] == evt0, "Event list mismatch\n  Expected: %s\n  Was: %s" % (evt0, self.events[evt0.eid])
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_4 = PyObject_RichCompare(__pyx_v_evt1->prev_byq, ((PyObject *)__pyx_v_evt0), Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L3_error)
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 816, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_evt1));
              __Pyx_INCREF(__pyx_v_evt1->prev_byq);
              __Pyx_GIVEREF(__pyx_v_evt1->prev_byq);
              PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_evt1->prev_byq);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(__pyx_v_evt0->next_byq);
              __Pyx_GIVEREF(__pyx_v_evt0->next_byq);
              PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_evt0->next_byq);
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Prev_byq_pointers_don_t_match_s, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 816, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 816, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":817
 *                     assert evt0.next_byq == evt1, "Next_byq pointers don't match\n  %s\n ==> next_byq\n%s\nbut\n  %s\n  ==>prev_byq\n  %s" % (evt0, evt0.next_byq, evt1, evt1.prev_byq)
 *                     assert evt1.prev_byq == evt0, "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s" % (evt1, evt1.prev_byq, evt0, evt0.next_byq)
 *                     assert evt0.eid in self.events, "Event not in event list:\n  %s" % evt0             # <<<<<<<<<<<<<<
 *                     assert self.events[evt0.eid] == evt0, "Event list mismatch\n  Expected: %s\n  Was: %s" % (evt0, self.events[evt0.eid])
 *             for tid, task_evts in self.byt.iteritems():
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt0->eid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 817, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_16 = (__Pyx_PySequence_ContainsTF(__pyx_t_8, __pyx_v_self->events, Py_EQ)); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 817, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!(__pyx_t_16 != 0))) {
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Event_not_in_event_list_s, ((PyObject *)__pyx_v_evt0)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 817, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 817, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":818
 *                     assert evt1.prev_byq == evt0, "Prev_byq pointers don't match:\n %s\n ==> prev_byq\n%s\nbut\n  %s\n  ==>next_byq\n  %s" % (evt1, evt1.prev_byq, evt0, evt0.next_byq)
 *                     assert evt0.eid in self.events, "Event not in event list:\n  %s" % evt0
 *                     assert self.events[evt0.eid] == evt0, "Event list mismatch\n  Expected: %s\n  Was: %s" % (evt0, self.events[evt0.eid])             # <<<<<<<<<<<<<<
 *             for tid, task_evts in self.byt.iteritems():
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_self->events, __pyx_v_evt0->eid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 818, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_4 = PyObject_RichCompare(__pyx_t_8, ((PyObject *)__pyx_v_evt0), Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 818, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_self->events, __pyx_v_evt0->eid, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 818, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(__pyx_t_4);
              PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
              __pyx_t_4 = 0;
              __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Event_list_mismatch_Expected_s_W, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 818, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_4);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              __PYX_ERR(0, 818, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":810
 *                qevts = self.events_of_qid (qi)
 *                for evt in qevts: evts_byq[evt.eid] = 1
 *                for evt0, evt1 in zip(qevts, qevts[1:]):             # <<<<<<<<<<<<<<
 *                     evts_byq[evt0.eid] = 1
 *                     evts_byq[evt1.eid] = 1
 */
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }

      /* "arrivals.pyx":819
 *                     assert evt0.eid in self.events, "Event not in event list:\n  %s" % evt0
 *                     assert self.events[evt0.eid] == evt0, "Event list mismatch\n  Expected: %s\n  Was: %s" % (evt0, self.events[evt0.eid])
 *             for tid, task_evts in self.byt.iteritems():             # <<<<<<<<<<<<<<
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):
 */
      __pyx_t_5 = 0;
      if (unlikely(__pyx_v_self->byt == Py_None)) {
        PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iteritems");
        __PYX_ERR(0, 819, __pyx_L3_error)
      }
      __pyx_t_4 = __Pyx_dict_iterator(__pyx_v_self->byt, 0, __pyx_n_s_iteritems, (&__pyx_t_6), (&__pyx_t_17)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 819, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_7);
      __pyx_t_7 = __pyx_t_4;
      __pyx_t_4 = 0;
      while (1) {
        __pyx_t_18 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_6, &__pyx_t_5, &__pyx_t_4, &__pyx_t_8, NULL, __pyx_t_17);
        if (unlikely(__pyx_t_18 == 0)) break;
        if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 819, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_XDECREF_SET(__pyx_v_tid, __pyx_t_4);
        __pyx_t_4 = 0;
        __Pyx_XDECREF_SET(__pyx_v_task_evts, __pyx_t_8);
        __pyx_t_8 = 0;

        /* "arrivals.pyx":820
 *                     assert self.events[evt0.eid] == evt0, "Event list mismatch\n  Expected: %s\n  Was: %s" % (evt0, self.events[evt0.eid])
 *             for tid, task_evts in self.byt.iteritems():
 *                 for evt in task_evts: evts_byt[evt.eid] = 1             # <<<<<<<<<<<<<<
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 */
        if (likely(PyList_CheckExact(__pyx_v_task_evts)) || PyTuple_CheckExact(__pyx_v_task_evts)) {
          __pyx_t_8 = __pyx_v_task_evts; __Pyx_INCREF(__pyx_t_8); __pyx_t_11 = 0;
          __pyx_t_12 = NULL;
        } else {
          __pyx_t_11 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_v_task_evts); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 820, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_12 = Py_TYPE(__pyx_t_8)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 820, __pyx_L3_error)
        }
        for (;;) {
          if (likely(!__pyx_t_12)) {
            if (likely(PyList_CheckExact(__pyx_t_8))) {
              if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_8)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_4 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_11); __Pyx_INCREF(__pyx_t_4); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 820, __pyx_L3_error)
              #else
              __pyx_t_4 = PySequence_ITEM(__pyx_t_8, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 820, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              #endif
            } else {
              if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_8)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_11); __Pyx_INCREF(__pyx_t_4); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 820, __pyx_L3_error)
              #else
              __pyx_t_4 = PySequence_ITEM(__pyx_t_8, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 820, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              #endif
            }
          } else {
            __pyx_t_4 = __pyx_t_12(__pyx_t_8);
            if (unlikely(!__pyx_t_4)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 820, __pyx_L3_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_4);
          }
          __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_4);
          __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_eid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 820, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
          if (unlikely(PyDict_SetItem(__pyx_v_evts_byt, __pyx_t_4, __pyx_int_1) < 0)) __PYX_ERR(0, 820, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        }
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "arrivals.pyx":821
 *             for tid, task_evts in self.byt.iteritems():
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 */
        __pyx_t_8 = __Pyx_PyObject_GetSlice(__pyx_v_task_evts, 1, 0, NULL, NULL, &__pyx_slice__11, 1, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 821, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_v_task_evts);
        __Pyx_GIVEREF(__pyx_v_task_evts);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_task_evts);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_8);
        __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_zip, __pyx_t_4, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (likely(PyList_CheckExact(__pyx_t_8)) || PyTuple_CheckExact(__pyx_t_8)) {
          __pyx_t_4 = __pyx_t_8; __Pyx_INCREF(__pyx_t_4); __pyx_t_11 = 0;
          __pyx_t_12 = NULL;
        } else {
          __pyx_t_11 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 821, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_12 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 821, __pyx_L3_error)
        }
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        for (;;) {
          if (likely(!__pyx_t_12)) {
            if (likely(PyList_CheckExact(__pyx_t_4))) {
              if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_4)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_8 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_8); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 821, __pyx_L3_error)
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              #endif
            } else {
              if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_11); __Pyx_INCREF(__pyx_t_8); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 821, __pyx_L3_error)
              #else
              __pyx_t_8 = PySequence_ITEM(__pyx_t_4, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 821, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              #endif
            }
          } else {
            __pyx_t_8 = __pyx_t_12(__pyx_t_4);
            if (unlikely(!__pyx_t_8)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 821, __pyx_L3_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_8);
          }
          if ((likely(PyTuple_CheckExact(__pyx_t_8))) || (PyList_CheckExact(__pyx_t_8))) {
            PyObject* sequence = __pyx_t_8;
            #if !CYTHON_COMPILING_IN_PYPY
            Py_ssize_t size = Py_SIZE(sequence);
            #else
            Py_ssize_t size = PySequence_Size(sequence);
            #endif
            if (unlikely(size != 2)) {
              if (size > 2) __Pyx_RaiseTooManyValuesError(2);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 821, __pyx_L3_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_14 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_10 = PyTuple_GET_ITEM(sequence, 1); 
            } else {
              __pyx_t_14 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
            }
            __Pyx_INCREF(__pyx_t_14);
            __Pyx_INCREF(__pyx_t_10);
            #else
            __pyx_t_14 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 821, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_14);
            __pyx_t_10 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 821, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else {
            Py_ssize_t index = -1;
            __pyx_t_15 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 821, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_15);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_13 = Py_TYPE(__pyx_t_15)->tp_iternext;
            index = 0; __pyx_t_14 = __pyx_t_13(__pyx_t_15); if (unlikely(!__pyx_t_14)) goto __pyx_L25_unpacking_failed;
            __Pyx_GOTREF(__pyx_t_14);
            index = 1; __pyx_t_10 = __pyx_t_13(__pyx_t_15); if (unlikely(!__pyx_t_10)) goto __pyx_L25_unpacking_failed;
            __Pyx_GOTREF(__pyx_t_10);
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_13(__pyx_t_15), 2) < 0) __PYX_ERR(0, 821, __pyx_L3_error)
            __pyx_t_13 = NULL;
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            goto __pyx_L26_unpacking_done;
            __pyx_L25_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            __pyx_t_13 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 821, __pyx_L3_error)
            __pyx_L26_unpacking_done:;
          }
          if (!(likely(((__pyx_t_14) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_14, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 821, __pyx_L3_error)
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 821, __pyx_L3_error)
          __Pyx_XDECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_14));
          __pyx_t_14 = 0;
          __Pyx_XDECREF_SET(__pyx_v_evt1, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_10));
          __pyx_t_10 = 0;

          /* "arrivals.pyx":822
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)             # <<<<<<<<<<<<<<
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 *                     assert tid == evt0.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt0)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = PyObject_RichCompare(__pyx_v_evt0->next_byt, ((PyObject *)__pyx_v_evt1), Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 822, __pyx_L3_error)
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 822, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 822, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(__pyx_v_evt0->next_byt);
              __Pyx_GIVEREF(__pyx_v_evt0->next_byt);
              PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_evt0->next_byt);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_8, 2, ((PyObject *)__pyx_v_evt1));
              __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Next_byt_pointers_don_t_match_FR, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 822, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __PYX_ERR(0, 822, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":823
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)             # <<<<<<<<<<<<<<
 *                     assert tid == evt0.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt0)
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_10 = PyObject_RichCompare(__pyx_v_evt1->prev_byt, ((PyObject *)__pyx_v_evt0), Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 823, __pyx_L3_error)
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 823, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 823, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_10, 0, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_10, 1, ((PyObject *)__pyx_v_evt1));
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Prev_byt_pointers_don_t_match_s, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 823, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 823, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":824
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 *                     assert tid == evt0.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt0)             # <<<<<<<<<<<<<<
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt0->tid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 824, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_10 = PyObject_RichCompare(__pyx_v_tid, __pyx_t_8, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 824, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 824, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 824, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_INCREF(__pyx_v_tid);
              __Pyx_GIVEREF(__pyx_v_tid);
              PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_tid);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_10, 1, ((PyObject *)__pyx_v_evt0));
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_TID_pointers_don_t_match_qnet_ha, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 824, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 824, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":825
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 *                     assert tid == evt0.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt0)
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)             # <<<<<<<<<<<<<<
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)
 *             for evt0 in self:
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_evt1->tid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 825, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_10 = PyObject_RichCompare(__pyx_v_tid, __pyx_t_8, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 825, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 825, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 825, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_INCREF(__pyx_v_tid);
              __Pyx_GIVEREF(__pyx_v_tid);
              PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_tid);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_10, 1, ((PyObject *)__pyx_v_evt1));
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_TID_pointers_don_t_match_qnet_ha, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 825, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 825, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":826
 *                     assert tid == evt0.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt0)
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)             # <<<<<<<<<<<<<<
 *             for evt0 in self:
 *                 evt0.q.validate_service (evt0)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            if (unlikely(!((fabs((__pyx_v_evt0->d - __pyx_v_evt1->a)) < 1e-15) != 0))) {
              __pyx_t_8 = PyFloat_FromDouble(__pyx_v_evt0->d); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 826, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __pyx_t_10 = PyFloat_FromDouble(__pyx_v_evt1->a); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 826, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __pyx_t_14 = PyTuple_New(4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 826, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_GIVEREF(__pyx_t_8);
              PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8);
              __Pyx_GIVEREF(__pyx_t_10);
              PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_10);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_14, 2, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(((PyObject *)__pyx_v_evt1));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt1));
              PyTuple_SET_ITEM(__pyx_t_14, 3, ((PyObject *)__pyx_v_evt1));
              __pyx_t_8 = 0;
              __pyx_t_10 = 0;
              __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Mismatched_arrivals_D_prev_s_A_s, __pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 826, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __PYX_ERR(0, 826, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":821
 *             for tid, task_evts in self.byt.iteritems():
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 */
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":827
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)
 *             for evt0 in self:             # <<<<<<<<<<<<<<
 *                 evt0.q.validate_service (evt0)
 *                 if evt0.next_byt:
 */
      if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
        __pyx_t_7 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_7); __pyx_t_6 = 0;
        __pyx_t_12 = NULL;
      } else {
        __pyx_t_6 = -1; __pyx_t_7 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 827, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_12 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 827, __pyx_L3_error)
      }
      for (;;) {
        if (likely(!__pyx_t_12)) {
          if (likely(PyList_CheckExact(__pyx_t_7))) {
            if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_4 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 827, __pyx_L3_error)
            #else
            __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 827, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_4);
            #endif
          } else {
            if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 827, __pyx_L3_error)
            #else
            __pyx_t_4 = PySequence_ITEM(__pyx_t_7, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 827, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_4);
            #endif
          }
        } else {
          __pyx_t_4 = __pyx_t_12(__pyx_t_7);
          if (unlikely(!__pyx_t_4)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 827, __pyx_L3_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_4);
        }
        if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_8arrivals_Event))))) __PYX_ERR(0, 827, __pyx_L3_error)
        __Pyx_XDECREF_SET(__pyx_v_evt0, ((struct __pyx_obj_8arrivals_Event *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "arrivals.pyx":828
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)
 *             for evt0 in self:
 *                 evt0.q.validate_service (evt0)             # <<<<<<<<<<<<<<
 *                 if evt0.next_byt:
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 */
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_evt0->q), __pyx_n_s_validate_service); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 828, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_14 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_14)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_14);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
          }
        }
        if (!__pyx_t_14) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_evt0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 828, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_10)) {
            PyObject *__pyx_temp[2] = {__pyx_t_14, ((PyObject *)__pyx_v_evt0)};
            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 828, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
            PyObject *__pyx_temp[2] = {__pyx_t_14, ((PyObject *)__pyx_v_evt0)};
            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 828, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          {
            __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 828, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_14); __pyx_t_14 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
            PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_evt0));
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 828, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "arrivals.pyx":829
 *             for evt0 in self:
 *                 evt0.q.validate_service (evt0)
 *                 if evt0.next_byt:             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 *             for q in self.net.queues:
 */
        __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_v_evt0->next_byt); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 829, __pyx_L3_error)
        if (__pyx_t_16) {

          /* "arrivals.pyx":830
 *                 evt0.q.validate_service (evt0)
 *                 if evt0.next_byt:
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)             # <<<<<<<<<<<<<<
 *             for q in self.net.queues:
 *                 q.validate_caches (self)
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt0->next_byt, __pyx_n_s_tid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 830, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_evt0->tid); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 830, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_8 = PyObject_RichCompare(__pyx_t_4, __pyx_t_10, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 830, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 830, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 830, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_INCREF(((PyObject *)__pyx_v_evt0));
              __Pyx_GIVEREF(((PyObject *)__pyx_v_evt0));
              PyTuple_SET_ITEM(__pyx_t_8, 0, ((PyObject *)__pyx_v_evt0));
              __Pyx_INCREF(__pyx_v_evt0->next_byt);
              __Pyx_GIVEREF(__pyx_v_evt0->next_byt);
              PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_evt0->next_byt);
              __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_TID_pointers_don_t_match_but_are, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 830, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __PYX_ERR(0, 830, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":829
 *             for evt0 in self:
 *                 evt0.q.validate_service (evt0)
 *                 if evt0.next_byt:             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 *             for q in self.net.queues:
 */
        }

        /* "arrivals.pyx":827
 *                     assert tid == evt1.tid, "TID pointers don't match (qnet has %s)\n  %s" % (tid, evt1)
 *                     assert abs(evt0.d - evt1.a) < 1e-15 , "Mismatched arrivals (D_prev: %s  A: %s)\n  %s\n  %s" % (evt0.d, evt1.a, evt0, evt1)
 *             for evt0 in self:             # <<<<<<<<<<<<<<
 *                 evt0.q.validate_service (evt0)
 *                 if evt0.next_byt:
 */
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":831
 *                 if evt0.next_byt:
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 *             for q in self.net.queues:             # <<<<<<<<<<<<<<
 *                 q.validate_caches (self)
 *             for eid in self.events.iterkeys():
 */
      if (likely(PyList_CheckExact(__pyx_v_self->net->queues)) || PyTuple_CheckExact(__pyx_v_self->net->queues)) {
        __pyx_t_7 = __pyx_v_self->net->queues; __Pyx_INCREF(__pyx_t_7); __pyx_t_6 = 0;
        __pyx_t_12 = NULL;
      } else {
        __pyx_t_6 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_self->net->queues); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 831, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_12 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 831, __pyx_L3_error)
      }
      for (;;) {
        if (likely(!__pyx_t_12)) {
          if (likely(PyList_CheckExact(__pyx_t_7))) {
            if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_6); __Pyx_INCREF(__pyx_t_10); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 831, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 831, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          } else {
            if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_6); __Pyx_INCREF(__pyx_t_10); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 831, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 831, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          }
        } else {
          __pyx_t_10 = __pyx_t_12(__pyx_t_7);
          if (unlikely(!__pyx_t_10)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 831, __pyx_L3_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_10);
        }
        __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":832
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 *             for q in self.net.queues:
 *                 q.validate_caches (self)             # <<<<<<<<<<<<<<
 *             for eid in self.events.iterkeys():
 *                 assert eid in evts_byq, "Event in event list but not in by_q cache:\n  %s" % self.events[eid]
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_q, __pyx_n_s_validate_caches); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 832, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
          }
        }
        if (!__pyx_t_4) {
          __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_8, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 832, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_10);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_8)) {
            PyObject *__pyx_temp[2] = {__pyx_t_4, ((PyObject *)__pyx_v_self)};
            __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 832, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
            PyObject *__pyx_temp[2] = {__pyx_t_4, ((PyObject *)__pyx_v_self)};
            __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 832, __pyx_L3_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          {
            __pyx_t_14 = PyTuple_New(1+1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 832, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_14);
            __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_4); __pyx_t_4 = NULL;
            __Pyx_INCREF(((PyObject *)__pyx_v_self));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
            PyTuple_SET_ITEM(__pyx_t_14, 0+1, ((PyObject *)__pyx_v_self));
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_14, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 832, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "arrivals.pyx":831
 *                 if evt0.next_byt:
 *                     assert evt0.next_byt.tid == evt0.tid, "TID pointers don't match, but are linked\n  %s\n  %s" % (evt0, evt0.next_byt)
 *             for q in self.net.queues:             # <<<<<<<<<<<<<<
 *                 q.validate_caches (self)
 *             for eid in self.events.iterkeys():
 */
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":833
 *             for q in self.net.queues:
 *                 q.validate_caches (self)
 *             for eid in self.events.iterkeys():             # <<<<<<<<<<<<<<
 *                 assert eid in evts_byq, "Event in event list but not in by_q cache:\n  %s" % self.events[eid]
 *                 assert eid in evts_byt, "Event in event list but not in by_t cache:\n  %s" % self.events[eid]
 */
      __pyx_t_6 = 0;
      if (unlikely(__pyx_v_self->events == Py_None)) {
        PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "iterkeys");
        __PYX_ERR(0, 833, __pyx_L3_error)
      }
      __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_self->events, 0, __pyx_n_s_iterkeys, (&__pyx_t_5), (&__pyx_t_17)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 833, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_7);
      __pyx_t_7 = __pyx_t_10;
      __pyx_t_10 = 0;
      while (1) {
        __pyx_t_18 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_5, &__pyx_t_6, &__pyx_t_10, NULL, NULL, __pyx_t_17);
        if (unlikely(__pyx_t_18 == 0)) break;
        if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 833, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":834
 *                 q.validate_caches (self)
 *             for eid in self.events.iterkeys():
 *                 assert eid in evts_byq, "Event in event list but not in by_q cache:\n  %s" % self.events[eid]             # <<<<<<<<<<<<<<
 *                 assert eid in evts_byt, "Event in event list but not in by_t cache:\n  %s" % self.events[eid]
 *             for eid in evts_byq.iterkeys():
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_16 = (__Pyx_PyDict_ContainsTF(__pyx_v_eid, __pyx_v_evts_byq, Py_EQ)); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 834, __pyx_L3_error)
          if (unlikely(!(__pyx_t_16 != 0))) {
            __pyx_t_10 = PyObject_GetItem(__pyx_v_self->events, __pyx_v_eid); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 834, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Event_in_event_list_but_not_in_b, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 834, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __PYX_ERR(0, 834, __pyx_L3_error)
          }
        }
        #endif

        /* "arrivals.pyx":835
 *             for eid in self.events.iterkeys():
 *                 assert eid in evts_byq, "Event in event list but not in by_q cache:\n  %s" % self.events[eid]
 *                 assert eid in evts_byt, "Event in event list but not in by_t cache:\n  %s" % self.events[eid]             # <<<<<<<<<<<<<<
 *             for eid in evts_byq.iterkeys():
 *                 assert eid in self.events, "Event in by_q cache but not events %s" % eid
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_16 = (__Pyx_PyDict_ContainsTF(__pyx_v_eid, __pyx_v_evts_byt, Py_EQ)); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 835, __pyx_L3_error)
          if (unlikely(!(__pyx_t_16 != 0))) {
            __pyx_t_8 = PyObject_GetItem(__pyx_v_self->events, __pyx_v_eid); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 835, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Event_in_event_list_but_not_in_b_2, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 835, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __PYX_ERR(0, 835, __pyx_L3_error)
          }
        }
        #endif
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":836
 *                 assert eid in evts_byq, "Event in event list but not in by_q cache:\n  %s" % self.events[eid]
 *                 assert eid in evts_byt, "Event in event list but not in by_t cache:\n  %s" % self.events[eid]
 *             for eid in evts_byq.iterkeys():             # <<<<<<<<<<<<<<
 *                 assert eid in self.events, "Event in by_q cache but not events %s" % eid
 *             for eid in evts_byt.iterkeys():
 */
      __pyx_t_5 = 0;
      __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_evts_byq, 1, __pyx_n_s_iterkeys, (&__pyx_t_6), (&__pyx_t_17)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 836, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_7);
      __pyx_t_7 = __pyx_t_10;
      __pyx_t_10 = 0;
      while (1) {
        __pyx_t_18 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_6, &__pyx_t_5, &__pyx_t_10, NULL, NULL, __pyx_t_17);
        if (unlikely(__pyx_t_18 == 0)) break;
        if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 836, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":837
 *                 assert eid in evts_byt, "Event in event list but not in by_t cache:\n  %s" % self.events[eid]
 *             for eid in evts_byq.iterkeys():
 *                 assert eid in self.events, "Event in by_q cache but not events %s" % eid             # <<<<<<<<<<<<<<
 *             for eid in evts_byt.iterkeys():
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_16 = (__Pyx_PySequence_ContainsTF(__pyx_v_eid, __pyx_v_self->events, Py_EQ)); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 837, __pyx_L3_error)
          if (unlikely(!(__pyx_t_16 != 0))) {
            __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Event_in_by_q_cache_but_not_even, __pyx_v_eid); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 837, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __PYX_ERR(0, 837, __pyx_L3_error)
          }
        }
        #endif
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":838
 *             for eid in evts_byq.iterkeys():
 *                 assert eid in self.events, "Event in by_q cache but not events %s" % eid
 *             for eid in evts_byt.iterkeys():             # <<<<<<<<<<<<<<
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid
 *             for evt in self:
 */
      __pyx_t_6 = 0;
      __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_evts_byt, 1, __pyx_n_s_iterkeys, (&__pyx_t_5), (&__pyx_t_17)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 838, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_7);
      __pyx_t_7 = __pyx_t_10;
      __pyx_t_10 = 0;
      while (1) {
        __pyx_t_18 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_5, &__pyx_t_6, &__pyx_t_10, NULL, NULL, __pyx_t_17);
        if (unlikely(__pyx_t_18 == 0)) break;
        if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 838, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_XDECREF_SET(__pyx_v_eid, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":839
 *                 assert eid in self.events, "Event in by_q cache but not events %s" % eid
 *             for eid in evts_byt.iterkeys():
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid             # <<<<<<<<<<<<<<
 *             for evt in self:
 *                 ninq = self.ninq [evt.qid]
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_16 = (__Pyx_PySequence_ContainsTF(__pyx_v_eid, __pyx_v_self->events, Py_EQ)); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 839, __pyx_L3_error)
          if (unlikely(!(__pyx_t_16 != 0))) {
            __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Event_in_by_t_cache_but_not_even, __pyx_v_eid); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 839, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __PYX_ERR(0, 839, __pyx_L3_error)
          }
        }
        #endif
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":840
 *             for eid in evts_byt.iterkeys():
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid
 *             for evt in self:             # <<<<<<<<<<<<<<
 *                 ninq = self.ninq [evt.qid]
 *                 assert ninq.contains_arrival (evt.a), \
 */
      if (likely(PyList_CheckExact(((PyObject *)__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_v_self))) {
        __pyx_t_7 = ((PyObject *)__pyx_v_self); __Pyx_INCREF(__pyx_t_7); __pyx_t_5 = 0;
        __pyx_t_12 = NULL;
      } else {
        __pyx_t_5 = -1; __pyx_t_7 = PyObject_GetIter(((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 840, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_12 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 840, __pyx_L3_error)
      }
      for (;;) {
        if (likely(!__pyx_t_12)) {
          if (likely(PyList_CheckExact(__pyx_t_7))) {
            if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_5); __Pyx_INCREF(__pyx_t_10); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 840, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 840, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          } else {
            if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_5); __Pyx_INCREF(__pyx_t_10); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 840, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 840, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          }
        } else {
          __pyx_t_10 = __pyx_t_12(__pyx_t_7);
          if (unlikely(!__pyx_t_10)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 840, __pyx_L3_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_10);
        }
        __Pyx_XDECREF_SET(__pyx_v_evt, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":841
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid
 *             for evt in self:
 *                 ninq = self.ninq [evt.qid]             # <<<<<<<<<<<<<<
 *                 assert ninq.contains_arrival (evt.a), \
 *                      "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s" % (evt, evt.a, ninq)
 */
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_qid); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 841, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_8 = PyObject_GetItem(__pyx_v_self->ninq, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 841, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_XDECREF_SET(__pyx_v_ninq, __pyx_t_8);
        __pyx_t_8 = 0;

        /* "arrivals.pyx":842
 *             for evt in self:
 *                 ninq = self.ninq [evt.qid]
 *                 assert ninq.contains_arrival (evt.a), \             # <<<<<<<<<<<<<<
 *                      "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s" % (evt, evt.a, ninq)
 *                 assert ninq.contains_departure (evt.d), \
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_ninq, __pyx_n_s_contains_arrival); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 842, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 842, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_14);
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          if (!__pyx_t_4) {
            __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_14); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 842, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __Pyx_GOTREF(__pyx_t_8);
          } else {
            #if CYTHON_FAST_PYCALL
            if (PyFunction_Check(__pyx_t_10)) {
              PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_14};
              __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 842, __pyx_L3_error)
              __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
              PyObject *__pyx_temp[2] = {__pyx_t_4, __pyx_t_14};
              __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 842, __pyx_L3_error)
              __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            } else
            #endif
            {
              __pyx_t_15 = PyTuple_New(1+1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 842, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_15);
              __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_4); __pyx_t_4 = NULL;
              __Pyx_GIVEREF(__pyx_t_14);
              PyTuple_SET_ITEM(__pyx_t_15, 0+1, __pyx_t_14);
              __pyx_t_14 = 0;
              __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_15, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 842, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            }
          }
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 842, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (unlikely(!__pyx_t_16)) {

            /* "arrivals.pyx":843
 *                 ninq = self.ninq [evt.qid]
 *                 assert ninq.contains_arrival (evt.a), \
 *                      "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s" % (evt, evt.a, ninq)             # <<<<<<<<<<<<<<
 *                 assert ninq.contains_departure (evt.d), \
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)
 */
            __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 843, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 843, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_v_evt);
            __Pyx_GIVEREF(__pyx_v_evt);
            PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_evt);
            __Pyx_GIVEREF(__pyx_t_8);
            PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_8);
            __Pyx_INCREF(__pyx_v_ninq);
            __Pyx_GIVEREF(__pyx_v_ninq);
            PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_ninq);
            __pyx_t_8 = 0;
            __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_NINQ_wrong_does_not_contain_arri, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 843, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __PYX_ERR(0, 842, __pyx_L3_error)
          }
        }
        #endif

        /* "arrivals.pyx":844
 *                 assert ninq.contains_arrival (evt.a), \
 *                      "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s" % (evt, evt.a, ninq)
 *                 assert ninq.contains_departure (evt.d), \             # <<<<<<<<<<<<<<
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)
 *                 if evt.s != 0:
 */
        #ifndef CYTHON_WITHOUT_ASSERTIONS
        if (unlikely(!Py_OptimizeFlag)) {
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_ninq, __pyx_n_s_contains_departure); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 844, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 844, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_15);
          __pyx_t_14 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_14)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_14);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          if (!__pyx_t_14) {
            __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_15); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 844, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            __Pyx_GOTREF(__pyx_t_8);
          } else {
            #if CYTHON_FAST_PYCALL
            if (PyFunction_Check(__pyx_t_10)) {
              PyObject *__pyx_temp[2] = {__pyx_t_14, __pyx_t_15};
              __pyx_t_8 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 844, __pyx_L3_error)
              __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
              PyObject *__pyx_temp[2] = {__pyx_t_14, __pyx_t_15};
              __pyx_t_8 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 844, __pyx_L3_error)
              __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            {
              __pyx_t_4 = PyTuple_New(1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 844, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_14); __pyx_t_14 = NULL;
              __Pyx_GIVEREF(__pyx_t_15);
              PyTuple_SET_ITEM(__pyx_t_4, 0+1, __pyx_t_15);
              __pyx_t_15 = 0;
              __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_4, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 844, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            }
          }
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 844, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (unlikely(!__pyx_t_16)) {

            /* "arrivals.pyx":845
 *                      "NINQ wrong, does not contain arrival\n%s\n%.15f\n%s" % (evt, evt.a, ninq)
 *                 assert ninq.contains_departure (evt.d), \
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)             # <<<<<<<<<<<<<<
 *                 if evt.s != 0:
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 */
            __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_d); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 845, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 845, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_v_evt);
            __Pyx_GIVEREF(__pyx_v_evt);
            PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_evt);
            __Pyx_GIVEREF(__pyx_t_8);
            PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_8);
            __Pyx_INCREF(__pyx_v_ninq);
            __Pyx_GIVEREF(__pyx_v_ninq);
            PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_ninq);
            __pyx_t_8 = 0;
            __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_NINQ_wrong_does_not_contain_depa, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 845, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __PYX_ERR(0, 844, __pyx_L3_error)
          }
        }
        #endif

        /* "arrivals.pyx":846
 *                 assert ninq.contains_departure (evt.d), \
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)
 *                 if evt.s != 0:             # <<<<<<<<<<<<<<
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 *                 if evt.state == self.net.fsm.initial_state():
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_s); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 846, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_10 = PyObject_RichCompare(__pyx_t_8, __pyx_int_0, Py_NE); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 846, __pyx_L3_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 846, __pyx_L3_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (__pyx_t_16) {

          /* "arrivals.pyx":847
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)
 *                 if evt.s != 0:
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)             # <<<<<<<<<<<<<<
 *                 if evt.state == self.net.fsm.initial_state():
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_ninq, __pyx_n_s_N); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 847, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_commencement); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 847, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_15);
            __pyx_t_14 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_15))) {
              __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_15);
              if (likely(__pyx_t_14)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
                __Pyx_INCREF(__pyx_t_14);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_15, function);
              }
            }
            if (__pyx_t_14) {
              __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L3_error)
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            } else {
              __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L3_error)
            }
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            __pyx_t_15 = NULL;
            if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
              __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
              if (likely(__pyx_t_15)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
                __Pyx_INCREF(__pyx_t_15);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_8, function);
              }
            }
            if (!__pyx_t_15) {
              __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              __Pyx_GOTREF(__pyx_t_10);
            } else {
              #if CYTHON_FAST_PYCALL
              if (PyFunction_Check(__pyx_t_8)) {
                PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_4};
                __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
                __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
                __Pyx_GOTREF(__pyx_t_10);
                __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              } else
              #endif
              #if CYTHON_FAST_PYCCALL
              if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
                PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_4};
                __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
                __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
                __Pyx_GOTREF(__pyx_t_10);
                __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              } else
              #endif
              {
                __pyx_t_14 = PyTuple_New(1+1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 847, __pyx_L3_error)
                __Pyx_GOTREF(__pyx_t_14);
                __Pyx_GIVEREF(__pyx_t_15); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_15); __pyx_t_15 = NULL;
                __Pyx_GIVEREF(__pyx_t_4);
                PyTuple_SET_ITEM(__pyx_t_14, 0+1, __pyx_t_4);
                __pyx_t_4 = 0;
                __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_14, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
                __Pyx_GOTREF(__pyx_t_10);
                __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              }
            }
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_8 = PyObject_RichCompare(__pyx_t_10, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 847, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 847, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_commencement); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __pyx_t_14 = NULL;
              if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
                __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
                if (likely(__pyx_t_14)) {
                  PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
                  __Pyx_INCREF(__pyx_t_14);
                  __Pyx_INCREF(function);
                  __Pyx_DECREF_SET(__pyx_t_10, function);
                }
              }
              if (__pyx_t_14) {
                __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_14); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 847, __pyx_L3_error)
                __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              } else {
                __pyx_t_8 = __Pyx_PyObject_CallNoArg(__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 847, __pyx_L3_error)
              }
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 847, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_INCREF(__pyx_v_evt);
              __Pyx_GIVEREF(__pyx_v_evt);
              PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_evt);
              __Pyx_GIVEREF(__pyx_t_8);
              PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_8);
              __Pyx_INCREF(__pyx_v_ninq);
              __Pyx_GIVEREF(__pyx_v_ninq);
              PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_ninq);
              __pyx_t_8 = 0;
              __pyx_t_8 = __Pyx_PyString_Format(__pyx_kp_s_Can_t_find_event_in_ninq_EVT_s_E, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 847, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_8);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
              __PYX_ERR(0, 847, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":846
 *                 assert ninq.contains_departure (evt.d), \
 *                      "NINQ wrong, does not contain departure\n%s\n%.15f\n%s" % (evt, evt.d, ninq)
 *                 if evt.s != 0:             # <<<<<<<<<<<<<<
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 *                 if evt.state == self.net.fsm.initial_state():
 */
        }

        /* "arrivals.pyx":848
 *                 if evt.s != 0:
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 *                 if evt.state == self.net.fsm.initial_state():             # <<<<<<<<<<<<<<
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt
 * 
 */
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_state); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 848, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_self->net->fsm, __pyx_n_s_initial_state); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 848, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_14);
        __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_14);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_14, function);
          }
        }
        if (__pyx_t_4) {
          __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 848, __pyx_L3_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else {
          __pyx_t_10 = __Pyx_PyObject_CallNoArg(__pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 848, __pyx_L3_error)
        }
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __pyx_t_14 = PyObject_RichCompare(__pyx_t_8, __pyx_t_10, Py_EQ); __Pyx_XGOTREF(__pyx_t_14); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 848, __pyx_L3_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 848, __pyx_L3_error)
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        if (__pyx_t_16) {

          /* "arrivals.pyx":849
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 *                 if evt.state == self.net.fsm.initial_state():
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt             # <<<<<<<<<<<<<<
 * 
 *             for inq in self.inq:
 */
          #ifndef CYTHON_WITHOUT_ASSERTIONS
          if (unlikely(!Py_OptimizeFlag)) {
            __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_a); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 849, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_14);
            __pyx_t_10 = __Pyx_PyInt_EqObjC(__pyx_t_14, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 849, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 849, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            if (unlikely(!__pyx_t_16)) {
              __pyx_t_10 = __Pyx_PyString_Format(__pyx_kp_s_Initial_event_with_bad_arrival_s, __pyx_v_evt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 849, __pyx_L3_error)
              __Pyx_GOTREF(__pyx_t_10);
              PyErr_SetObject(PyExc_AssertionError, __pyx_t_10);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __PYX_ERR(0, 849, __pyx_L3_error)
            }
          }
          #endif

          /* "arrivals.pyx":848
 *                 if evt.s != 0:
 *                     assert ninq.N (evt.commencement()) > 0, "Can't find event in ninq!\nEVT %s\nE.C %.15f\nNINQ %s" % (evt, evt.commencement(), ninq)
 *                 if evt.state == self.net.fsm.initial_state():             # <<<<<<<<<<<<<<
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt
 * 
 */
        }

        /* "arrivals.pyx":840
 *             for eid in evts_byt.iterkeys():
 *                 assert eid in self.events, "Event in by_t cache but not events %s" % eid
 *             for evt in self:             # <<<<<<<<<<<<<<
 *                 ninq = self.ninq [evt.qid]
 *                 assert ninq.contains_arrival (evt.a), \
 */
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":851
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt
 * 
 *             for inq in self.inq:             # <<<<<<<<<<<<<<
 *                 if inq: inq.validate()
 * 
 */
      if (likely(PyList_CheckExact(__pyx_v_self->inq)) || PyTuple_CheckExact(__pyx_v_self->inq)) {
        __pyx_t_7 = __pyx_v_self->inq; __Pyx_INCREF(__pyx_t_7); __pyx_t_5 = 0;
        __pyx_t_12 = NULL;
      } else {
        __pyx_t_5 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_self->inq); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 851, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_12 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 851, __pyx_L3_error)
      }
      for (;;) {
        if (likely(!__pyx_t_12)) {
          if (likely(PyList_CheckExact(__pyx_t_7))) {
            if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_5); __Pyx_INCREF(__pyx_t_10); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 851, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 851, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          } else {
            if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_5); __Pyx_INCREF(__pyx_t_10); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 851, __pyx_L3_error)
            #else
            __pyx_t_10 = PySequence_ITEM(__pyx_t_7, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 851, __pyx_L3_error)
            __Pyx_GOTREF(__pyx_t_10);
            #endif
          }
        } else {
          __pyx_t_10 = __pyx_t_12(__pyx_t_7);
          if (unlikely(!__pyx_t_10)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 851, __pyx_L3_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_10);
        }
        __Pyx_XDECREF_SET(__pyx_v_inq, __pyx_t_10);
        __pyx_t_10 = 0;

        /* "arrivals.pyx":852
 * 
 *             for inq in self.inq:
 *                 if inq: inq.validate()             # <<<<<<<<<<<<<<
 * 
 *             check_commencement_cache (self)
 */
        __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_v_inq); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 852, __pyx_L3_error)
        if (__pyx_t_16) {
          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_inq, __pyx_n_s_validate); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 852, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_14);
          __pyx_t_8 = NULL;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_14))) {
            __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_14);
            if (likely(__pyx_t_8)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
              __Pyx_INCREF(__pyx_t_8);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_14, function);
            }
          }
          if (__pyx_t_8) {
            __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 852, __pyx_L3_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          } else {
            __pyx_t_10 = __Pyx_PyObject_CallNoArg(__pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 852, __pyx_L3_error)
          }
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }

        /* "arrivals.pyx":851
 *                     assert evt.a == 0, "Initial event with bad arrival\n%s" % evt
 * 
 *             for inq in self.inq:             # <<<<<<<<<<<<<<
 *                 if inq: inq.validate()
 * 
 */
      }
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":854
 *                 if inq: inq.validate()
 * 
 *             check_commencement_cache (self)             # <<<<<<<<<<<<<<
 * 
 *         except AssertionError, e:
 */
      __pyx_t_10 = __Pyx_GetModuleGlobalName(__pyx_n_s_check_commencement_cache); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 854, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_14 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      if (!__pyx_t_14) {
        __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_t_10, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_7);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[2] = {__pyx_t_14, ((PyObject *)__pyx_v_self)};
          __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L3_error)
          __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
          __Pyx_GOTREF(__pyx_t_7);
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[2] = {__pyx_t_14, ((PyObject *)__pyx_v_self)};
          __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L3_error)
          __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
          __Pyx_GOTREF(__pyx_t_7);
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(1+1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_14); __pyx_t_14 = NULL;
          __Pyx_INCREF(((PyObject *)__pyx_v_self));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
          PyTuple_SET_ITEM(__pyx_t_8, 0+1, ((PyObject *)__pyx_v_self));
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_8, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L3_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "arrivals.pyx":804
 *     def validate (self):
 *         cdef Event evt0, evt1
 *         try:             # <<<<<<<<<<<<<<
 *             evts_byq = dict()
 *             evts_byt = dict()
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L10_try_end;
    __pyx_L3_error:;
    __Pyx_PyThreadState_assign
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "arrivals.pyx":856
 *             check_commencement_cache (self)
 * 
 *         except AssertionError, e:             # <<<<<<<<<<<<<<
 *             self.write_csv (sys.stdout)
 *             print e
 */
    __pyx_t_17 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_AssertionError);
    if (__pyx_t_17) {
      __Pyx_AddTraceback("arrivals.Arrivals.validate", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_10, &__pyx_t_8) < 0) __PYX_ERR(0, 856, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_10);
      __pyx_v_e = __pyx_t_10;

      /* "arrivals.pyx":857
 * 
 *         except AssertionError, e:
 *             self.write_csv (sys.stdout)             # <<<<<<<<<<<<<<
 *             print e
 *             traceback.print_exc()
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_write_csv); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 857, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_15 = __Pyx_GetModuleGlobalName(__pyx_n_s_sys); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 857, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_stdout); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 857, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_15 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_15)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_15);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      if (!__pyx_t_15) {
        __pyx_t_14 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 857, __pyx_L5_except_error)
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_GOTREF(__pyx_t_14);
      } else {
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_9};
          __pyx_t_14 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 857, __pyx_L5_except_error)
          __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[2] = {__pyx_t_15, __pyx_t_9};
          __pyx_t_14 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 857, __pyx_L5_except_error)
          __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        } else
        #endif
        {
          __pyx_t_19 = PyTuple_New(1+1); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 857, __pyx_L5_except_error)
          __Pyx_GOTREF(__pyx_t_19);
          __Pyx_GIVEREF(__pyx_t_15); PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_15); __pyx_t_15 = NULL;
          __Pyx_GIVEREF(__pyx_t_9);
          PyTuple_SET_ITEM(__pyx_t_19, 0+1, __pyx_t_9);
          __pyx_t_9 = 0;
          __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_19, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 857, __pyx_L5_except_error)
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
        }
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

      /* "arrivals.pyx":858
 *         except AssertionError, e:
 *             self.write_csv (sys.stdout)
 *             print e             # <<<<<<<<<<<<<<
 *             traceback.print_exc()
 *             raise e
 */
      if (__Pyx_PrintOne(0, __pyx_v_e) < 0) __PYX_ERR(0, 858, __pyx_L5_except_error)

      /* "arrivals.pyx":859
 *             self.write_csv (sys.stdout)
 *             print e
 *             traceback.print_exc()             # <<<<<<<<<<<<<<
 *             raise e
 * 
 */
      __pyx_t_4 = __Pyx_GetModuleGlobalName(__pyx_n_s_traceback); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 859, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_19 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_print_exc); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 859, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_19);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_19))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_19);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_19);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_19, function);
        }
      }
      if (__pyx_t_4) {
        __pyx_t_14 = __Pyx_PyObject_CallOneArg(__pyx_t_19, __pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 859, __pyx_L5_except_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        __pyx_t_14 = __Pyx_PyObject_CallNoArg(__pyx_t_19); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 859, __pyx_L5_except_error)
      }
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

      /* "arrivals.pyx":860
 *             print e
 *             traceback.print_exc()
 *             raise e             # <<<<<<<<<<<<<<
 * 
 *     def report (self):
 */
      __Pyx_Raise(__pyx_v_e, 0, 0, 0);
      __PYX_ERR(0, 860, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "arrivals.pyx":804
 *     def validate (self):
 *         cdef Event evt0, evt1
 *         try:             # <<<<<<<<<<<<<<
 *             evts_byq = dict()
 *             evts_byt = dict()
 */
    __Pyx_PyThreadState_assign
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L10_try_end:;
  }

  /* "arrivals.pyx":802
 *     def duplicate (self): return self.subset (netutils.all_true)
 * 
 *     def validate (self):             # <<<<<<<<<<<<<<
 *         cdef Event evt0, evt1
 *         try:
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_XDECREF(__pyx_t_19);
  __Pyx_AddTraceback("arrivals.Arrivals.validate", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF((PyObject *)__pyx_v_evt0);
  __Pyx_XDECREF((PyObject *)__pyx_v_evt1);
  __Pyx_XDECREF(__pyx_v_evts_byq);
  __Pyx_XDECREF(__pyx_v_evts_byt);
  __Pyx_XDECREF(__pyx_v_qevts);
  __Pyx_XDECREF(__pyx_v_evt);
  __Pyx_XDECREF(__pyx_v_tid);
  __Pyx_XDECREF(__pyx_v_task_evts);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XDECREF(__pyx_v_eid);
  __Pyx_XDECREF(__pyx_v_ninq);
  __Pyx_XDECREF(__pyx_v_inq);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":862
 *             raise e
 * 
 *     def report (self):             # <<<<<<<<<<<<<<
 *         ne = self.num_events()
 *         nt = self.num_tasks()
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_8Arrivals_109report(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8arrivals_8Arrivals_109report(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("report (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_8Arrivals_108report(((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_8Arrivals_108report(struct __pyx_obj_8arrivals_Arrivals *__pyx_v_self) {
  int __pyx_v_ne;
  PyObject *__pyx_v_nt = NULL;
  PyObject *__pyx_v_treap = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  __Pyx_RefNannySetupContext("report", 0);

  /* "arrivals.pyx":863
 * 
 *     def report (self):
 *         ne = self.num_events()             # <<<<<<<<<<<<<<
 *         nt = self.num_tasks()
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)
 */
  __pyx_v_ne = __pyx_f_8arrivals_8Arrivals_num_events(__pyx_v_self, 0);

  /* "arrivals.pyx":864
 *     def report (self):
 *         ne = self.num_events()
 *         nt = self.num_tasks()             # <<<<<<<<<<<<<<
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)
 *         for treap in self.inq:
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_num_tasks); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 864, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 864, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 864, __pyx_L1_error)
  }
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_nt = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "arrivals.pyx":865
 *         ne = self.num_events()
 *         nt = self.num_tasks()
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)             # <<<<<<<<<<<<<<
 *         for treap in self.inq:
 *             if treap: treap.report()
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ne); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __Pyx_INCREF(__pyx_v_nt);
  __Pyx_GIVEREF(__pyx_v_nt);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_nt);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_ARRIVALS_NE_d_NT_d, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__Pyx_PrintOne(0, __pyx_t_1) < 0) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":866
 *         nt = self.num_tasks()
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)
 *         for treap in self.inq:             # <<<<<<<<<<<<<<
 *             if treap: treap.report()
 * 
 */
  if (likely(PyList_CheckExact(__pyx_v_self->inq)) || PyTuple_CheckExact(__pyx_v_self->inq)) {
    __pyx_t_1 = __pyx_v_self->inq; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_self->inq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 866, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 866, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 866, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 866, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely(0 < 0)) __PYX_ERR(0, 866, __pyx_L1_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 866, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_5(__pyx_t_1);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 866, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_treap, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "arrivals.pyx":867
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)
 *         for treap in self.inq:
 *             if treap: treap.report()             # <<<<<<<<<<<<<<
 * 
 * def format_evt (evt):
 */
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_treap); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 867, __pyx_L1_error)
    if (__pyx_t_6) {
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_treap, __pyx_n_s_report); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 867, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
        }
      }
      if (__pyx_t_7) {
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 867, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else {
        __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 867, __pyx_L1_error)
      }
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }

    /* "arrivals.pyx":866
 *         nt = self.num_tasks()
 *         print "ARRIVALS NE %d  NT %d" % (ne, nt)
 *         for treap in self.inq:             # <<<<<<<<<<<<<<
 *             if treap: treap.report()
 * 
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":862
 *             raise e
 * 
 *     def report (self):             # <<<<<<<<<<<<<<
 *         ne = self.num_events()
 *         nt = self.num_tasks()
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("arrivals.Arrivals.report", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_nt);
  __Pyx_XDECREF(__pyx_v_treap);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":869
 *             if treap: treap.report()
 * 
 * def format_evt (evt):             # <<<<<<<<<<<<<<
 *     if evt is None:
 *         return "None"
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_11format_evt(PyObject *__pyx_self, PyObject *__pyx_v_evt); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_11format_evt = {"format_evt", (PyCFunction)__pyx_pw_8arrivals_11format_evt, METH_O, 0};
static PyObject *__pyx_pw_8arrivals_11format_evt(PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("format_evt (wrapper)", 0);
  __pyx_r = __pyx_pf_8arrivals_10format_evt(__pyx_self, ((PyObject *)__pyx_v_evt));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_10format_evt(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_evt) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  __Pyx_RefNannySetupContext("format_evt", 0);

  /* "arrivals.pyx":870
 * 
 * def format_evt (evt):
 *     if evt is None:             # <<<<<<<<<<<<<<
 *         return "None"
 *     else:
 */
  __pyx_t_1 = (__pyx_v_evt == Py_None);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "arrivals.pyx":871
 * def format_evt (evt):
 *     if evt is None:
 *         return "None"             # <<<<<<<<<<<<<<
 *     else:
 *         return evt.dump()
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_n_s_None);
    __pyx_r = __pyx_n_s_None;
    goto __pyx_L0;

    /* "arrivals.pyx":870
 * 
 * def format_evt (evt):
 *     if evt is None:             # <<<<<<<<<<<<<<
 *         return "None"
 *     else:
 */
  }

  /* "arrivals.pyx":873
 *         return "None"
 *     else:
 *         return evt.dump()             # <<<<<<<<<<<<<<
 * 
 * EPS = 1e-5
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_evt, __pyx_n_s_dump); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 873, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (__pyx_t_5) {
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 873, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    } else {
      __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 873, __pyx_L1_error)
    }
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }

  /* "arrivals.pyx":869
 *             if treap: treap.report()
 * 
 * def format_evt (evt):             # <<<<<<<<<<<<<<
 *     if evt is None:
 *         return "None"
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("arrivals.format_evt", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "arrivals.pyx":877
 * EPS = 1e-5
 * 
 * def check_commencement_cache (Arrivals arrv):             # <<<<<<<<<<<<<<
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]
 */

/* Python wrapper */
static PyObject *__pyx_pw_8arrivals_13check_commencement_cache(PyObject *__pyx_self, PyObject *__pyx_v_arrv); /*proto*/
static PyMethodDef __pyx_mdef_8arrivals_13check_commencement_cache = {"check_commencement_cache", (PyCFunction)__pyx_pw_8arrivals_13check_commencement_cache, METH_O, 0};
static PyObject *__pyx_pw_8arrivals_13check_commencement_cache(PyObject *__pyx_self, PyObject *__pyx_v_arrv) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("check_commencement_cache (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arrv), __pyx_ptype_8arrivals_Arrivals, 1, "arrv", 0))) __PYX_ERR(0, 877, __pyx_L1_error)
  __pyx_r = __pyx_pf_8arrivals_12check_commencement_cache(__pyx_self, ((struct __pyx_obj_8arrivals_Arrivals *)__pyx_v_arrv));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8arrivals_12check_commencement_cache(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_8arrivals_Arrivals *__pyx_v_arrv) {
  Py_ssize_t __pyx_v_qi;
  PyObject *__pyx_v_c2e = NULL;
  PyObject *__pyx_v_evtl = NULL;
  PyObject *__pyx_v_e = NULL;
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  Py_ssize_t __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  __Pyx_RefNannySetupContext("check_commencement_cache", 0);

  /* "arrivals.pyx":878
 * 
 * def check_commencement_cache (Arrivals arrv):
 *     for qi in range(len(arrv.byq)):             # <<<<<<<<<<<<<<
 *         c2e = arrv.c2e_cache[qi]
 *         evtl = arrv.events_of_qid (qi)
 */
  __pyx_t_1 = __pyx_v_arrv->byq;
  __Pyx_INCREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) __PYX_ERR(0, 878, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_qi = __pyx_t_3;

    /* "arrivals.pyx":879
 * def check_commencement_cache (Arrivals arrv):
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]             # <<<<<<<<<<<<<<
 *         evtl = arrv.events_of_qid (qi)
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)
 */
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arrv->c2e_cache, __pyx_v_qi, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 879, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_c2e, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":880
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]
 *         evtl = arrv.events_of_qid (qi)             # <<<<<<<<<<<<<<
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)
 *         for e in evtl:
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_arrv), __pyx_n_s_events_of_qid); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 880, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_qi); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 880, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    if (!__pyx_t_6) {
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else {
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[2] = {__pyx_t_6, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(1+1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 880, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6); __pyx_t_6 = NULL;
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_7, 0+1, __pyx_t_5);
        __pyx_t_5 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_evtl, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "arrivals.pyx":881
 *         c2e = arrv.c2e_cache[qi]
 *         evtl = arrv.events_of_qid (qi)
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)             # <<<<<<<<<<<<<<
 *         for e in evtl:
 *             c = e.commencement()
 */
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_8 = PyObject_Length(__pyx_v_c2e); if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 881, __pyx_L1_error)
      __pyx_t_9 = PyObject_Length(__pyx_v_evtl); if (unlikely(__pyx_t_9 == -1)) __PYX_ERR(0, 881, __pyx_L1_error)
      if (unlikely(!((__pyx_t_8 == __pyx_t_9) != 0))) {
        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 881, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(((PyObject *)(&PyString_Type)));
        __Pyx_GIVEREF(((PyObject *)(&PyString_Type)));
        PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)(&PyString_Type)));
        __Pyx_INCREF(__pyx_v_evtl);
        __Pyx_GIVEREF(__pyx_v_evtl);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_evtl);
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 881, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyString_Join(__pyx_kp_s__4, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 881, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 881, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
        __Pyx_INCREF(__pyx_v_c2e);
        __Pyx_GIVEREF(__pyx_v_c2e);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_c2e);
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Huh_EVTL_s_C2E_s, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 881, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        PyErr_SetObject(PyExc_AssertionError, __pyx_t_1);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __PYX_ERR(0, 881, __pyx_L1_error)
      }
    }
    #endif

    /* "arrivals.pyx":882
 *         evtl = arrv.events_of_qid (qi)
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)
 *         for e in evtl:             # <<<<<<<<<<<<<<
 *             c = e.commencement()
 *             assert c2e.contains_key (c)
 */
    if (likely(PyList_CheckExact(__pyx_v_evtl)) || PyTuple_CheckExact(__pyx_v_evtl)) {
      __pyx_t_1 = __pyx_v_evtl; __Pyx_INCREF(__pyx_t_1); __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_evtl); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 882, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 882, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_4); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 882, __pyx_L1_error)
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 882, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        } else {
          if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_4); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 882, __pyx_L1_error)
          #else
          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 882, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_10(__pyx_t_1);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(exc_type == PyExc_StopIteration || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 882, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      __Pyx_XDECREF_SET(__pyx_v_e, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":883
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)
 *         for e in evtl:
 *             c = e.commencement()             # <<<<<<<<<<<<<<
 *             assert c2e.contains_key (c)
 *             assert c2e.in_range (c-EPS, c+EPS).index(e) >= 0
 */
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_e, __pyx_n_s_commencement); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 883, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      if (__pyx_t_5) {
        __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 883, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else {
        __pyx_t_4 = __Pyx_PyObject_CallNoArg(__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 883, __pyx_L1_error)
      }
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF_SET(__pyx_v_c, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "arrivals.pyx":884
 *         for e in evtl:
 *             c = e.commencement()
 *             assert c2e.contains_key (c)             # <<<<<<<<<<<<<<
 *             assert c2e.in_range (c-EPS, c+EPS).index(e) >= 0
 */
      #ifndef CYTHON_WITHOUT_ASSERTIONS
      if (unlikely(!Py_OptimizeFlag)) {
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_c2e, __pyx_n_s_contains_key); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 884, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_5 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
          }
        }
        if (!__pyx_t_5) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_c); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 884, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_c};
            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 884, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[2] = {__pyx_t_5, __pyx_v_c};
            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 884, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          {
            __pyx_t_6 = PyTuple_New(1+1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 884, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5); __pyx_t_5 = NULL;
            __Pyx_INCREF(__pyx_v_c);
            __Pyx_GIVEREF(__pyx_v_c);
            PyTuple_SET_ITEM(__pyx_t_6, 0+1, __pyx_v_c);
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 884, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 884, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_11)) {
          PyErr_SetNone(PyExc_AssertionError);
          __PYX_ERR(0, 884, __pyx_L1_error)
        }
      }
      #endif

      /* "arrivals.pyx":885
 *             c = e.commencement()
 *             assert c2e.contains_key (c)
 *             assert c2e.in_range (c-EPS, c+EPS).index(e) >= 0             # <<<<<<<<<<<<<<
 */
      #ifndef CYTHON_WITHOUT_ASSERTIONS
      if (unlikely(!Py_OptimizeFlag)) {
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_c2e, __pyx_n_s_in_range); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_EPS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_12 = PyNumber_Subtract(__pyx_v_c, __pyx_t_5); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_GetModuleGlobalName(__pyx_n_s_EPS); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_13 = PyNumber_Add(__pyx_v_c, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_13);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = NULL;
        __pyx_t_14 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
            __pyx_t_14 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_12, __pyx_t_13};
          __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_14, 2+__pyx_t_14); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 885, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_12, __pyx_t_13};
          __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_14, 2+__pyx_t_14); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 885, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        } else
        #endif
        {
          __pyx_t_15 = PyTuple_New(2+__pyx_t_14); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 885, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_15);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_12);
          PyTuple_SET_ITEM(__pyx_t_15, 0+__pyx_t_14, __pyx_t_12);
          __Pyx_GIVEREF(__pyx_t_13);
          PyTuple_SET_ITEM(__pyx_t_15, 1+__pyx_t_14, __pyx_t_13);
          __pyx_t_12 = 0;
          __pyx_t_13 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_15, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 885, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_index); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
          }
        }
        if (!__pyx_t_7) {
          __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_e); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 885, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
        } else {
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_6)) {
            PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_e};
            __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 885, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
            PyObject *__pyx_temp[2] = {__pyx_t_7, __pyx_v_e};
            __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-1, 1+1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 885, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_4);
          } else
          #endif
          {
            __pyx_t_15 = PyTuple_New(1+1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 885, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_15);
            __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_7); __pyx_t_7 = NULL;
            __Pyx_INCREF(__pyx_v_e);
            __Pyx_GIVEREF(__pyx_v_e);
            PyTuple_SET_ITEM(__pyx_t_15, 0+1, __pyx_v_e);
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_15, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 885, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
          }
        }
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 885, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(!__pyx_t_11)) {
          PyErr_SetNone(PyExc_AssertionError);
          __PYX_ERR(0, 885, __pyx_L1_error)
        }
      }
      #endif

      /* "arrivals.pyx":882
 *         evtl = arrv.events_of_qid (qi)
 *         assert len(c2e) == len(evtl), "Huh? EVTL %s  C2E %s" % ("\n".join(map(str,evtl)), c2e)
 *         for e in evtl:             # <<<<<<<<<<<<<<
 *             c = e.commencement()
 *             assert c2e.contains_key (c)
 */
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "arrivals.pyx":877
 * EPS = 1e-5
 * 
 * def check_commencement_cache (Arrivals arrv):             # <<<<<<<<<<<<<<
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("arrivals.check_commencement_cache", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c2e);
  __Pyx_XDECREF(__pyx_v_evtl);
  __Pyx_XDECREF(__pyx_v_e);
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static struct __pyx_vtabstruct_8arrivals_Event __pyx_vtable_8arrivals_Event;

static PyObject *__pyx_tp_new_8arrivals_Event(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_8arrivals_Event *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_8arrivals_Event *)o);
  p->__pyx_vtab = __pyx_vtabptr_8arrivals_Event;
  p->q = ((struct __pyx_obj_6queues_Queue *)Py_None); Py_INCREF(Py_None);
  p->prev_byt = Py_None; Py_INCREF(Py_None);
  p->next_byt = Py_None; Py_INCREF(Py_None);
  p->prev_byq = Py_None; Py_INCREF(Py_None);
  p->next_byq = Py_None; Py_INCREF(Py_None);
  p->arrv = Py_None; Py_INCREF(Py_None);
  p->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_8arrivals_Event(PyObject *o) {
  struct __pyx_obj_8arrivals_Event *p = (struct __pyx_obj_8arrivals_Event *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pw_8arrivals_5Event_5__dealloc__(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_CLEAR(p->q);
  Py_CLEAR(p->prev_byt);
  Py_CLEAR(p->next_byt);
  Py_CLEAR(p->prev_byq);
  Py_CLEAR(p->next_byq);
  Py_CLEAR(p->arrv);
  Py_CLEAR(p->auxiliaries);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8arrivals_Event(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8arrivals_Event *p = (struct __pyx_obj_8arrivals_Event *)o;
  if (p->q) {
    e = (*v)(((PyObject*)p->q), a); if (e) return e;
  }
  if (p->prev_byt) {
    e = (*v)(p->prev_byt, a); if (e) return e;
  }
  if (p->next_byt) {
    e = (*v)(p->next_byt, a); if (e) return e;
  }
  if (p->prev_byq) {
    e = (*v)(p->prev_byq, a); if (e) return e;
  }
  if (p->next_byq) {
    e = (*v)(p->next_byq, a); if (e) return e;
  }
  if (p->arrv) {
    e = (*v)(p->arrv, a); if (e) return e;
  }
  if (p->auxiliaries) {
    e = (*v)(((PyObject*)p->auxiliaries), a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8arrivals_Event(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_8arrivals_Event *p = (struct __pyx_obj_8arrivals_Event *)o;
  tmp = ((PyObject*)p->q);
  p->q = ((struct __pyx_obj_6queues_Queue *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->prev_byt);
  p->prev_byt = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->next_byt);
  p->next_byt = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->prev_byq);
  p->prev_byq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->next_byq);
  p->next_byq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->arrv);
  p->arrv = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->auxiliaries);
  p->auxiliaries = ((struct __pyx_obj_8arrivals_Vars *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_8arrivals_5Event_eid(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_3eid_1__get__(o);
}

static PyObject *__pyx_getprop_8arrivals_5Event_tid(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_3tid_1__get__(o);
}

static PyObject *__pyx_getprop_8arrivals_5Event_qid(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_3qid_1__get__(o);
}

static PyObject *__pyx_getprop_8arrivals_5Event_state(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_5state_1__get__(o);
}

static PyObject *__pyx_getprop_8arrivals_5Event_a(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_1a_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_a(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_1a_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_s(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_1s_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_s(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_1s_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_c(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_1c_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_c(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_1c_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_d(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_1d_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_d(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_1d_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_obs_a(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_5obs_a_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_obs_a(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_5obs_a_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_obs_d(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_5obs_d_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_obs_d(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_5obs_d_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_proc(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_4proc_1__get__(o);
}

static int __pyx_setprop_8arrivals_5Event_proc(PyObject *o, PyObject *v, CYTHON_UNUSED void *x) {
  if (v) {
    return __pyx_pw_8arrivals_5Event_4proc_3__set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_8arrivals_5Event_auxiliaries(PyObject *o, CYTHON_UNUSED void *x) {
  return __pyx_pw_8arrivals_5Event_11auxiliaries_1__get__(o);
}

static PyMethodDef __pyx_methods_8arrivals_Event[] = {
  {"dump", (PyCFunction)__pyx_pw_8arrivals_5Event_7dump, METH_NOARGS, 0},
  {"as_csv", (PyCFunction)__pyx_pw_8arrivals_5Event_9as_csv, METH_NOARGS, 0},
  {"arrival", (PyCFunction)__pyx_pw_8arrivals_5Event_11arrival, METH_NOARGS, 0},
  {"service", (PyCFunction)__pyx_pw_8arrivals_5Event_13service, METH_NOARGS, 0},
  {"departure", (PyCFunction)__pyx_pw_8arrivals_5Event_15departure, METH_NOARGS, 0},
  {"queue", (PyCFunction)__pyx_pw_8arrivals_5Event_17queue, METH_NOARGS, 0},
  {"set_state", (PyCFunction)__pyx_pw_8arrivals_5Event_19set_state, METH_O, 0},
  {"duplicate", (PyCFunction)__pyx_pw_8arrivals_5Event_21duplicate, METH_NOARGS, 0},
  {"previous_by_queue", (PyCFunction)__pyx_pw_8arrivals_5Event_23previous_by_queue, METH_NOARGS, 0},
  {"next_by_queue", (PyCFunction)__pyx_pw_8arrivals_5Event_25next_by_queue, METH_NOARGS, 0},
  {"previous_by_task", (PyCFunction)__pyx_pw_8arrivals_5Event_27previous_by_task, METH_NOARGS, 0},
  {"next_by_task", (PyCFunction)__pyx_pw_8arrivals_5Event_29next_by_task, METH_NOARGS, 0},
  {"set_next_by_task", (PyCFunction)__pyx_pw_8arrivals_5Event_31set_next_by_task, METH_O, 0},
  {"set_previous_by_task", (PyCFunction)__pyx_pw_8arrivals_5Event_33set_previous_by_task, METH_O, 0},
  {"set_previous_by_queue", (PyCFunction)__pyx_pw_8arrivals_5Event_35set_previous_by_queue, METH_O, 0},
  {"set_next_by_queue", (PyCFunction)__pyx_pw_8arrivals_5Event_37set_next_by_queue, METH_O, 0},
  {"variable", (PyCFunction)__pyx_pw_8arrivals_5Event_39variable, METH_O, 0},
  {"set_variable", (PyCFunction)__pyx_pw_8arrivals_5Event_41set_variable, METH_VARARGS|METH_KEYWORDS, 0},
  {"set_all_vars", (PyCFunction)__pyx_pw_8arrivals_5Event_43set_all_vars, METH_O, 0},
  {"copy_caches", (PyCFunction)__pyx_pw_8arrivals_5Event_45copy_caches, METH_O, 0},
  {"wait", (PyCFunction)__pyx_pw_8arrivals_5Event_47wait, METH_NOARGS, 0},
  {"commencement", (PyCFunction)__pyx_pw_8arrivals_5Event_49commencement, METH_NOARGS, 0},
  {"reset_commencement", (PyCFunction)__pyx_pw_8arrivals_5Event_51reset_commencement, METH_NOARGS, 0},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_8arrivals_Event[] = {
  {(char *)"eid", __pyx_getprop_8arrivals_5Event_eid, 0, (char *)0, 0},
  {(char *)"tid", __pyx_getprop_8arrivals_5Event_tid, 0, (char *)0, 0},
  {(char *)"qid", __pyx_getprop_8arrivals_5Event_qid, 0, (char *)0, 0},
  {(char *)"state", __pyx_getprop_8arrivals_5Event_state, 0, (char *)0, 0},
  {(char *)"a", __pyx_getprop_8arrivals_5Event_a, __pyx_setprop_8arrivals_5Event_a, (char *)0, 0},
  {(char *)"s", __pyx_getprop_8arrivals_5Event_s, __pyx_setprop_8arrivals_5Event_s, (char *)0, 0},
  {(char *)"c", __pyx_getprop_8arrivals_5Event_c, __pyx_setprop_8arrivals_5Event_c, (char *)0, 0},
  {(char *)"d", __pyx_getprop_8arrivals_5Event_d, __pyx_setprop_8arrivals_5Event_d, (char *)0, 0},
  {(char *)"obs_a", __pyx_getprop_8arrivals_5Event_obs_a, __pyx_setprop_8arrivals_5Event_obs_a, (char *)0, 0},
  {(char *)"obs_d", __pyx_getprop_8arrivals_5Event_obs_d, __pyx_setprop_8arrivals_5Event_obs_d, (char *)0, 0},
  {(char *)"proc", __pyx_getprop_8arrivals_5Event_proc, __pyx_setprop_8arrivals_5Event_proc, (char *)0, 0},
  {(char *)"auxiliaries", __pyx_getprop_8arrivals_5Event_auxiliaries, 0, (char *)0, 0},
  {0, 0, 0, 0, 0}
};

static PyTypeObject __pyx_type_8arrivals_Event = {
  PyVarObject_HEAD_INIT(0, 0)
  "arrivals.Event", /*tp_name*/
  sizeof(struct __pyx_obj_8arrivals_Event), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8arrivals_Event, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  __pyx_pw_8arrivals_5Event_53__cmp__, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_8arrivals_5Event_3__repr__, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_8arrivals_Event, /*tp_traverse*/
  __pyx_tp_clear_8arrivals_Event, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8arrivals_Event, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_8arrivals_Event, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_8arrivals_5Event_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8arrivals_Event, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};
static struct __pyx_vtabstruct_8arrivals_Arrivals __pyx_vtable_8arrivals_Arrivals;

static PyObject *__pyx_tp_new_8arrivals_Arrivals(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_8arrivals_Arrivals *p;
  PyObject *o;
  o = (*t->tp_alloc)(t, 0);
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_8arrivals_Arrivals *)o);
  p->__pyx_vtab = __pyx_vtabptr_8arrivals_Arrivals;
  p->net = ((struct __pyx_obj_4qnet_Qnet *)Py_None); Py_INCREF(Py_None);
  p->byq = Py_None; Py_INCREF(Py_None);
  p->final_byq = Py_None; Py_INCREF(Py_None);
  p->byt = Py_None; Py_INCREF(Py_None);
  p->events = Py_None; Py_INCREF(Py_None);
  p->_initial_events = Py_None; Py_INCREF(Py_None);
  p->queue_orders = Py_None; Py_INCREF(Py_None);
  p->ninq = Py_None; Py_INCREF(Py_None);
  p->inq = Py_None; Py_INCREF(Py_None);
  p->a2e_cache = Py_None; Py_INCREF(Py_None);
  p->c2e_cache = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_8arrivals_Arrivals(PyObject *o) {
  struct __pyx_obj_8arrivals_Arrivals *p = (struct __pyx_obj_8arrivals_Arrivals *)o;
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->net);
  Py_CLEAR(p->byq);
  Py_CLEAR(p->final_byq);
  Py_CLEAR(p->byt);
  Py_CLEAR(p->events);
  Py_CLEAR(p->_initial_events);
  Py_CLEAR(p->queue_orders);
  Py_CLEAR(p->ninq);
  Py_CLEAR(p->inq);
  Py_CLEAR(p->a2e_cache);
  Py_CLEAR(p->c2e_cache);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8arrivals_Arrivals(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8arrivals_Arrivals *p = (struct __pyx_obj_8arrivals_Arrivals *)o;
  if (p->net) {
    e = (*v)(((PyObject*)p->net), a); if (e) return e;
  }
  if (p->byq) {
    e = (*v)(p->byq, a); if (e) return e;
  }
  if (p->final_byq) {
    e = (*v)(p->final_byq, a); if (e) return e;
  }
  if (p->byt) {
    e = (*v)(p->byt, a); if (e) return e;
  }
  if (p->events) {
    e = (*v)(p->events, a); if (e) return e;
  }
  if (p->_initial_events) {
    e = (*v)(p->_initial_events, a); if (e) return e;
  }
  if (p->queue_orders) {
    e = (*v)(p->queue_orders, a); if (e) return e;
  }
  if (p->ninq) {
    e = (*v)(p->ninq, a); if (e) return e;
  }
  if (p->inq) {
    e = (*v)(p->inq, a); if (e) return e;
  }
  if (p->a2e_cache) {
    e = (*v)(p->a2e_cache, a); if (e) return e;
  }
  if (p->c2e_cache) {
    e = (*v)(p->c2e_cache, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8arrivals_Arrivals(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_8arrivals_Arrivals *p = (struct __pyx_obj_8arrivals_Arrivals *)o;
  tmp = ((PyObject*)p->net);
  p->net = ((struct __pyx_obj_4qnet_Qnet *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->byq);
  p->byq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->final_byq);
  p->final_byq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->byt);
  p->byt = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->events);
  p->events = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->_initial_events);
  p->_initial_events = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->queue_orders);
  p->queue_orders = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->ninq);
  p->ninq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->inq);
  p->inq = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->a2e_cache);
  p->a2e_cache = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->c2e_cache);
  p->c2e_cache = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_8arrivals_Arrivals[] = {
  {"display", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_7display, METH_NOARGS, 0},
  {"dump", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_9dump, METH_NOARGS, 0},
  {"as_csv", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_11as_csv, METH_NOARGS, 0},
  {"write_csv", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_13write_csv, METH_O, 0},
  {"all_events", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_15all_events, METH_NOARGS, 0},
  {"events_of_qid", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_17events_of_qid, METH_O, 0},
  {"events_of_queue", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_19events_of_queue, METH_O, 0},
  {"final_arrival_by_queue", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_21final_arrival_by_queue, METH_O, 0},
  {"final_arrival_by_qid", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_23final_arrival_by_qid, METH_O, 0},
  {"first_arrival_by_queue", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_25first_arrival_by_queue, METH_O, 0},
  {"first_arrival_by_qid", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_27first_arrival_by_qid, METH_O, 0},
  {"events_of_task", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_29events_of_task, METH_O, 0},
  {"c2e_range", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_31c2e_range, METH_VARARGS|METH_KEYWORDS, 0},
  {"arrivals_in_range", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_33arrivals_in_range, METH_VARARGS|METH_KEYWORDS, 0},
  {"evts_in_range", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_35evts_in_range, METH_VARARGS|METH_KEYWORDS, 0},
  {"num_events", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_37num_events, METH_NOARGS, 0},
  {"num_hidden_events", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_39num_hidden_events, METH_NOARGS, 0},
  {"num_tasks", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_41num_tasks, METH_NOARGS, 0},
  {"all_tasks", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_43all_tasks, METH_NOARGS, 0},
  {"max_eidx", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_45max_eidx, METH_NOARGS, 0},
  {"max_tid", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_47max_tid, METH_NOARGS, 0},
  {"initial_events", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_49initial_events, METH_NOARGS, 0},
  {"append", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_51append, METH_O, 0},
  {"insert", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_53insert, METH_O, 0},
  {"resort_byq", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_55resort_byq, METH_O, 0},
  {"find_next_byq", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_57find_next_byq, METH_VARARGS|METH_KEYWORDS, 0},
  {"applyDiffList", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_59applyDiffList, METH_VARARGS|METH_KEYWORDS, 0},
  {"_update_final_byq", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_61_update_final_byq, METH_O, 0},
  {"_update_ninq", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_63_update_ninq, METH_VARARGS|METH_KEYWORDS, 0},
  {"update_commencement_cache", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_65update_commencement_cache, METH_VARARGS|METH_KEYWORDS, 0},
  {"update_arrival_cache", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_67update_arrival_cache, METH_VARARGS|METH_KEYWORDS, 0},
  {"setup_inq_cache", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_69setup_inq_cache, METH_NOARGS, 0},
  {"update_inq_cache", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_71update_inq_cache, METH_VARARGS|METH_KEYWORDS, 0},
  {"update_departure_caches", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_73update_departure_caches, METH_VARARGS|METH_KEYWORDS, 0},
  {"regenerate_all_caches", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_75regenerate_all_caches, METH_NOARGS, 0},
  {"ninq_of_queue", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_77ninq_of_queue, METH_O, 0},
  {"delete_task", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_79delete_task, METH_O, 0},
  {"append_and_check", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_81append_and_check, METH_O, __pyx_doc_8arrivals_8Arrivals_80append_and_check},
  {"qnet", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_83qnet, METH_NOARGS, 0},
  {"num_queues", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_85num_queues, METH_NOARGS, 0},
  {"event", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_87event, METH_O, 0},
  {"is_initial", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_89is_initial, METH_O, 0},
  {"is_final", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_91is_final, METH_O, 0},
  {"is_last_in_queue", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_93is_last_in_queue, METH_O, 0},
  {"recompute_all_service", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_95recompute_all_service, METH_NOARGS, 0},
  {"subset", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_97subset, METH_VARARGS|METH_KEYWORDS, 0},
  {"subset_by_task", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_99subset_by_task, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8arrivals_8Arrivals_98subset_by_task},
  {"subset_by_task_fn", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_101subset_by_task_fn, METH_VARARGS|METH_KEYWORDS, 0},
  {"recompute_caches", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_103recompute_caches, METH_NOARGS, 0},
  {"duplicate", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_105duplicate, METH_NOARGS, 0},
  {"validate", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_107validate, METH_NOARGS, 0},
  {"report", (PyCFunction)__pyx_pw_8arrivals_8Arrivals_109report, METH_NOARGS, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_8arrivals_Arrivals = {
  PyVarObject_HEAD_INIT(0, 0)
  "arrivals.Arrivals", /*tp_name*/
  sizeof(struct __pyx_obj_8arrivals_Arrivals), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8arrivals_Arrivals, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  __pyx_pw_8arrivals_8Arrivals_5__repr__, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_8arrivals_Arrivals, /*tp_traverse*/
  __pyx_tp_clear_8arrivals_Arrivals, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  __pyx_pw_8arrivals_8Arrivals_3__iter__, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8arrivals_Arrivals, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_8arrivals_8Arrivals_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8arrivals_Arrivals, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyObject *__pyx_tp_new_8arrivals_Vars(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_8arrivals_Vars *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_8arrivals_Vars *)o);
  p->map = Py_None; Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_8arrivals_Vars(PyObject *o) {
  struct __pyx_obj_8arrivals_Vars *p = (struct __pyx_obj_8arrivals_Vars *)o;
  #if PY_VERSION_HEX >= 0x030400a1
  if (unlikely(Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->map);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_8arrivals_Vars(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_8arrivals_Vars *p = (struct __pyx_obj_8arrivals_Vars *)o;
  if (p->map) {
    e = (*v)(p->map, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_8arrivals_Vars(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_8arrivals_Vars *p = (struct __pyx_obj_8arrivals_Vars *)o;
  tmp = ((PyObject*)p->map);
  p->map = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyMethodDef __pyx_methods_8arrivals_Vars[] = {
  {"duplicate", (PyCFunction)__pyx_pw_8arrivals_4Vars_3duplicate, METH_NOARGS, 0},
  {"get", (PyCFunction)__pyx_pw_8arrivals_4Vars_5get, METH_O, 0},
  {"set", (PyCFunction)__pyx_pw_8arrivals_4Vars_7set, METH_VARARGS|METH_KEYWORDS, 0},
  {"num_vars", (PyCFunction)__pyx_pw_8arrivals_4Vars_9num_vars, METH_NOARGS, 0},
  {"allvars", (PyCFunction)__pyx_pw_8arrivals_4Vars_11allvars, METH_NOARGS, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_8arrivals_Vars = {
  PyVarObject_HEAD_INIT(0, 0)
  "arrivals.Vars", /*tp_name*/
  sizeof(struct __pyx_obj_8arrivals_Vars), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8arrivals_Vars, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_8arrivals_Vars, /*tp_traverse*/
  __pyx_tp_clear_8arrivals_Vars, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8arrivals_Vars, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_8arrivals_4Vars_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8arrivals_Vars, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
  #if PY_VERSION_HEX < 0x03020000
    { PyObject_HEAD_INIT(NULL) NULL, 0, NULL },
  #else
    PyModuleDef_HEAD_INIT,
  #endif
    "arrivals",
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_s_, __pyx_k_, sizeof(__pyx_k_), 0, 0, 1, 0},
  {&__pyx_kp_s_5f, __pyx_k_5f, sizeof(__pyx_k_5f), 0, 0, 1, 0},
  {&__pyx_kp_s_ARRIVALS_NE_d_NT_d, __pyx_k_ARRIVALS_NE_d_NT_d, sizeof(__pyx_k_ARRIVALS_NE_d_NT_d), 0, 0, 1, 0},
  {&__pyx_n_s_ARRV_BY_A, __pyx_k_ARRV_BY_A, sizeof(__pyx_k_ARRV_BY_A), 0, 0, 1, 1},
  {&__pyx_n_s_ARRV_BY_D, __pyx_k_ARRV_BY_D, sizeof(__pyx_k_ARRV_BY_D), 0, 0, 1, 1},
  {&__pyx_kp_s_Arrivals_Disregarding_event_s_br, __pyx_k_Arrivals_Disregarding_event_s_br, sizeof(__pyx_k_Arrivals_Disregarding_event_s_br), 0, 0, 1, 0},
  {&__pyx_n_s_AssertionError, __pyx_k_AssertionError, sizeof(__pyx_k_AssertionError), 0, 0, 1, 1},
  {&__pyx_n_s_BIG_N, __pyx_k_BIG_N, sizeof(__pyx_k_BIG_N), 0, 0, 1, 1},
  {&__pyx_kp_s_Bad_order_d_for_queue_s, __pyx_k_Bad_order_d_for_queue_s, sizeof(__pyx_k_Bad_order_d_for_queue_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Can_t_find_event_in_ninq_EVT_s_E, __pyx_k_Can_t_find_event_in_ninq_EVT_s_E, sizeof(__pyx_k_Can_t_find_event_in_ninq_EVT_s_E), 0, 0, 1, 0},
  {&__pyx_kp_s_Cycle, __pyx_k_Cycle, sizeof(__pyx_k_Cycle), 0, 0, 1, 0},
  {&__pyx_kp_s_EID_TID_QID_A_D_S_W_STATE_PROC_O, __pyx_k_EID_TID_QID_A_D_S_W_STATE_PROC_O, sizeof(__pyx_k_EID_TID_QID_A_D_S_W_STATE_PROC_O), 0, 0, 1, 0},
  {&__pyx_n_s_EPS, __pyx_k_EPS, sizeof(__pyx_k_EPS), 0, 0, 1, 1},
  {&__pyx_kp_s_EVT_5d_23_17g_23_17g_S_23_17g_T, __pyx_k_EVT_5d_23_17g_23_17g_S_23_17g_T, sizeof(__pyx_k_EVT_5d_23_17g_23_17g_S_23_17g_T), 0, 0, 1, 0},
  {&__pyx_kp_s_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d, __pyx_k_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d, sizeof(__pyx_k_EVT_5d_5_5f_5_5f_S_5_5f_TID_5d), 0, 0, 1, 0},
  {&__pyx_kp_s_Error_in_initializing_observed_e, __pyx_k_Error_in_initializing_observed_e, sizeof(__pyx_k_Error_in_initializing_observed_e), 0, 0, 1, 0},
  {&__pyx_kp_s_Error_in_initializing_observed_e_2, __pyx_k_Error_in_initializing_observed_e_2, sizeof(__pyx_k_Error_in_initializing_observed_e_2), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_in_by_q_cache_but_not_even, __pyx_k_Event_in_by_q_cache_but_not_even, sizeof(__pyx_k_Event_in_by_q_cache_but_not_even), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_in_by_t_cache_but_not_even, __pyx_k_Event_in_by_t_cache_but_not_even, sizeof(__pyx_k_Event_in_by_t_cache_but_not_even), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_in_event_list_but_not_in_b, __pyx_k_Event_in_event_list_but_not_in_b, sizeof(__pyx_k_Event_in_event_list_but_not_in_b), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_in_event_list_but_not_in_b_2, __pyx_k_Event_in_event_list_but_not_in_b_2, sizeof(__pyx_k_Event_in_event_list_but_not_in_b_2), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_list_mismatch_Expected_s_W, __pyx_k_Event_list_mismatch_Expected_s_W, sizeof(__pyx_k_Event_list_mismatch_Expected_s_W), 0, 0, 1, 0},
  {&__pyx_kp_s_Event_not_in_event_list_s, __pyx_k_Event_not_in_event_list_s, sizeof(__pyx_k_Event_not_in_event_list_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Huh_EVTL_s_C2E_s, __pyx_k_Huh_EVTL_s_C2E_s, sizeof(__pyx_k_Huh_EVTL_s_C2E_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Initial_event_with_bad_arrival_s, __pyx_k_Initial_event_with_bad_arrival_s, sizeof(__pyx_k_Initial_event_with_bad_arrival_s), 0, 0, 1, 0},
  {&__pyx_n_s_IntervalTreap, __pyx_k_IntervalTreap, sizeof(__pyx_k_IntervalTreap), 0, 0, 1, 1},
  {&__pyx_kp_s_Invalid_negative_service_time_s, __pyx_k_Invalid_negative_service_time_s, sizeof(__pyx_k_Invalid_negative_service_time_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Mismatched_arrivals_D_prev_s_A_s, __pyx_k_Mismatched_arrivals_D_prev_s_A_s, sizeof(__pyx_k_Mismatched_arrivals_D_prev_s_A_s), 0, 0, 1, 0},
  {&__pyx_n_s_N, __pyx_k_N, sizeof(__pyx_k_N), 0, 0, 1, 1},
  {&__pyx_kp_s_NA, __pyx_k_NA, sizeof(__pyx_k_NA), 0, 0, 1, 0},
  {&__pyx_kp_s_NINQ_wrong_does_not_contain_arri, __pyx_k_NINQ_wrong_does_not_contain_arri, sizeof(__pyx_k_NINQ_wrong_does_not_contain_arri), 0, 0, 1, 0},
  {&__pyx_kp_s_NINQ_wrong_does_not_contain_depa, __pyx_k_NINQ_wrong_does_not_contain_depa, sizeof(__pyx_k_NINQ_wrong_does_not_contain_depa), 0, 0, 1, 0},
  {&__pyx_kp_s_NO_TIMES, __pyx_k_NO_TIMES, sizeof(__pyx_k_NO_TIMES), 0, 0, 1, 0},
  {&__pyx_kp_s_Next_byq_pointers_don_t_match_s, __pyx_k_Next_byq_pointers_don_t_match_s, sizeof(__pyx_k_Next_byq_pointers_don_t_match_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Next_byt_pointers_don_t_match_FR, __pyx_k_Next_byt_pointers_don_t_match_FR, sizeof(__pyx_k_Next_byt_pointers_don_t_match_FR), 0, 0, 1, 0},
  {&__pyx_n_s_Ninq, __pyx_k_Ninq, sizeof(__pyx_k_Ninq), 0, 0, 1, 1},
  {&__pyx_n_s_None, __pyx_k_None, sizeof(__pyx_k_None), 0, 0, 1, 1},
  {&__pyx_kp_s_Prev_byq_pointers_don_t_match_s, __pyx_k_Prev_byq_pointers_don_t_match_s, sizeof(__pyx_k_Prev_byq_pointers_don_t_match_s), 0, 0, 1, 0},
  {&__pyx_kp_s_Prev_byt_pointers_don_t_match_s, __pyx_k_Prev_byt_pointers_don_t_match_s, sizeof(__pyx_k_Prev_byt_pointers_don_t_match_s), 0, 0, 1, 0},
  {&__pyx_kp_s_QUEUE_s_d, __pyx_k_QUEUE_s_d, sizeof(__pyx_k_QUEUE_s_d), 0, 0, 1, 0},
  {&__pyx_kp_s_QUEUE_s_d_2, __pyx_k_QUEUE_s_d_2, sizeof(__pyx_k_QUEUE_s_d_2), 0, 0, 1, 0},
  {&__pyx_n_s_QueuePS, __pyx_k_QueuePS, sizeof(__pyx_k_QueuePS), 0, 0, 1, 1},
  {&__pyx_n_s_SortedList, __pyx_k_SortedList, sizeof(__pyx_k_SortedList), 0, 0, 1, 1},
  {&__pyx_kp_s_TID_pointers_don_t_match_but_are, __pyx_k_TID_pointers_don_t_match_but_are, sizeof(__pyx_k_TID_pointers_don_t_match_but_are), 0, 0, 1, 0},
  {&__pyx_kp_s_TID_pointers_don_t_match_qnet_ha, __pyx_k_TID_pointers_don_t_match_qnet_ha, sizeof(__pyx_k_TID_pointers_don_t_match_qnet_ha), 0, 0, 1, 0},
  {&__pyx_kp_s_TIMES, __pyx_k_TIMES, sizeof(__pyx_k_TIMES), 0, 0, 1, 0},
  {&__pyx_kp_s_Users_csutton_research_projects, __pyx_k_Users_csutton_research_projects, sizeof(__pyx_k_Users_csutton_research_projects), 0, 0, 1, 0},
  {&__pyx_kp_s__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 0, 1, 0},
  {&__pyx_kp_s__4, __pyx_k__4, sizeof(__pyx_k__4), 0, 0, 1, 0},
  {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
  {&__pyx_n_s_a0, __pyx_k_a0, sizeof(__pyx_k_a0), 0, 0, 1, 1},
  {&__pyx_n_s_a1, __pyx_k_a1, sizeof(__pyx_k_a1), 0, 0, 1, 1},
  {&__pyx_kp_s_a_d, __pyx_k_a_d, sizeof(__pyx_k_a_d), 0, 0, 1, 0},
  {&__pyx_n_s_adapt_fn, __pyx_k_adapt_fn, sizeof(__pyx_k_adapt_fn), 0, 0, 1, 1},
  {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
  {&__pyx_n_s_add_birth_death, __pyx_k_add_birth_death, sizeof(__pyx_k_add_birth_death), 0, 0, 1, 1},
  {&__pyx_n_s_all_intersect, __pyx_k_all_intersect, sizeof(__pyx_k_all_intersect), 0, 0, 1, 1},
  {&__pyx_n_s_all_queues, __pyx_k_all_queues, sizeof(__pyx_k_all_queues), 0, 0, 1, 1},
  {&__pyx_n_s_all_true, __pyx_k_all_true, sizeof(__pyx_k_all_true), 0, 0, 1, 1},
  {&__pyx_n_s_allvars, __pyx_k_allvars, sizeof(__pyx_k_allvars), 0, 0, 1, 1},
  {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
  {&__pyx_n_s_arrivals, __pyx_k_arrivals, sizeof(__pyx_k_arrivals), 0, 0, 1, 1},
  {&__pyx_n_s_arrv, __pyx_k_arrv, sizeof(__pyx_k_arrv), 0, 0, 1, 1},
  {&__pyx_n_s_as_csv, __pyx_k_as_csv, sizeof(__pyx_k_as_csv), 0, 0, 1, 1},
  {&__pyx_n_s_aux, __pyx_k_aux, sizeof(__pyx_k_aux), 0, 0, 1, 1},
  {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
  {&__pyx_n_s_c0, __pyx_k_c0, sizeof(__pyx_k_c0), 0, 0, 1, 1},
  {&__pyx_n_s_c1, __pyx_k_c1, sizeof(__pyx_k_c1), 0, 0, 1, 1},
  {&__pyx_n_s_c2e, __pyx_k_c2e, sizeof(__pyx_k_c2e), 0, 0, 1, 1},
  {&__pyx_n_s_cap, __pyx_k_cap, sizeof(__pyx_k_cap), 0, 0, 1, 1},
  {&__pyx_n_s_check_commencement_cache, __pyx_k_check_commencement_cache, sizeof(__pyx_k_check_commencement_cache), 0, 0, 1, 1},
  {&__pyx_n_s_cmp, __pyx_k_cmp, sizeof(__pyx_k_cmp), 0, 0, 1, 1},
  {&__pyx_n_s_cmp_by_arrival, __pyx_k_cmp_by_arrival, sizeof(__pyx_k_cmp_by_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_cmp_by_departure, __pyx_k_cmp_by_departure, sizeof(__pyx_k_cmp_by_departure), 0, 0, 1, 1},
  {&__pyx_n_s_cninq, __pyx_k_cninq, sizeof(__pyx_k_cninq), 0, 0, 1, 1},
  {&__pyx_n_s_commencement, __pyx_k_commencement, sizeof(__pyx_k_commencement), 0, 0, 1, 1},
  {&__pyx_n_s_contains_arrival, __pyx_k_contains_arrival, sizeof(__pyx_k_contains_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_contains_departure, __pyx_k_contains_departure, sizeof(__pyx_k_contains_departure), 0, 0, 1, 1},
  {&__pyx_n_s_contains_key, __pyx_k_contains_key, sizeof(__pyx_k_contains_key), 0, 0, 1, 1},
  {&__pyx_n_s_contains_kv, __pyx_k_contains_kv, sizeof(__pyx_k_contains_kv), 0, 0, 1, 1},
  {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
  {&__pyx_n_s_d, __pyx_k_d, sizeof(__pyx_k_d), 0, 0, 1, 1},
  {&__pyx_n_s_d0, __pyx_k_d0, sizeof(__pyx_k_d0), 0, 0, 1, 1},
  {&__pyx_n_s_d1, __pyx_k_d1, sizeof(__pyx_k_d1), 0, 0, 1, 1},
  {&__pyx_kp_s_d_d, __pyx_k_d_d, sizeof(__pyx_k_d_d), 0, 0, 1, 0},
  {&__pyx_kp_s_d_d_d_5f_5f_5f_5f_d_d_d_d, __pyx_k_d_d_d_5f_5f_5f_5f_d_d_d_d, sizeof(__pyx_k_d_d_d_5f_5f_5f_5f_d_d_d_d), 0, 0, 1, 0},
  {&__pyx_n_s_diff_list, __pyx_k_diff_list, sizeof(__pyx_k_diff_list), 0, 0, 1, 1},
  {&__pyx_n_s_dump, __pyx_k_dump, sizeof(__pyx_k_dump), 0, 0, 1, 1},
  {&__pyx_n_s_duplicate, __pyx_k_duplicate, sizeof(__pyx_k_duplicate), 0, 0, 1, 1},
  {&__pyx_n_s_e, __pyx_k_e, sizeof(__pyx_k_e), 0, 0, 1, 1},
  {&__pyx_n_s_eid, __pyx_k_eid, sizeof(__pyx_k_eid), 0, 0, 1, 1},
  {&__pyx_n_s_end, __pyx_k_end, sizeof(__pyx_k_end), 0, 0, 1, 1},
  {&__pyx_n_s_events_of_qid, __pyx_k_events_of_qid, sizeof(__pyx_k_events_of_qid), 0, 0, 1, 1},
  {&__pyx_n_s_events_of_task, __pyx_k_events_of_task, sizeof(__pyx_k_events_of_task), 0, 0, 1, 1},
  {&__pyx_n_s_evt, __pyx_k_evt, sizeof(__pyx_k_evt), 0, 0, 1, 1},
  {&__pyx_n_s_evt_new, __pyx_k_evt_new, sizeof(__pyx_k_evt_new), 0, 0, 1, 1},
  {&__pyx_n_s_evt_old, __pyx_k_evt_old, sizeof(__pyx_k_evt_old), 0, 0, 1, 1},
  {&__pyx_n_s_evtl, __pyx_k_evtl, sizeof(__pyx_k_evtl), 0, 0, 1, 1},
  {&__pyx_n_s_file, __pyx_k_file, sizeof(__pyx_k_file), 0, 0, 1, 1},
  {&__pyx_n_s_final_arrival_by_qid, __pyx_k_final_arrival_by_qid, sizeof(__pyx_k_final_arrival_by_qid), 0, 0, 1, 1},
  {&__pyx_n_s_final_arrival_by_queue, __pyx_k_final_arrival_by_queue, sizeof(__pyx_k_final_arrival_by_queue), 0, 0, 1, 1},
  {&__pyx_n_s_find_next_byq, __pyx_k_find_next_byq, sizeof(__pyx_k_find_next_byq), 0, 0, 1, 1},
  {&__pyx_n_s_first_arrival_by_qid, __pyx_k_first_arrival_by_qid, sizeof(__pyx_k_first_arrival_by_qid), 0, 0, 1, 1},
  {&__pyx_n_s_fn, __pyx_k_fn, sizeof(__pyx_k_fn), 0, 0, 1, 1},
  {&__pyx_n_s_format_evt, __pyx_k_format_evt, sizeof(__pyx_k_format_evt), 0, 0, 1, 1},
  {&__pyx_n_s_get, __pyx_k_get, sizeof(__pyx_k_get), 0, 0, 1, 1},
  {&__pyx_n_s_get_arrival, __pyx_k_get_arrival, sizeof(__pyx_k_get_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_hmm, __pyx_k_hmm, sizeof(__pyx_k_hmm), 0, 0, 1, 1},
  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
  {&__pyx_n_s_in_range, __pyx_k_in_range, sizeof(__pyx_k_in_range), 0, 0, 1, 1},
  {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
  {&__pyx_n_s_initial_state, __pyx_k_initial_state, sizeof(__pyx_k_initial_state), 0, 0, 1, 1},
  {&__pyx_n_s_insert, __pyx_k_insert, sizeof(__pyx_k_insert), 0, 0, 1, 1},
  {&__pyx_n_s_iter, __pyx_k_iter, sizeof(__pyx_k_iter), 0, 0, 1, 1},
  {&__pyx_n_s_iteritems, __pyx_k_iteritems, sizeof(__pyx_k_iteritems), 0, 0, 1, 1},
  {&__pyx_n_s_iterkeys, __pyx_k_iterkeys, sizeof(__pyx_k_iterkeys), 0, 0, 1, 1},
  {&__pyx_n_s_ivltreap, __pyx_k_ivltreap, sizeof(__pyx_k_ivltreap), 0, 0, 1, 1},
  {&__pyx_n_s_join, __pyx_k_join, sizeof(__pyx_k_join), 0, 0, 1, 1},
  {&__pyx_n_s_keys, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
  {&__pyx_n_s_l, __pyx_k_l, sizeof(__pyx_k_l), 0, 0, 1, 1},
  {&__pyx_n_s_lik, __pyx_k_lik, sizeof(__pyx_k_lik), 0, 0, 1, 1},
  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
  {&__pyx_n_s_map, __pyx_k_map, sizeof(__pyx_k_map), 0, 0, 1, 1},
  {&__pyx_n_s_move_arrival, __pyx_k_move_arrival, sizeof(__pyx_k_move_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_move_departure, __pyx_k_move_departure, sizeof(__pyx_k_move_departure), 0, 0, 1, 1},
  {&__pyx_n_s_mytime, __pyx_k_mytime, sizeof(__pyx_k_mytime), 0, 0, 1, 1},
  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
  {&__pyx_n_s_net, __pyx_k_net, sizeof(__pyx_k_net), 0, 0, 1, 1},
  {&__pyx_n_s_netutils, __pyx_k_netutils, sizeof(__pyx_k_netutils), 0, 0, 1, 1},
  {&__pyx_n_s_ninqueue, __pyx_k_ninqueue, sizeof(__pyx_k_ninqueue), 0, 0, 1, 1},
  {&__pyx_n_s_not_in_set2, __pyx_k_not_in_set2, sizeof(__pyx_k_not_in_set2), 0, 0, 1, 1},
  {&__pyx_n_s_num_queues, __pyx_k_num_queues, sizeof(__pyx_k_num_queues), 0, 0, 1, 1},
  {&__pyx_n_s_num_tasks, __pyx_k_num_tasks, sizeof(__pyx_k_num_tasks), 0, 0, 1, 1},
  {&__pyx_n_s_num_vars, __pyx_k_num_vars, sizeof(__pyx_k_num_vars), 0, 0, 1, 1},
  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
  {&__pyx_n_s_obs_a, __pyx_k_obs_a, sizeof(__pyx_k_obs_a), 0, 0, 1, 1},
  {&__pyx_n_s_obs_d, __pyx_k_obs_d, sizeof(__pyx_k_obs_d), 0, 0, 1, 1},
  {&__pyx_n_s_other, __pyx_k_other, sizeof(__pyx_k_other), 0, 0, 1, 1},
  {&__pyx_n_s_pct, __pyx_k_pct, sizeof(__pyx_k_pct), 0, 0, 1, 1},
  {&__pyx_n_s_pop, __pyx_k_pop, sizeof(__pyx_k_pop), 0, 0, 1, 1},
  {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
  {&__pyx_n_s_print_exc, __pyx_k_print_exc, sizeof(__pyx_k_print_exc), 0, 0, 1, 1},
  {&__pyx_n_s_proc, __pyx_k_proc, sizeof(__pyx_k_proc), 0, 0, 1, 1},
  {&__pyx_n_s_pwfun, __pyx_k_pwfun, sizeof(__pyx_k_pwfun), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
  {&__pyx_n_s_q, __pyx_k_q, sizeof(__pyx_k_q), 0, 0, 1, 1},
  {&__pyx_n_s_qi, __pyx_k_qi, sizeof(__pyx_k_qi), 0, 0, 1, 1},
  {&__pyx_n_s_qid, __pyx_k_qid, sizeof(__pyx_k_qid), 0, 0, 1, 1},
  {&__pyx_n_s_qid_of_queue, __pyx_k_qid_of_queue, sizeof(__pyx_k_qid_of_queue), 0, 0, 1, 1},
  {&__pyx_n_s_queue_order, __pyx_k_queue_order, sizeof(__pyx_k_queue_order), 0, 0, 1, 1},
  {&__pyx_n_s_queues, __pyx_k_queues, sizeof(__pyx_k_queues), 0, 0, 1, 1},
  {&__pyx_n_s_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 0, 1, 1},
  {&__pyx_n_s_rand, __pyx_k_rand, sizeof(__pyx_k_rand), 0, 0, 1, 1},
  {&__pyx_n_s_random, __pyx_k_random, sizeof(__pyx_k_random), 0, 0, 1, 1},
  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
  {&__pyx_n_s_recompute_all_service, __pyx_k_recompute_all_service, sizeof(__pyx_k_recompute_all_service), 0, 0, 1, 1},
  {&__pyx_n_s_remove, __pyx_k_remove, sizeof(__pyx_k_remove), 0, 0, 1, 1},
  {&__pyx_n_s_report, __pyx_k_report, sizeof(__pyx_k_report), 0, 0, 1, 1},
  {&__pyx_n_s_reset_commencement, __pyx_k_reset_commencement, sizeof(__pyx_k_reset_commencement), 0, 0, 1, 1},
  {&__pyx_n_s_round, __pyx_k_round, sizeof(__pyx_k_round), 0, 0, 1, 1},
  {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
  {&__pyx_n_s_s_2, __pyx_k_s_2, sizeof(__pyx_k_s_2), 0, 0, 1, 1},
  {&__pyx_kp_s_s_3, __pyx_k_s_3, sizeof(__pyx_k_s_3), 0, 0, 1, 0},
  {&__pyx_kp_s_s_s, __pyx_k_s_s, sizeof(__pyx_k_s_s), 0, 0, 1, 0},
  {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
  {&__pyx_n_s_set, __pyx_k_set, sizeof(__pyx_k_set), 0, 0, 1, 1},
  {&__pyx_n_s_setup_inq_cache, __pyx_k_setup_inq_cache, sizeof(__pyx_k_setup_inq_cache), 0, 0, 1, 1},
  {&__pyx_n_s_sort, __pyx_k_sort, sizeof(__pyx_k_sort), 0, 0, 1, 1},
  {&__pyx_n_s_sort_by_arrival, __pyx_k_sort_by_arrival, sizeof(__pyx_k_sort_by_arrival), 0, 0, 1, 1},
  {&__pyx_n_s_sort_by_departure, __pyx_k_sort_by_departure, sizeof(__pyx_k_sort_by_departure), 0, 0, 1, 1},
  {&__pyx_n_s_state, __pyx_k_state, sizeof(__pyx_k_state), 0, 0, 1, 1},
  {&__pyx_n_s_stdout, __pyx_k_stdout, sizeof(__pyx_k_stdout), 0, 0, 1, 1},
  {&__pyx_n_s_subset, __pyx_k_subset, sizeof(__pyx_k_subset), 0, 0, 1, 1},
  {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
  {&__pyx_n_s_tid, __pyx_k_tid, sizeof(__pyx_k_tid), 0, 0, 1, 1},
  {&__pyx_n_s_traceback, __pyx_k_traceback, sizeof(__pyx_k_traceback), 0, 0, 1, 1},
  {&__pyx_n_s_update_arrival_cache, __pyx_k_update_arrival_cache, sizeof(__pyx_k_update_arrival_cache), 0, 0, 1, 1},
  {&__pyx_n_s_update_caches_for, __pyx_k_update_caches_for, sizeof(__pyx_k_update_caches_for), 0, 0, 1, 1},
  {&__pyx_n_s_update_commencement_cache, __pyx_k_update_commencement_cache, sizeof(__pyx_k_update_commencement_cache), 0, 0, 1, 1},
  {&__pyx_n_s_update_departure_caches, __pyx_k_update_departure_caches, sizeof(__pyx_k_update_departure_caches), 0, 0, 1, 1},
  {&__pyx_n_s_update_final_byq, __pyx_k_update_final_byq, sizeof(__pyx_k_update_final_byq), 0, 0, 1, 1},
  {&__pyx_n_s_update_inq_cache, __pyx_k_update_inq_cache, sizeof(__pyx_k_update_inq_cache), 0, 0, 1, 1},
  {&__pyx_n_s_update_ninq, __pyx_k_update_ninq, sizeof(__pyx_k_update_ninq), 0, 0, 1, 1},
  {&__pyx_n_s_val, __pyx_k_val, sizeof(__pyx_k_val), 0, 0, 1, 1},
  {&__pyx_n_s_validate, __pyx_k_validate, sizeof(__pyx_k_validate), 0, 0, 1, 1},
  {&__pyx_n_s_validate_caches, __pyx_k_validate_caches, sizeof(__pyx_k_validate_caches), 0, 0, 1, 1},
  {&__pyx_n_s_validate_service, __pyx_k_validate_service, sizeof(__pyx_k_validate_service), 0, 0, 1, 1},
  {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
  {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
  {&__pyx_n_s_var, __pyx_k_var, sizeof(__pyx_k_var), 0, 0, 1, 1},
  {&__pyx_n_s_wait, __pyx_k_wait, sizeof(__pyx_k_wait), 0, 0, 1, 1},
  {&__pyx_n_s_warn, __pyx_k_warn, sizeof(__pyx_k_warn), 0, 0, 1, 1},
  {&__pyx_n_s_warnings, __pyx_k_warnings, sizeof(__pyx_k_warnings), 0, 0, 1, 1},
  {&__pyx_n_s_when_clear, __pyx_k_when_clear, sizeof(__pyx_k_when_clear), 0, 0, 1, 1},
  {&__pyx_n_s_write, __pyx_k_write, sizeof(__pyx_k_write), 0, 0, 1, 1},
  {&__pyx_n_s_write_csv, __pyx_k_write_csv, sizeof(__pyx_k_write_csv), 0, 0, 1, 1},
  {&__pyx_n_s_xrange, __pyx_k_xrange, sizeof(__pyx_k_xrange), 0, 0, 1, 1},
  {&__pyx_n_s_zip, __pyx_k_zip, sizeof(__pyx_k_zip), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_round = __Pyx_GetBuiltinName(__pyx_n_s_round); if (!__pyx_builtin_round) __PYX_ERR(0, 196, __pyx_L1_error)
  __pyx_builtin_cmp = __Pyx_GetBuiltinName(__pyx_n_s_cmp); if (!__pyx_builtin_cmp) __PYX_ERR(0, 211, __pyx_L1_error)
  #if PY_MAJOR_VERSION >= 3
  __pyx_builtin_xrange = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_xrange) __PYX_ERR(0, 249, __pyx_L1_error)
  #else
  __pyx_builtin_xrange = __Pyx_GetBuiltinName(__pyx_n_s_xrange); if (!__pyx_builtin_xrange) __PYX_ERR(0, 249, __pyx_L1_error)
  #endif
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 257, __pyx_L1_error)
  __pyx_builtin_zip = __Pyx_GetBuiltinName(__pyx_n_s_zip); if (!__pyx_builtin_zip) __PYX_ERR(0, 810, __pyx_L1_error)
  __pyx_builtin_AssertionError = __Pyx_GetBuiltinName(__pyx_n_s_AssertionError); if (!__pyx_builtin_AssertionError) __PYX_ERR(0, 856, __pyx_L1_error)
  __pyx_builtin_map = __Pyx_GetBuiltinName(__pyx_n_s_map); if (!__pyx_builtin_map) __PYX_ERR(0, 881, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "arrivals.pyx":306
 * 
 *     def write_csv (self, f):
 *         f.write ("EID TID QID A D S W STATE PROC OBS_A OBS_D CMP\n")             # <<<<<<<<<<<<<<
 *         cdef Event evt
 *         for evt in self:
 */
  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_EID_TID_QID_A_D_S_W_STATE_PROC_O); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 306, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__5);
  __Pyx_GIVEREF(__pyx_tuple__5);

  /* "arrivals.pyx":313
 *                 f.write (" %s" % (evt.auxiliaries.get(k)))
 *             if evt.auxiliaries.num_vars() == 0:
 *                 f.write(" NA")             # <<<<<<<<<<<<<<
 *             f.write("\n")
 * 
 */
  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_NA); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 313, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__6);
  __Pyx_GIVEREF(__pyx_tuple__6);

  /* "arrivals.pyx":314
 *             if evt.auxiliaries.num_vars() == 0:
 *                 f.write(" NA")
 *             f.write("\n")             # <<<<<<<<<<<<<<
 * 
 *     def all_events (self):
 */
  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s__4); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__7);
  __Pyx_GIVEREF(__pyx_tuple__7);

  /* "arrivals.pyx":329
 *                 print e0
 *                 print visited.keys()
 *                 raise Exception ("Cycle!!!")             # <<<<<<<<<<<<<<
 *             visited[e0.eid] = True
 *             e0 = e0.prev_byq
 */
  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_Cycle); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 329, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__8);
  __Pyx_GIVEREF(__pyx_tuple__8);

  /* "arrivals.pyx":684
 *     # expensive
 *     def delete_task (self, tid):
 *         task_list = self.byt[tid][:]             # <<<<<<<<<<<<<<
 *         cdef Event evt, prev, next
 *         for evt in task_list:
 */
  __pyx_slice__9 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__9)) __PYX_ERR(0, 684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__9);
  __Pyx_GIVEREF(__pyx_slice__9);

  /* "arrivals.pyx":810
 *                qevts = self.events_of_qid (qi)
 *                for evt in qevts: evts_byq[evt.eid] = 1
 *                for evt0, evt1 in zip(qevts, qevts[1:]):             # <<<<<<<<<<<<<<
 *                     evts_byq[evt0.eid] = 1
 *                     evts_byq[evt1.eid] = 1
 */
  __pyx_slice__10 = PySlice_New(__pyx_int_1, Py_None, Py_None); if (unlikely(!__pyx_slice__10)) __PYX_ERR(0, 810, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__10);
  __Pyx_GIVEREF(__pyx_slice__10);

  /* "arrivals.pyx":821
 *             for tid, task_evts in self.byt.iteritems():
 *                 for evt in task_evts: evts_byt[evt.eid] = 1
 *                 for evt0, evt1 in zip(task_evts, task_evts[1:]):             # <<<<<<<<<<<<<<
 *                     assert evt0.next_byt == evt1, "Next_byt pointers don't match\nFROM   %s\nPOINTS  %s\nARRV   %s" % (evt0, evt0.next_byt, evt1)
 *                     assert evt1.prev_byt == evt0, "Prev_byt pointers don't match\n  %s\n  %s" % (evt0, evt1)
 */
  __pyx_slice__11 = PySlice_New(__pyx_int_1, Py_None, Py_None); if (unlikely(!__pyx_slice__11)) __PYX_ERR(0, 821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__11);
  __Pyx_GIVEREF(__pyx_slice__11);

  /* "arrivals.pyx":217
 * 
 * 
 * def sort_by_arrival (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_arrival)
 *     return evtl
 */
  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_n_s_evtl); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__12);
  __Pyx_GIVEREF(__pyx_tuple__12);
  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_sort_by_arrival, 217, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 217, __pyx_L1_error)

  /* "arrivals.pyx":221
 *     return evtl
 * 
 * def sort_by_departure (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_departure)
 *     return evtl
 */
  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_n_s_evtl); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 221, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__14);
  __Pyx_GIVEREF(__pyx_tuple__14);
  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_sort_by_departure, 221, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 221, __pyx_L1_error)

  /* "arrivals.pyx":225
 *     return evtl
 * 
 * def cmp_by_arrival (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.a, other.a)
 *     return cmp(self.d, other.d) if c == 0 else c
 */
  __pyx_tuple__16 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_c); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 225, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__16);
  __Pyx_GIVEREF(__pyx_tuple__16);
  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_cmp_by_arrival, 225, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 225, __pyx_L1_error)

  /* "arrivals.pyx":229
 *     return cmp(self.d, other.d) if c == 0 else c
 * 
 * def cmp_by_departure (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.d, other.d)
 *     return cmp(self.a, other.a) if c == 0 else c
 */
  __pyx_tuple__18 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_other, __pyx_n_s_c); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__18);
  __Pyx_GIVEREF(__pyx_tuple__18);
  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_cmp_by_departure, 229, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 229, __pyx_L1_error)

  /* "arrivals.pyx":235
 * 
 * 
 * def _get_arrival (evt): return (evt.a, evt.d)             # <<<<<<<<<<<<<<
 * 
 * BIG_N = 10000
 */
  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__20);
  __Pyx_GIVEREF(__pyx_tuple__20);
  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_get_arrival, 235, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 235, __pyx_L1_error)

  /* "arrivals.pyx":869
 *             if treap: treap.report()
 * 
 * def format_evt (evt):             # <<<<<<<<<<<<<<
 *     if evt is None:
 *         return "None"
 */
  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_n_s_evt); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 869, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__22);
  __Pyx_GIVEREF(__pyx_tuple__22);
  __pyx_codeobj__23 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__22, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_format_evt, 869, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__23)) __PYX_ERR(0, 869, __pyx_L1_error)

  /* "arrivals.pyx":877
 * EPS = 1e-5
 * 
 * def check_commencement_cache (Arrivals arrv):             # <<<<<<<<<<<<<<
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]
 */
  __pyx_tuple__24 = PyTuple_Pack(6, __pyx_n_s_arrv, __pyx_n_s_qi, __pyx_n_s_c2e, __pyx_n_s_evtl, __pyx_n_s_e, __pyx_n_s_c); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 877, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__24);
  __Pyx_GIVEREF(__pyx_tuple__24);
  __pyx_codeobj__25 = (PyObject*)__Pyx_PyCode_New(1, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Users_csutton_research_projects, __pyx_n_s_check_commencement_cache, 877, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 877, __pyx_L1_error)
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_InitGlobals(void) {
  __pyx_umethod_PyDict_Type_keys.type = (PyObject*)&PyDict_Type;
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_5 = PyFloat_FromDouble(1e-5); if (unlikely(!__pyx_float_1eneg_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_8 = PyFloat_FromDouble(1e-8); if (unlikely(!__pyx_float_1eneg_8)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_9 = PyInt_FromLong(9); if (unlikely(!__pyx_int_9)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_10000 = PyInt_FromLong(10000L); if (unlikely(!__pyx_int_10000)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initarrivals(void); /*proto*/
PyMODINIT_FUNC initarrivals(void)
#else
PyMODINIT_FUNC PyInit_arrivals(void); /*proto*/
PyMODINIT_FUNC PyInit_arrivals(void)
#endif
{
  PyObject *__pyx_t_1 = NULL;
  __Pyx_RefNannyDeclarations
  #if CYTHON_REFNANNY
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
  if (!__Pyx_RefNanny) {
      PyErr_Clear();
      __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
      if (!__Pyx_RefNanny)
          Py_FatalError("failed to import 'refnanny' module");
  }
  #endif
  __Pyx_RefNannySetupContext("PyMODINIT_FUNC PyInit_arrivals(void)", 0);
  if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pyx_CyFunction_USED
  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Coroutine_USED
  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_StopAsyncIteration_USED
  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("arrivals", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_d);
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
  #if CYTHON_COMPILING_IN_PYPY
  Py_INCREF(__pyx_b);
  #endif
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  /*--- Initialize various global constants etc. ---*/
  if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  if (__pyx_module_is_main_arrivals) {
    if (PyObject_SetAttrString(__pyx_m, "__name__", __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
    if (!PyDict_GetItemString(modules, "arrivals")) {
      if (unlikely(PyDict_SetItemString(modules, "arrivals", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Constants init code ---*/
  if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Global init code ---*/
  /*--- Variable export code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  __pyx_vtabptr_8arrivals_Event = &__pyx_vtable_8arrivals_Event;
  __pyx_vtable_8arrivals_Event.set_service = (PyObject *(*)(struct __pyx_obj_8arrivals_Event *, double))__pyx_f_8arrivals_5Event_set_service;
  __pyx_vtable_8arrivals_Event.set_departure = (PyObject *(*)(struct __pyx_obj_8arrivals_Event *, double))__pyx_f_8arrivals_5Event_set_departure;
  __pyx_vtable_8arrivals_Event.duplicate = (struct __pyx_obj_8arrivals_Event *(*)(struct __pyx_obj_8arrivals_Event *, int __pyx_skip_dispatch))__pyx_f_8arrivals_5Event_duplicate;
  __pyx_vtable_8arrivals_Event.dup_with_structure = (struct __pyx_obj_8arrivals_Event *(*)(struct __pyx_obj_8arrivals_Event *))__pyx_f_8arrivals_5Event_dup_with_structure;
  __pyx_vtable_8arrivals_Event.update_from_solution = (int (*)(struct __pyx_obj_8arrivals_Event *, PyObject *))__pyx_f_8arrivals_5Event_update_from_solution;
  __pyx_vtable_8arrivals_Event.copy_dtimes = (PyObject *(*)(struct __pyx_obj_8arrivals_Event *, struct __pyx_obj_8arrivals_Event *))__pyx_f_8arrivals_5Event_copy_dtimes;
  __pyx_vtable_8arrivals_Event.init_dtimes = (PyObject *(*)(struct __pyx_obj_8arrivals_Event *))__pyx_f_8arrivals_5Event_init_dtimes;
  __pyx_vtable_8arrivals_Event._dup_inner = (struct __pyx_obj_8arrivals_Event *(*)(struct __pyx_obj_8arrivals_Event *, int))__pyx_f_8arrivals_5Event__dup_inner;
  if (PyType_Ready(&__pyx_type_8arrivals_Event) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  __pyx_type_8arrivals_Event.tp_print = 0;
  if (__Pyx_SetVtable(__pyx_type_8arrivals_Event.tp_dict, __pyx_vtabptr_8arrivals_Event) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  if (PyObject_SetAttrString(__pyx_m, "Event", (PyObject *)&__pyx_type_8arrivals_Event) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  __pyx_ptype_8arrivals_Event = &__pyx_type_8arrivals_Event;
  __pyx_vtabptr_8arrivals_Arrivals = &__pyx_vtable_8arrivals_Arrivals;
  __pyx_vtable_8arrivals_Arrivals.event = (struct __pyx_obj_8arrivals_Event *(*)(struct __pyx_obj_8arrivals_Arrivals *, int, int __pyx_skip_dispatch))__pyx_f_8arrivals_8Arrivals_event;
  __pyx_vtable_8arrivals_Arrivals.num_events = (int (*)(struct __pyx_obj_8arrivals_Arrivals *, int __pyx_skip_dispatch))__pyx_f_8arrivals_8Arrivals_num_events;
  __pyx_vtable_8arrivals_Arrivals._is_initial = (PyObject *(*)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *))__pyx_f_8arrivals_8Arrivals__is_initial;
  __pyx_vtable_8arrivals_Arrivals._is_final = (PyObject *(*)(struct __pyx_obj_8arrivals_Arrivals *, struct __pyx_obj_8arrivals_Event *))__pyx_f_8arrivals_8Arrivals__is_final;
  if (PyType_Ready(&__pyx_type_8arrivals_Arrivals) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
  __pyx_type_8arrivals_Arrivals.tp_print = 0;
  #if CYTHON_COMPILING_IN_CPYTHON
  {
    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_8arrivals_Arrivals, "__init__"); if (unlikely(!wrapper)) __PYX_ERR(0, 240, __pyx_L1_error)
    if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
      __pyx_wrapperbase_8arrivals_8Arrivals___init__ = *((PyWrapperDescrObject *)wrapper)->d_base;
      __pyx_wrapperbase_8arrivals_8Arrivals___init__.doc = __pyx_doc_8arrivals_8Arrivals___init__;
      ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_8arrivals_8Arrivals___init__;
    }
  }
  #endif
  if (__Pyx_SetVtable(__pyx_type_8arrivals_Arrivals.tp_dict, __pyx_vtabptr_8arrivals_Arrivals) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
  if (PyObject_SetAttrString(__pyx_m, "Arrivals", (PyObject *)&__pyx_type_8arrivals_Arrivals) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
  __pyx_ptype_8arrivals_Arrivals = &__pyx_type_8arrivals_Arrivals;
  if (PyType_Ready(&__pyx_type_8arrivals_Vars) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __pyx_type_8arrivals_Vars.tp_print = 0;
  if (PyObject_SetAttrString(__pyx_m, "Vars", (PyObject *)&__pyx_type_8arrivals_Vars) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __pyx_ptype_8arrivals_Vars = &__pyx_type_8arrivals_Vars;
  /*--- Type import code ---*/
  __pyx_ptype_13distributions_Distribution = __Pyx_ImportType("distributions", "Distribution", sizeof(struct __pyx_obj_13distributions_Distribution), 1); if (unlikely(!__pyx_ptype_13distributions_Distribution)) __PYX_ERR(2, 1, __pyx_L1_error)
  __pyx_vtabptr_13distributions_Distribution = (struct __pyx_vtabstruct_13distributions_Distribution*)__Pyx_GetVtable(__pyx_ptype_13distributions_Distribution->tp_dict); if (unlikely(!__pyx_vtabptr_13distributions_Distribution)) __PYX_ERR(2, 1, __pyx_L1_error)
  __pyx_ptype_5pwfun_Pwfun = __Pyx_ImportType("pwfun", "Pwfun", sizeof(struct __pyx_obj_5pwfun_Pwfun), 1); if (unlikely(!__pyx_ptype_5pwfun_Pwfun)) __PYX_ERR(3, 1, __pyx_L1_error)
  __pyx_vtabptr_5pwfun_Pwfun = (struct __pyx_vtabstruct_5pwfun_Pwfun*)__Pyx_GetVtable(__pyx_ptype_5pwfun_Pwfun->tp_dict); if (unlikely(!__pyx_vtabptr_5pwfun_Pwfun)) __PYX_ERR(3, 1, __pyx_L1_error)
  __pyx_ptype_5pwfun_Pwlin = __Pyx_ImportType("pwfun", "Pwlin", sizeof(struct __pyx_obj_5pwfun_Pwlin), 1); if (unlikely(!__pyx_ptype_5pwfun_Pwlin)) __PYX_ERR(3, 16, __pyx_L1_error)
  __pyx_vtabptr_5pwfun_Pwlin = (struct __pyx_vtabstruct_5pwfun_Pwlin*)__Pyx_GetVtable(__pyx_ptype_5pwfun_Pwlin->tp_dict); if (unlikely(!__pyx_vtabptr_5pwfun_Pwlin)) __PYX_ERR(3, 16, __pyx_L1_error)
  __pyx_ptype_6queues_Queue = __Pyx_ImportType("queues", "Queue", sizeof(struct __pyx_obj_6queues_Queue), 1); if (unlikely(!__pyx_ptype_6queues_Queue)) __PYX_ERR(4, 1, __pyx_L1_error)
  __pyx_vtabptr_6queues_Queue = (struct __pyx_vtabstruct_6queues_Queue*)__Pyx_GetVtable(__pyx_ptype_6queues_Queue->tp_dict); if (unlikely(!__pyx_vtabptr_6queues_Queue)) __PYX_ERR(4, 1, __pyx_L1_error)
  __pyx_ptype_6queues_FactorTemplate = __Pyx_ImportType("queues", "FactorTemplate", sizeof(struct __pyx_obj_6queues_FactorTemplate), 1); if (unlikely(!__pyx_ptype_6queues_FactorTemplate)) __PYX_ERR(4, 12, __pyx_L1_error)
  __pyx_vtabptr_6queues_FactorTemplate = (struct __pyx_vtabstruct_6queues_FactorTemplate*)__Pyx_GetVtable(__pyx_ptype_6queues_FactorTemplate->tp_dict); if (unlikely(!__pyx_vtabptr_6queues_FactorTemplate)) __PYX_ERR(4, 12, __pyx_L1_error)
  __pyx_ptype_4qnet_Qnet = __Pyx_ImportType("qnet", "Qnet", sizeof(struct __pyx_obj_4qnet_Qnet), 1); if (unlikely(!__pyx_ptype_4qnet_Qnet)) __PYX_ERR(5, 1, __pyx_L1_error)
  __pyx_vtabptr_4qnet_Qnet = (struct __pyx_vtabstruct_4qnet_Qnet*)__Pyx_GetVtable(__pyx_ptype_4qnet_Qnet->tp_dict); if (unlikely(!__pyx_vtabptr_4qnet_Qnet)) __PYX_ERR(5, 1, __pyx_L1_error)
  /*--- Variable import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/
  #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
  if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif

  /* "arrivals.pyx":4
 * ##   This needs to be really fast
 * 
 * import warnings             # <<<<<<<<<<<<<<
 * import numpy
 * import sys
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_warnings, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_warnings, __pyx_t_1) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":5
 * 
 * import warnings
 * import numpy             # <<<<<<<<<<<<<<
 * import sys
 * import traceback
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_numpy, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":6
 * import warnings
 * import numpy
 * import sys             # <<<<<<<<<<<<<<
 * import traceback
 * import mytime
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":7
 * import numpy
 * import sys
 * import traceback             # <<<<<<<<<<<<<<
 * import mytime
 * import pwfun
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_traceback, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_traceback, __pyx_t_1) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":8
 * import sys
 * import traceback
 * import mytime             # <<<<<<<<<<<<<<
 * import pwfun
 * import hmm
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_mytime, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 8, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_mytime, __pyx_t_1) < 0) __PYX_ERR(0, 8, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":9
 * import traceback
 * import mytime
 * import pwfun             # <<<<<<<<<<<<<<
 * import hmm
 * import netutils
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_pwfun, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 9, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pwfun, __pyx_t_1) < 0) __PYX_ERR(0, 9, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":10
 * import mytime
 * import pwfun
 * import hmm             # <<<<<<<<<<<<<<
 * import netutils
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_hmm, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hmm, __pyx_t_1) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":11
 * import pwfun
 * import hmm
 * import netutils             # <<<<<<<<<<<<<<
 * 
 * from queues cimport Queue
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_netutils, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 11, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_netutils, __pyx_t_1) < 0) __PYX_ERR(0, 11, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":16
 * from qnet cimport Qnet
 * 
 * import queues             # <<<<<<<<<<<<<<
 * import cninq
 * import ninqueue
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_queues, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_queues, __pyx_t_1) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":17
 * 
 * import queues
 * import cninq             # <<<<<<<<<<<<<<
 * import ninqueue
 * import ivltreap
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_cninq, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cninq, __pyx_t_1) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":18
 * import queues
 * import cninq
 * import ninqueue             # <<<<<<<<<<<<<<
 * import ivltreap
 * 
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_ninqueue, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ninqueue, __pyx_t_1) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":19
 * import cninq
 * import ninqueue
 * import ivltreap             # <<<<<<<<<<<<<<
 * 
 * cimport cython
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_ivltreap, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ivltreap, __pyx_t_1) < 0) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":24
 * 
 * # arrival orders
 * ARRV_BY_A = 0             # <<<<<<<<<<<<<<
 * ARRV_BY_D = 1
 * 
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARRV_BY_A, __pyx_int_0) < 0) __PYX_ERR(0, 24, __pyx_L1_error)

  /* "arrivals.pyx":25
 * # arrival orders
 * ARRV_BY_A = 0
 * ARRV_BY_D = 1             # <<<<<<<<<<<<<<
 * 
 * cdef extern from "string.h":
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ARRV_BY_D, __pyx_int_1) < 0) __PYX_ERR(0, 25, __pyx_L1_error)

  /* "arrivals.pyx":217
 * 
 * 
 * def sort_by_arrival (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_arrival)
 *     return evtl
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_1sort_by_arrival, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sort_by_arrival, __pyx_t_1) < 0) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":221
 *     return evtl
 * 
 * def sort_by_departure (evtl):             # <<<<<<<<<<<<<<
 *     evtl.sort(cmp=cmp_by_departure)
 *     return evtl
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_3sort_by_departure, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 221, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sort_by_departure, __pyx_t_1) < 0) __PYX_ERR(0, 221, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":225
 *     return evtl
 * 
 * def cmp_by_arrival (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.a, other.a)
 *     return cmp(self.d, other.d) if c == 0 else c
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_5cmp_by_arrival, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cmp_by_arrival, __pyx_t_1) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":229
 *     return cmp(self.d, other.d) if c == 0 else c
 * 
 * def cmp_by_departure (self, other):             # <<<<<<<<<<<<<<
 *     c = cmp(self.d, other.d)
 *     return cmp(self.a, other.a) if c == 0 else c
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_7cmp_by_departure, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cmp_by_departure, __pyx_t_1) < 0) __PYX_ERR(0, 229, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":235
 * 
 * 
 * def _get_arrival (evt): return (evt.a, evt.d)             # <<<<<<<<<<<<<<
 * 
 * BIG_N = 10000
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_9_get_arrival, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_arrival, __pyx_t_1) < 0) __PYX_ERR(0, 235, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":237
 * def _get_arrival (evt): return (evt.a, evt.d)
 * 
 * BIG_N = 10000             # <<<<<<<<<<<<<<
 * 
 * @cython.final
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_BIG_N, __pyx_int_10000) < 0) __PYX_ERR(0, 237, __pyx_L1_error)

  /* "arrivals.pyx":243
 * 
 *     ## TODO: Are the python lists going to be fast enough?
 *     def __init__ (self, net, cap=BIG_N):             # <<<<<<<<<<<<<<
 *         """nq the number of queues in the net."""
 *         self.net = net
 */
  __pyx_t_1 = __Pyx_GetModuleGlobalName(__pyx_n_s_BIG_N); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 243, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_k__2 = __pyx_t_1;
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "arrivals.pyx":869
 *             if treap: treap.report()
 * 
 * def format_evt (evt):             # <<<<<<<<<<<<<<
 *     if evt is None:
 *         return "None"
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_11format_evt, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 869, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_format_evt, __pyx_t_1) < 0) __PYX_ERR(0, 869, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":875
 *         return evt.dump()
 * 
 * EPS = 1e-5             # <<<<<<<<<<<<<<
 * 
 * def check_commencement_cache (Arrivals arrv):
 */
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_EPS, __pyx_float_1eneg_5) < 0) __PYX_ERR(0, 875, __pyx_L1_error)

  /* "arrivals.pyx":877
 * EPS = 1e-5
 * 
 * def check_commencement_cache (Arrivals arrv):             # <<<<<<<<<<<<<<
 *     for qi in range(len(arrv.byq)):
 *         c2e = arrv.c2e_cache[qi]
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8arrivals_13check_commencement_cache, NULL, __pyx_n_s_arrivals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 877, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_check_commencement_cache, __pyx_t_1) < 0) __PYX_ERR(0, 877, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "arrivals.pyx":1
 * ##  Data structure for managing Arrivals.             # <<<<<<<<<<<<<<
 * ##   This needs to be really fast
 * 
 */
  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /*--- Wrapped vars code ---*/

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  if (__pyx_m) {
    if (__pyx_d) {
      __Pyx_AddTraceback("init arrivals", __pyx_clineno, __pyx_lineno, __pyx_filename);
    }
    Py_DECREF(__pyx_m); __pyx_m = 0;
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init arrivals");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

/* --- Runtime support code --- */
/* Refnanny */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule((char *)modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, (char *)"RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif

/* GetBuiltinName */
static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

/* RaiseDoubleKeywords */
static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

/* ParseKeywords */
static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_CheckExact(key)) || likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (PyUnicode_GET_SIZE(**name) != PyUnicode_GET_SIZE(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (PyUnicode_GET_SIZE(**argname) != PyUnicode_GET_SIZE(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

/* RaiseArgTupleInvalid */
static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

/* PyCFunctionFastCall */
#if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
    PyObject *self = PyCFunction_GET_SELF(func);
    assert(PyCFunction_Check(func));
    assert(METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST)));
    assert(nargs >= 0);
    assert(nargs == 0 || args != NULL);
    /* _PyCFunction_FastCallDict() must not be called with an exception set,
       because it may clear it (directly or indirectly) and so the
       caller loses its exception */
    assert(!PyErr_Occurred());
    return (*((__Pyx_PyCFunctionFast)meth)) (self, args, nargs, NULL);
}
#endif  // CYTHON_FAST_PYCCALL

/* PyFunctionFastCall */
#if CYTHON_FAST_PYCALL
#include "frameobject.h"
static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                               PyObject *globals) {
    PyFrameObject *f;
    PyThreadState *tstate = PyThreadState_GET();
    PyObject **fastlocals;
    Py_ssize_t i;
    PyObject *result;
    assert(globals != NULL);
    /* XXX Perhaps we should create a specialized
       PyFrame_New() that doesn't take locals, but does
       take builtins without sanity checking them.
       */
    assert(tstate != NULL);
    f = PyFrame_New(tstate, co, globals, NULL);
    if (f == NULL) {
        return NULL;
    }
    fastlocals = f->f_localsplus;
    for (i = 0; i < na; i++) {
        Py_INCREF(*args);
        fastlocals[i] = *args++;
    }
    result = PyEval_EvalFrameEx(f,0);
    ++tstate->recursion_depth;
    Py_DECREF(f);
    --tstate->recursion_depth;
    return result;
}
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, int nargs, PyObject *kwargs) {
    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
    PyObject *globals = PyFunction_GET_GLOBALS(func);
    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
    PyObject *closure;
#if PY_MAJOR_VERSION >= 3
    PyObject *kwdefs;
#endif
    PyObject *kwtuple, **k;
    PyObject **d;
    Py_ssize_t nd;
    Py_ssize_t nk;
    PyObject *result;
    assert(kwargs == NULL || PyDict_Check(kwargs));
    nk = kwargs ? PyDict_Size(kwargs) : 0;
    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
        return NULL;
    }
    if (
#if PY_MAJOR_VERSION >= 3
            co->co_kwonlyargcount == 0 &&
#endif
            likely(kwargs == NULL || nk == 0) &&
            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
        if (argdefs == NULL && co->co_argcount == nargs) {
            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
            goto done;
        }
        else if (nargs == 0 && argdefs != NULL
                 && co->co_argcount == Py_SIZE(argdefs)) {
            /* function called with no arguments, but all parameters have
               a default value: use default values as arguments .*/
            args = &PyTuple_GET_ITEM(argdefs, 0);
            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
            goto done;
        }
    }
    if (kwargs != NULL) {
        Py_ssize_t pos, i;
        kwtuple = PyTuple_New(2 * nk);
        if (kwtuple == NULL) {
            result = NULL;
            goto done;
        }
        k = &PyTuple_GET_ITEM(kwtuple, 0);
        pos = i = 0;
        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
            Py_INCREF(k[i]);
            Py_INCREF(k[i+1]);
            i += 2;
        }
        nk = i / 2;
    }
    else {
        kwtuple = NULL;
        k = NULL;
    }
    closure = PyFunction_GET_CLOSURE(func);
#if PY_MAJOR_VERSION >= 3
    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
#endif
    if (argdefs != NULL) {
        d = &PyTuple_GET_ITEM(argdefs, 0);
        nd = Py_SIZE(argdefs);
    }
    else {
        d = NULL;
        nd = 0;
    }
#if PY_MAJOR_VERSION >= 3
    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
                               args, nargs,
                               k, (int)nk,
                               d, (int)nd, kwdefs, closure);
#else
    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
                               args, nargs,
                               k, (int)nk,
                               d, (int)nd, closure);
#endif
    Py_XDECREF(kwtuple);
done:
    Py_LeaveRecursiveCall();
    return result;
}
#endif  // CPython < 3.6
#endif  // CYTHON_FAST_PYCALL

/* PyObjectCall */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *result;
    ternaryfunc call = func->ob_type->tp_call;
    if (unlikely(!call))
        return PyObject_Call(func, arg, kw);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = (*call)(func, arg, kw);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallMethO */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
    PyObject *self, *result;
    PyCFunction cfunc;
    cfunc = PyCFunction_GET_FUNCTION(func);
    self = PyCFunction_GET_SELF(func);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = cfunc(self, arg);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallOneArg */
#if CYTHON_COMPILING_IN_CPYTHON
static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_New(1);
    if (unlikely(!args)) return NULL;
    Py_INCREF(arg);
    PyTuple_SET_ITEM(args, 0, arg);
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, &arg, 1);
    }
#endif
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || PyObject_TypeCheck(func, __pyx_CyFunctionType))) {
#else
    if (likely(PyCFunction_Check(func))) {
#endif
        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
            return __Pyx_PyObject_CallMethO(func, arg);
#if CYTHON_FAST_PYCCALL
        } else if (PyCFunction_GET_FLAGS(func) & METH_FASTCALL) {
            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
#endif
        }
    }
    return __Pyx__PyObject_CallOneArg(func, arg);
}
#else
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_Pack(1, arg);
    if (unlikely(!args)) return NULL;
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
#endif

/* PyObjectCallNoArg */
  #if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, NULL, 0);
    }
#endif
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || PyObject_TypeCheck(func, __pyx_CyFunctionType))) {
#else
    if (likely(PyCFunction_Check(func))) {
#endif
        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
            return __Pyx_PyObject_CallMethO(func, NULL);
        }
    }
    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
}
#endif

/* ExtTypeTest */
    static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(PyObject_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

/* ArgTypeTest */
    static void __Pyx_RaiseArgumentTypeInvalid(const char* name, PyObject *obj, PyTypeObject *type) {
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
}
static CYTHON_INLINE int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (likely(Py_TYPE(obj) == type)) return 1;
        #if PY_MAJOR_VERSION == 2
        else if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(PyObject_TypeCheck(obj, type))) return 1;
    }
    __Pyx_RaiseArgumentTypeInvalid(name, obj, type);
    return 0;
}

/* PyIntBinop */
    #if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED int inplace) {
    if (op1 == op2) {
        Py_RETURN_TRUE;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        if (a == b) {
            Py_RETURN_TRUE;
        } else {
            Py_RETURN_FALSE;
        }
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a;
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                #if PyLong_SHIFT < 30 && PyLong_SHIFT != 15
                default: return PyLong_Type.tp_richcompare(op1, op2, Py_EQ);
                #else
                default: Py_RETURN_FALSE;
                #endif
            }
        }
            if (a == b) {
                Py_RETURN_TRUE;
            } else {
                Py_RETURN_FALSE;
            }
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            if ((double)a == (double)b) {
                Py_RETURN_TRUE;
            } else {
                Py_RETURN_FALSE;
            }
    }
    return PyObject_RichCompare(op1, op2, Py_EQ);
}
#endif

/* GetModuleGlobalName */
    static CYTHON_INLINE PyObject *__Pyx_GetModuleGlobalName(PyObject *name) {
    PyObject *result;
#if !CYTHON_AVOID_BORROWED_REFS
    result = PyDict_GetItem(__pyx_d, name);
    if (likely(result)) {
        Py_INCREF(result);
    } else {
#else
    result = PyObject_GetItem(__pyx_d, name);
    if (!result) {
        PyErr_Clear();
#endif
        result = __Pyx_GetBuiltinName(name);
    }
    return result;
}

/* PyObjectCallMethod1 */
      static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
    PyObject *method, *result = NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto done;
#if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(method))) {
        PyObject *self = PyMethod_GET_SELF(method);
        if (likely(self)) {
            PyObject *args;
            PyObject *function = PyMethod_GET_FUNCTION(method);
            #if CYTHON_FAST_PYCALL
            if (PyFunction_Check(function)) {
                PyObject *args[2] = {self, arg};
                result = __Pyx_PyFunction_FastCall(function, args, 2);
                goto done;
            }
            #endif
            #if CYTHON_FAST_PYCCALL
            if (__Pyx_PyFastCFunction_Check(function)) {
                PyObject *args[2] = {self, arg};
                result = __Pyx_PyCFunction_FastCall(function, args, 2);
                goto done;
            }
            #endif
            args = PyTuple_New(2);
            if (unlikely(!args)) goto done;
            Py_INCREF(self);
            PyTuple_SET_ITEM(args, 0, self);
            Py_INCREF(arg);
            PyTuple_SET_ITEM(args, 1, arg);
            Py_INCREF(function);
            Py_DECREF(method); method = NULL;
            result = __Pyx_PyObject_Call(function, args, NULL);
            Py_DECREF(args);
            Py_DECREF(function);
            return result;
        }
    }
#endif
    result = __Pyx_PyObject_CallOneArg(method, arg);
done:
    Py_XDECREF(method);
    return result;
}

/* append */
      static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
    } else {
        PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
        if (unlikely(!retval))
            return -1;
        Py_DECREF(retval);
    }
    return 0;
}

/* SetItemInt */
      static CYTHON_INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int is_list,
                                               CYTHON_NCP_UNUSED int wraparound, CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
        if ((!boundscheck) || likely((n >= 0) & (n < PyList_GET_SIZE(o)))) {
            PyObject* old = PyList_GET_ITEM(o, n);
            Py_INCREF(v);
            PyList_SET_ITEM(o, n, v);
            Py_DECREF(old);
            return 1;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_ass_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return -1;
                    PyErr_Clear();
                }
            }
            return m->sq_ass_item(o, i, v);
        }
    }
#else
#if CYTHON_COMPILING_IN_PYPY
    if (is_list || (PySequence_Check(o) && !PyDict_Check(o))) {
#else
    if (is_list || PySequence_Check(o)) {
#endif
        return PySequence_SetItem(o, i, v);
    }
#endif
    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
}

/* GetItemInt */
        static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (wraparound & unlikely(i < 0)) i += PyList_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (wraparound & unlikely(i < 0)) i += PyTuple_GET_SIZE(o);
    if ((!boundscheck) || likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
                                                     CYTHON_NCP_UNUSED int wraparound,
                                                     CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely((n >= 0) & (n < PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely((n >= 0) & (n < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return NULL;
                    PyErr_Clear();
                }
            }
            return m->sq_item(o, i);
        }
    }
#else
    if (is_list || PySequence_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

/* UnpackUnboundCMethod */
        static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
    PyObject *method;
    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
    if (unlikely(!method))
        return -1;
    target->method = method;
#if CYTHON_COMPILING_IN_CPYTHON
    #if PY_MAJOR_VERSION >= 3
    if (likely(PyObject_TypeCheck(method, &PyMethodDescr_Type)))
    #endif
    {
        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
        target->func = descr->d_method->ml_meth;
        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST);
    }
#endif
    return 0;
}

/* CallUnboundCMethod0 */
        static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self) {
    PyObject *args, *result = NULL;
    if (unlikely(!cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
#if CYTHON_ASSUME_SAFE_MACROS
    args = PyTuple_New(1);
    if (unlikely(!args)) goto bad;
    Py_INCREF(self);
    PyTuple_SET_ITEM(args, 0, self);
#else
    args = PyTuple_Pack(1, self);
    if (unlikely(!args)) goto bad;
#endif
    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
    Py_DECREF(args);
bad:
    return result;
}

/* py_dict_keys */
        static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d) {
    if (PY_MAJOR_VERSION >= 3)
        return __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyDict_Type_keys, d);
    else
        return PyDict_Keys(d);
}

/* PyErrFetchRestore */
        #if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}
#endif

/* RaiseException */
        #if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    __Pyx_PyThreadState_declare
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    if (PyType_Check(type)) {
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
    }
    __Pyx_PyThreadState_assign
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                int is_subclass = PyObject_IsSubclass(instance_class, type);
                if (!is_subclass) {
                    instance_class = NULL;
                } else if (unlikely(is_subclass == -1)) {
                    goto bad;
                } else {
                    type = instance_class;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
#if PY_VERSION_HEX >= 0x03030000
    if (cause) {
#else
    if (cause && cause != Py_None) {
#endif
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
#if CYTHON_COMPILING_IN_PYPY
        PyObject *tmp_type, *tmp_value, *tmp_tb;
        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
        Py_INCREF(tb);
        PyErr_Restore(tmp_type, tmp_value, tb);
        Py_XDECREF(tmp_tb);
#else
        PyThreadState *tstate = PyThreadState_GET();
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
#endif
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

/* WriteUnraisableException */
          static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
                                  int full_traceback, CYTHON_UNUSED int nogil) {
    PyObject *old_exc, *old_val, *old_tb;
    PyObject *ctx;
    __Pyx_PyThreadState_declare
#ifdef WITH_THREAD
    PyGILState_STATE state;
    if (nogil)
        state = PyGILState_Ensure();
#ifdef _MSC_VER
    else state = (PyGILState_STATE)-1;
#endif
#endif
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
    if (full_traceback) {
        Py_XINCREF(old_exc);
        Py_XINCREF(old_val);
        Py_XINCREF(old_tb);
        __Pyx_ErrRestore(old_exc, old_val, old_tb);
        PyErr_PrintEx(1);
    }
    #if PY_MAJOR_VERSION < 3
    ctx = PyString_FromString(name);
    #else
    ctx = PyUnicode_FromString(name);
    #endif
    __Pyx_ErrRestore(old_exc, old_val, old_tb);
    if (!ctx) {
        PyErr_WriteUnraisable(Py_None);
    } else {
        PyErr_WriteUnraisable(ctx);
        Py_DECREF(ctx);
    }
#ifdef WITH_THREAD
    if (nogil)
        PyGILState_Release(state);
#endif
}

/* PyIntBinop */
          #if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, CYTHON_UNUSED int inplace) {
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            x = (long)((unsigned long)a + b);
            if (likely((x^a) >= 0 || (x^b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_add(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
            }
        }
                x = a + b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla + llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            PyFPE_START_PROTECT("add", return NULL)
            result = ((double)a) + (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
}
#endif

/* SliceObject */
          static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
        Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
#if CYTHON_USE_TYPE_SLOTS
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                    goto bad;
                PyErr_Clear();
            }
        }
        return ms->sq_slice(obj, cstart, cstop);
    }
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_subscript))
#endif
    {
        PyObject* result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_USE_TYPE_SLOTS
        result = mp->mp_subscript(obj, py_slice);
#else
        result = PyObject_GetItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    PyErr_Format(PyExc_TypeError,
        "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
bad:
    return NULL;
}

/* pop_index */
          static PyObject* __Pyx__PyObject_PopNewIndex(PyObject* L, PyObject* py_ix) {
    PyObject *r;
    if (unlikely(!py_ix)) return NULL;
    r = __Pyx__PyObject_PopIndex(L, py_ix);
    Py_DECREF(py_ix);
    return r;
}
static PyObject* __Pyx__PyObject_PopIndex(PyObject* L, PyObject* py_ix) {
    return __Pyx_PyObject_CallMethod1(L, __pyx_n_s_pop, py_ix);
}
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static PyObject* __Pyx__PyList_PopIndex(PyObject* L, PyObject* py_ix, Py_ssize_t ix) {
    Py_ssize_t size = PyList_GET_SIZE(L);
    if (likely(size > (((PyListObject*)L)->allocated >> 1))) {
        Py_ssize_t cix = ix;
        if (cix < 0) {
            cix += size;
        }
        if (likely(0 <= cix && cix < size)) {
            PyObject* v = PyList_GET_ITEM(L, cix);
            Py_SIZE(L) -= 1;
            size -= 1;
            memmove(&PyList_GET_ITEM(L, cix), &PyList_GET_ITEM(L, cix+1), (size_t)(size-cix)*sizeof(PyObject*));
            return v;
        }
    }
    if (py_ix == Py_None) {
        return __Pyx__PyObject_PopNewIndex(L, PyInt_FromSsize_t(ix));
    } else {
        return __Pyx__PyObject_PopIndex(L, py_ix);
    }
}
#endif

/* IterFinish */
          static CYTHON_INLINE int __Pyx_IterFinish(void) {
#if CYTHON_FAST_THREAD_STATE
    PyThreadState *tstate = PyThreadState_GET();
    PyObject* exc_type = tstate->curexc_type;
    if (unlikely(exc_type)) {
        if (likely(exc_type == PyExc_StopIteration) || PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)) {
            PyObject *exc_value, *exc_tb;
            exc_value = tstate->curexc_value;
            exc_tb = tstate->curexc_traceback;
            tstate->curexc_type = 0;
            tstate->curexc_value = 0;
            tstate->curexc_traceback = 0;
            Py_DECREF(exc_type);
            Py_XDECREF(exc_value);
            Py_XDECREF(exc_tb);
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#else
    if (unlikely(PyErr_Occurred())) {
        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
            PyErr_Clear();
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#endif
}

/* PyObjectCallMethod0 */
          static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
    PyObject *method, *result = NULL;
    method = __Pyx_PyObject_GetAttrStr(obj, method_name);
    if (unlikely(!method)) goto bad;
#if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(method))) {
        PyObject *self = PyMethod_GET_SELF(method);
        if (likely(self)) {
            PyObject *function = PyMethod_GET_FUNCTION(method);
            result = __Pyx_PyObject_CallOneArg(function, self);
            Py_DECREF(method);
            return result;
        }
    }
#endif
    result = __Pyx_PyObject_CallNoArg(method);
    Py_DECREF(method);
bad:
    return result;
}

/* RaiseNeedMoreValuesToUnpack */
          static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                 index, (index == 1) ? "" : "s");
}

/* RaiseTooManyValuesToUnpack */
          static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
    PyErr_Format(PyExc_ValueError,
                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
}

/* UnpackItemEndCheck */
          static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
    if (unlikely(retval)) {
        Py_DECREF(retval);
        __Pyx_RaiseTooManyValuesError(expected);
        return -1;
    } else {
        return __Pyx_IterFinish();
    }
    return 0;
}

/* RaiseNoneIterError */
          static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
}

/* UnpackTupleError */
          static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
    if (t == Py_None) {
      __Pyx_RaiseNoneNotIterableError();
    } else if (PyTuple_GET_SIZE(t) < index) {
      __Pyx_RaiseNeedMoreValuesError(PyTuple_GET_SIZE(t));
    } else {
      __Pyx_RaiseTooManyValuesError(index);
    }
}

/* UnpackTuple2 */
          static CYTHON_INLINE int __Pyx_unpack_tuple2(PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2,
                                             int is_tuple, int has_known_size, int decref_tuple) {
    Py_ssize_t index;
    PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
    if (!is_tuple && unlikely(!PyTuple_Check(tuple))) {
        iternextfunc iternext;
        iter = PyObject_GetIter(tuple);
        if (unlikely(!iter)) goto bad;
        if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
        iternext = Py_TYPE(iter)->tp_iternext;
        value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
        value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
        if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
        Py_DECREF(iter);
    } else {
        if (!has_known_size && unlikely(PyTuple_GET_SIZE(tuple) != 2)) {
            __Pyx_UnpackTupleError(tuple, 2);
            goto bad;
        }
#if CYTHON_COMPILING_IN_PYPY
        value1 = PySequence_ITEM(tuple, 0);
        if (unlikely(!value1)) goto bad;
        value2 = PySequence_ITEM(tuple, 1);
        if (unlikely(!value2)) goto bad;
#else
        value1 = PyTuple_GET_ITEM(tuple, 0);
        value2 = PyTuple_GET_ITEM(tuple, 1);
        Py_INCREF(value1);
        Py_INCREF(value2);
#endif
        if (decref_tuple) { Py_DECREF(tuple); }
    }
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
unpacking_failed:
    if (!has_known_size && __Pyx_IterFinish() == 0)
        __Pyx_RaiseNeedMoreValuesError(index);
bad:
    Py_XDECREF(iter);
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
}

/* dict_iter */
          static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* iterable, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_source_is_dict) {
    is_dict = is_dict || likely(PyDict_CheckExact(iterable));
    *p_source_is_dict = is_dict;
#if !CYTHON_COMPILING_IN_PYPY
    if (is_dict) {
        *p_orig_length = PyDict_Size(iterable);
        Py_INCREF(iterable);
        return iterable;
    }
#endif
    *p_orig_length = 0;
    if (method_name) {
        PyObject* iter;
        iterable = __Pyx_PyObject_CallMethod0(iterable, method_name);
        if (!iterable)
            return NULL;
#if !CYTHON_COMPILING_IN_PYPY
        if (PyTuple_CheckExact(iterable) || PyList_CheckExact(iterable))
            return iterable;
#endif
        iter = PyObject_GetIter(iterable);
        Py_DECREF(iterable);
        return iter;
    }
    return PyObject_GetIter(iterable);
}
static CYTHON_INLINE int __Pyx_dict_iter_next(
        PyObject* iter_obj, CYTHON_NCP_UNUSED Py_ssize_t orig_length, CYTHON_NCP_UNUSED Py_ssize_t* ppos,
        PyObject** pkey, PyObject** pvalue, PyObject** pitem, int source_is_dict) {
    PyObject* next_item;
#if !CYTHON_COMPILING_IN_PYPY
    if (source_is_dict) {
        PyObject *key, *value;
        if (unlikely(orig_length != PyDict_Size(iter_obj))) {
            PyErr_SetString(PyExc_RuntimeError, "dictionary changed size during iteration");
            return -1;
        }
        if (unlikely(!PyDict_Next(iter_obj, ppos, &key, &value))) {
            return 0;
        }
        if (pitem) {
            PyObject* tuple = PyTuple_New(2);
            if (unlikely(!tuple)) {
                return -1;
            }
            Py_INCREF(key);
            Py_INCREF(value);
            PyTuple_SET_ITEM(tuple, 0, key);
            PyTuple_SET_ITEM(tuple, 1, value);
            *pitem = tuple;
        } else {
            if (pkey) {
                Py_INCREF(key);
                *pkey = key;
            }
            if (pvalue) {
                Py_INCREF(value);
                *pvalue = value;
            }
        }
        return 1;
    } else if (PyTuple_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyTuple_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyTuple_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else if (PyList_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyList_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyList_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else
#endif
    {
        next_item = PyIter_Next(iter_obj);
        if (unlikely(!next_item)) {
            return __Pyx_IterFinish();
        }
    }
    if (pitem) {
        *pitem = next_item;
    } else if (pkey && pvalue) {
        if (__Pyx_unpack_tuple2(next_item, pkey, pvalue, source_is_dict, source_is_dict, 1))
            return -1;
    } else if (pkey) {
        *pkey = next_item;
    } else {
        *pvalue = next_item;
    }
    return 1;
}

/* SaveResetException */
          #if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
#endif

/* PyErrExceptionMatches */
          #if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
    PyObject *exc_type = tstate->curexc_type;
    if (exc_type == err) return 1;
    if (unlikely(!exc_type)) return 0;
    return PyErr_GivenExceptionMatches(exc_type, err);
}
#endif

/* GetException */
          #if CYTHON_FAST_THREAD_STATE
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
#endif
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_FAST_THREAD_STATE
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_FAST_THREAD_STATE
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_FAST_THREAD_STATE
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

/* StringJoin */
            #if !CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values) {
    return PyObject_CallMethodObjArgs(sep, __pyx_n_s_join, values, NULL);
}
#endif

/* SetVTable */
            static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX >= 0x02070000
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#else
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItem(dict, __pyx_n_s_pyx_vtable, ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

/* GetVTable */
            static void* __Pyx_GetVtable(PyObject *dict) {
    void* ptr;
    PyObject *ob = PyObject_GetItem(dict, __pyx_n_s_pyx_vtable);
    if (!ob)
        goto bad;
#if PY_VERSION_HEX >= 0x02070000
    ptr = PyCapsule_GetPointer(ob, 0);
#else
    ptr = PyCObject_AsVoidPtr(ob);
#endif
    if (!ptr && !PyErr_Occurred())
        PyErr_SetString(PyExc_RuntimeError, "invalid vtable found for imported type");
    Py_DECREF(ob);
    return ptr;
bad:
    Py_XDECREF(ob);
    return NULL;
}

/* Import */
            static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_VERSION_HEX < 0x03030000
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.')) {
                #if PY_VERSION_HEX < 0x03030000
                PyObject *py_level = PyInt_FromLong(1);
                if (!py_level)
                    goto bad;
                module = PyObject_CallFunctionObjArgs(py_import,
                    name, global_dict, empty_dict, list, py_level, NULL);
                Py_DECREF(py_level);
                #else
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                #endif
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0;
        }
        #endif
        if (!module) {
            #if PY_VERSION_HEX < 0x03030000
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
bad:
    #if PY_VERSION_HEX < 0x03030000
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

/* CodeObjectCache */
            static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = start + (end - start) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, (size_t)new_max*sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

/* AddTraceback */
            #include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,
        0,
        0,
        0,
        0,
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    py_code = __pyx_find_code_object(c_line ? c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? c_line : py_line, py_code);
    }
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        __pyx_d,      /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

/* CIntFromPyVerify */
            #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
    {\
        func_type value = func_value;\
        if (sizeof(target_type) < sizeof(func_type)) {\
            if (unlikely(value != (func_type) (target_type) value)) {\
                func_type zero = 0;\
                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
                    return (target_type) -1;\
                if (is_unsigned && unlikely(value < zero))\
                    goto raise_neg_overflow;\
                else\
                    goto raise_overflow;\
            }\
        }\
        return (target_type) value;\
    }

/* CIntToPy */
            static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
    const int neg_one = (int) -1, const_zero = (int) 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(int),
                                     little, !is_unsigned);
    }
}

/* CIntToPy */
            static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
    const long neg_one = (long) -1, const_zero = (long) 0;
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
    }
}

/* Print */
            #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject((char *)"stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}
static int __Pyx_Print(PyObject* f, PyObject *arg_tuple, int newline) {
    int i;
    if (!f) {
        if (!(f = __Pyx_GetStdout()))
            return -1;
    }
    Py_INCREF(f);
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        PyObject* v;
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                goto error;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            goto error;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0) {
                switch (s[len-1]) {
                    case ' ': break;
                    case '\f': case '\r': case '\n': case '\t': case '\v':
                        PyFile_SoftSpace(f, 0);
                        break;
                    default:  break;
                }
            }
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            goto error;
        PyFile_SoftSpace(f, 0);
    }
    Py_DECREF(f);
    return 0;
error:
    Py_DECREF(f);
    return -1;
}
#else
static int __Pyx_Print(PyObject* stream, PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (unlikely(!__pyx_print)) {
        __pyx_print = PyObject_GetAttr(__pyx_b, __pyx_n_s_print);
        if (!__pyx_print)
            return -1;
    }
    if (stream) {
        kwargs = PyDict_New();
        if (unlikely(!kwargs))
            return -1;
        if (unlikely(PyDict_SetItem(kwargs, __pyx_n_s_file, stream) < 0))
            goto bad;
        if (!newline) {
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (unlikely(!end_string))
                goto bad;
            if (PyDict_SetItem(kwargs, __pyx_n_s_end, end_string) < 0) {
                Py_DECREF(end_string);
                goto bad;
            }
            Py_DECREF(end_string);
        }
    } else if (!newline) {
        if (unlikely(!__pyx_print_kwargs)) {
            __pyx_print_kwargs = PyDict_New();
            if (unlikely(!__pyx_print_kwargs))
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (unlikely(!end_string))
                return -1;
            if (PyDict_SetItem(__pyx_print_kwargs, __pyx_n_s_end, end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (unlikely(kwargs) && (kwargs != __pyx_print_kwargs))
        Py_DECREF(kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
bad:
    if (kwargs != __pyx_print_kwargs)
        Py_XDECREF(kwargs);
    return -1;
}
#endif

/* CIntFromPy */
            static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
    const int neg_one = (int) -1, const_zero = (int) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(int) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (int) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(int) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(int) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            int val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to int");
    return (int) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to int");
    return (int) -1;
}

/* PrintOne */
            #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION < 3
static int __Pyx_PrintOne(PyObject* f, PyObject *o) {
    if (!f) {
        if (!(f = __Pyx_GetStdout()))
            return -1;
    }
    Py_INCREF(f);
    if (PyFile_SoftSpace(f, 0)) {
        if (PyFile_WriteString(" ", f) < 0)
            goto error;
    }
    if (PyFile_WriteObject(o, f, Py_PRINT_RAW) < 0)
        goto error;
    if (PyFile_WriteString("\n", f) < 0)
        goto error;
    Py_DECREF(f);
    return 0;
error:
    Py_DECREF(f);
    return -1;
    /* the line below is just to avoid C compiler
     * warnings about unused functions */
    return __Pyx_Print(f, NULL, 0);
}
#else
static int __Pyx_PrintOne(PyObject* stream, PyObject *o) {
    int res;
    PyObject* arg_tuple = PyTuple_Pack(1, o);
    if (unlikely(!arg_tuple))
        return -1;
    res = __Pyx_Print(stream, arg_tuple, 1);
    Py_DECREF(arg_tuple);
    return res;
}
#endif

/* CIntFromPy */
            static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
    const long neg_one = (long) -1, const_zero = (long) 0;
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (long) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            long val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to long");
    return (long) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to long");
    return (long) -1;
}

/* CheckBinaryVersion */
            static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        return PyErr_WarnEx(NULL, message, 1);
    }
    return 0;
}

/* ModuleImport */
            #ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(const char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;
    py_name = __Pyx_PyIdentifier_FromString(name);
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

/* TypeImport */
            #ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class_name,
    size_t size, int strict)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;
    char warning[200];
    Py_ssize_t basicsize;
#ifdef Py_LIMITED_API
    PyObject *py_basicsize;
#endif
    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    py_name = __Pyx_PyIdentifier_FromString(class_name);
    if (!py_name)
        goto bad;
    result = PyObject_GetAttr(py_module, py_name);
    Py_DECREF(py_name);
    py_name = 0;
    Py_DECREF(py_module);
    py_module = 0;
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s.%.200s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifndef Py_LIMITED_API
    basicsize = ((PyTypeObject *)result)->tp_basicsize;
#else
    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
    if (!py_basicsize)
        goto bad;
    basicsize = PyLong_AsSsize_t(py_basicsize);
    Py_DECREF(py_basicsize);
    py_basicsize = 0;
    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
        goto bad;
#endif
    if (!strict && (size_t)basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning),
            "%s.%s size changed, may indicate binary incompatibility. Expected %zd, got %zd",
            module_name, class_name, basicsize, size);
        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
    }
    else if ((size_t)basicsize != size) {
        PyErr_Format(PyExc_ValueError,
            "%.200s.%.200s has the wrong size, try recompiling. Expected %zd, got %zd",
            module_name, class_name, basicsize, size);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_module);
    Py_XDECREF(result);
    return NULL;
}
#endif

/* InitStrings */
            static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
}
static CYTHON_INLINE char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
static CYTHON_INLINE char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if CYTHON_COMPILING_IN_CPYTHON && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
#if PY_VERSION_HEX < 0x03030000
        char* defenc_c;
        PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
        if (!defenc) return NULL;
        defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        {
            char* end = defenc_c + PyBytes_GET_SIZE(defenc);
            char* c;
            for (c = defenc_c; c < end; c++) {
                if ((unsigned char) (*c) >= 128) {
                    PyUnicode_AsASCIIString(o);
                    return NULL;
                }
            }
        }
#endif
        *length = PyBytes_GET_SIZE(defenc);
        return defenc_c;
#else
        if (__Pyx_PyUnicode_READY(o) == -1) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
        if (PyUnicode_IS_ASCII(o)) {
            *length = PyUnicode_GET_LENGTH(o);
            return PyUnicode_AsUTF8(o);
        } else {
            PyUnicode_AsASCIIString(o);
            return NULL;
        }
#else
        return PyUnicode_AsUTF8AndSize(o, length);
#endif
#endif
    } else
#endif
#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
#if CYTHON_USE_TYPE_SLOTS
  PyNumberMethods *m;
#endif
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return __Pyx_NewRef(x);
#if CYTHON_USE_TYPE_SLOTS
  m = Py_TYPE(x)->tp_as_number;
  #if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
  #else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
  #endif
#else
  res = PyNumber_Int(x);
#endif
  if (res) {
#if PY_MAJOR_VERSION < 3
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%.4s__ returned non-%.4s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b))) {
    if (sizeof(Py_ssize_t) >= sizeof(long))
        return PyInt_AS_LONG(b);
    else
        return PyInt_AsSsize_t(x);
  }
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_USE_PYLONG_INTERNALS
    const digit* digits = ((PyLongObject*)b)->ob_digit;
    const Py_ssize_t size = Py_SIZE(b);
    if (likely(__Pyx_sst_abs(size) <= 1)) {
        ival = likely(size) ? digits[0] : 0;
        if (size == -1) ival = -ival;
        return ival;
    } else {
      switch (size) {
         case 2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
      }
    }
    #endif
    return PyLong_AsSsize_t(b);
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
    return PyInt_FromSize_t(ival);
}


#endif /* Py_PYTHON_H */
